!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t=t||self).Milque={})}(this,function(t){"use strict";var e=new Map,n={id:null,canvas:null};function r(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(e.has(t)){var r=e.get(t);n.id=t,n.canvas=r}else i()}function i(){n.id=null,n.canvas=null}var o=Object.freeze({VIEW:n,attach:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;i?(e.set(i,t),n.canvas||r(i)):(t||((t=document.createElement("canvas")).setAttribute("width",640),t.setAttribute("height",480),document.body.appendChild(t)),e.set(null,t),r(null))},detach:function(t){e.delete(t)},bind:r,unbind:i,width:function(){return n.canvas.width},height:function(){return n.canvas.height},halfWidth:function(){return n.canvas.width/2},halfHeight:function(){return n.canvas.height/2}});function a(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function s(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function u(t,e,n){return e&&s(t.prototype,e),n&&s(t,n),t}function l(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&h(t,e)}function c(t){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function h(t,e){return(h=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function v(t,e,n){return(v=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}()?Reflect.construct:function(t,e,n){var r=[null];r.push.apply(r,e);var i=new(Function.bind.apply(t,r));return n&&h(i,n.prototype),i}).apply(null,arguments)}function f(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function y(t,e){return!e||"object"!=typeof e&&"function"!=typeof e?f(t):e}function p(t,e,n){return(p="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=c(t)););return t}(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(n):i.value}})(t,e,n||t)}function d(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=[],r=!0,i=!1,o=void 0;try{for(var a,s=t[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!e||n.length!==e);r=!0);}catch(t){i=!0,o=t}finally{try{r||null==s.return||s.return()}finally{if(i)throw o}}return n}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function g(t){return function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var m=function(){function t(){a(this,t),this.actions=new Set,this.states=new Set,this.ranges=new Map}return u(t,[{key:"clear",value:function(){this.actions.clear(),this.ranges.clear(),this.states.clear()}},{key:"setAction",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return e?this.actions.add(t):this.actions.delete(t),this}},{key:"setState",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return e?this.states.add(t):this.states.delete(t),this}},{key:"setRange",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;return void 0===e?this.ranges.delete(t):this.ranges.set(t,e),this}},{key:"getAction",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return!!this.actions.has(t)&&(e&&this.actions.delete(t),!0)}},{key:"getState",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return!!this.states.has(t)&&(e&&this.states.delete(t),!0)}},{key:"getRange",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.ranges.has(t)){var n=this.ranges.get(t);return e&&this.ranges.delete(t),n}return 0}},{key:"hasAction",value:function(t){return this.actions.has(t)}},{key:"hasState",value:function(t){return this.states.has(t)}},{key:"hasRange",value:function(t){return this.ranges.has(t)}}]),t}(),w=function(){function t(){a(this,t),this.inputs=new Map}return u(t,[{key:"clear",value:function(){this.inputs.clear()}},{key:"register",value:function(t){var e=!0,n=!1,r=void 0;try{for(var i,o=t.eventKeys[Symbol.iterator]();!(e=(i=o.next()).done);e=!0){var a=i.value;this.inputs.has(a)?this.inputs.get(a).push(t):this.inputs.set(a,[t])}}catch(t){n=!0,r=t}finally{try{e||null==o.return||o.return()}finally{if(n)throw r}}}},{key:"unregister",value:function(t){var e=!0,n=!1,r=void 0;try{for(var i,o=t.eventKeys[Symbol.iterator]();!(e=(i=o.next()).done);e=!0){var a=i.value;if(this.inputs.has(a)){var s=this.inputs.get(a),u=s.indexOf(t);u>=0&&s.splice(u,1)}}}catch(t){n=!0,r=t}finally{try{e||null==o.return||o.return()}finally{if(n)throw r}}}},{key:"get",value:function(t){return this.inputs.has(t)?this.inputs.get(t):[]}},{key:"values",value:function(){return this.inputs.values()}}],[{key:"toEventKey",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;return t+"["+e+"]"+(n?":"+n:"")}},{key:"fromEventKey",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=t.indexOf("[");if(n>=0){var r=t.substring(0,n).trim();e.push(r);var i=t.indexOf("]",n+1);if(!(i>=0))throw new Error("Invalid format - missing closing bracket for key.");var o=t.substring(n+1,i).trim();e.push(o);var a=t.indexOf(":",i+1);if(a>=0){var s=t.substring(a+1).trim();e.push(s)}}else e.push(t.trim());return e}}]),t}(),k=function(){function t(e){a(this,t),this.name=e,this.disabled=!1,this.mapping=new w}return u(t,[{key:"enable",value:function(){return this.disabled=!0,this}},{key:"disable",value:function(){return this.disabled=!0,this}}]),t}(),b=function(){function t(e){a(this,t),this.name=e;for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];this.eventKeys=r}return u(t,[{key:"update",value:function(t,e,n,r){return r}}]),t}(),E=function(t){function e(t){var n;a(this,e);for(var r=arguments.length,i=new Array(r>1?r-1:0),o=1;o<r;o++)i[o-1]=arguments[o];return y(this,(n=c(e)).call.apply(n,[this,t].concat(i)))}return l(e,b),u(e,[{key:"update",value:function(t,e,n,r){return"boolean"!=typeof r&&(r=Boolean(r)),r}}]),e}(),_=function(t){function e(t,n,r){var i;return a(this,e),(i=y(this,c(e).call(this,t,n,r))).active=!1,i}return l(e,b),u(e,[{key:"update",value:function(t,e,n,r){"boolean"!=typeof r&&(r=Boolean(r));var i=w.toEventKey(t.name,e,n);if(i===this.eventKeys[0])this.active=r;else{if(i!==this.eventKeys[1])return null;this.active=!r}return this.active}}]),e}(),M=function(t){function e(t,n,r,i){var o;if(a(this,e),o=y(this,c(e).call(this,t,n)),"number"!=typeof i||"number"!=typeof r)throw new Error("Range bounds for input not specified");if(i<r)throw new Error("Max range must be greater than min range");o.min=r,o.max=i;var s=i-r;if(0==s)throw new Error("Range of input cannot be zero");return o.normal=s,o}return l(e,b),u(e,[{key:"update",value:function(t,e,n,r){return"number"!=typeof r&&(r=r?1:0),this.normalize(r)}},{key:"normalize",value:function(t){return(t-this.min)/this.normal}}]),e}(),A=function(){function t(){a(this,t),this.devices={},this.contexts=new Map,this.currentState=new m,this.contexts.set("default",new k("default")),this.onInputEvent=this.onInputEvent.bind(this)}return u(t,[{key:"addDevice",value:function(t){this.devices[t.name]=t,t.addEventListener("input",this.onInputEvent)}},{key:"removeDevice",value:function(t){t.removeEventListener("input",this.onInputEvent),delete this.devices[t.name]}},{key:"getDevice",value:function(t){return this.devices[t.name]}},{key:"clearDevices",value:function(){for(var t=0,e=Object.keys(this.devices);t<e.length;t++){var n=e[t];this.devices[n].removeEventListener("input",this.onInputEvent),delete this.devices[n]}}},{key:"getDevices",value:function(){return Object.values(this.devices)}},{key:"poll",value:function(){this.propagateActiveStateInputs()}},{key:"propagateActiveStateInputs",value:function(){var t=this.currentState,e=!0,n=!1,r=void 0;try{for(var i,o=this.contexts.values()[Symbol.iterator]();!(e=(i=o.next()).done);e=!0){var a=i.value;if(!a.disabled){var s=!0,u=!1,l=void 0;try{for(var c,h=a.mapping.values()[Symbol.iterator]();!(s=(c=h.next()).done);s=!0){var v=c.value,f=!0,y=!1,p=void 0;try{for(var d,g=v[Symbol.iterator]();!(f=(d=g.next()).done);f=!0){var m=d.value;if(m instanceof _&&m.active){t.setState(m.name,!0);break}}}catch(t){y=!0,p=t}finally{try{f||null==g.return||g.return()}finally{if(y)throw p}}}}catch(t){u=!0,l=t}finally{try{s||null==h.return||h.return()}finally{if(u)throw l}}}}}catch(t){n=!0,r=t}finally{try{e||null==o.return||o.return()}finally{if(n)throw r}}}},{key:"onInputEvent",value:function(t,e,n){for(var r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],i=this.currentState,o=w.toEventKey(t.name,e,n),a=arguments.length,s=new Array(a>4?a-4:0),u=4;u<a;u++)s[u-4]=arguments[u];var l=!0,c=!1,h=void 0;try{for(var v,f=this.contexts.values()[Symbol.iterator]();!(l=(v=f.next()).done);l=!0){var y=v.value;if(!y.disabled){var p=!0,d=!1,g=void 0;try{for(var m,k=y.mapping.get(o)[Symbol.iterator]();!(p=(m=k.next()).done);p=!0){var b=m.value,A=b.update.apply(b,[t,e,n,r].concat(s));if(null!==A){if(b instanceof E)i.setAction(b.name,A);else if(b instanceof _)i.setState(b.name,A);else{if(!(b instanceof M))throw new Error("Unknown input class.");i.setRange(b.name,A)}break}}}catch(t){d=!0,g=t}finally{try{p||null==k.return||k.return()}finally{if(d)throw g}}}}}catch(t){c=!0,h=t}finally{try{l||null==f.return||f.return()}finally{if(c)throw h}}}},{key:"registerContext",value:function(t){var e=new k(t);return this.contexts.set(t,e),this}},{key:"unregisterContext",value:function(t){return this.contexts.delete(t),this}},{key:"getContext",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"default";return this.contexts.get(t)}}]),t}(),x=function(){function t(e){a(this,t),this.name=e,this.listeners=new Map}return u(t,[{key:"delete",value:function(){this.listeners.clear()}},{key:"addEventListener",value:function(t,e){this.listeners.has(t)?this.listeners.get(t).push(e):this.listeners.set(t,[e])}},{key:"removeEventListener",value:function(t,e){if(this.listeners.has(t)){var n=this.listeners.get(t),r=e.indexOf(e);r>=0&&n.splice(r,1)}}},{key:"dispatchEvent",value:function(t,e,n,r){if(this.listeners.has(t)){for(var i=arguments.length,o=new Array(i>4?i-4:0),a=4;a<i;a++)o[a-4]=arguments[a];var s=!0,u=!1,l=void 0;try{for(var c,h=this.listeners.get(t)[Symbol.iterator]();!(s=(c=h.next()).done);s=!0){var v=c.value;v.call.apply(v,[null,this,e,n,r].concat(o))}}catch(t){u=!0,l=t}finally{try{s||null==h.return||h.return()}finally{if(u)throw l}}}}}]),t}(),S=function(t){function e(t){var n;return a(this,e),(n=y(this,c(e).call(this,"key"))).element=t,n.onKeyDown=n.onKeyDown.bind(f(n)),n.onKeyUp=n.onKeyUp.bind(f(n)),document.addEventListener("keydown",n.onKeyDown),document.addEventListener("keyup",n.onKeyUp),n}return l(e,x),u(e,[{key:"delete",value:function(){document.removeEventListener("keydown",this.onKeyDown),document.removeEventListener("keyup",this.onKeyUp),p(c(e.prototype),"delete",this).call(this)}},{key:"onKeyDown",value:function(t){t.repeat||this.dispatchEvent("input",t.key,"down",!0)}},{key:"onKeyUp",value:function(t){this.dispatchEvent("input",t.key,"up",!0)}}]),e}(),O=function(t){function e(t){var n,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return a(this,e),(n=y(this,c(e).call(this,"mouse"))).element=t,n.allowCursorLock=r,n.onMouseMove=n.onMouseMove.bind(f(n)),n.onMouseDown=n.onMouseDown.bind(f(n)),n.onMouseUp=n.onMouseUp.bind(f(n)),n._down=!1,t.addEventListener("mousedown",n.onMouseDown,!1),document.addEventListener("mousemove",n.onMouseMove,!1),n.onMouseClick=n.onMouseClick.bind(f(n)),t.addEventListener("click",n.onMouseClick,!1),n}return l(e,x),u(e,[{key:"delete",value:function(){this.hasPointerLock()&&document.exitPointerLock(),this.element.removeEventListener("mousedown",this.onMouseDown),document.removeEventListener("mousemove",this.onMouseMove),document.removeEventListener("mouseup",this.onMouseUp),this.element.removeEventListener("click",this.onMouseClick),p(c(e.prototype),"delete",this).call(this)}},{key:"onMouseClick",value:function(t){this.allowCursorLock&&this.element.requestPointerLock()}},{key:"onMouseMove",value:function(t){if(!this.allowCursorLock||this.hasPointerLock())if(this.dispatchEvent("input","move","x",t.movementX),this.dispatchEvent("input","move","y",t.movementY),this.element instanceof Element){var e=this.element.getBoundingClientRect();this.dispatchEvent("input","pos","x",t.clientX-e.left),this.dispatchEvent("input","pos","y",t.clientY-e.top)}else this.dispatchEvent("input","pos","x",t.clientX),this.dispatchEvent("input","pos","y",t.clientY)}},{key:"onMouseDown",value:function(t){this.allowCursorLock&&!this.hasPointerLock()||(this._down&&document.removeEventListener("mouseup",this.onMouseUp),this._down=!0,document.addEventListener("mouseup",this.onMouseUp,!1),this.dispatchEvent("input",t.button,"down",!0,t.clientX,t.clientY))}},{key:"onMouseUp",value:function(t){this.allowCursorLock&&!this.hasPointerLock()||(document.removeEventListener("mouseup",this.onMouseUp),this._down=!1,this.dispatchEvent("input",t.button,"up",!0,t.clientX,t.clientY))}},{key:"hasPointerLock",value:function(){return document.pointerLockElement===this.element}}]),e}(),L=new A,C=new S(window),D=new O(window,!1);L.addDevice(C),L.addDevice(D);var R=Object.freeze({INPUT_MANAGER:L,KEYBOARD:C,MOUSE:D,Action:function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];var i=v(E,[t].concat(n));return L.getContext().mapping.register(i),{input:i,get:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],e=L.currentState;return!!e.hasAction(this.input.name)&&e.getAction(this.input.name,t)}}},State:function(t){for(var e=[],n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];for(var o=0,a=r;o<a.length;o++){var s=a[o],u=void 0,l=void 0;if(Array.isArray(s))u=s[0],l=s[1];else{var c=d(w.fromEventKey(s),2),h=c[0],v=c[1];u=w.toEventKey(h,v,"down"),l=w.toEventKey(h,v,"up")}var f=new _(t,u,l);L.getContext().mapping.register(f),e.push(f)}return{inputs:e,get:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],e=L.currentState;return!!e.hasState(this.inputs[0].name)&&e.getState(this.inputs[0].name,t)}}},Range:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,i=new M(t,e,n,r);return L.getContext().mapping.register(i),{input:i,get:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],e=L.currentState;return e.hasRange(this.input.name)?e.getRange(this.input.name,t):0}}}}),I=function(){function t(e){a(this,t),this.entityManager=e}return u(t,null,[{key:"TAG",get:function(){return"#".concat(this.name)}}]),u(t,[{key:"create",value:function(){var t,e=function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if(e.hasOwnProperty("INHERITED_TAGS")){var r=!0,i=!1,o=void 0;try{for(var a,s=e.INHERITED_TAGS[Symbol.iterator]();!(r=(a=s.next()).done);r=!0){var u=a.value;n.push(u)}}catch(t){i=!0,o=t}finally{try{r||null==s.return||s.return()}finally{if(i)throw o}}}else if(e.hasOwnProperty("TAG")){n.push(e.TAG);var l=Object.getPrototypeOf(e);if(l){var c=!0,h=!1,v=void 0;try{for(var f,y=t(l)[Symbol.iterator]();!(c=(f=y.next()).done);c=!0){var p=f.value;n.push(p)}}catch(t){h=!0,v=t}finally{try{c||null==y.return||y.return()}finally{if(h)throw v}}}e.INHERITED_TAGS=n}return n}(this.constructor);return this.id=(t=this.entityManager).create.apply(t,g(e)),this}},{key:"destroy",value:function(){return this.entityManager.destroy(this.id),this.id=-1,!1}},{key:"assign",value:function(t){for(var e,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];return(e=this.entityManager).assign.apply(e,[this.id,t].concat(r)),this}},{key:"remove",value:function(){for(var t,e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return(t=this.entityManager).remove.apply(t,[this.id].concat(n)),this}},{key:"has",value:function(){for(var t,e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return(t=this.entityManager).has.apply(t,[this.id].concat(n))}},{key:"get",value:function(t){for(var e,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];return(e=this.entityManager).get.apply(e,[this.id,t].concat(r))}}]),t}();var K=function(){function t(e,n){a(this,t),this.entityManager=e,this.filter=n}return u(t,[{key:Symbol.iterator,value:function(){return{filter:this.filter,iterator:this.entityManager._entities[Symbol.iterator](),next:function(){for(var t;!(t=this.iterator.next()).done;){var e=t.value;if(this.filter(e))return{value:e,done:!1}}return{done:!0}}}}}]),t}(),j={},P=function(){function t(e){a(this,t),this.components=new Map,this.type=e,this._createComponent=null,this._destroyComponent=null,"string"==typeof e?(this._createComponent=U,this._destroyComponent=T):(this._createComponent=G,this._destroyComponent=N)}return u(t,[{key:"add",value:function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];var i=this._createComponent.apply(this,[this.type].concat(n));return this.components.set(t,i),i}},{key:"remove",value:function(t){if(this.components.has(t)){var e=this.components.get(t);this._destroyComponent(this.type,e),this.components.delete(t)}}},{key:"get",value:function(t){return this.components.get(t)}},{key:"has",value:function(t){return this.components.has(t)}},{key:"clear",value:function(){this.components.clear()}}]),t}();function U(t){return j}function T(t,e){return!0}function G(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return t.apply(void 0,n)}function N(t,e){return!0}var Y=new(function(){function t(){a(this,t),this._entities=new Set,this._componentManagers=new Map,this._nextEntityID=1}return u(t,[{key:"create",value:function(){var t=this._nextEntityID++;this._entities.add(t);for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];for(var i=0,o=n;i<o.length;i++){var a=o[i];this.assign(t,a)}return t}},{key:"destroy",value:function(t){var e=!0,n=!1,r=void 0;try{for(var i,o=this._componentManagers.values()[Symbol.iterator]();!(e=(i=o.next()).done);e=!0){var a=i.value;a.has(t)&&a.remove(t)}}catch(t){n=!0,r=t}finally{try{e||null==o.return||o.return()}finally{if(n)throw r}}this._entities.delete(t)}},{key:"entities",value:function(){for(var t=this,e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return new K(this,function(e){return t.has.apply(t,[e].concat(n))})}},{key:"has",value:function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];for(var i=0,o=n;i<o.length;i++){var a=o[i];if(!this._componentManagers.has(a))return!1;if(!this._componentManagers.get(a).has(t))return!1}return!0}},{key:"get",value:function(t,e){for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];if(r.length>0){var o=[];o.push(this._componentManagers.get(e).get(t));for(var a=0,s=r;a<s.length;a++){var u=s[a];o.push(this._componentManagers.get(u).get(t))}return o}return this._componentManagers.get(e).get(t)}},{key:"assign",value:function(t,e){var n,r;this._componentManagers.has(e)?r=this._componentManagers.get(e):(r=new P(e),this._componentManagers.set(e,r));for(var i=arguments.length,o=new Array(i>2?i-2:0),a=2;a<i;a++)o[a-2]=arguments[a];return(n=r).add.apply(n,[t].concat(o))}},{key:"remove",value:function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];for(var i=0,o=n;i<o.length;i++){var a=o[i];this._componentManagers.get(a).remove(t)}}},{key:"clear",value:function(){if(this.components.length>0){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];for(var r=0,i=e;r<i.length;r++){var o=i[r];this._componentManagers.get(o).clear()}}else this._componentManagers.clear(),this._entities.clear()}}]),t}());var z=Object.freeze({ENTITY_MANAGER:Y,EntityBase:I,spawn:function(){return new(arguments.length>0&&void 0!==arguments[0]?arguments[0]:I)(Y).create()},keys:function(){return Y.entities.apply(Y,arguments)},component:function(t,e){for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];return Y.get.apply(Y,[t,e].concat(r))}}),B={on:function(t,e){var n,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e;if(this.__events.has(t)?n=this.__events.get(t):(n=new Map,this.__events.set(t,n)),n.has(r))throw new Error("Found callback for event '".concat(t,"' with the same handle '").concat(r,"'."));return n.set(r,e),this},off:function(t,e){if(!this.__events.has(t))throw new Error("Unable to find event '".concat(t,"'."));var n=this.__events.get(t);if(!n.has(e))throw new Error("Unable to find callback for event '".concat(t,"' with handle '").concat(e,"'."));return n.delete(e),this},once:function(t,e){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e,i=function(){n.off(t,r),e.apply(void 0,arguments)};return this.on(t,i,r)},emit:function(t){if(this.__events.has(t)){for(var e=Array.from(this.__events.get(t).values()),n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];for(var o=0,a=e;o<a.length;o++){var s=a[o];s.apply(void 0,r)}}else this.__events.set(t,new Map);return this}},F=function(t){var e=t.prototype;Object.assign(e,B),e.__events=new Map},X=function(){function t(){a(this,t),this.handle=0,this.ticks=0,this._running=!1,this.run=this.run.bind(this)}return u(t,[{key:"hasStarted",value:function(){return this._running}},{key:"start",value:function(){return this.emit("start"),this.handle=requestAnimationFrame(this.run),this._running=!0,this.ticks=0,this}},{key:"stop",value:function(){return cancelAnimationFrame(this.handle),this.handle=0,this._running=!1,this.emit("stop"),this}},{key:"run",value:function(){this.handle=requestAnimationFrame(this.run),this.emit("update"),++this.ticks}}]),t}();F(X);var q=new X;q.on("update",function(){L.poll()}),t.Display=o,t.Entity=z,t.Game=q,t.Input=R,Object.defineProperty(t,"__esModule",{value:!0})});
