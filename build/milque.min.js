!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t=t||self).Milque={})}(this,function(t){"use strict";var e={on:function(t,e){var n,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e;if(this.__events.has(t)?n=this.__events.get(t):(n=new Map,this.__events.set(t,n)),n.has(r))throw new Error("Found callback for event '".concat(t,"' with the same handle '").concat(r,"'."));return n.set(r,e),this},off:function(t,e){if(!this.__events.has(t))throw new Error("Unable to find event '".concat(t,"'."));var n=this.__events.get(t);if(!n.has(e))throw new Error("Unable to find callback for event '".concat(t,"' with handle '").concat(e,"'."));return n.delete(e),this},once:function(t,e){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e,i=function(){n.off(t,r),e.apply(void 0,arguments)};return this.on(t,i,r)},emit:function(t){if(this.__events.has(t)){for(var e=Array.from(this.__events.get(t).values()),n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];for(var a=0,o=e;a<o.length;a++){var s=o[a];s.apply(void 0,r)}}else this.__events.set(t,new Map);return this}},n={create:function(){var t=Object.create(e);return t.__events=new Map,t},assign:function(t){var n=Object.assign(t,e);return n.__events=new Map,n},mixin:function(t){var n=t.prototype;Object.assign(n,e),n.__events=new Map}},r=null,i={VIEWS:new Map};function a(t,e){return{id:t,canvas:e}}function o(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;i.VIEWS.has(t)?(r&&s(),r=i.VIEWS.get(t),i.emit("bind",t,r)):s()}function s(){r&&(i.emit("unbind",r.id,r),r=null)}function h(){return r.canvas.width}function u(){return r.canvas.height}n.assign(i);var l=Object.freeze({DISPLAY_MANAGER:i,get VIEW(){return r},attach:function(t){var e,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;n?(e=a(n,t),i.VIEWS.set(n,e),r||o(n)):(t||(t=function(t,e){var n=document.createElement("canvas");return n.setAttribute("width",t),n.setAttribute("height",e),document.body.appendChild(n),n}(640,480)),e=a(null,t),i.VIEWS.set(null,e),o(null)),i.emit("attach",n,e)},detach:function(t){var e=i.VIEWS.get(t);i.emit("detach",t,e),i.VIEWS.delete(t)},bind:o,unbind:s,width:h,height:u,clear:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"#000000",e=r.canvas.getContext("2d");e.fillStyle=t,e.fillRect(0,0,h(),u())}});function c(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function v(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function f(t,e,n){return e&&v(t.prototype,e),n&&v(t,n),t}function _(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function y(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&p(t,e)}function d(t){return(d=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function p(t,e){return(p=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function g(t,e,n){return(g=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}()?Reflect.construct:function(t,e,n){var r=[null];r.push.apply(r,e);var i=new(Function.bind.apply(t,r));return n&&p(i,n.prototype),i}).apply(null,arguments)}function m(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function b(t,e){return!e||"object"!=typeof e&&"function"!=typeof e?m(t):e}function w(t,e,n){return(w="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=d(t)););return t}(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(n):i.value}})(t,e,n||t)}function x(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=[],r=!0,i=!1,a=void 0;try{for(var o,s=t[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!e||n.length!==e);r=!0);}catch(t){i=!0,a=t}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}return n}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function k(t){return function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function M(){return([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,function(t){return(t^crypto.getRandomValues(new Uint8Array(1))[0]&15>>t/4).toString(16)})}var A=Object.freeze({uuid:M,lerp:function(t,e,n){return t*(1-n)+e*n},stringHash:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e=0,n=0,r=t.length;n<r;n++)e=Math.imul(31,e)+t.charCodeAt(n)|0;return e},getDirectionalVector:function(t,e,n,r){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:[0,0],s=n-t,h=r-e,u=Math.atan2(h,s)+a;return o[0]=Math.cos(u)*i,o[1]=Math.sin(u)*i,o},getMidPoint:function(t,e,n,r){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[0,0];return i[0]=t+(n-t)/2,i[1]=e+(r-e)/2,i},randomRange:function(t,e){return Math.random()*(e-t)+t},choose:function(t){return t[Math.floor(Math.random()*t.length)]},distanceSqu:function(t,e,n,r){var i=n-t,a=r-e;return i*i+a*a},distance:function(t,e,n,r){var i=n-t,a=r-e;return Math.sqrt(i*i+a*a)}}),E=function(){function t(){c(this,t),this.actions=new Set,this.states=new Set,this.ranges=new Map}return f(t,[{key:"clear",value:function(){this.actions.clear(),this.ranges.clear(),this.states.clear()}},{key:"setAction",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return e?this.actions.add(t):this.actions.delete(t),this}},{key:"setState",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return e?this.states.add(t):this.states.delete(t),this}},{key:"setRange",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;return void 0===e?this.ranges.delete(t):this.ranges.set(t,e),this}},{key:"getAction",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return!!this.actions.has(t)&&(e&&this.actions.delete(t),!0)}},{key:"getState",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return!!this.states.has(t)&&(e&&this.states.delete(t),!0)}},{key:"getRange",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.ranges.has(t)){var n=this.ranges.get(t);return e&&this.ranges.delete(t),n}return 0}},{key:"hasAction",value:function(t){return this.actions.has(t)}},{key:"hasState",value:function(t){return this.states.has(t)}},{key:"hasRange",value:function(t){return this.ranges.has(t)}}]),t}(),I=function(){function t(){c(this,t),this.inputs=new Map}return f(t,[{key:"clear",value:function(){this.inputs.clear()}},{key:"register",value:function(t){var e=!0,n=!1,r=void 0;try{for(var i,a=t.eventKeys[Symbol.iterator]();!(e=(i=a.next()).done);e=!0){var o=i.value;this.inputs.has(o)?this.inputs.get(o).push(t):this.inputs.set(o,[t])}}catch(t){n=!0,r=t}finally{try{e||null==a.return||a.return()}finally{if(n)throw r}}}},{key:"unregister",value:function(t){var e=!0,n=!1,r=void 0;try{for(var i,a=t.eventKeys[Symbol.iterator]();!(e=(i=a.next()).done);e=!0){var o=i.value;if(this.inputs.has(o)){var s=this.inputs.get(o),h=s.indexOf(t);h>=0&&s.splice(h,1)}}}catch(t){n=!0,r=t}finally{try{e||null==a.return||a.return()}finally{if(n)throw r}}}},{key:"get",value:function(t){return this.inputs.has(t)?this.inputs.get(t):[]}},{key:"values",value:function(){return this.inputs.values()}}],[{key:"toEventKey",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;return t+"["+e+"]"+(n?":"+n:"")}},{key:"fromEventKey",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=t.indexOf("[");if(n>=0){var r=t.substring(0,n).trim();e.push(r);var i=t.indexOf("]",n+1);if(!(i>=0))throw new Error("Invalid format - missing closing bracket for key.");var a=t.substring(n+1,i).trim();e.push(a);var o=t.indexOf(":",i+1);if(o>=0){var s=t.substring(o+1).trim();e.push(s)}}else e.push(t.trim());return e}}]),t}(),P=function(){function t(e){c(this,t),this.name=e,this.disabled=!1,this.mapping=new I}return f(t,[{key:"enable",value:function(){return this.disabled=!0,this}},{key:"disable",value:function(){return this.disabled=!0,this}}]),t}(),O=function(){function t(e){c(this,t),this.name=e;for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];this.eventKeys=r}return f(t,[{key:"update",value:function(t,e,n,r){return r}}]),t}(),C=function(t){function e(t){var n;c(this,e);for(var r=arguments.length,i=new Array(r>1?r-1:0),a=1;a<r;a++)i[a-1]=arguments[a];return b(this,(n=d(e)).call.apply(n,[this,t].concat(i)))}return y(e,O),f(e,[{key:"update",value:function(t,e,n,r){return"boolean"!=typeof r&&(r=Boolean(r)),r}}]),e}(),S=function(t){function e(t,n,r){var i;return c(this,e),(i=b(this,d(e).call(this,t,n,r))).active=!1,i}return y(e,O),f(e,[{key:"update",value:function(t,e,n,r){"boolean"!=typeof r&&(r=Boolean(r));var i=I.toEventKey(t.name,e,n);if(i===this.eventKeys[0])this.active=r;else{if(i!==this.eventKeys[1])return null;this.active=!r}return this.active}}]),e}(),D=function(t){function e(t,n,r,i){var a,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1;if(c(this,e),a=b(this,d(e).call(this,t,n)),"number"!=typeof i||"number"!=typeof r||"number"!=typeof s||"number"!=typeof o)throw new Error("Range bounds for input not specified");if(i<r||s<o)throw new Error("Max range must be greater than min range");if(i===r||s===o)throw new Error("Range of input cannot be zero");return a.fromMin=r,a.fromMax=i,a.fromNormal=i-r,a.toMin=o,a.toMax=s,a.toNormal=s-o,a}return y(e,O),f(e,[{key:"update",value:function(t,e,n,r){return"number"!=typeof r&&(r=r?1:0),this.normalize(r)}},{key:"normalize",value:function(t){return(t-this.fromMin)/this.fromNormal*this.toNormal+this.toMin}}]),e}(),L=function(){function t(){c(this,t),this.devices={},this.contexts=new Map,this.currentState=new E,this.contexts.set("default",new P("default")),this.onInputEvent=this.onInputEvent.bind(this)}return f(t,[{key:"addDevice",value:function(t,e){t in this.devices&&Array.isArray(this.devices[t])?this.devices[t].push(e):this.devices[t]=[e],e.setName(t),e.addInputListener(this.onInputEvent)}},{key:"removeDevice",value:function(t,e){if(t in this.devices&&Array.isArray(this.devices[t]))if(this.devices[t].length<=1)delete this.devices[t];else{var n=this.devices[t].indexOf(e);this.devices[t].splice(n,1)}e.removeInputListener(this.onInputEvent)}},{key:"getDevices",value:function(t){return this.devices[t]}},{key:"clearDevices",value:function(){for(var t=0,e=Object.keys(this.devices);t<e.length;t++){var n=e[t],r=this.devices[n],i=!0,a=!1,o=void 0;try{for(var s,h=r[Symbol.iterator]();!(i=(s=h.next()).done);i=!0){s.value.removeInputListener(this.onInputEvent)}}catch(t){a=!0,o=t}finally{try{i||null==h.return||h.return()}finally{if(a)throw o}}delete this.devices[n]}}},{key:"poll",value:function(){this.propagateActiveStateInputs()}},{key:"propagateActiveStateInputs",value:function(){var t=this.currentState,e=!0,n=!1,r=void 0;try{for(var i,a=this.contexts.values()[Symbol.iterator]();!(e=(i=a.next()).done);e=!0){var o=i.value;if(!o.disabled){var s=!0,h=!1,u=void 0;try{for(var l,c=o.mapping.values()[Symbol.iterator]();!(s=(l=c.next()).done);s=!0){var v=l.value,f=!0,_=!1,y=void 0;try{for(var d,p=v[Symbol.iterator]();!(f=(d=p.next()).done);f=!0){var g=d.value;if(g instanceof S&&g.active){t.setState(g.name,!0);break}}}catch(t){_=!0,y=t}finally{try{f||null==p.return||p.return()}finally{if(_)throw y}}}}catch(t){h=!0,u=t}finally{try{s||null==c.return||c.return()}finally{if(h)throw u}}}}}catch(t){n=!0,r=t}finally{try{e||null==a.return||a.return()}finally{if(n)throw r}}}},{key:"onInputEvent",value:function(t,e,n){for(var r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],i=this.currentState,a=I.toEventKey(t.name,e,n),o=arguments.length,s=new Array(o>4?o-4:0),h=4;h<o;h++)s[h-4]=arguments[h];var u=!0,l=!1,c=void 0;try{for(var v,f=this.contexts.values()[Symbol.iterator]();!(u=(v=f.next()).done);u=!0){var _=v.value;if(!_.disabled){var y=!0,d=!1,p=void 0;try{for(var g,m=_.mapping.get(a)[Symbol.iterator]();!(y=(g=m.next()).done);y=!0){var b=g.value,w=b.update.apply(b,[t,e,n,r].concat(s));if(null!==w){if(b instanceof C)i.setAction(b.name,w);else if(b instanceof S)i.setState(b.name,w);else{if(!(b instanceof D))throw new Error("Unknown input class.");i.setRange(b.name,w)}break}}}catch(t){d=!0,p=t}finally{try{y||null==m.return||m.return()}finally{if(d)throw p}}}}}catch(t){l=!0,c=t}finally{try{u||null==f.return||f.return()}finally{if(l)throw c}}}},{key:"registerContext",value:function(t){var e=new P(t);return this.contexts.set(t,e),this}},{key:"unregisterContext",value:function(t){return this.contexts.delete(t),this}},{key:"getContext",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"default";return this.contexts.get(t)}}]),t}(),B=function(){function t(){c(this,t),this.name="input",this.inputListeners=[],this.listeners=new Map}return f(t,[{key:"setName",value:function(t){return this.name=t,this}},{key:"delete",value:function(){this.inputListeners.length=0,this.listeners.clear()}},{key:"addInputListener",value:function(t){this.inputListeners.push(t)}},{key:"removeInputListener",value:function(t){this.inputListeners.splice(this.inputListeners.indexOf(t),1)}},{key:"dispatchInput",value:function(t,e,n){for(var r=arguments.length,i=new Array(r>3?r-3:0),a=3;a<r;a++)i[a-3]=arguments[a];var o=!0,s=!1,h=void 0;try{for(var u,l=this.inputListeners[Symbol.iterator]();!(o=(u=l.next()).done);o=!0){var c=u.value;c.call.apply(c,[null,this,t,e,n].concat(i))}}catch(t){s=!0,h=t}finally{try{o||null==l.return||l.return()}finally{if(s)throw h}}}}]),t}(),j=function(t){function e(t){var n;return c(this,e),(n=b(this,d(e).call(this))).element=t,n.onKeyDown=n.onKeyDown.bind(m(n)),n.onKeyUp=n.onKeyUp.bind(m(n)),document.addEventListener("keydown",n.onKeyDown),document.addEventListener("keyup",n.onKeyUp),n}return y(e,B),f(e,[{key:"delete",value:function(){document.removeEventListener("keydown",this.onKeyDown),document.removeEventListener("keyup",this.onKeyUp),w(d(e.prototype),"delete",this).call(this)}},{key:"onKeyDown",value:function(t){t.repeat||this.dispatchInput(t.key,"down",!0)}},{key:"onKeyUp",value:function(t){this.dispatchInput(t.key,"up",!0)}}]),e}(),T=function(t){function e(t){var n,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return c(this,e),(n=b(this,d(e).call(this))).element=t,n.allowCursorLock=r,n.onMouseMove=n.onMouseMove.bind(m(n)),n.onMouseDown=n.onMouseDown.bind(m(n)),n.onMouseUp=n.onMouseUp.bind(m(n)),n._down=!1,t.addEventListener("mousedown",n.onMouseDown,!1),document.addEventListener("mousemove",n.onMouseMove,!1),n.onMouseClick=n.onMouseClick.bind(m(n)),t.addEventListener("click",n.onMouseClick,!1),n}return y(e,B),f(e,[{key:"delete",value:function(){this.hasPointerLock()&&document.exitPointerLock(),this.element.removeEventListener("mousedown",this.onMouseDown),document.removeEventListener("mousemove",this.onMouseMove),document.removeEventListener("mouseup",this.onMouseUp),this.element.removeEventListener("click",this.onMouseClick),w(d(e.prototype),"delete",this).call(this)}},{key:"onMouseClick",value:function(t){this.allowCursorLock&&this.element.requestPointerLock()}},{key:"onMouseMove",value:function(t){if(!this.allowCursorLock||this.hasPointerLock())if(this.dispatchInput("move","x",t.movementX),this.dispatchInput("move","y",t.movementY),this.element instanceof Element){var e=this.element.getBoundingClientRect();this.dispatchInput("pos","x",t.pageX-e.left),this.dispatchInput("pos","y",t.pageY-e.top)}else this.dispatchInput("pos","x",t.pageX),this.dispatchInput("pos","y",t.pageY)}},{key:"onMouseDown",value:function(t){this.allowCursorLock&&!this.hasPointerLock()||(this._down&&document.removeEventListener("mouseup",this.onMouseUp),this._down=!0,document.addEventListener("mouseup",this.onMouseUp,!1),this.dispatchInput(t.button,"down",!0,t.clientX,t.clientY))}},{key:"onMouseUp",value:function(t){this.allowCursorLock&&!this.hasPointerLock()||(document.removeEventListener("mouseup",this.onMouseUp),this._down=!1,this.dispatchInput(t.button,"up",!0,t.clientX,t.clientY))}},{key:"hasPointerLock",value:function(){return document.pointerLockElement===this.element}}]),e}(),R=new L;function F(){for(var t={name:arguments.length>0&&void 0!==arguments[0]?arguments[0]:M(),inputs:null,attach:function(){if(this.inputs)throw new Error("Already attached input to source.");this.inputs=[];for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];for(var r=0,i=e;r<i.length;r++){var a=i[r],o=void 0,s=void 0;if(Array.isArray(a))o=a[0],s=a[1];else{var h=I.fromEventKey(a),u=x(h,2),l=u[0],c=u[1];o=I.toEventKey(l,c,"down"),s=I.toEventKey(l,c,"up")}var v=new S(this.name,o,s);R.getContext().mapping.register(v),this.inputs.push(v)}return this},get:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],e=R.currentState;return!!e.hasState(this.inputs[0].name)&&e.getState(this.inputs[0].name,t)}},e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return n.length>0&&t.attach.apply(t,n),t}function U(){for(var t={name:arguments.length>0&&void 0!==arguments[0]?arguments[0]:M(),input:null,attach:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:n;if(this.input)throw new Error("Already attached input to source.");return this.input=new D(this.name,t,e,n,r,i),R.getContext().mapping.register(this.input),this},get:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],e=R.currentState;return e.hasRange(this.input.name)?e.getRange(this.input.name,t):0}},e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return n.length>0&&t.attach.apply(t,n),t}var K=Object.freeze({INPUT_MANAGER:R,Keyboard:j,Mouse:T,Action:function(){for(var t={name:arguments.length>0&&void 0!==arguments[0]?arguments[0]:M(),input:null,attach:function(){if(this.input)throw new Error("Already attached input to source.");for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return this.input=g(C,[this.name].concat(e)),R.getContext().mapping.register(this.input),this},get:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this.input){var e=R.currentState;if(e.hasAction(this.input.name))return e.getAction(this.input.name,t)}return!1}},e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return n.length>0&&t.attach.apply(t,n),t},State:F,Range:U}),N=function(){function t(){c(this,t)}return f(t,[{key:"onCreate",value:function(t){if(t){for(var e=Object.keys(t),n=0;n<e.length;++n)t[e[n]]=n+1<1||arguments.length<=n+1?void 0:arguments[n+1];return t}return{}}},{key:"onChange",value:function(t){for(var e=Object.keys(t),n=0;n<e.length;++n)t[e[n]]=n+1<1||arguments.length<=n+1?void 0:arguments[n+1]}},{key:"onDestroy",value:function(t){return!0}}]),t}(),q=function(){function t(){c(this,t)}return f(t,[{key:"onChange",value:function(){}},{key:"onDestroy",value:function(){}}]),t}(),z=function(t){function e(t,n){var r;return c(this,e),(r=b(this,d(e).call(this))).entityManager=t,r.entityID=n,r}return y(e,q),f(e,[{key:"onChange",value:function(){}},{key:"onDestroy",value:function(){this.entityManager.destroy(this.entityID,{exclude:[this.constructor]})}},{key:"destroy",value:function(){this.entityManager.destroy(this.entityID)}},{key:"component",value:function(t){for(var e,n=this,r=arguments.length,i=new Array(r>1?r-1:0),a=1;a<r;a++)i[a-1]=arguments[a];this.entityManager.has(this.entityID,t)?(e=this.entityManager).update.apply(e,[this.entityID,t].concat(i)):function(){for(var e,r=(e=n.entityManager).assign.apply(e,[n.entityID,t].concat(i)),a=function(){var t=s[o],e=Object.getOwnPropertyDescriptor(n,t);e&&e.value&&(r[t]=value),Object.defineProperty(n,t,{get:function(){return r[t]},set:function(e){r[t]=e},enumerable:!0})},o=0,s=Object.keys(r);o<s.length;o++)a()}();return this}},{key:"tag",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return e?this.entityManager.assign(this.entityID,t):this.entityManager.remove(this.entityID,t),this}},{key:"remove",value:function(){for(var t,e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];for(var i=0,a=n;i<a.length;i++)for(var o=a[i],s=this.entityManager.get(this.entityID,o),h=0,u=Object.keys(s);h<u.length;h++){var l=u[h];delete this[l]}return(t=this.entityManager).remove.apply(t,[this.entityID].concat(n)),this}},{key:"has",value:function(){for(var t,e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return(t=this.entityManager).has.apply(t,[this.entityID].concat(n))}},{key:"get",value:function(t){for(var e,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];return(e=this.entityManager).get.apply(e,[this.entityID,t].concat(r))}}]),e}(),V=function(){function t(e,n){c(this,t),this.entityManager=e,this.filter=n}return f(t,[{key:"subview",value:function(e){var n=this;return new t(this.entityManager,function(t){return n.filter(t)&&e(t)})}},{key:Symbol.iterator,value:function(){return{filter:this.filter,iterator:this.entityManager._entities[Symbol.iterator](),next:function(){for(var t;!(t=this.iterator.next()).done;){var e=t.value;if(this.filter(e))return{value:e,done:!1}}return{done:!0}}}}}]),t}(),W=function(){function t(e){c(this,t),this.components=new Map,this.factory=e}return f(t,null,[{key:"getComponentName",value:function(t){return"string"==typeof t?t:t.name}}]),f(t,[{key:"add",value:function(t){for(var e,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];var a=(e=this.factory).create.apply(e,r);return this.components.set(t,a),a}},{key:"change",value:function(t){for(var e,n=this.components.get(t),r=arguments.length,i=new Array(r>1?r-1:0),a=1;a<r;a++)i[a-1]=arguments[a];return(e=this.factory).change.apply(e,[n].concat(i)),n}},{key:"remove",value:function(t){var e=this.components.get(t);this.factory.destroy(e),this.components.delete(t)}},{key:"get",value:function(t){return this.components.get(t)}},{key:"has",value:function(t){return this.components.has(t)}},{key:"clear",value:function(){this.components.clear()}}]),t}(),Y=function(){function t(){c(this,t)}return f(t,[{key:"create",value:function(){return{}}},{key:"change",value:function(t){}},{key:"destroy",value:function(t){}}]),t}(),G=function(t){function e(t){var n;return c(this,e),(n=b(this,d(e).call(this))).tagName=t,n}return y(e,Y),f(e,[{key:"create",value:function(){return null}}]),e}(),X=function(t){function e(t){var n;return c(this,e),(n=b(this,d(e).call(this))).handler=new t,n._cached=[],n}return y(e,Y),f(e,[{key:"create",value:function(){var t,e;e=this._cached.length>0?this._cached.shift():{};for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(t=this.handler).onCreate.apply(t,[e].concat(r))}},{key:"change",value:function(t){for(var e,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];(e=this.handler).onChange.apply(e,[t].concat(r))}},{key:"destroy",value:function(t){this.handler.onDestroy(t)&&this._cached.push(t)}}]),e}(),H=function(t){function e(t){var n;return c(this,e),(n=b(this,d(e).call(this))).instanceClass=t,n}return y(e,Y),f(e,[{key:"create",value:function(){for(var t=this.instanceClass,e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return g(t,n)}},{key:"change",value:function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];t.onChange.apply(t,n)}},{key:"destroy",value:function(t){t.onDestroy()}}]),e}(),Q=function(t){function e(t){var n;return c(this,e),(n=b(this,d(e).call(this))).handler=t,n._cached=[],n}return y(e,Y),f(e,[{key:"create",value:function(){for(var t,e,n,r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];if(this._cached.length>0)if(t=this._cached.shift(),"function"==typeof this.handler.onRecreate)(e=this.handler.onRecreate).call.apply(e,[this.handler,t].concat(i));else for(var o=Object.keys(t),s=0;s<o.length;++s)t[o[s]]=i[s];else t=(n=this.handler).call.apply(n,[this.handler].concat(i));return t}},{key:"change",value:function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];var i;if("function"==typeof this.handler.onChange)(i=this.handler.onChange).call.apply(i,[this.handler,t].concat(n));else for(var a=Object.keys(t),o=Math.min(n.length,a.length),s=0;s<o;++s)t[a[s]]=n[s]}},{key:"destroy",value:function(t){"function"==typeof this.handler.onDestroy&&(this.handler.onDestroy.call(this.handler,t)&&this._cached.push(t))}}]),e}(),J=new(function(){function t(){c(this,t),this._entities=new Set,this._componentManagers=new Map,this._nextEntityID=1}return f(t,[{key:"registerComponent",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(!e)if("string"==typeof t)e=new G(t);else if(t.prototype instanceof N)e=new X(t);else if(t.prototype instanceof q)e=new H(t);else{if("function"!=typeof t)throw new Error("Cannot find factory for component type.");e=new Q(t)}var n=new W(e);return this._componentManagers.set(t,n),n}},{key:"unregisterComponent",value:function(t){this._componentManagers.delete(t)}},{key:"create",value:function(){var t=this._nextEntityID++;this._entities.add(t);for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];for(var i=0,a=n;i<a.length;i++){var o=a[i];this.assign(t,o)}return t}},{key:"destroy",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=!0,r=!1,i=void 0;try{for(var a,o=this._componentManagers.keys()[Symbol.iterator]();!(n=(a=o.next()).done);n=!0){var s=a.value,h=this._componentManagers.get(s);if(h.has(t)){if(e.exclude&&e.exclude.includes(s))continue;h.remove(t)}}}catch(t){r=!0,i=t}finally{try{n||null==o.return||o.return()}finally{if(r)throw i}}e.persist||this._entities.delete(t)}},{key:"entities",value:function(){for(var t=this,e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return new V(this,function(e){return t.has.apply(t,[e].concat(n))})}},{key:"has",value:function(t){if(!this._entities.has(t))return!1;for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];for(var i=0,a=n;i<a.length;i++){var o=a[i];if(!this._componentManagers.has(o))return!1;if(!this._componentManagers.get(o).has(t))return!1}return!0}},{key:"get",value:function(t,e){for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];if(r.length>0){var a=[];a.push(this._componentManagers.get(e).get(t));for(var o=0,s=r;o<s.length;o++){var h=s[o];a.push(this._componentManagers.get(h).get(t))}return a}return this._componentManagers.get(e).get(t)}},{key:"assign",value:function(t,e){var n,r;if("number"!=typeof t)throw new Error("Invalid entity handle - must be a number.");r=this._componentManagers.has(e)?this._componentManagers.get(e):this.registerComponent(e);for(var i=arguments.length,a=new Array(i>2?i-2:0),o=2;o<i;o++)a[o-2]=arguments[o];return(n=r).add.apply(n,[t].concat(a))}},{key:"change",value:function(t,e){if("number"!=typeof t)throw new Error("Invalid entity handle - must be a number.");for(var n=this._componentManagers.get(e),r=arguments.length,i=new Array(r>2?r-2:0),a=2;a<r;a++)i[a-2]=arguments[a];return n.change.apply(n,[t].concat(i))}},{key:"remove",value:function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];for(var i=0,a=n;i<a.length;i++){var o=a[i];if(this._componentManagers.has(o)){var s=this._componentManagers.get(o);s.has(t)&&s.remove(t)}}}},{key:"clear",value:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];if(e.length>0)for(var r=0,i=e;r<i.length;r++){var a=i[r];if(this._componentManagers.has(a)){var o=this._componentManagers.get(a);o.clear()}}else this._componentManagers.clear(),this._entities.clear()}}]),t}());var Z=Object.freeze({ENTITY_MANAGER:J,ComponentBase:N,EntityBase:z,spawn:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:z,e=J.create(),n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];return J.assign.apply(J,[e,t,J,e].concat(r))},entities:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return _({view:new V(J,function(t){return J.has.apply(J,[t,z].concat(e))})},Symbol.iterator,function(){return{iterator:this.view[Symbol.iterator](),next:function(){var t=this.iterator.next();return t.done?{done:!0}:{value:J.get(t.value,z),done:!1}}}})},components:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return _({view:new V(J,function(t){return J.has.apply(J,[t].concat(e))})},Symbol.iterator,function(){return{iterator:this.view[Symbol.iterator](),next:function(){var t=this.iterator.next();return t.done?{done:!0}:{value:J.get.apply(J,[t.value].concat(e)),done:!1}}}})}}),$=function(){function t(){c(this,t),this.tweens=new Map,this.cachedTweens=new Set,this.useCache=!1}return f(t,[{key:"add",value:function(t){this.useCache?this.cachedTweens.add(t):this.tweens.set(t.id,t)}},{key:"remove",value:function(t){this.cachedTweens.has(t)?this.cachedTweens.delete(t):this.tweens.delete(t.id)}},{key:"clear",value:function(){this.tweens.clear(),this.cachedTweens.clear()}},{key:"update",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];do{var n=!0,r=!1,i=void 0;try{for(var a,o=this.cachedTweens.values()[Symbol.iterator]();!(n=(a=o.next()).done);n=!0){var s=a.value;this.add(s)}}catch(t){r=!0,i=t}finally{try{n||null==o.return||o.return()}finally{if(r)throw i}}this.cachedTweens.clear(),this.useCache=!0;var h=!0,u=!1,l=void 0;try{for(var c,v=this.tweens.keys()[Symbol.iterator]();!(h=(c=v.next()).done);h=!0){var f=c.value,_=this.tweens.get(f);_.update(t)||e||this.tweens.delete(f)}}catch(t){u=!0,l=t}finally{try{h||null==v.return||v.return()}finally{if(u)throw l}}this.useCache=!1}while(this.cachedTweens.size>0)}}]),t}();function tt(t){switch(t){case"linear":return et.Both;case"quadratic":case"quadratic-both":case"quadratic-in-out":return nt.Both;case"quadratic-in":return nt.In;case"quadratic-out":return nt.Out;case"cubic":case"cubic-both":case"cubic-in-out":return rt.Both;case"cubic-in":return rt.In;case"cubic-out":return rt.Out;case"sinusoidal":case"sinusoidal-both":case"sinusoidal-in-out":return it.Both;case"sinusoidal-in":return it.In;case"sinusoidal-out":return it.Out;case"exponential":case"exponential-both":case"exponential-in-out":return at.Both;case"exponential-in":return at.In;case"exponential-out":return at.Out;case"circular":case"circular-both":case"circular-in-out":return ot.Both;case"circular-in":return ot.In;case"circular-out":return ot.Out;case"elastic":case"elastic-both":case"elastic-in-out":return st.Both;case"elastic-in":return st.In;case"elastic-out":return st.Out;case"back":case"back-both":case"back-in-out":return ht.Both;case"back-in":return ht.In;case"back-out":return ht.Out;case"bounce":case"bounce-both":case"bounce-in-out":return ut.Both;case"bounce-in":return ut.In;case"bounce-out":return ut.Out;default:throw new Error("Unknown easing function name '".concat(t,"'."))}}var et={Both:function(t){return t}},nt={In:function(t){return t*t},Out:function(t){return t*(2-t)},Both:function(t){return(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)}},rt={In:function(t){return t*t*t},Out:function(t){return--t*t*t+1},Both:function(t){return(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2)}},it={In:function(t){return 1-Math.cos(t*Math.PI/2)},Out:function(t){return Math.sin(t*Math.PI/2)},Both:function(t){return.5*(1-Math.cos(Math.PI*t))}},at={In:function(t){return 0===t?0:Math.pow(1024,t-1)},Out:function(t){return 1===t?1:1-Math.pow(2,-10*t)},Both:function(t){return 0===t?0:1===t?1:(t*=2)<1?.5*Math.pow(1024,t-1):.5*(2-Math.pow(2,-10*(t-1)))}},ot={In:function(t){return 1-Math.sqrt(1-t*t)},Out:function(t){return Math.sqrt(1- --t*t)},Both:function(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)}},st={In:function(t){return 0===t?0:1===t?1:-Math.pow(2,10*(t-1))*Math.sin(5*(t-1.1)*Math.PI)},Out:function(t){return 0===t?0:1===t?1:Math.pow(2,-10*t)*Math.sin(5*(t-.1)*Math.PI)+1},Both:function(t){return 0===t?0:1===t?1:(t*=2)<1?-.5*Math.pow(2,10*(t-1))*Math.sin(5*(t-1.1)*Math.PI):.5*Math.pow(2,-10*(t-1))*Math.sin(5*(t-1.1)*Math.PI)+1}},ht={In:function(t){var e=1.70158;return t*t*((e+1)*t-e)},Out:function(t){var e=1.70158;return--t*t*((e+1)*t+e)+1},Both:function(t){var e=2.5949095;return(t*=2)<1?t*t*((e+1)*t-e)*.5:.5*((t-=2)*t*((e+1)*t+e)+2)}},ut={In:function(t){return 1-ut.Out(1-t)},Out:function(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},Both:function(t){return t<.5?.5*ut.In(2*t):.5*ut.Out(2*t-1)+.5}},lt=Object.freeze({getFunctionByName:tt,Linear:et,Quadratic:nt,Cubic:rt,Sinusoidal:it,Exponential:at,Circular:ot,Elastic:st,Back:ht,Bounce:ut});function ct(t){switch(t){case"linear":return vt;case"bezier":return ft;case"catmullrom":return _t;default:throw new Error("Unknown interpolation function name '".concat(t,"'."))}}function vt(t,e){var n=t.length-1,r=n*e,i=Math.floor(r),a=yt;return e<0?a(t[0],t[1],r):e>1?a(t[n],t[n-1],n-r):a(t[i],t[i+1>n?n:i+1],r-i)}function ft(t,e){for(var n=0,r=t.length-1,i=Math.pow,a=dt,o=0;o<=r;o++)n+=i(1-e,r-o)*i(e,o)*t[o]*a(r,o);return n}function _t(t,e){var n=t.length-1,r=n*e,i=Math.floor(r),a=mt;return t[0]===t[n]?(e<0&&(i=Math.floor((function(t){throw new Error('"'+t+'" is read-only')}("f"),r=n*(1+e)))),a(t[(i-1+n)%n],t[i],t[(i+1)%n],t[(i+2)%n],r-i)):e<0?t[0]-(a(t[0],t[0],t[1],t[1],-r)-t[0]):e>1?t[n]-(a(t[n],t[n],t[n-1],t[n-1],r-n)-t[n]):a(t[i?i-1:0],t[i],t[n<i+1?n:i+1],t[n<i+2?n:i+2],r-i)}function yt(t,e,n){return(e-t)*n+t}function dt(t,e){var n=gt;return n(t)/n(e)/n(t-e)}var pt=[1];function gt(t){if(pt[t])return pt[t];for(var e=1,n=t;n>1;n--)e*=n;return pt[t]=e,e}function mt(t,e,n,r,i){var a=.5*(n-t),o=.5*(r-e),s=i*i;return(2*e-2*n+a+o)*(i*s)+(-3*e+3*n-2*a-o)*s+a*i+e}var bt=Object.freeze({getFunctionByName:ct,Linear:vt,Bezier:ft,CatmullRom:_t}),wt=1,xt=function(){function t(e){c(this,t),this.target=e,this.id=wt++,this.active=!1,this.startTime=0,this.startProperties={},this.repeatProperties={},this.reversed=!1,this.endProperties={},this.nexts=[],this.easingFunction=et.Both,this.interpolationFunction=vt,this._duration=1e3,this._startDelay=0,this._repeatDelay=0,this._repeat=0,this._yoyo=!1,this.firstUpdate=!1}return f(t,null,[{key:"now",value:function(){return Date.now()}}]),f(t,[{key:"to",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;return this.endProperties=Object.create(t),void 0!==e&&(this._duration=e),this}},{key:"next",value:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return this.nexts=e,this}},{key:"start",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;for(var n in this.startTime=void 0===e?t.now():e,this.startTime+=this._startDelay,this.endProperties){if(!(n in this.target))throw new Error("Cannot tween non-existent property.");var r=this.target[n];if("number"!=typeof r)throw new Error("Cannot tween non-number property.");var i=this.endProperties[n];if(Array.isArray(i))this.endProperties[n]=[r].concat(k(i));else if("function"!=typeof i&&"number"!=typeof i)throw new Error("Unable to tween unknown end property type.");this.startProperties[n]=r,this.repeatProperties[n]=this.startProperties[n]}return this.active=!0,this.firstUpdate=!0,this}},{key:"stop",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.active)return this;if(this.active=!1,t)this.update(1/0);else{var e=!0,n=!1,r=void 0;try{for(var i,a=this.nexts[Symbol.iterator]();!(e=(i=a.next()).done);e=!0){var o=i.value;o.stop()}}catch(t){n=!0,r=t}finally{try{e||null==a.return||a.return()}finally{if(n)throw r}}}return this}},{key:"update",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:t.now();if(e<this.startTime)return!0;this.firstUpdate&&(this.firstUpdate=!1,this.emit("start",this.target));var n=this._duration>0?Math.min((e-this.startTime)/this._duration,1):1,r=this.easingFunction(n);for(var i in this.endProperties)if(i in this.startProperties){var a=this.startProperties[i],o=this.endProperties[i];this.target[i]=this.getTweenValue(a,o,r)}if(this.emit("update",this.target,n),n>=1){if(this._repeat>0){for(var s in Number.isFinite(this._repeat)&&--this._repeat,this.repeatProperties){if(this._yoyo){var h=this.repeatProperties[s];if(this.repeatProperties[s]=this.endProperties[s],this.endProperties[s]=h,"function"==typeof this.repeatProperties[s]){this.startProperties[s]=this.repeatProperties[s].call(null,this.endProperties[s]);continue}}else"function"==typeof this.endProperties[s]&&(this.repeatProperties[s]+=this.endProperties[s].call(null,this.repeatProperties[s]));this.startProperties[s]=this.repeatProperties[s]}return this._yoyo&&(this.reversed=!this.reversed),this._repeatDelay?this.startTime=e+this._repeatDelay:this.startTime=e+this._startDelay,this.emit("repeat",this.target),!0}this.active=!1,this.emit("complete",this.target);var u=!0,l=!1,c=void 0;try{for(var v,f=this.nexts[Symbol.iterator]();!(u=(v=f.next()).done);u=!0){var _=v.value;_.start(this.startTime+this._duration)}}catch(t){l=!0,c=t}finally{try{u||null==f.return||f.return()}finally{if(l)throw c}}return!1}return!0}},{key:"getTweenValue",value:function(t,e,n){var r;if("number"==typeof(r=Array.isArray(e)?this.interpolationFunction(e,n):"function"==typeof e?e.call(null,t):e))return t+(r-t)*n;throw new Error("Unable to tween unknown end property type.")}},{key:"ease",value:function(t){return this.easingFunction="string"==typeof t?tt(t):t,this}},{key:"interpolate",value:function(t){return this.interpolationFunction="string"==typeof t?ct(t):t,this}},{key:"repeat",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1/0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;return this._repeat=t,void 0!==e&&(this._repeatDelay=e),this}},{key:"delay",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e3,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;return this._startDelay=t,void 0===e&&(this._repeatDelay=e),this}},{key:"yoyo",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._yoyo=t,this._repeat<=0&&(this._repeat=1),this}},{key:"setDuration",value:function(t){return this._duration=t,this}},{key:"setRepeatDelay",value:function(t){return this._repeatDelay=t,this}}]),t}();n.mixin(xt);var kt=new $;var Mt=Object.freeze({TWEEN_MANAGER:kt,Easing:lt,Interpolation:bt,create:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0,i=new xt(t).to(e,r).delay(n);return kt.add(i),i}});var At=Object.freeze({randomColor:function(){for(var t="#",e=0;e<6;e++)t+="0123456789ABCDEF"[Math.floor(16*Math.random())];return t}}),Et=[],It=function(){function t(){c(this,t),this._bvh_parent=null,this._bvh_branch=!0,this._bvh_left=null,this._bvh_right=null,this._bvh_sort=0,this._bvh_min_x=0,this._bvh_min_y=0,this._bvh_max_x=0,this._bvh_max_y=0}return f(t,null,[{key:"getBranch",value:function(){return Et.length?Et.pop():new t}},{key:"releaseBranch",value:function(t){Et.push(t)}},{key:"sortBranches",value:function(t,e){return t.sort>e.sort?-1:1}}]),t}(),Pt=function(){function t(){c(this,t),this._hierarchy=null,this._bodies=[],this._dirty_branches=[]}return f(t,[{key:"insert",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!e){var n=t._bvh;if(n&&n!==this)throw new Error("Body belongs to another collision system");t._bvh=this,this._bodies.push(t)}var r=t._polygon,i=t.x,a=t.y;r&&(t._dirty_coords||t.x!==t._x||t.y!==t._y||t.angle!==t._angle||t.scale_x!==t._scale_x||t.scale_y!==t._scale_y)&&t._calculateCoords();var o=t._bvh_padding,s=r?0:t.radius*t.scale,h=(r?t._min_x:i-s)-o,u=(r?t._min_y:a-s)-o,l=(r?t._max_x:i+s)+o,c=(r?t._max_y:a+s)+o;t._bvh_min_x=h,t._bvh_min_y=u,t._bvh_max_x=l,t._bvh_max_y=c;var v=this._hierarchy,f=0;if(v)for(;;){if(!v._bvh_branch){var _=v._bvh_parent,y=v._bvh_min_x,d=v._bvh_min_y,p=v._bvh_max_x,g=v._bvh_max_y,m=v._bvh_parent=t._bvh_parent=It.getBranch();m._bvh_parent=_,m._bvh_left=v,m._bvh_right=t,m._bvh_sort=f++,m._bvh_min_x=h<y?h:y,m._bvh_min_y=u<d?u:d,m._bvh_max_x=l>p?l:p,m._bvh_max_y=c>g?c:g,_?_._bvh_left===v?_._bvh_left=m:_._bvh_right=m:this._hierarchy=m;break}var b=v._bvh_left,w=b._bvh_min_y,x=b._bvh_max_x,k=b._bvh_max_y,M=h<b._bvh_min_x?h:b._bvh_min_x,A=u<w?u:w,E=l>x?l:x,I=c>k?c:k,P=(x-b._bvh_min_x)*(k-w),O=(E-M)*(I-A),C=O-P,S=v._bvh_right,D=S._bvh_min_x,L=S._bvh_min_y,B=S._bvh_max_x,j=S._bvh_max_y,T=h<D?h:D,R=u<L?u:L,F=l>B?l:B,U=c>j?c:j,K=(B-D)*(j-L),N=(F-T)*(U-R),q=N-K;v._bvh_sort=f++,v._bvh_min_x=M<T?M:T,v._bvh_min_y=A<R?A:R,v._bvh_max_x=E>F?E:F,v._bvh_max_y=I>U?I:U,v=C<=q?b:S}else this._hierarchy=t}},{key:"remove",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!e){var n=t._bvh;if(n&&n!==this)throw new Error("Body belongs to another collision system");t._bvh=null,this._bodies.splice(this._bodies.indexOf(t),1)}if(this._hierarchy!==t){var r=t._bvh_parent,i=r._bvh_parent,a=r._bvh_left,o=a===t?r._bvh_right:a;if(o._bvh_parent=i,o._bvh_branch&&(o._bvh_sort=r._bvh_sort),i){i._bvh_left===r?i._bvh_left=o:i._bvh_right=o;for(var s=i;s;){var h=s._bvh_left,u=h._bvh_min_x,l=h._bvh_min_y,c=h._bvh_max_x,v=h._bvh_max_y,f=s._bvh_right,_=f._bvh_min_x,y=f._bvh_min_y,d=f._bvh_max_x,p=f._bvh_max_y;s._bvh_min_x=u<_?u:_,s._bvh_min_y=l<y?l:y,s._bvh_max_x=c>d?c:d,s._bvh_max_y=v>p?v:p,s=s._bvh_parent}}else this._hierarchy=o;It.releaseBranch(r)}else this._hierarchy=null}},{key:"update",value:function(){for(var t=this._bodies,e=t.length,n=0;n<e;++n){var r=t[n],i=!1;if(i||r.padding===r._bvh_padding||(r._bvh_padding=r.padding,i=!0),!i){var a=r._polygon;a&&(r._dirty_coords||r.x!==r._x||r.y!==r._y||r.angle!==r._angle||r.scale_x!==r._scale_x||r.scale_y!==r._scale_y)&&r._calculateCoords();var o=r.x,s=r.y,h=a?0:r.radius*r.scale,u=a?r._min_x:o-h,l=a?r._min_y:s-h,c=a?r._max_x:o+h,v=a?r._max_y:s+h;i=u<r._bvh_min_x||l<r._bvh_min_y||c>r._bvh_max_x||v>r._bvh_max_y}i&&(this.remove(r,!0),this.insert(r,!0))}}},{key:"potentials",value:function(t){var e=[],n=t._bvh_min_x,r=t._bvh_min_y,i=t._bvh_max_x,a=t._bvh_max_y,o=this._hierarchy,s=!0;if(!o||!o._bvh_branch)return e;for(;o;){if(s){s=!1;for(var h=o._bvh_branch?o._bvh_left:null;h&&h._bvh_max_x>=n&&h._bvh_max_y>=r&&h._bvh_min_x<=i&&h._bvh_min_y<=a;)h=(o=h)._bvh_branch?o._bvh_left:null}var u=o._bvh_branch,l=u?o._bvh_right:null;if(l&&l._bvh_max_x>n&&l._bvh_max_y>r&&l._bvh_min_x<i&&l._bvh_min_y<a)o=l,s=!0;else{u||o===t||e.push(o);var c=o._bvh_parent;if(!c)break;for(;c&&c._bvh_right===o;)c=(o=c)._bvh_parent;o=c}}return e}},{key:"draw",value:function(t){for(var e=this._bodies,n=e.length,r=0;r<n;++r)e[r].draw(t)}},{key:"drawBVH",value:function(t){for(var e=this._hierarchy,n=!0;e;){if(n){n=!1;for(var r=e._bvh_branch?e._bvh_left:null;r;)r=(e=r)._bvh_branch?e._bvh_left:null}var i=e._bvh_branch,a=e._bvh_min_x,o=e._bvh_min_y,s=e._bvh_max_x,h=e._bvh_max_y,u=i?e._bvh_right:null;if(t.moveTo(a,o),t.lineTo(s,o),t.lineTo(s,h),t.lineTo(a,h),t.lineTo(a,o),u)e=u,n=!0;else{var l=e._bvh_parent;if(!l)break;for(;l&&l._bvh_right===e;)l=(e=l)._bvh_parent;e=l}}}}]),t}();function Ot(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],i=t._polygon,a=e._polygon,o=!1;return n&&(n.a=t,n.b=e,n.a_in_b=!0,n.b_in_a=!0,n.overlap=null,n.overlap_x=0,n.overlap_y=0),i&&(t._dirty_coords||t.x!==t._x||t.y!==t._y||t.angle!==t._angle||t.scale_x!==t._scale_x||t.scale_y!==t._scale_y)&&t._calculateCoords(),a&&(e._dirty_coords||e.x!==e._x||e.y!==e._y||e.angle!==e._angle||e.scale_x!==e._scale_x||e.scale_y!==e._scale_y)&&e._calculateCoords(),r&&!function(t,e){var n=t._polygon,r=n?0:t.x,i=n?0:t.y,a=n?0:t.radius*t.scale,o=n?t._min_x:r-a,s=n?t._min_y:i-a,h=n?t._max_x:r+a,u=n?t._max_y:i+a,l=e._polygon,c=l?0:e.x,v=l?0:e.y,f=l?0:e.radius*e.scale,_=l?e._min_x:c-f,y=l?e._min_y:v-f,d=l?e._max_x:c+f,p=l?e._max_y:v+f;return o<d&&s<p&&h>_&&u>y}(t,e)||(i&&t._dirty_normals&&t._calculateNormals(),a&&e._dirty_normals&&e._calculateNormals(),o=i&&a?function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=t._coords.length,i=e._coords.length;if(2===r&&2===i){var a=t._coords,o=e._coords;return n&&(n.overlap=0),a[0]===o[0]&&a[1]===o[1]}var s=t._coords,h=e._coords,u=t._normals,l=e._normals;if(r>2)for(var c=0,v=1;c<r;c+=2,v+=2)if(St(s,h,u[c],u[v],n))return!1;if(i>2)for(var f=0,_=1;f<i;f+=2,_+=2)if(St(s,h,l[f],l[_],n))return!1;return!0}(t,e,n):i?Ct(t,e,n,!1):a?Ct(e,t,n,!0):function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=t.radius*t.scale,i=e.radius*e.scale,a=e.x-t.x,o=e.y-t.y,s=r+i,h=a*a+o*o;if(h>s*s)return!1;if(n){var u=Math.sqrt(h);n.a_in_b=r<=i&&u<=i-r,n.b_in_a=i<=r&&u<=r-i,n.overlap=s-u,n.overlap_x=a/u,n.overlap_y=o/u}return!0}(t,e,n)),n&&(n.collision=o),o}function Ct(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=t._coords,a=t._edges,o=t._normals,s=e.x,h=e.y,u=e.radius*e.scale,l=2*u,c=u*u,v=i.length,f=!0,_=!0,y=null,d=0,p=0;if(2===v){var g=s-i[0],m=h-i[1],b=g*g+m*m;if(b>c)return!1;if(n){var w=Math.sqrt(b);y=u-w,d=g/w,p=m/w,_=!1}}else for(var x=0,k=1;x<v;x+=2,k+=2){var M=s-i[x],A=h-i[k],E=a[x],I=a[k],P=M*E+A*I,O=P<0?-1:P>E*E+I*I?1:0,C=!1,S=0,D=0,L=0;if(n&&f&&M*M+A*A>c&&(f=!1),O){var B=-1===O,j=B?0===x?v-2:x-2:x===v-2?0:x+2,T=j+1,R=s-i[j],F=h-i[T],U=a[j],K=a[T],N=R*U+F*K;if((N<0?-1:N>U*U+K*K?1:0)===-O){var q=B?M:R,z=B?A:F,V=q*q+z*z;if(V>c)return!1;if(n){var W=Math.sqrt(V);C=!0,S=u-W,D=q/W,L=z/W,_=!1}}}else{var Y=o[x],G=o[k],X=M*Y+A*G;if(X>0&&(X<0?-X:X)>u)return!1;n&&(C=!0,S=u-X,D=Y,L=G,(_&&X>=0||S<l)&&(_=!1))}C&&(null===y||y>S)&&(y=S,d=D,p=L)}return n&&(n.a_in_b=r?_:f,n.b_in_a=r?f:_,n.overlap=y,n.overlap_x=r?-d:d,n.overlap_y=r?-p:p),!0}function St(t,e,n,r){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,a=t.length,o=e.length;if(!a||!o)return!0;for(var s=null,h=null,u=null,l=null,c=0,v=1;c<a;c+=2,v+=2){var f=t[c]*n+t[v]*r;(null===s||s>f)&&(s=f),(null===h||h<f)&&(h=f)}for(var _=0,y=1;_<o;_+=2,y+=2){var d=e[_]*n+e[y]*r;(null===u||u>d)&&(u=d),(null===l||l<d)&&(l=d)}if(s>l||h<u)return!0;if(i){var p=0;if(s<u)if(i.a_in_b=!1,h<l)p=h-u,i.b_in_a=!1;else{var g=h-u,m=l-s;p=g<m?g:-m}else if(i.b_in_a=!1,h>l)p=s-l,i.a_in_b=!1;else{var b=h-u,w=l-s;p=b<w?b:-w}var x=i.overlap,k=p<0?-p:p;if(null===x||x>k){var M=p<0?-1:1;i.overlap=k,i.overlap_x=n*M,i.overlap_y=r*M}}return!1}var Dt=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;c(this,t),this.x=e,this.y=n,this.padding=r,this._circle=!1,this._polygon=!1,this._point=!1,this._bvh=null,this._bvh_parent=null,this._bvh_branch=!1,this._bvh_padding=r,this._bvh_min_x=0,this._bvh_min_y=0,this._bvh_max_x=0,this._bvh_max_y=0}return f(t,[{key:"collides",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return Ot(this,t,e,n)}},{key:"potentials",value:function(){var t=this._bvh;if(null===t)throw new Error("Body does not belong to a collision system");return t.potentials(this)}},{key:"remove",value:function(){var t=this._bvh;t&&t.remove(this,!1)}}]),t}(),Lt=function(t){function e(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;return c(this,e),(t=b(this,d(e).call(this,n,r,o))).radius=i,t.scale=a,t}return y(e,Dt),f(e,[{key:"draw",value:function(t){var e=this.x,n=this.y,r=this.radius*this.scale;t.moveTo(e+r,n),t.arc(e,n,r,0,2*Math.PI)}}]),e}(),Bt=function(t){function e(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,h=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;return c(this,e),(t=b(this,d(e).call(this,n,r,h))).angle=a,t.scale_x=o,t.scale_y=s,t._polygon=!0,t._x=n,t._y=r,t._angle=a,t._scale_x=o,t._scale_y=s,t._min_x=0,t._min_y=0,t._max_x=0,t._max_y=0,t._points=null,t._coords=null,t._edges=null,t._normals=null,t._dirty_coords=!0,t._dirty_normals=!0,e.prototype.setPoints.call(m(t),i),t}return y(e,Dt),f(e,[{key:"draw",value:function(t){(this._dirty_coords||this.x!==this._x||this.y!==this._y||this.angle!==this._angle||this.scale_x!==this._scale_x||this.scale_y!==this._scale_y)&&this._calculateCoords();var e=this._coords;if(2===e.length)t.moveTo(e[0],e[1]),t.arc(e[0],e[1],1,0,2*Math.PI);else{t.moveTo(e[0],e[1]);for(var n=2;n<e.length;n+=2)t.lineTo(e[n],e[n+1]);e.length>4&&t.lineTo(e[0],e[1])}}},{key:"setPoints",value:function(t){var e=t.length;this._points=new Float64Array(2*e),this._coords=new Float64Array(2*e),this._edges=new Float64Array(2*e),this._normals=new Float64Array(2*e);for(var n=this._points,r=0,i=0,a=1;r<e;++r,i+=2,a+=2){var o=t[r];n[i]=o[0],n[a]=o[1]}this._dirty_coords=!0}},{key:"_calculateCoords",value:function(){for(var t,e,n,r,i=this.x,a=this.y,o=this.angle,s=this.scale_x,h=this.scale_y,u=this._points,l=this._coords,c=u.length,v=0,f=1;v<c;v+=2,f+=2){var _=u[v]*s,y=u[f]*h;if(o){var d=Math.cos(o),p=Math.sin(o),g=_;_=g*d-y*p,y=g*p+y*d}_+=i,y+=a,l[v]=_,l[f]=y,0===v?(t=e=_,n=r=y):(_<t?t=_:_>e&&(e=_),y<n?n=y:y>r&&(r=y))}this._x=i,this._y=a,this._angle=o,this._scale_x=s,this._scale_y=h,this._min_x=t,this._min_y=n,this._max_x=e,this._max_y=r,this._dirty_coords=!1,this._dirty_normals=!0}},{key:"_calculateNormals",value:function(){for(var t=this._coords,e=this._edges,n=this._normals,r=t.length,i=0,a=1;i<r;i+=2,a+=2){var o=i+2<r?i+2:0,s=t[o]-t[i],h=t[o+1]-t[a],u=s||h?Math.sqrt(s*s+h*h):0;e[i]=s,e[a]=h,n[i]=u?h/u:0,n[a]=u?-s/u:0}this._dirty_normals=!1}}]),e}(),jt=function(t){function e(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return c(this,e),(t=b(this,d(e).call(this,n,r,[[0,0]],0,1,1,i)))._point=!0,t}return y(e,Bt),f(e,[{key:"setPoints",value:function(){throw new Error("Cannt set points for a single point.")}}]),e}(),Tt=[[-.5,-.5],[-.5,.5],[.5,.5],[.5,-.5]],Rt=new(function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;c(this,t),this.broadPhase=e||new Pt,this.narrowPhase=n}return f(t,[{key:"addCircle",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,a=new Lt(t,e,n,r,i);return this.broadPhase.insert(a),a}},{key:"addBox",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,s=new Bt(t,e,Tt,i,n*a,r*a,o);return this.broadPhase.insert(s),s}},{key:"addPolygon",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[[0,0]],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,s=new Bt(t,e,n,r,i,a,o);return this.broadPhase.insert(s),s}},{key:"addPoint",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=new jt(t,e,n);return this.broadPhase.insert(r),r}},{key:"add",value:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];for(var r=0,i=e;r<i.length;r++){var a=i[r];this.broadPhase.insert(a,!1)}return this}},{key:"remove",value:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];for(var r=0,i=e;r<i.length;r++){var a=i[r];this.broadPhase.remove(a,!1)}return this}},{key:"update",value:function(){return this.broadPhase.update(),this}},{key:"potentials",value:function(t){return this.broadPhase.potentials(t)}},{key:"collides",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return Ot(t,e,n,!0)}}]),t}());var Ft=Object.freeze({COLLISION_MANAGER:Rt,overlap:function(t,e,n,r,i,a,o,s){return t+n>=i&&i+o>=t&&e+r>=a&&a+s>=e},draw:function(){var t=r.canvas.getContext("2d");t.strokeStyle="#FFFFFF",t.beginPath(),Rt.broadPhase.draw(t),t.stroke(),t.strokeStyle="#00FF00",t.beginPath(),Rt.broadPhase.drawBVH(t),t.stroke()}});var Ut=Object.freeze({Pointer:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"mouse[pos]:x",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"mouse[pos]:y",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"mouse[0]:down",r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"mouse[0]:up",i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"mouse[move]:x",a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"mouse[move]:y";return{_x:U().attach(t),_y:U().attach(e),_dx:U().attach(i),_dy:U().attach(a),_down:F().attach([n,r]),get x(){return this._x.get(!1)},get y(){return this._y.get(!1)},get down(){return this._down.get(!0)},get dx(){return this._dx.get(!1)},get dy(){return this._dy.get(!1)}}},Mover:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"key[w]",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"key[a]",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"key[s]",r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"key[d]";return{_up:F().attach(t),_left:F().attach(e),_down:F().attach(n),_right:F().attach(r),get up(){return this._up.get(!1)},get left(){return this._left.get(!1)},get down(){return this._down.get(!1)},get right(){return this._right.get(!1)}}}}),Kt=function(){function t(){c(this,t),this.handle=0,this.ticks=0,this._prevtime=0,this._running=!1,this.run=this.run.bind(this)}return f(t,[{key:"hasStarted",value:function(){return this._running}},{key:"start",value:function(){return this.emit("start"),this.handle=requestAnimationFrame(this.run),this._prevtime=performance.now(),this._running=!0,this.ticks=0,this}},{key:"stop",value:function(){return cancelAnimationFrame(this.handle),this.handle=0,this._running=!1,this.emit("stop"),this}},{key:"run",value:function(t){this.handle=requestAnimationFrame(this.run);var e=t-this._prevtime;this.emit("update",e),this._prevtime=t,++this.ticks}}]),t}();n.mixin(Kt);var Nt=n.create(),qt=new Kt;qt.on("update",function(t){R.poll(),Nt.emit("preupdate"),Rt.update(),kt.update(),Nt.emit("update",.01*t),Nt.emit("postupdate")});var zt=new j(window);R.addDevice("key",zt),i.on("attach",function(t,e){e.mouse=new T(e.canvas,!1),t||(t="mouse");R.addDevice(t,e.mouse)}),i.on("detach",function(t,e){t||(t="mouse");R.removeDevice(t,e.mouse)}),t.Collision=Ft,t.Color=At,t.Controller=Ut,t.Display=l,t.Entity=Z,t.Eventable=n,t.Game=Nt,t.Input=K,t.Math=A,t.Tween=Mt,t.play=function(){qt.start()},Object.defineProperty(t,"__esModule",{value:!0})});
