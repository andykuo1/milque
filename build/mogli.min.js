!function(r,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((r=r||self).Mogli={})}(this,function(r){"use strict";function t(r,t){for(var e=0;e<t.length;e++){var n=t[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(r,n.key,n)}}function e(r,t,e){return t in r?Object.defineProperty(r,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):r[t]=e,r}function n(r,t){return function(r){if(Array.isArray(r))return r}(r)||function(r,t){var e=[],n=!0,a=!1,o=void 0;try{for(var i,u=r[Symbol.iterator]();!(n=(i=u.next()).done)&&(e.push(i.value),!t||e.length!==t);n=!0);}catch(r){a=!0,o=r}finally{try{n||null==u.return||u.return()}finally{if(a)throw o}}return e}(r,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function a(r){return function(r){if(Array.isArray(r)){for(var t=0,e=new Array(r.length);t<r.length;t++)e[t]=r[t];return e}}(r)||function(r){if(Symbol.iterator in Object(r)||"[object Arguments]"===Object.prototype.toString.call(r))return Array.from(r)}(r)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var o=1e-6,i="undefined"!=typeof Float32Array?Float32Array:Array;Math.PI;function u(){var r=new i(9);return i!=Float32Array&&(r[1]=0,r[2]=0,r[3]=0,r[5]=0,r[6]=0,r[7]=0),r[0]=1,r[4]=1,r[8]=1,r}function f(r,t,e){var n=e[0],a=e[1];return r[0]=n*t[0],r[1]=n*t[1],r[2]=n*t[2],r[3]=a*t[3],r[4]=a*t[4],r[5]=a*t[5],r[6]=t[6],r[7]=t[7],r[8]=t[8],r}function l(r,t){return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=1,r[5]=0,r[6]=t[0],r[7]=t[1],r[8]=1,r}function c(){var r=new i(16);return i!=Float32Array&&(r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=0,r[12]=0,r[13]=0,r[14]=0),r[0]=1,r[5]=1,r[10]=1,r[15]=1,r}function s(r,t){return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[4]=t[4],r[5]=t[5],r[6]=t[6],r[7]=t[7],r[8]=t[8],r[9]=t[9],r[10]=t[10],r[11]=t[11],r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15],r}function h(r,t,e){var n=t[0],a=t[1],o=t[2],i=t[3],u=t[4],f=t[5],l=t[6],c=t[7],s=t[8],h=t[9],d=t[10],v=t[11],y=t[12],A=t[13],p=t[14],m=t[15],g=e[0],b=e[1],T=e[2],E=e[3];return r[0]=g*n+b*u+T*s+E*y,r[1]=g*a+b*f+T*h+E*A,r[2]=g*o+b*l+T*d+E*p,r[3]=g*i+b*c+T*v+E*m,g=e[4],b=e[5],T=e[6],E=e[7],r[4]=g*n+b*u+T*s+E*y,r[5]=g*a+b*f+T*h+E*A,r[6]=g*o+b*l+T*d+E*p,r[7]=g*i+b*c+T*v+E*m,g=e[8],b=e[9],T=e[10],E=e[11],r[8]=g*n+b*u+T*s+E*y,r[9]=g*a+b*f+T*h+E*A,r[10]=g*o+b*l+T*d+E*p,r[11]=g*i+b*c+T*v+E*m,g=e[12],b=e[13],T=e[14],E=e[15],r[12]=g*n+b*u+T*s+E*y,r[13]=g*a+b*f+T*h+E*A,r[14]=g*o+b*l+T*d+E*p,r[15]=g*i+b*c+T*v+E*m,r}function d(r,t,e){var n,a,o,i,u,f,l,c,s,h,d,v,y=e[0],A=e[1],p=e[2];return t===r?(r[12]=t[0]*y+t[4]*A+t[8]*p+t[12],r[13]=t[1]*y+t[5]*A+t[9]*p+t[13],r[14]=t[2]*y+t[6]*A+t[10]*p+t[14],r[15]=t[3]*y+t[7]*A+t[11]*p+t[15]):(n=t[0],a=t[1],o=t[2],i=t[3],u=t[4],f=t[5],l=t[6],c=t[7],s=t[8],h=t[9],d=t[10],v=t[11],r[0]=n,r[1]=a,r[2]=o,r[3]=i,r[4]=u,r[5]=f,r[6]=l,r[7]=c,r[8]=s,r[9]=h,r[10]=d,r[11]=v,r[12]=n*y+u*A+s*p+t[12],r[13]=a*y+f*A+h*p+t[13],r[14]=o*y+l*A+d*p+t[14],r[15]=i*y+c*A+v*p+t[15]),r}function v(r,t,e){var n=e[0],a=e[1],o=e[2];return r[0]=t[0]*n,r[1]=t[1]*n,r[2]=t[2]*n,r[3]=t[3]*n,r[4]=t[4]*a,r[5]=t[5]*a,r[6]=t[6]*a,r[7]=t[7]*a,r[8]=t[8]*o,r[9]=t[9]*o,r[10]=t[10]*o,r[11]=t[11]*o,r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15],r}function y(r,t){return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=t[0],r[13]=t[1],r[14]=t[2],r[15]=1,r}function A(r,t){var e=Math.sin(t),n=Math.cos(t);return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=n,r[6]=e,r[7]=0,r[8]=0,r[9]=-e,r[10]=n,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function p(r,t){var e=Math.sin(t),n=Math.cos(t);return r[0]=n,r[1]=0,r[2]=-e,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=e,r[9]=0,r[10]=n,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function m(){var r=new i(3);return i!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0),r}function g(r,t,e){var n=new i(3);return n[0]=r,n[1]=t,n[2]=e,n}function b(r,t,e){var n=t[0],a=t[1],o=t[2],i=e[0],u=e[1],f=e[2];return r[0]=a*f-o*u,r[1]=o*i-n*f,r[2]=n*u-a*i,r}function T(r,t,e){var n=t[0],a=t[1],o=t[2],i=e[3]*n+e[7]*a+e[11]*o+e[15];return i=i||1,r[0]=(e[0]*n+e[4]*a+e[8]*o+e[12])/i,r[1]=(e[1]*n+e[5]*a+e[9]*o+e[13])/i,r[2]=(e[2]*n+e[6]*a+e[10]*o+e[14])/i,r}function E(r,t,e){var n=t[0],a=t[1],o=t[2];return r[0]=n*e[0]+a*e[3]+o*e[6],r[1]=n*e[1]+a*e[4]+o*e[7],r[2]=n*e[2]+a*e[5]+o*e[8],r}var _,S=function(r){var t=r[0],e=r[1],n=r[2];return Math.sqrt(t*t+e*e+n*n)};_=m();!function(){var r,t=(r=new i(4),i!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0,r[3]=0),r)}();function M(){var r=new i(4);return i!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0),r[3]=1,r}function w(r,t,e,n){var a,i,u,f,l,c=t[0],s=t[1],h=t[2],d=t[3],v=e[0],y=e[1],A=e[2],p=e[3];return(i=c*v+s*y+h*A+d*p)<0&&(i=-i,v=-v,y=-y,A=-A,p=-p),1-i>o?(a=Math.acos(i),u=Math.sin(a),f=Math.sin((1-n)*a)/u,l=Math.sin(n*a)/u):(f=1-n,l=n),r[0]=f*c+l*v,r[1]=f*s+l*y,r[2]=f*h+l*A,r[3]=f*d+l*p,r}var F,R,x,I,z,O,B=function(r,t){var e=t[0],n=t[1],a=t[2],o=t[3],i=e*e+n*n+a*a+o*o;return i>0&&(i=1/Math.sqrt(i)),r[0]=e*i,r[1]=n*i,r[2]=a*i,r[3]=o*i,r};F=m(),R=g(1,0,0),x=g(0,1,0),I=M(),z=M(),O=u();function U(){return{translation:m(),rotation:M(),scale:g(1,1,1)}}function P(r){var t,e,n,a,o,i,u,f,l,s,h,d,v,y,A,p,m,g,b,T,E,_,S,M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:c();return t=M,e=r.rotation,n=r.translation,a=r.scale,o=e[0],i=e[1],u=e[2],f=e[3],d=o*(l=o+o),v=o*(s=i+i),y=o*(h=u+u),A=i*s,p=i*h,m=u*h,g=f*l,b=f*s,T=f*h,E=a[0],_=a[1],S=a[2],t[0]=(1-(A+m))*E,t[1]=(v+T)*E,t[2]=(y-b)*E,t[3]=0,t[4]=(v-T)*_,t[5]=(1-(d+m))*_,t[6]=(p+g)*_,t[7]=0,t[8]=(y+b)*S,t[9]=(p-g)*S,t[10]=(1-(d+A))*S,t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t}var C=Object.freeze({create:U,getTransformationMatrix:P}),L=function(){function r(){!function(r,t){if(!(r instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),this.root=this.createSceneNode(U(),null)}var e,n,a;return e=r,(n=[{key:"update",value:function(){this.root.updateWorldMatrix()}},{key:"createSceneNode",value:function(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:U(),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.root,e={sceneGraph:this,transform:r,localMatrix:c(),worldMatrix:c(),parent:null,children:[],setParent:function(r){if(this.parent){var e=this.parent.children.indexOf(this);this.parent.children.splice(e,1)}return r&&r.children.push(this),this.parent=t,this},updateWorldMatrix:function(r){P(this.transform,this.localMatrix),r?h(this.worldMatrix,r,this.localMatrix):s(this.worldMatrix,this.localMatrix);var t=!0,e=!1,n=void 0;try{for(var a,o=this.children[Symbol.iterator]();!(t=(a=o.next()).done);t=!0)a.value.updateWorldMatrix(this.worldMatrix)}catch(r){e=!0,n=r}finally{try{t||null==o.return||o.return()}finally{if(e)throw n}}}};return t&&e.setParent(t),e}}])&&t(e.prototype,n),a&&t(e,a),r}();function D(r,t,e,n){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:void 0;if(!a){var o=Math.random(),i=Math.random(),u=Math.random();a=[];for(var f=0;f<r.length;f+=3)a.push(o,i,u)}return{position:r,texcoord:t,normal:e,indices:n,color:a,elementSize:3,elementCount:n.length}}function j(r,t,e,n){for(var a=0;a<n.color.length;a+=3)n.color[a+0]=r,n.color[a+1]=t,n.color[a+2]=e;return n}function N(r,t){var e,n,a,o,i,f,l,c,s,h,d,v,y,A,p,g,b,_,S,M,w,F,R,x,I,z,O,B,U,P,C,L=t.position,D=t.normal,j=u();e=j,a=(n=r)[0],o=n[1],i=n[2],f=n[3],l=n[4],c=n[5],s=n[6],h=n[7],d=n[8],v=n[9],y=n[10],A=n[11],p=n[12],g=n[13],b=n[14],_=n[15],(C=(S=a*c-o*l)*(P=y*_-A*b)-(M=a*s-i*l)*(U=v*_-A*g)+(w=a*h-f*l)*(B=v*b-y*g)+(F=o*s-i*c)*(O=d*_-A*p)-(R=o*h-f*c)*(z=d*b-y*p)+(x=i*h-f*s)*(I=d*g-v*p))&&(C=1/C,e[0]=(c*P-s*U+h*B)*C,e[1]=(s*O-l*P-h*z)*C,e[2]=(l*U-c*O+h*I)*C,e[3]=(i*U-o*P-f*B)*C,e[4]=(a*P-i*O+f*z)*C,e[5]=(o*O-a*U-f*I)*C,e[6]=(g*x-b*R+_*F)*C,e[7]=(b*w-p*x-_*M)*C,e[8]=(p*R-g*w+_*S)*C);for(var N=m(),V=0;V<L.length;V+=3)N[0]=L[V+0],N[1]=L[V+1],N[2]=L[V+2],T(N,N,r),L[V+0]=N[0],L[V+1]=N[1],L[V+2]=N[2],N[0]=D[V+0],N[1]=D[V+1],N[2]=D[V+2],E(N,N,j),D[V+0]=N[0],D[V+1]=N[1],D[V+2]=N[2];return t}function V(){for(var r=[],t=[],e=[],n=[],o=[],i=0,u=arguments.length,f=new Array(u),l=0;l<u;l++)f[l]=arguments[l];for(var c=0,s=f;c<s.length;c++){var h=s[c];r.push.apply(r,a(h.position)),t.push.apply(t,a(h.texcoord)),e.push.apply(e,a(h.normal)),o.push.apply(o,a(h.color));for(var d=0;d<h.indices.length;++d){var v=h.indices[d];n.push(v+i)}i+=h.position.length/3}return D(r,t,e,n,o)}function G(){var r;if(arguments.length>0&&void 0!==arguments[0]&&arguments[0]){r=[-.5,-.5,0,.5,-.5,0,-.5,.5,0,.5,.5,0]}else r=[0,0,0,1,0,0,0,1,0,1,1,0];return D(r,[0,0,1,0,0,1,1,1],[0,0,1,0,0,1,0,0,1,0,0,1],[0,1,2,2,1,3])}var Y=Object.freeze({create:G});function k(){var r=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=G(!0);if(r){var e=G(!0);return N(p(c(),Math.PI),e),j(t.color[0],t.color[1],t.color[2],e),V(t,e)}return t}var W=Object.freeze({create:k});function X(){var r=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],e=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],o=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],i=Math.PI/2,u=c(),f=[];if(r){var l=k(!1);y(u,[0,0,.5]),N(u,l),f.push(l)}if(e){var s=k(!1);A(u,-i),d(u,u,[0,0,.5]),N(u,s),f.push(s)}if(t){var h=k(!1);p(u,Math.PI),d(u,u,[0,0,.5]),N(u,h),f.push(h)}if(n){var v=k(!1);A(u,i),d(u,u,[0,0,.5]),N(u,v),f.push(v)}if(a){var m=k(!1);p(u,-i),d(u,u,[0,0,.5]),N(u,m),f.push(m)}if(o){var g=k(!1);p(u,i),d(u,u,[0,0,.5]),N(u,g),f.push(g)}return V.apply(void 0,f)}var H=Object.freeze({create:X});var q=Object.freeze({create:function(){var r=c(),t=X(!0,!0,!0,!0,!1,!0);y(r,[.1,.4,0]),v(r,r,[.4,.2,.2]),N(r,t),j(t.color[0],t.color[1],t.color[2],t);var e,n,a=X(!0,!0,!0,!0,!1,!0);n=[.2,.2,.2],(e=r)[0]=n[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=n[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=n[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,N(r,a),j(t.color[0],t.color[1],t.color[2],a);var o=X(!0,!0,!0,!0,!0,!0);return y(r,[-.2,0,0]),v(r,r,[.2,1,.2]),N(r,o),j(t.color[0],t.color[1],t.color[2],o),V(o,t,a)}}),Q=Object.freeze({Quad:Y,Plane:W,Cube:H,GlyphF:q,create:D,applyColor:j,applyTransformation:N,joinGeometry:V});function K(r,t,e){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0;if(!n){var a=Math.random(),o=Math.random(),i=Math.random();n=[];for(var u=0;u<r.length;u+=3)n.push(a,o,i)}return{position:r,texcoord:t,indices:e,color:n,elementSize:2,elementCount:e.length}}function Z(r,t){for(var e=t.position,n=vec2.create(),a=0;a<e.length;a+=2)n[0]=e[a+0],n[1]=e[a+1],vec3.transformMat3(n,n,r),e[a+0]=n[0],e[a+1]=n[1];return t}function J(){for(var r=[],t=[],e=[],n=[],o=0,i=arguments.length,u=new Array(i),f=0;f<i;f++)u[f]=arguments[f];for(var l=0,c=u;l<c.length;l++){var s=c[l];r.push.apply(r,a(s.position)),t.push.apply(t,a(s.texcoord)),n.push.apply(n,a(s.color));for(var h=0;h<s.indices.length;++h){var d=s.indices[h];e.push(d+o)}o+=s.position.length/2}return K(r,t,e,n)}function $(){var r;if(arguments.length>0&&void 0!==arguments[0]&&arguments[0]){r=[-.5,-.5,.5,-.5,-.5,.5,.5,.5]}else r=[0,0,1,0,0,1,1,1];return K(r,[0,0,1,0,0,1,1,1],[0,1,2,2,1,3])}var rr=Object.freeze({create:$});var tr=Object.freeze({create:function(){var r=u(),t=$();l(r,[.1,.4]),f(r,r,[.4,.2]),Z(r,t),j(t.color[0],t.color[1],t.color[2],t);var e,n,a=$();n=[.2,.2],(e=r)[0]=n[0],e[1]=0,e[2]=0,e[3]=0,e[4]=n[1],e[5]=0,e[6]=0,e[7]=0,e[8]=1,Z(r,a),j(t.color[0],t.color[1],t.color[2],a);var o=$();return l(r,[-.2,0]),f(r,r,[.2,1]),Z(r,o),j(t.color[0],t.color[1],t.color[2],o),J(o,t,a)}}),er=Object.freeze({Quad2D:rr,GlyphF2D:tr,create:K,applyTransformation2D:Z,joinGeometry2D:J,applyColor2D:j});function nr(r,t,e){var n=r.createShader(t);if(r.shaderSource(n,e),r.compileShader(n),!r.getShaderParameter(n,r.COMPILE_STATUS)){var a=r.getShaderInfoLog(n);throw r.deleteShader(n),new Error(a)}return n}function ar(r,t,e){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],a=r.createProgram();r.attachShader(a,t),r.attachShader(a,e);for(var o=0;o<n.length;++o)r.bindAttribLocation(a,o,n[o]);if(r.linkProgram(a),!r.getProgramParameter(a,r.LINK_STATUS)){var i=r.getProgramInfoLog(a);throw r.deleteProgram(a),new Error(i)}return a}function or(r,t){for(var e={},n=r.getProgramParameter(t,r.ACTIVE_ATTRIBUTES),a=0;a<n;++a){var o=r.getActiveAttrib(t,a);if(!o)break;var i=o.name,u=r.getAttribLocation(t,i);e[i]=ir(u)}return e}function ir(r){var t=function(r,t,e){t.enableVertexAttribArray(r),t.bindBuffer(t.ARRAY_BUFFER,e.handle),t.vertexAttribPointer(r,e.size,e.type,e.normalize,e.stride,e.offset)}.bind(null,r);return t.location=r,t}function ur(r,t){for(var e={},n={textureUnit:0},a=r.getProgramParameter(t,r.ACTIVE_UNIFORMS),o=0;o<a;++o){var i=r.getActiveUniform(t,o);if(!i)break;var u=i.name;"[0]"===u.substring(u.length-3)&&(u=u.substring(0,u.length-3));var f=fr(r,t,i,n);e[u]=f}return e}function fr(r,t,e,n){var a=e.name,o=r.getUniformLocation(t,a),i=e.type,u=e.size>1&&"[0]"===a.substring(a.length-3),f=cr(r,i);if(!f)throw new Error("Unknown uniform type 0x".concat(i.toString(16),"."));switch(i){case r.FLOAT:case r.INT:case r.BOOL:return f.setter(o,u);case r.SAMPLER_2D:case r.SAMPLER_CUBE:var l;if(u){l=[];for(var c=0;c<e.size;++c)l.push(n.textureUnit++)}else l=n.textureUnit++;return f.setter(o,u,l);default:return f.setter(o)}}var lr=null;function cr(r,t){var n;if(lr)return lr[t];function a(r,t){var e=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(e&&!Array.isArray(n))throw new Error("Cannot create sampler array for non-array texture unit.");var a=(e?function(r,t,e,n,a){n.uniform1fv(r,t),a.forEach(function(r,a){n.activeTexture(n.TEXTURE0+t[a]),n.bindTexture(e,r)})}:function(r,t,e,n,a){n.uniform1i(r,t),n.activeTexture(n.TEXTURE0+t),n.bindTexture(e,a)}).bind(null,t,n,r);return a.location=t,a}return e(n={},r.FLOAT,{TypedArray:Float32Array,size:4,setter:function(r){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],e=(t?function(r,t,e){t.uniform1fv(r,e)}:function(r,t,e){t.uniform1f(r,e)}).bind(null,r);return e.location=r,e}}),e(n,r.FLOAT_VEC2,{TypedArray:Float32Array,size:8,setter:function(r){var t=function(r,t,e){t.uniform2fv(r,e)}.bind(null,r);return t.location=r,t}}),e(n,r.FLOAT_VEC3,{TypedArray:Float32Array,size:12,setter:function(r){var t=function(r,t,e){t.uniform3fv(r,e)}.bind(null,r);return t.location=r,t}}),e(n,r.FLOAT_VEC4,{TypedArray:Float32Array,size:16,setter:function(r){var t=function(r,t,e){t.uniform4fv(r,e)}.bind(null,r);return t.location=r,t}}),e(n,r.INT,{TypedArray:Int32Array,size:4,setter:function(r){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],e=(t?function(r,t,e){t.uniform1iv(r,e)}:function(r,t,e){t.uniform1i(r,e)}).bind(null,r);return e.location=r,e}}),e(n,r.INT_VEC2,{TypedArray:Int32Array,size:8,setter:function(r){var t=function(r,t,e){t.uniform2iv(r,e)}.bind(null,r);return t.location=r,t}}),e(n,r.INT_VEC3,{TypedArray:Int32Array,size:12,setter:function(r){var t=function(r,t,e){t.uniform3iv(r,e)}.bind(null,r);return t.location=r,t}}),e(n,r.INT_VEC4,{TypedArray:Int32Array,size:16,setter:function(r){var t=function(r,t,e){t.uniform4iv(r,e)}.bind(null,r);return t.location=r,t}}),e(n,r.BOOL,{TypedArray:Uint32Array,size:4,setter:function(r){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],e=(t?function(r,t,e){t.uniform1iv(r,e)}:function(r,t,e){t.uniform1i(r,e)}).bind(null,r);return e.location=r,e}}),e(n,r.BOOL_VEC2,{TypedArray:Uint32Array,size:8,setter:function(r){var t=function(r,t,e){t.uniform2iv(r,e)}.bind(null,r);return t.location=r,t}}),e(n,r.BOOL_VEC3,{TypedArray:Uint32Array,size:12,setter:function(r){var t=function(r,t,e){t.uniform3iv(r,e)}.bind(null,r);return t.location=r,t}}),e(n,r.BOOL_VEC4,{TypedArray:Uint32Array,size:16,setter:function(r){var t=function(r,t,e){t.uniform4iv(r,e)}.bind(null,r);return t.location=r,t}}),e(n,r.FLOAT_MAT2,{TypedArray:Float32Array,size:16,setter:function(r){var t=function(r,t,e){t.uniformMatrix2fv(r,!1,e)}.bind(null,r);return t.location=r,t}}),e(n,r.FLOAT_MAT3,{TypedArray:Float32Array,size:36,setter:function(r){var t=function(r,t,e){t.uniformMatrix3fv(r,!1,e)}.bind(null,r);return t.location=r,t}}),e(n,r.FLOAT_MAT4,{TypedArray:Float32Array,size:64,setter:function(r){var t=function(r,t,e){t.uniformMatrix4fv(r,!1,e)}.bind(null,r);return t.location=r,t}}),e(n,r.SAMPLER_2D,{TypedArray:null,size:0,setter:a.bind(null,r.TEXTURE_2D)}),e(n,r.SAMPLER_CUBE,{TypedArray:null,size:0,setter:a.bind(null,r.TEXTURE_CUBE)}),(lr=n)[t]}function sr(r,t,e,n){var a=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,i=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,u=arguments.length>7&&void 0!==arguments[7]?arguments[7]:r.ARRAY_BUFFER,f=arguments.length>8&&void 0!==arguments[8]?arguments[8]:r.STATIC_DRAW,l=r.createBuffer(),c=dr(r,t);if(!c)throw new Error("Unknown uniform type 0x".concat(t.toString(16),"."));if(e instanceof c.TypedArray)r.bindBuffer(u,l),r.bufferData(u,e,f);else if(Array.isArray(e))e=new c.TypedArray(e),r.bindBuffer(u,l),r.bufferData(u,e,f);else{if("number"!=typeof e)throw new Error("Unknown buffer data type - can only be a TypedArray, an Array, or a number.");r.bindBuffer(u,l),r.bufferData(u,e,f)}return{handle:l,size:n,type:t,normalize:a,stride:o,offset:i,updateData:function(r,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:r.STATIC_DRAW;r.bindBuffer(r.ARRAY_BUFFER,this.handle);var o=dr(r,t);e instanceof o.TypedArray||(e=new o.TypedArray(e)),n>0?r.bufferSubData(r.ARRAY_BUFFER,n,e):r.bufferData(r.ARRAY_BUFFER,e,a)}}}var hr=null;function dr(r,t){var n;return hr?hr[t]:(e(n={},r.BYTE,{TypedArray:Int8Array,size:1}),e(n,r.SHORT,{TypedArray:Int16Array,size:2}),e(n,r.UNSIGNED_BYTE,{TypedArray:Uint8Array,size:1}),e(n,r.UNSIGNED_SHORT,{TypedArray:Uint16Array,size:2}),e(n,r.FLOAT,{TypedArray:Float32Array,size:4}),(hr=n)[t])}r.Geometry=Q,r.Geometry2D=er,r.SceneGraph=L,r.Transform=C,r.createBufferInfo=sr,r.createDrawInfo=function(r,t,e){return{programInfo:r,vertexArrayInfo:t,uniforms:e,drawArrayOffset:arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,drawMode:arguments.length>4&&void 0!==arguments[4]?arguments[4]:null}},r.createElementBufferInfo=function(r,t,e){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:r.STATIC_DRAW;return sr(r,t,e,1,!1,n,a,r.ELEMENT_ARRAY_BUFFER,o)},r.createShader=nr,r.createShaderProgram=ar,r.createShaderProgramAttributeSetter=ir,r.createShaderProgramAttributeSetters=or,r.createShaderProgramInfo=function(r,t,e){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],a=nr(r,r.VERTEX_SHADER,t),o=nr(r,r.FRAGMENT_SHADER,e),i=ar(r,a,o,n);return r.detachShader(i,a),r.detachShader(i,o),r.deleteShader(a),r.deleteShader(o),{handle:i,_gl:r,uniforms:ur(r,i),attributes:or(r,i),uniform:function(r,t){return r in this.uniforms&&this.uniforms[r](this._gl,t),this},attribute:function(r,t){return r in this.attributes&&this.attributes[r](this._gl,t),this},elementAttribute:function(r){return this._gl.bindBuffer(this._gl.ELEMENT_ARRAY_BUFFER,r),this}}},r.createShaderProgramUniformSetter=fr,r.createShaderProgramUniformSetters=ur,r.createTextureInfo=function(r){return{handle:r.createTexture()}},r.createVertexArrayInfo=function(r){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],e=r.createVertexArray(),n={},a=0;a<t.length;++a)n[t[a]]={location:a,setter:ir(a)};return{handle:e,attributes:n,_gl:r,elementBuffer:null,elementType:null,elementCount:0,attributeBuffers:{},setElementCount:function(r){return this.elementCount=r,this},elementAttribute:function(r){this._gl.bindBuffer(this._gl.ELEMENT_ARRAY_BUFFER,r.handle);var t=dr(this._gl,r.type);return this.elementCount=this._gl.getBufferParameter(this._gl.ELEMENT_ARRAY_BUFFER,this._gl.BUFFER_SIZE)/t.size,this.elementBuffer=r,this.elementType=r.type,this},sharedAttribute:function(r,t){return r in this.attributes&&this.attributes[r].setter(this._gl,t),this.attributeBuffers[r]=t,this},programAttribute:function(r,t){for(var e=arguments.length,n=new Array(e>2?e-2:0),a=2;a<e;a++)n[a-2]=arguments[a];for(var o=0,i=n;o<i.length;o++){var u=i[o];u.attribute(r,t)}return this.attributeBuffers[r]=t,this}}},r.draw=function(r,t){var e=!0,a=!1,o=void 0;try{for(var i,u=t[Symbol.iterator]();!(e=(i=u.next()).done);e=!0){var f=i.value,l=f.programInfo,c=f.vertexArrayInfo,s=f.uniforms,h=f.drawArrayOffset,d=f.drawMode||r.TRIANGLES;r.useProgram(l.handle),r.bindVertexArray(c.handle);for(var v=0,y=Object.entries(s);v<y.length;v++){var A=n(y[v],2),p=A[0],m=A[1];l.uniform(p,m)}c.elementBuffer?r.drawElements(d,c.elementCount,c.elementType,h*c.elementBuffer.size):r.drawArrays(d,h,c.elementCount)}}catch(r){a=!0,o=r}finally{try{e||null==u.return||u.return()}finally{if(a)throw o}}},r.getBufferTypeInfo=dr,r.getUniformTypeInfo=cr,Object.defineProperty(r,"__esModule",{value:!0})});
