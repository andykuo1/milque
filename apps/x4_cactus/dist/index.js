!function(){"use strict";var e=1e-6,t="undefined"!=typeof Float32Array?Float32Array:Array;function n(){var e=new t(16);return t!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function s(e,t){var n=t[0],s=t[1],i=t[2],r=t[3],o=t[4],a=t[5],l=t[6],u=t[7],h=t[8],c=t[9],d=t[10],p=t[11],m=t[12],f=t[13],b=t[14],_=t[15],v=n*a-s*o,g=n*l-i*o,E=n*u-r*o,y=s*l-i*a,A=s*u-r*a,w=i*u-r*l,N=h*f-c*m,S=h*b-d*m,x=h*_-p*m,T=c*b-d*f,L=c*_-p*f,M=d*_-p*b,I=v*M-g*L+E*T+y*x-A*S+w*N;return I?(I=1/I,e[0]=(a*M-l*L+u*T)*I,e[1]=(i*L-s*M-r*T)*I,e[2]=(f*w-b*A+_*y)*I,e[3]=(d*A-c*w-p*y)*I,e[4]=(l*x-o*M-u*S)*I,e[5]=(n*M-i*x+r*S)*I,e[6]=(b*E-m*w-_*g)*I,e[7]=(h*w-d*E+p*g)*I,e[8]=(o*L-a*x+u*N)*I,e[9]=(s*x-n*L-r*N)*I,e[10]=(m*A-f*E+_*v)*I,e[11]=(c*E-h*A-p*v)*I,e[12]=(a*S-o*T-l*N)*I,e[13]=(n*T-s*S+i*N)*I,e[14]=(f*g-m*y-b*v)*I,e[15]=(h*y-c*g+d*v)*I,e):null}function i(){var e=new t(3);return t!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function r(e,n,s){var i=new t(3);return i[0]=e,i[1]=n,i[2]=s,i}function o(e,t,n,s){return e[0]=t,e[1]=n,e[2]=s,e}function a(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e}function l(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e}function u(e,t){var n=t[0],s=t[1],i=t[2],r=n*n+s*s+i*i;return r>0&&(r=1/Math.sqrt(r)),e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e}function h(e,t,n){var s=t[0],i=t[1],r=t[2],o=n[0],a=n[1],l=n[2];return e[0]=i*l-r*a,e[1]=r*o-s*l,e[2]=s*a-i*o,e}Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)});var c,d=function(e){var t=e[0],n=e[1],s=e[2];return Math.hypot(t,n,s)};c=i();function p(e,t,n){var s=t[0],i=t[1],r=t[2],o=t[3];return e[0]=n[0]*s+n[4]*i+n[8]*r+n[12]*o,e[1]=n[1]*s+n[5]*i+n[9]*r+n[13]*o,e[2]=n[2]*s+n[6]*i+n[10]*r+n[14]*o,e[3]=n[3]*s+n[7]*i+n[11]*r+n[15]*o,e}!function(){var e,n=(e=new t(4),t!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e)}();function m(){var e=new t(4);return t!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}function f(t,n,s,i){var r,o,a,l,u,h=n[0],c=n[1],d=n[2],p=n[3],m=s[0],f=s[1],b=s[2],_=s[3];return(o=h*m+c*f+d*b+p*_)<0&&(o=-o,m=-m,f=-f,b=-b,_=-_),1-o>e?(r=Math.acos(o),a=Math.sin(r),l=Math.sin((1-i)*r)/a,u=Math.sin(i*r)/a):(l=1-i,u=i),t[0]=l*h+u*m,t[1]=l*c+u*f,t[2]=l*d+u*b,t[3]=l*p+u*_,t}var b,_,v,g,E,y,A,w=function(e,t){var n=t[0],s=t[1],i=t[2],r=t[3],o=n*n+s*s+i*i+r*r;return o>0&&(o=1/Math.sqrt(o)),e[0]=n*o,e[1]=s*o,e[2]=i*o,e[3]=r*o,e};b=i(),_=r(1,0,0),v=r(0,1,0),g=m(),E=m(),y=new t(9),t!=Float32Array&&(y[1]=0,y[2]=0,y[3]=0,y[5]=0,y[6]=0,y[7]=0),y[0]=1,y[4]=1,y[8]=1,A=y;const N="noscale";class S extends HTMLElement{static get[Symbol.for("cuttleTemplate")](){let e=document.createElement("template");return e.innerHTML='<div class="container">\n    <label class="hidden" id="title">display-port</label>\n    <label class="hidden" id="fps">00</label>\n    <label class="hidden" id="dimension">0x0</label>\n    <canvas></canvas>\n    <slot></slot>\n</div>',Object.defineProperty(this,Symbol.for("cuttleTemplate"),{value:e}),e}static get[Symbol.for("cuttleStyle")](){let e=document.createElement("style");return e.innerHTML=":host{display:inline-block;color:#555}.container{display:flex;position:relative;width:100%;height:100%}canvas{background:#000;margin:auto;-ms-interpolation-mode:nearest-neighbor;image-rendering:-moz-crisp-edges;image-rendering:pixelated}label{font-family:monospace;color:currentColor;position:absolute}#title{left:.5rem;top:.5rem}#fps{right:.5rem;top:.5rem}#dimension{left:.5rem;bottom:.5rem}.hidden{display:none}:host([debug]) .container{outline:6px dashed rgba(0,0,0,.1);outline-offset:-4px;background-color:rgba(0,0,0,.1)}:host([mode=noscale]) canvas{margin:0;top:0;left:0}:host([mode=center]),:host([mode=fit]),:host([mode=stretch]){width:100%;height:100%}:host([full]){width:100vw!important;height:100vh!important}:host([disabled]){display:none}slot{display:flex;flex-direction:column;align-items:center;justify-content:center;position:absolute;width:100%;height:100%;top:0;left:0;pointer-events:none}::slotted(*){pointer-events:auto}",Object.defineProperty(this,Symbol.for("cuttleStyle"),{value:e}),e}static get properties(){return{width:Number,height:Number,disabled:Boolean,debug:Boolean,mode:{type:String,value:"fit",observed:!1}}}get mode(){return this.getAttribute("mode")}set mode(e){this.setAttribute("mode",e)}get debug(){return this._debug}set debug(e){this.toggleAttribute("debug",e)}get disabled(){return this._disabled}set disabled(e){this.toggleAttribute("disabled",e)}get height(){return this._height}set height(e){this.setAttribute("height",String(e))}get width(){return this._width}set width(e){this.setAttribute("width",String(e))}static get customEvents(){return["frame"]}get onframe(){return this._onframe}set onframe(e){this._onframe&&this.removeEventListener("frame",this._onframe),this._onframe=e,this._onframe&&this.addEventListener("frame",e)}static get observedAttributes(){return["onframe","width","height","disabled","debug","id","class"]}constructor(){super(),this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(this.constructor[Symbol.for("cuttleTemplate")].content.cloneNode(!0)),this.shadowRoot.appendChild(this.constructor[Symbol.for("cuttleStyle")].cloneNode(!0)),this._canvasElement=this.shadowRoot.querySelector("canvas"),this._titleElement=this.shadowRoot.querySelector("#title"),this._fpsElement=this.shadowRoot.querySelector("#fps"),this._dimensionElement=this.shadowRoot.querySelector("#dimension"),this._animationRequestHandle=0,this._prevAnimationFrameTime=0,this._width=300,this._height=150,this._onframe=null,this.update=this.update.bind(this)}get canvas(){return this._canvasElement}connectedCallback(){if(Object.prototype.hasOwnProperty.call(this,"onframe")){let e=this.onframe;delete this.onframe,this.onframe=e}if(Object.prototype.hasOwnProperty.call(this,"width")){let e=this.width;delete this.width,this.width=e}if(Object.prototype.hasOwnProperty.call(this,"height")){let e=this.height;delete this.height,this.height=e}if(Object.prototype.hasOwnProperty.call(this,"disabled")){let e=this.disabled;delete this.disabled,this.disabled=e}if(Object.prototype.hasOwnProperty.call(this,"debug")){let e=this.debug;delete this.debug,this.debug=e}if(Object.prototype.hasOwnProperty.call(this,"mode")){let e=this.mode;delete this.mode,this.mode=e}this.hasAttribute("mode")||this.setAttribute("mode","fit"),this.hasAttribute("tabindex")||this.setAttribute("tabindex",0),this.updateCanvasSize(),this.resume()}disconnectedCallback(){this.pause()}attributeChangedCallback(e,t,n){switch(e){case"width":this._width=Number(n);break;case"height":this._height=Number(n);break;case"disabled":this._disabled=null!==n;break;case"debug":this._debug=null!==n;break;case"onframe":this.onframe=new Function("event","with(document){with(this){"+n+"}}").bind(this)}((e,t,n)=>{switch(e){case"disabled":n?(this.update(0),this.pause()):this.resume();break;case"id":case"class":this._titleElement.innerHTML=`display-port${this.className?"."+this.className:""}${this.hasAttribute("id")?"#"+this.getAttribute("id"):""}`;break;case"debug":this._titleElement.classList.toggle("hidden",n),this._fpsElement.classList.toggle("hidden",n),this._dimensionElement.classList.toggle("hidden",n)}})(e,0,n)}update(e){this._animationRequestHandle=requestAnimationFrame(this.update),this.updateCanvasSize();const t=e-this._prevAnimationFrameTime;if(this._prevAnimationFrameTime=e,this.debug){const e=t<=0?"--":String(Math.round(1e3/t)).padStart(2,"0");if(this._fpsElement.innerText!==e&&(this._fpsElement.innerText=e),this.mode===N){let e=`${this._width}x${this._height}`;this._dimensionElement.innerText!==e&&(this._dimensionElement.innerText=e)}else{let e=`${this._width}x${this._height}|${this.shadowRoot.host.clientWidth}x${this.shadowRoot.host.clientHeight}`;this._dimensionElement.innerText!==e&&(this._dimensionElement.innerText=e)}}this.dispatchEvent(new CustomEvent("frame",{detail:{now:e,prevTime:this._prevAnimationFrameTime,deltaTime:t,canvas:this._canvasElement},bubbles:!1,composed:!0}))}pause(){cancelAnimationFrame(this._animationRequestHandle)}resume(){this._animationRequestHandle=requestAnimationFrame(this.update)}updateCanvasSize(){let e=this.shadowRoot.host.getBoundingClientRect();const t=e.width,n=e.height;let s=this._canvasElement,i=this._width,r=this._height;const o=this.mode;if("stretch"===o)i=t,r=n;else if(o!==N){if(t<i||n<r||"fit"===o){let e=t/i,s=n/r;e<s?(i=t,r*=e):(i*=s,r=n)}}i=Math.floor(i),r=Math.floor(r),s.clientWidth===i&&s.clientHeight===r||(s.width=this._width,s.height=this._height,s.style=`width: ${i}px; height: ${r}px`,this.dispatchEvent(new CustomEvent("resize",{detail:{width:i,height:r},bubbles:!1,composed:!0})))}}window.customElements.define("display-port",S);const x=1,T=2,L=3,M={NULL:0,DOWN:1,UP:2,MOVE:3,parse(e){if("string"!=typeof e)return M.NULL;switch(e.toLowerCase()){case"down":return M.DOWN;case"up":return M.UP;case"move":return M.MOVE;default:return M.NULL}}},I="*";class R{constructor(e,t){this.deviceName=e,this.eventTarget=t,this.listeners={}}destroy(){this.listeners={}}addInputListener(e,t){let n=this.listeners[e];n?n.push(t):(n=[t],this.listeners[e]=n)}removeInputListener(e,t){let n=this.listeners[e];n&&(n.indexOf(t),n.splice(t,1))}dispatchInput(e){const{keyCode:t}=e,n=this.listeners[t];let s=!1;if(n){for(let t of n)s|=t(e);return s}for(let t of this.listeners["*"])s|=t(e);return s}}class O{static createAdapter(e,t,n,s,i,r){return{target:e,adapterId:t,deviceName:n,keyCode:s,scale:i,eventCode:r}}constructor(){this.adapters={"*":C()}}add(e){for(let t of e){const{deviceName:e,keyCode:n}=t;let s;e in this.adapters?s=this.adapters[e]:(s=C(),this.adapters[e]=s),n in s?s[n].push(t):s[n]=[t]}}delete(e){for(let t of e){const{deviceName:e,keyCode:n}=t;if(e in this.adapters){let s=this.adapters[e];if(n in s){let e=s[n],i=e.indexOf(t);i>=0&&e.splice(i,1)}}}}clear(){for(let e in this.adapters)this.adapters[e]=C()}poll(e,t,n){const s=this.findAdapters(e,t);for(let e of s){const t=e.eventCode;if(t===M.NULL){const{target:t,scale:s}=e,i=n.value*s;t.poll(i,e)}else{const{target:s,scale:i}=e,r=n.getEvent(t)*i;s.poll(r,e)}}return s.length>0}update(e,t,n){let s=!1;for(let i of this.findAdapters(e,t)){const e=i.eventCode;if(e!==M.NULL){const{target:t,scale:r}=i,o=n.getEvent(e)*r;t.update(o,i),s=!0}}return s}reset(e,t,n){let s=!1;for(let n of this.findAdapters(e,t))n.target.reset(),s=!0;return s}findAdapters(e,t){let n=[];if(e in this.adapters){let s=this.adapters[e];t in s&&n.push(...s[t]),n.push(...s["*"])}let s=this.adapters["*"];return t in s&&n.push(...s[t]),n.push(...s["*"]),n}}function C(){return{[I]:[]}}class F{constructor(){this.value=0}update(e){this.value=e}poll(){this.value=0}getEvent(e){return 0}getState(){return this.value}}class P extends F{constructor(){super(),this.update=this.update.bind(this),this.adapters=[],this.values=[],this.next={values:[],value:0}}hydrate(e){Array.isArray(e)||(e=[e]);let t=[],n=0;for(let s of e){"string"==typeof s&&(s={key:s});const{key:e,scale:i=1,event:r="null"}=s,{deviceName:o,keyCode:a}=k(e),l=M.parse(r),u=Number(i);let h=O.createAdapter(this,n,o,a,u,l);t.push(h),++n}this.adapters=t,this.values=new Array(t.length).fill(0),this.next={values:new Array(t.length).fill(0),value:0}}poll(e,t){const n=t.adapterId;let s=this.values[n];this.values[n]=e,this.value=this.value-s+e,this.next.values[n]=0,this.next.value+=e-s}update(e,t){const n=t.adapterId;let s=this.next.values[n];this.next.values[n]=e,this.next.value+=e-s}reset(){this.values.fill(0),this.value=0,this.next.values.fill(0),this.next.value=0}}function k(e){let t=e.indexOf(":");if(t>=0)return{deviceName:e.substring(0,t),keyCode:e.substring(t+1)};throw new Error("Invalid key string - missing device separator ':'.")}function D(e,t){return`${e}:${t}`}class U extends R{constructor(e,t={}){super("Keyboard",e);const{repeat:n=!1}=t;this.repeat=n,this._eventObject={target:e,deviceName:this.deviceName,keyCode:"",event:M.NULL,type:x,value:0,control:!1,shift:!1,alt:!1},this.onKeyDown=this.onKeyDown.bind(this),this.onKeyUp=this.onKeyUp.bind(this),e.addEventListener("keydown",this.onKeyDown),e.addEventListener("keyup",this.onKeyUp)}destroy(){let e=this.eventTarget;e.removeEventListener("keydown",this.onKeyDown),e.removeEventListener("keyup",this.onKeyUp),super.destroy()}onKeyDown(e){if(e.repeat)return e.preventDefault(),e.stopPropagation(),!1;let t=this._eventObject;return t.keyCode=e.code,t.event=M.DOWN,t.value=1,t.control=e.ctrlKey,t.shift=e.shiftKey,t.alt=e.altKey,this.dispatchInput(t)?(e.preventDefault(),e.stopPropagation(),!1):void 0}onKeyUp(e){let t=this._eventObject;if(t.keyCode=e.code,t.event=M.UP,t.value=1,t.control=e.ctrlKey,t.shift=e.shiftKey,t.alt=e.altKey,this.dispatchInput(t))return e.preventDefault(),e.stopPropagation(),!1}}class B extends R{constructor(e,t={eventsOnFocus:!0}){super("Mouse",e),this.canvasTarget=e instanceof HTMLCanvasElement&&e||e.canvas||e.querySelector("canvas")||e.shadowRoot&&e.shadowRoot.querySelector("canvas")||e,this.eventsOnFocus=t.eventsOnFocus,this._downHasFocus=!1,this._eventObject={target:e,deviceName:this.deviceName,keyCode:"",event:M.NULL,type:x,value:0,control:!1,shift:!1,alt:!1},this._positionObject={target:e,deviceName:this.deviceName,keyCode:"Position",event:M.MOVE,type:T,x:0,y:0,dx:0,dy:0},this._wheelObject={target:e,deviceName:this.deviceName,keyCode:"Wheel",event:M.MOVE,type:L,dx:0,dy:0,dz:0},this.onMouseDown=this.onMouseDown.bind(this),this.onMouseUp=this.onMouseUp.bind(this),this.onMouseMove=this.onMouseMove.bind(this),this.onContextMenu=this.onContextMenu.bind(this),this.onWheel=this.onWheel.bind(this),e.addEventListener("mousedown",this.onMouseDown),e.addEventListener("contextmenu",this.onContextMenu),e.addEventListener("wheel",this.onWheel),document.addEventListener("mousemove",this.onMouseMove),document.addEventListener("mouseup",this.onMouseUp)}destroy(){let e=this.eventTarget;e.removeEventListener("mousedown",this.onMouseDown),e.removeEventListener("contextmenu",this.onContextMenu),e.removeEventListener("wheel",this.onWheel),document.removeEventListener("mousemove",this.onMouseMove),document.removeEventListener("mouseup",this.onMouseUp),super.destroy()}setPointerLock(e=!0){e?this.eventTarget.requestPointerLock():this.eventTarget.exitPointerLock()}hasPointerLock(){return document.pointerLockElement===this.eventTarget}onMouseDown(e){this._downHasFocus=!0;let t=this._eventObject;if(t.keyCode="Button"+e.button,t.event=M.DOWN,t.value=1,t.control=e.ctrlKey,t.shift=e.shiftKey,t.alt=e.altKey,this.dispatchInput(t)&&document.activeElement===this.eventTarget)return e.preventDefault(),e.stopPropagation(),!1}onContextMenu(e){return e.preventDefault(),e.stopPropagation(),!1}onWheel(e){let t=this._wheelObject;switch(e.deltaMode){case WheelEvent.DOM_DELTA_LINE:t.dx=10*e.deltaX,t.dy=10*e.deltaY,t.dz=10*e.deltaZ;break;case WheelEvent.DOM_DELTA_PAGE:t.dx=100*e.deltaX,t.dy=100*e.deltaY,t.dz=100*e.deltaZ;break;case WheelEvent.DOM_DELTA_PIXEL:default:t.dx=e.deltaX,t.dy=e.deltaY,t.dz=e.deltaZ}if(this.dispatchInput(t))return e.preventDefault(),e.stopPropagation(),!1}onMouseUp(e){if(!this._downHasFocus)return;this._downHasFocus=!1;let t=this._eventObject;return t.keyCode="Button"+e.button,t.event=M.UP,t.value=1,t.control=e.ctrlKey,t.shift=e.shiftKey,t.alt=e.altKey,this.dispatchInput(t)?(e.preventDefault(),e.stopPropagation(),!1):void 0}onMouseMove(e){if(this.eventsOnFocus&&document.activeElement!==this.eventTarget)return;const t=this.canvasTarget,{clientWidth:n,clientHeight:s}=t,i=t.getBoundingClientRect();let r=e.movementX/n,o=e.movementY/s,a=(e.clientX-i.left)/n,l=(e.clientY-i.top)/s,u=this._positionObject;u.x=a,u.y=l,u.dx=r,u.dy=o,this.dispatchInput(u)}}class j extends F{constructor(){super(),this.delta=0,this.next={delta:0}}update(e,t){this.value=e,this.next.delta+=t}poll(){this.delta=this.next.delta,this.next.delta=0}getEvent(e){switch(e){case M.MOVE:return this.delta;default:return super.getEvent(e)}}}class H extends F{constructor(){super(),this.down=!1,this.up=!1,this.next={down:!1,up:!1}}update(e){e?this.next.down=!0:this.next.up=!0}poll(){const{up:e,down:t}=this.next;this.value?this.up&&!e&&(this.value=0):t&&(this.value=1),this.down=t,this.up=e,this.next.down=!1,this.next.up=!1}getEvent(e){switch(e){case M.DOWN:return 1&this.down;case M.UP:return 1&this.up;default:return super.getEvent(e)}}}const V=1,W=2;const Y=Symbol("inputSource");class q{static for(e){if(Object.prototype.hasOwnProperty.call(e,Y))return e[Y];{let t=new q([new U(e),new B(e)]);return Object.defineProperty(e,Y,{value:t}),t}}constructor(e){this.onInputEvent=this.onInputEvent.bind(this);let t={},n={};for(let s of e){const e=s.deviceName;t[e]=s,n[e]={},s.addInputListener(I,this.onInputEvent)}this.devices=t,this.inputs=n,this.listeners={poll:[],update:[]},this._autopoll=!1,this._animationFrameHandle=null,this.onAnimationFrame=this.onAnimationFrame.bind(this)}set autopoll(e){this._autopoll=e,e?this._animationFrameHandle=requestAnimationFrame(this.onAnimationFrame):cancelAnimationFrame(this._animationFrameHandle)}get autopoll(){return this._autopoll}destroy(){this.clear();for(let e in this.devices){let t=this.devices[e];t.removeInputListener(I,this.onInputEvent),t.destroy()}}addEventListener(e,t){e in this.listeners?this.listeners[e].unshift(t):this.listeners[e]=[t]}removeEventListener(e,t){if(e in this.listeners){let n=this.listeners[e],s=n.indexOf(t);n.splice(s,1)}}dispatchEvent(e,t){for(let n of this.listeners[e])n(t)}_dispatchInputEvent(e,t,n,s){this.dispatchEvent("input",{stage:e,deviceName:t,keyCode:n,input:s})}_dispatchPollEvent(e){this.dispatchEvent("poll",{now:e})}poll(e=performance.now()){for(const e in this.inputs){const t=this.inputs[e];for(const n in t){let s=t[n];s.poll(),this._dispatchInputEvent(W,e,n,s)}}this._dispatchPollEvent(e)}onAnimationFrame(e){this._autopoll&&(this._animationFrameHandle=requestAnimationFrame(this.onAnimationFrame),this.poll(e))}onInputEvent(e){const t=e.deviceName;switch(e.type){case x:{const n=e.keyCode;let s=this.inputs[t][n];if(s)return s.update(e.event===M.DOWN),this._dispatchInputEvent(V,t,n,s),!0}break;case T:{let n=this.inputs[t],s=n.PosX;s&&(s.update(e.x,e.dx),this._dispatchInputEvent(V,t,"PosX",s));let i=n.PosY;i&&(i.update(e.y,e.dy),this._dispatchInputEvent(V,t,"PosY",i))}break;case L:{let n=this.inputs[t],s=n.WheelX;s&&(s.update(e.dx,e.dx),this._dispatchInputEvent(V,t,"WheelX",s));let i=n.WheelY;i&&(i.update(e.dy,e.dy),this._dispatchInputEvent(V,t,"WheelY",i));let r=n.WheelZ;r&&(r.update(e.dz,e.dz),this._dispatchInputEvent(V,t,"WheelZ",r))}}}add(e,t){if(!(e in this.devices))throw new Error("Invalid device name - missing device with name in source.");let n=function(e,t){return"Mouse"===e&&("PosX"===t||"PosY"===t||"WheelX"===t||"WheelY"===t||"WheelZ"===t)}(e,t)?new j:new H;return this.inputs[e][t]=n,this}delete(e,t){delete this.inputs[e][t]}get(e,t){return this.inputs[e][t]}has(e,t){return e in this.inputs&&t in this.inputs[e]}clear(){for(let e in this.devices)this.inputs[e]={}}}class G{constructor(e={}){const{disabled:t=!0}=e;this.source=null,this._disabled=t,this._ignoreInput=t,this.adapters=new O,this.inputs={},this.onSourceInput=this.onSourceInput.bind(this),this.onSourcePoll=this.onSourcePoll.bind(this)}get disabled(){return this._disabled}set disabled(e){this.toggle(!e)}setInputMap(e){return this._setupInputs(this.source,e),this}attach(e){return this._setupInputs(e,null),this.toggle(!0),this}detach(){return this.toggle(!1),this._setupInputs(null,null),this}_setupInputs(e,t){const n=this.disabled;this.disabled=!0;const s=this.source,i=this.inputs,r=s!==e&&s,o=this.inputs&&t;if(r||o){r&&(s.removeEventListener("poll",this.onSourcePoll),s.removeEventListener("input",this.onSourceInput));for(let e in i){let{adapters:t}=i[e];for(let e of t){const{deviceName:t,keyCode:n}=e;0===X(s,t,n)&&s.delete(t,n)}}o&&(this.adapters.clear(),this.inputs={})}if(t){let e={};for(let n in t){let s=t[n],r=i[n]||new P;r.hydrate(s);let o=r.adapters;this.adapters.add(o),e[n]=r}this.inputs=e}if(e){!function(e){z in e||(e[z]={})}(e);const t=this.inputs;for(let n in t){let{adapters:s}=t[n];for(let t of s){const{deviceName:n,keyCode:s}=t;1===K(e,n,s)&&e.add(n,s)}}this.source!==e&&(e.addEventListener("poll",this.onSourcePoll),e.addEventListener("input",this.onSourceInput),this.source=e)}this.disabled=n}onSourceInput(e){if(e.consumed||this._ignoreInput){const{deviceName:t,keyCode:n,input:s}=e;this.adapters.reset(t,n,s)}else{const{stage:t,deviceName:n,keyCode:s,input:i}=e;switch(t){case W:this.adapters.poll(n,s,i);break;case V:this.adapters.update(n,s,i)}e.consumed=!0}}onSourcePoll(e){this._ignoreInput!==this.disabled&&(this._ignoreInput=this.disabled)}toggle(e=this._disabled){if(e){if(!this.source)throw new Error("Input source must be set before enabling input context.");Object.keys(this.inputs).length<=0&&console.warn("No inputs found for enabled input context - did you forget to setInputMap()?")}return this._disabled=!e,this}getInput(e){if(e in this.inputs)return this.inputs[e];{let t=new P;return this.inputs[e]=t,t}}hasInput(e){return e in this.inputs&&this.inputs[e].adapters.length>0}getInputValue(e){return e in this.inputs?this.inputs[e].value:0}}const z=Symbol("inputRefCounts");function K(e,t,n){const s=D(t,n);let i=e[z],r=i[s]+1||1;return i[s]=r,r}function X(e,t,n){const s=D(t,n);let i=e[z],r=i[s]-1||0;return i[s]=Math.max(r,0),r}class $ extends HTMLElement{static get[Symbol.for("cuttleTemplate")](){let e=document.createElement("template");return e.innerHTML='<kbd>\n    <span id="key"><slot></slot></span>\n    <span id="value" class="hidden"></span>\n</kbd>\n',Object.defineProperty(this,Symbol.for("cuttleTemplate"),{value:e}),e}static get[Symbol.for("cuttleStyle")](){let e=document.createElement("style");return e.innerHTML='kbd{position:relative;display:inline-block;border-radius:3px;border:1px solid #888;font-size:.85em;font-weight:700;text-rendering:optimizeLegibility;line-height:12px;height:14px;padding:2px 4px;color:#444;background-color:#eee;box-shadow:inset 0 -3px 0 #aaa;overflow:hidden}kbd:empty:after{content:"<?>";opacity:.6}.disabled{opacity:.6;box-shadow:none;background-color:#aaa}.hidden{display:none}#value{position:absolute;top:0;bottom:0;right:0;font-size:.85em;padding:2px 4px 0;color:#ccc;background-color:#333;box-shadow:inset 0 3px 0 #222}',Object.defineProperty(this,Symbol.for("cuttleStyle"),{value:e}),e}static get properties(){return{name:String,value:String,disabled:Boolean}}get disabled(){return this._disabled}set disabled(e){this.toggleAttribute("disabled",e)}get value(){return this._value}set value(e){this.setAttribute("value",e)}get name(){return this._name}set name(e){this.setAttribute("name",e)}constructor(){super(),this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(this.constructor[Symbol.for("cuttleTemplate")].content.cloneNode(!0)),this.shadowRoot.appendChild(this.constructor[Symbol.for("cuttleStyle")].cloneNode(!0)),this._keyboardElement=this.shadowRoot.querySelector("kbd"),this._keyElement=this.shadowRoot.querySelector("#key"),this._valueElement=this.shadowRoot.querySelector("#value")}attributeChangedCallback(e,t,n){switch(e){case"name":this._name=n;break;case"value":this._value=n;break;case"disabled":this._disabled=null!==n}((e,t,n)=>{switch(e){case"name":this._keyElement.innerText=n;break;case"value":null!==n?(this._valueElement.classList.toggle("hidden",!1),this._valueElement.innerText=n,this._keyboardElement.style.paddingRight=`${this._valueElement.clientWidth+4}px`):this._valueElement.classList.toggle("hidden",!0);break;case"disabled":this._keyboardElement.classList.toggle("disabled",null!==n)}})(e,0,n)}connectedCallback(){if(Object.prototype.hasOwnProperty.call(this,"name")){let e=this.name;delete this.name,this.name=e}if(Object.prototype.hasOwnProperty.call(this,"value")){let e=this.value;delete this.value,this.value=e}if(Object.prototype.hasOwnProperty.call(this,"disabled")){let e=this.disabled;delete this.disabled,this.disabled=e}}static get observedAttributes(){return["name","value","disabled"]}}window.customElements.define("input-key",$);class Z extends HTMLElement{static get[Symbol.for("cuttleTemplate")](){let e=document.createElement("template");return e.innerHTML='<table>\n    <thead>\n        <tr class="tableHeader">\n            <th colspan=4>\n                <slot id="title">input-map</slot>\n            </th>\n        </tr>\n        <tr class="colHeader">\n            <th>name</th>\n            <th>key</th>\n            <th>mod</th>\n            <th>value</th>\n        </tr>\n    </thead>\n    <tbody>\n    </tbody>\n</table>\n',Object.defineProperty(this,Symbol.for("cuttleTemplate"),{value:e}),e}static get[Symbol.for("cuttleStyle")](){let e=document.createElement("style");return e.innerHTML=":host{display:block}table{border-collapse:collapse}table,td,th{border:1px solid #666}td,th{padding:5px 10px}td{text-align:center}thead th{padding:0}.colHeader>th{font-size:.8em;padding:0 10px;letter-spacing:3px;background-color:#aaa;color:#666}.colHeader>th,output{font-family:monospace}output{border-radius:.3em;padding:3px}tr:not(.primary) .name,tr:not(.primary) .value{opacity:.3}tr:nth-child(2n){background-color:#eee}",Object.defineProperty(this,Symbol.for("cuttleStyle"),{value:e}),e}static get customEvents(){return["load"]}get onload(){return this._onload}set onload(e){this._onload&&this.removeEventListener("load",this._onload),this._onload=e,this._onload&&this.addEventListener("load",e)}static get observedAttributes(){return["onload","src","id","class"]}constructor(){super(),this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(this.constructor[Symbol.for("cuttleTemplate")].content.cloneNode(!0)),this.shadowRoot.appendChild(this.constructor[Symbol.for("cuttleStyle")].cloneNode(!0)),this._src="",this._inputMap=null,this._tableElements={},this._titleElement=this.shadowRoot.querySelector("#title"),this._bodyElement=this.shadowRoot.querySelector("tbody"),this._children=this.shadowRoot.querySelector("slot")}get map(){return this._inputMap}get mapElements(){return this._tableElements}connectedCallback(){if(Object.prototype.hasOwnProperty.call(this,"onload")){let e=this.onload;delete this.onload,this.onload=e}!function(e,t){if(Object.prototype.hasOwnProperty.call(e,t)){let n=e[t];delete e[t],e[t]=n}}(this,"src")}attributeChangedCallback(e,t,n){switch(e){case"onload":this.onload=new Function("event","with(document){with(this){"+n+"}}").bind(this)}((e,t,n)=>{switch(e){case"src":if(this._src!==n)if(this._src=n,n.trim().startsWith("{")){let e=JSON.parse(n);this._setInputMap(e)}else fetch(n).then((e=>e.json())).then((e=>this._setInputMap(e)));break;case"id":case"class":this._titleElement.innerHTML=`input-port${this.className?"."+this.className:""}${this.hasAttribute("id")?"#"+this.getAttribute("id"):""}`}})(e,0,n)}get src(){return this.getAttribute("src")}set src(e){switch(typeof e){case"object":{let t=JSON.stringify(e);this._src=t,this._setInputMap(e),this.setAttribute("src",t)}break;case"string":this.setAttribute("src",e);break;default:this.setAttribute("src",JSON.stringify(e))}}_setInputMap(e){let t={},n=[];for(let s in e){let i=[];J(i,s,e[s]),t[s]=i,n.push(...i)}this._bodyElement.innerHTML="";for(let e of n)this._bodyElement.appendChild(e);this._inputMap=e,this._tableElements=t,this.dispatchEvent(new CustomEvent("load",{bubbles:!1,composed:!0,detail:{map:e}}))}}function J(e,t,n){if(Array.isArray(n)){J(e,t,n[0]);let s=n.length;for(let i=1;i<s;++i)e.push(Q(t,n[i],!1))}else e.push(Q(t,n,!0));return e}function Q(e,t,n=!0){if("object"==typeof t){const{key:s,event:i,scale:r}=t;return ee(e,s,i,r,0,n)}return ee(e,t,null,1,0,n)}function ee(e,t,n,s,i,r=!0){let o=document.createElement("tr");r&&o.classList.add("primary");{let t=document.createElement("td");t.textContent=e,t.classList.add("name"),o.appendChild(t)}{let e=document.createElement("td");e.classList.add("key");let n=new $;n.innerText=t,e.appendChild(n),o.appendChild(e)}{let e=document.createElement("td"),t=document.createElement("samp"),i=[];"string"==typeof n&&"null"!==n&&i.push(n),"number"==typeof s&&1!==s&&i.push(`×(${s.toFixed(2)})`),t.innerText=i.join(" "),e.classList.add("mod"),e.appendChild(t),o.appendChild(e)}{let e=document.createElement("td"),t=document.createElement("output");t.innerText=Number(i).toFixed(2),t.classList.add("value"),e.appendChild(t),o.appendChild(e)}return o}window.customElements.define("input-map",Z);class te extends HTMLElement{static get[Symbol.for("cuttleTemplate")](){let e=document.createElement("template");return e.innerHTML='<div class="hidden">\n    <label id="title">\n        input-source\n    </label>\n    <span>|</span>\n    <p>\n        <label for="poll">poll</label>\n        <output id="poll"></output>\n    </p>\n    <p>\n        <label for="focus">focus</label>\n        <output id="focus"></output>\n    </p>\n</div>\n',Object.defineProperty(this,Symbol.for("cuttleTemplate"),{value:e}),e}static get[Symbol.for("cuttleStyle")](){let e=document.createElement("style");return e.innerHTML=':host{display:inline-block}.hidden{display:none}div{font-family:monospace;color:#666;outline:1px solid #666;padding:4px}p{display:inline;margin:0;padding:0}#focus:empty:after,#poll:empty:after{content:"✗";color:red}',Object.defineProperty(this,Symbol.for("cuttleStyle"),{value:e}),e}static get properties(){return{for:String,autopoll:Boolean,debug:Boolean}}get debug(){return this._debug}set debug(e){this.toggleAttribute("debug",e)}get autopoll(){return this._autopoll}set autopoll(e){this.toggleAttribute("autopoll",e)}get for(){return this._for}set for(e){this.setAttribute("for",e)}static get customEvents(){return["input","poll"]}get onpoll(){return this._onpoll}set onpoll(e){this._onpoll&&this.removeEventListener("poll",this._onpoll),this._onpoll=e,this._onpoll&&this.addEventListener("poll",e)}get oninput(){return this._oninput}set oninput(e){this._oninput&&this.removeEventListener("input",this._oninput),this._oninput=e,this._oninput&&this.addEventListener("input",e)}static get observedAttributes(){return["oninput","onpoll","for","autopoll","debug","id","class"]}constructor(){super(),this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(this.constructor[Symbol.for("cuttleTemplate")].content.cloneNode(!0)),this.shadowRoot.appendChild(this.constructor[Symbol.for("cuttleStyle")].cloneNode(!0)),this._containerElement=this.shadowRoot.querySelector("div"),this._titleElement=this.shadowRoot.querySelector("#title"),this._pollElement=this.shadowRoot.querySelector("#poll"),this._focusElement=this.shadowRoot.querySelector("#focus"),this._pollCount=0,this._pollCountDelay=0,this._sourceElement=null,this._inputSource=null,this.onSourceInput=this.onSourceInput.bind(this),this.onSourcePoll=this.onSourcePoll.bind(this),this.onSourceFocus=this.onSourceFocus.bind(this),this.onSourceBlur=this.onSourceBlur.bind(this)}get source(){return this._inputSource}poll(){this._inputSource.poll()}connectedCallback(){if(Object.prototype.hasOwnProperty.call(this,"oninput")){let e=this.oninput;delete this.oninput,this.oninput=e}if(Object.prototype.hasOwnProperty.call(this,"onpoll")){let e=this.onpoll;delete this.onpoll,this.onpoll=e}if(Object.prototype.hasOwnProperty.call(this,"for")){let e=this.for;delete this.for,this.for=e}if(Object.prototype.hasOwnProperty.call(this,"autopoll")){let e=this.autopoll;delete this.autopoll,this.autopoll=e}if(Object.prototype.hasOwnProperty.call(this,"debug")){let e=this.debug;delete this.debug,this.debug=e}this.hasAttribute("tabindex")||this.setAttribute("tabindex",0),this.hasAttribute("for")||this._setSourceElement(this)}disconnectedCallback(){this._clearSourceElement()}attributeChangedCallback(e,t,n){switch(e){case"for":this._for=n;break;case"autopoll":this._autopoll=null!==n;break;case"debug":this._debug=null!==n;break;case"oninput":this.oninput=new Function("event","with(document){with(this){"+n+"}}").bind(this);break;case"onpoll":this.onpoll=new Function("event","with(document){with(this){"+n+"}}").bind(this)}((e,t,n)=>{switch(e){case"for":this._setSourceElement(n?document.getElementById(n):this);break;case"id":case"class":{let e=this.className?"."+this.className:"",t=this.hasAttribute("id")?"#"+this.getAttribute("id"):"";this._titleElement.innerHTML=e+t}break;case"debug":this._containerElement.classList.toggle("hidden",n)}})(e,0,n)}onSourceInput(e){this.dispatchEvent(new CustomEvent("input",{composed:!0,bubbles:!1,detail:e}))}onSourcePoll(e){const{now:t}=e;if(this._pollCount+=1,this.dispatchEvent(new CustomEvent("poll",{composed:!0,bubbles:!1})),this.debug){t-this._pollCountDelay>1e3&&(this._pollCountDelay=t,this._pollCount>0?(this._pollElement.innerText="✓",this._pollCount=0):this._pollElement.innerText="")}}onSourceFocus(){this._focusElement.innerText="✓"}onSourceBlur(){this._focusElement.innerText=""}_clearSourceElement(){if(this._inputSource){let e=this._inputSource,t=this._sourceElement;this._inputSource=null,this._sourceElement=null,t.removeEventListener("focus",this.onSourceFocus),t.removeEventListener("blur",this.onSourceBlur),e.destroy()}}_setSourceElement(e){if(this._clearSourceElement(),!e)throw new Error("Event target not found.");let t=q.for(e);t.addEventListener("input",this.onSourceInput),t.addEventListener("poll",this.onSourcePoll),e.addEventListener("focus",this.onSourceFocus),e.addEventListener("blur",this.onSourceBlur),this._sourceElement=e,this._inputSource=t}}window.customElements.define("input-source",te);class ne extends HTMLElement{static get[Symbol.for("cuttleTemplate")](){let e=document.createElement("template");return e.innerHTML='<input-map class="hidden">\n    <slot></slot>\n    <input-source debug></input-source>\n</input-map>\n',Object.defineProperty(this,Symbol.for("cuttleTemplate"),{value:e}),e}static get[Symbol.for("cuttleStyle")](){let e=document.createElement("style");return e.innerHTML=":host{display:inline-block}.hidden{display:none}",Object.defineProperty(this,Symbol.for("cuttleStyle"),{value:e}),e}static get properties(){return{for:String,disabled:Boolean,debug:Boolean}}get debug(){return this._debug}set debug(e){this.toggleAttribute("debug",e)}get disabled(){return this._disabled}set disabled(e){this.toggleAttribute("disabled",e)}get for(){return this._for}set for(e){this.setAttribute("for",e)}static get observedAttributes(){return["for","disabled","debug","src","id","class"]}constructor(){super(),this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(this.constructor[Symbol.for("cuttleTemplate")].content.cloneNode(!0)),this.shadowRoot.appendChild(this.constructor[Symbol.for("cuttleStyle")].cloneNode(!0)),this._inputContext=new G,this._mapElement=this.shadowRoot.querySelector("input-map"),this._sourceElement=this.shadowRoot.querySelector("input-source"),this.onInputMapLoad=this.onInputMapLoad.bind(this),this.onInputSourcePoll=this.onInputSourcePoll.bind(this),this._mapElement.addEventListener("load",this.onInputMapLoad),this._sourceElement.addEventListener("poll",this.onInputSourcePoll)}get context(){return this._inputContext}get source(){return this._sourceElement.source}get map(){return this._mapElement.map}onInputMapLoad(){let e=this._sourceElement.source,t=this._mapElement.map;e&&t&&(this._inputContext.setInputMap(t).attach(e),this._inputContext.disabled=this._disabled)}onInputSourcePoll(){for(let[e,t]of Object.entries(this._mapElement.mapElements)){let n=this._inputContext.getInputValue(e);t[0].querySelector("output").innerText=Number(n).toFixed(2)}}connectedCallback(){if(Object.prototype.hasOwnProperty.call(this,"for")){let e=this.for;delete this.for,this.for=e}if(Object.prototype.hasOwnProperty.call(this,"disabled")){let e=this.disabled;delete this.disabled,this.disabled=e}if(Object.prototype.hasOwnProperty.call(this,"debug")){let e=this.debug;delete this.debug,this.debug=e}!function(e,t){if(Object.prototype.hasOwnProperty.call(e,t)){let n=e[t];delete e[t],e[t]=n}}(this,"src")}attributeChangedCallback(e,t,n){switch(e){case"for":this._for=n;break;case"disabled":this._disabled=null!==n;break;case"debug":this._debug=null!==n}((e,t,n)=>{switch(e){case"for":{this._sourceElement.for=n;let e=this._sourceElement.source,t=this._mapElement.map;t&&(this._inputContext.setInputMap(t).attach(e),this._inputContext.disabled=this._disabled)}break;case"src":this._mapElement.src=n;break;case"disabled":{let e=this._sourceElement.source,t=this._mapElement.map;e&&t&&(this._inputContext.disabled=this._disabled)}break;case"debug":this._mapElement.classList.toggle("hidden",null===n);break;case"id":this._sourceElement.id=n;break;case"class":this._sourceElement.className=n}})(e,0,n)}get src(){return this._mapElement.src}set src(e){this._mapElement.src=e}}window.customElements.define("input-context",ne);r(0,1,0);function se(e,i,o,a){let l=function(e,n,s,i){var r=new t(4);return r[0]=e,r[1]=n,r[2]=s,r[3]=i,r}(e,i,-1,1),h=n();s(h,o),p(l,l,h),l[2]=-1,l[3]=0,s(h,a),p(l,l,h);let c=r(l[0],l[1],l[2]);return u(c,c),c}const ie=Math.PI/3;class re extends class{constructor(e,t,n){this.canvas=e,this.projectionMatrix=t,this.viewMatrix=n,this.resize=this.resize.bind(this),e.addEventListener("resize",this.resize),setTimeout(this.resize,0)}destroy(){this.canvas.removeEventListener("resize",this.resize)}resize(){}}{constructor(e,t=ie,s=.1,i=1e3){super(e,n(),n()),this.fieldOfView=t,this.clippingPlane={near:s,far:i}}resize(){const e=this.canvas.width/this.canvas.height,{near:t,far:n}=this.clippingPlane;!function(e,t,n,s,i){var r,o=1/Math.tan(t/2);e[0]=o/n,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=o,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=i&&i!==1/0?(r=1/(s-i),e[10]=(i+s)*r,e[14]=2*i*s*r):(e[10]=-1,e[14]=-2*s)}(this.projectionMatrix,this.fieldOfView,e,t,n)}}const oe=Math.PI/180;class ae{constructor(e={locky:!1}){this.locky=e.locky,this.position=i(),this.forward=r(0,0,-1),this.right=r(1,0,0),this.up=r(0,1,0),this.forwardAmount=0,this.rightAmount=0,this.upAmount=0,this.pitch=0,this.yaw=-90}look(e,t,n=1){return this.pitch=Math.min(89.9,Math.max(-89.9,this.pitch+t*n)),this.yaw=(this.yaw+e*n)%360,this}move(e,t=0,n=0,s=1){return this.forwardAmount+=e*s,this.rightAmount+=t*s,this.upAmount+=n*s,this}apply(t){let{position:n,forward:s,right:r,up:c,forwardAmount:d,rightAmount:p,upAmount:m,pitch:f,yaw:b}=this,_=b*oe,v=f*oe,g=Math.cos(_),E=Math.cos(v),y=Math.sin(_),A=g*E,w=Math.sin(v),N=y*E;u(s,o(s,A,this.locky?0:w,N)),u(r,h(r,s,c));let S=i();return l(S,s,d),a(n,n,S),l(S,r,p),a(n,n,S),l(S,c,m),a(n,n,S),this.forwardAmount=0,this.rightAmount=0,this.upAmount=0,this.locky&&o(s,A,w,N),function(t,n,s,i){var r,o,a,l,u,h,c,d,p,m,f=n[0],b=n[1],_=n[2],v=i[0],g=i[1],E=i[2],y=s[0],A=s[1],w=s[2];Math.abs(f-y)<e&&Math.abs(b-A)<e&&Math.abs(_-w)<e?function(e){e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1}(t):(c=f-y,d=b-A,p=_-w,r=g*(p*=m=1/Math.hypot(c,d,p))-E*(d*=m),o=E*(c*=m)-v*p,a=v*d-g*c,(m=Math.hypot(r,o,a))?(r*=m=1/m,o*=m,a*=m):(r=0,o=0,a=0),l=d*a-p*o,u=p*r-c*a,h=c*o-d*r,(m=Math.hypot(l,u,h))?(l*=m=1/m,u*=m,h*=m):(l=0,u=0,h=0),t[0]=r,t[1]=l,t[2]=c,t[3]=0,t[4]=o,t[5]=u,t[6]=d,t[7]=0,t[8]=a,t[9]=h,t[10]=p,t[11]=0,t[12]=-(r*f+o*b+a*_),t[13]=-(l*f+u*b+h*_),t[14]=-(c*f+d*b+p*_),t[15]=1)}(t,n,a(S,n,s),c),t}}function le(e){return"undefined"!=typeof WebGL2RenderingContext&&e instanceof WebGL2RenderingContext}function ue(e,t){switch(t){case e.FLOAT:return 1;case e.FLOAT_VEC2:return 2;case e.FLOAT_VEC3:return 3;case e.FLOAT_VEC4:case e.FLOAT_MAT2:return 4;case e.FLOAT_MAT3:return 9;case e.FLOAT_MAT4:return 16;default:throw new Error("Invalid vertex attribute type.")}}function he(e,t,n){return new(function(e,t){switch(t){case e.BYTE:return Int8Array;case e.UNSIGNED_BYTE:return Uint8Array;case e.SHORT:return Int16Array;case e.UNSIGNED_SHORT:return Uint16Array;case e.INT:return Int32Array;case e.UNSIGNED_INT:return Uint32Array;case e.FLOAT:return Float32Array;default:throw new Error("Cannot find valid typed array for buffer type.")}}(e,t))(n)}function ce(e,t){switch(t){case e.FLOAT:return e.uniform1f;case e.FLOAT_VEC2:return e.uniform2fv;case e.FLOAT_VEC3:return e.uniform3fv;case e.FLOAT_VEC4:return e.uniform4fv;case e.INT:return e.uniform1i;case e.INT_VEC2:return e.uniform2iv;case e.INT_VEC3:return e.uniform3iv;case e.INT_VEC4:return e.uniform4iv;case e.BOOL:return e.uniform1i;case e.BOOL_VEC2:return e.uniform2iv;case e.BOOL_VEC3:return e.uniform3iv;case e.BOOL_VEC4:return e.uniform4iv;case e.FLOAT_MAT2:return pe;case e.FLOAT_MAT3:return me;case e.FLOAT_MAT4:return fe;case e.SAMPLER_2D:case e.SAMPLER_CUBE:return e.uniform1i}if(le(e))switch(t){case e.UNSIGNED_INT:return e.uniform1ui;case e.UNSIGNED_INT_VEC2:return e.uniform2uiv;case e.UNSIGNED_INT_VEC3:return e.uniform3uiv;case e.UNSIGNED_INT_VEC4:return e.uniform4uiv;case e.FLOAT_MAT2x3:return be;case e.FLOAT_MAT2x4:return _e;case e.FLOAT_MAT3x2:return ve;case e.FLOAT_MAT3x4:return ge;case e.FLOAT_MAT4x2:return Ee;case e.FLOAT_MAT4x3:return ye;case e.SAMPLER_3D:case e.SAMPLER_2D_SHADOW:case e.SAMPLER_2D_ARRAY:case e.SAMPLER_2D_ARRAY_SHADOW:case e.SAMPLER_CUBE_SHADOW:case e.INT_SAMPLER_2D:case e.INT_SAMPLER_3D:case e.INT_SAMPLER_CUBE:case e.INT_SAMPLER_2D_ARRAY:case e.UNSIGNED_INT_SAMPLER_2D:case e.UNSIGNED_INT_SAMPLER_3D:case e.UNSIGNED_INT_SAMPLER_CUBE:case e.UNSIGNED_INT_SAMPLER_2D_ARRAY:return e.uniform1i}throw new Error("Cannot find uniform function for gl enum.")}function de(e,t){switch(t){case e.FLOAT:return e.uniform1fv;case e.FLOAT_VEC2:return e.uniform2fv;case e.FLOAT_VEC3:return e.uniform3fv;case e.FLOAT_VEC4:return e.uniform4fv;case e.INT:return e.uniform1iv;case e.INT_VEC2:return e.uniform2iv;case e.INT_VEC3:return e.uniform3iv;case e.INT_VEC4:return e.uniform4iv;case e.BOOL:return e.uniform1iv;case e.BOOL_VEC2:return e.uniform2iv;case e.BOOL_VEC3:return e.uniform3iv;case e.BOOL_VEC4:return e.uniform4iv;case e.FLOAT_MAT2:return pe;case e.FLOAT_MAT3:return me;case e.FLOAT_MAT4:return fe;case e.SAMPLER_2D:case e.SAMPLER_CUBE:return e.uniform1iv}if(le(e))switch(t){case e.UNSIGNED_INT:return e.uniform1uiv;case e.UNSIGNED_INT_VEC2:return e.uniform2uiv;case e.UNSIGNED_INT_VEC3:return e.uniform3uiv;case e.UNSIGNED_INT_VEC4:return e.uniform4uiv;case e.FLOAT_MAT2x3:return be;case e.FLOAT_MAT2x4:return _e;case e.FLOAT_MAT3x2:return ve;case e.FLOAT_MAT3x4:return ge;case e.FLOAT_MAT4x2:return Ee;case e.FLOAT_MAT4x3:return ye;case e.SAMPLER_3D:case e.SAMPLER_2D_SHADOW:case e.SAMPLER_2D_ARRAY:case e.SAMPLER_2D_ARRAY_SHADOW:case e.SAMPLER_CUBE_SHADOW:case e.INT_SAMPLER_2D:case e.INT_SAMPLER_3D:case e.INT_SAMPLER_CUBE:case e.INT_SAMPLER_2D_ARRAY:case e.UNSIGNED_INT_SAMPLER_2D:case e.UNSIGNED_INT_SAMPLER_3D:case e.UNSIGNED_INT_SAMPLER_CUBE:case e.UNSIGNED_INT_SAMPLER_2D_ARRAY:return e.uniform1iv}throw new Error("Cannot find array uniform function for gl enum.")}function pe(e,t){this.uniformMatrix2fv(e,!1,t)}function me(e,t){this.uniformMatrix3fv(e,!1,t)}function fe(e,t){this.uniformMatrix4fv(e,!1,t)}function be(e,t){this.uniformMatrix2x3fv(e,!1,t)}function _e(e,t){this.uniformMatrix2x4fv(e,!1,t)}function ve(e,t){this.uniformMatrix3x2fv(e,!1,t)}function ge(e,t){this.uniformMatrix3x4fv(e,!1,t)}function Ee(e,t){this.uniformMatrix4x2fv(e,!1,t)}function ye(e,t){this.uniformMatrix4x3fv(e,!1,t)}class Ae{static from(e,t){return new Ae(e,t)}constructor(e,t){this.handle=t||e.createProgram(),this.shaders=[],this.gl=e}shader(e,t){let n=function(e,t,n){let s=e.createShader(t);return e.shaderSource(s,n),e.compileShader(s),e.getShaderParameter(s,e.COMPILE_STATUS)||(console.error(e.getShaderInfoLog(s)+`\nFailed to compile shader:\n${n}`),e.deleteShader(s)),s}(this.gl,e,t);return this.shaders.push(n),this}link(){return function(e,t,n){for(let s of n)e.attachShader(t,s);e.linkProgram(t);for(let s of n)e.detachShader(t,s),e.deleteShader(s);e.getProgramParameter(t,e.LINK_STATUS)||(console.error(e.getProgramInfoLog(t)),e.deleteProgram(t))}(this.gl,this.handle,this.shaders),this.shaders.length=0,this.handle}}class we extends Ae{constructor(e){super(e)}link(){const e=super.link();return new Ne(this.gl,e)}}class Ne{static from(e){return new we(e)}constructor(e,t){this.handle=t,this.activeUniforms=function(e,t){let n={};const s=function(e,t){let n=[];const s=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(let i=0;i<s;++i){let s=e.getActiveUniform(t,i);if(!s)break;n.push(s)}return n}(e,t);for(let i of s){const s=i.name,r=i.size,o=i.type,a=e.getUniformLocation(t,s);let l;l=r<=1?ce(e,o):de(e,o),n[s]={type:o,length:r,location:a,set:l}}return n}(e,t),this.activeAttributes=function(e,t){let n={};const s=function(e,t){let n=[];const s=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES);for(let i=0;i<s;++i){let s=e.getActiveAttrib(t,i);s&&n.push(s)}return n}(e,t);for(let i of s){const s=i.name,r=i.size,o=i.type,a=e.getAttribLocation(t,s),l=ue(e,o);n[s]={type:o,length:r,location:a,size:l}}return n}(e,t),this.drawContext=new Se(e,this)}bind(e){return e.useProgram(this.handle),this.drawContext.gl=e,this.drawContext}}class Se{constructor(e,t){this.gl=e,this.parent=t}uniform(e,t){const n=this.parent.activeUniforms;if(e in n){let s=n[e],i=s.location;s.set.call(this.gl,i,t)}return this}attribute(e,t,n,s=!1,i=0,r=0){const o=this.gl,a=this.parent.activeAttributes;if(e in a){let l=a[e],u=l.location,h=l.size;n?(o.bindBuffer(o.ARRAY_BUFFER,n),o.vertexAttribPointer(u,h,t,s,i,r),o.enableVertexAttribArray(u)):o.disableVertexAttribArray(u)}return this}draw(e,t,n,s,i=null){return function(e,t,n,s,i){i?(e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,i),e.drawElements(t,s,e.UNSIGNED_SHORT,n)):e.drawArrays(t,n,s)}(e,t,n,s,i),this.parent}}async function xe(e,t){return(await fetch(e)).text()}async function Te(e,t){return new Promise(((t,n)=>{let s=new Image;s.addEventListener("load",(()=>{t(s)})),s.addEventListener("error",(e=>{n(e)})),s.src=e}))}async function Le(e,t){let n=await fetch(e);return function(e){const t=[],n=[],s=[],i=[],r=[],o=[],a=/^#.*/g,l=/v\s+(\S+)\s+(\S+)\s+(\S+)/g,u=/vn\s+(\S+)\s+(\S+)\s+(\S+)/g,h=/vt\s+(\S+)\s+(\S+)/g,c=/f\s+(([^/\s]*)\/([^/\s]*)\/?([^/\s]*))\s+(([^/\s]*)\/([^/\s]*)\/?([^/\s]*))\s+(([^/\s]*)\/([^/\s]*)\/?([^/\s]*))(\s+(([^/\s]*)\/([^/\s]*)\/?([^/\s]*)))?/g,d=/f\s+([^/\s]+)\s+([^/\s]+)\s+([^/\s]+)/g;let p,m,f,b,_,v,g=!1,E=null;e=e.replace(a,"");for(;null!=(E=l.exec(e));)p=Number.parseFloat(E[1]),m=Number.parseFloat(E[2]),f=Number.parseFloat(E[3]),t.push(p),t.push(m),t.push(f);for(;null!=(E=u.exec(e));)p=Number.parseFloat(E[1]),m=Number.parseFloat(E[2]),f=Number.parseFloat(E[3]),s.push(p),s.push(m),s.push(f);for(;null!=(E=h.exec(e));)p=Number.parseFloat(E[1]),m=Number.parseFloat(E[2]),n.push(p),n.push(m);for(;null!=(E=c.exec(e));)p=Number.parseInt(E[2]),Number.isNaN(p)&&(p=1),m=Number.parseInt(E[6]),Number.isNaN(m)&&(m=1),f=Number.parseInt(E[10]),Number.isNaN(f)&&(f=1),i.push(p),i.push(m),i.push(f),p=Number.parseInt(E[4]),Number.isNaN(p)?(p=Number.parseInt(E[3]),m=Number.parseInt(E[7]),f=Number.parseInt(E[11]),o.push(p),o.push(m),o.push(f),r.push(1),r.push(1),r.push(1)):(m=Number.parseInt(E[8]),Number.isNaN(m)&&(m=1),f=Number.parseInt(E[12]),Number.isNaN(f)&&(f=1),o.push(p),o.push(m),o.push(f),p=Number.parseInt(E[3]),Number.isNaN(p)&&(p=1),m=Number.parseInt(E[7]),Number.isNaN(m)&&(m=1),f=Number.parseInt(E[11]),Number.isNaN(f)&&(f=1),r.push(p),r.push(m),r.push(f)),void 0!==E[13]&&(b=Number.parseInt(E[15]),Number.isNaN(b)&&(b=1),i.push(b),b=Number.parseInt(E[17]),Number.isNaN(b)?(b=Number.parseInt(E[16]),o.push(b),r.push(1)):(o.push(b),b=Number.parseInt(E[16]),r.push(b)),g=!0);for(;null!=(E=d.exec(e));)p=Number.parseInt(E[2]),m=Number.parseInt(E[6]),f=Number.parseInt(E[10]),i.push(p),i.push(m),i.push(f),r.push(1),r.push(1),r.push(1),o.push(1),o.push(1),o.push(1),void 0!==E[13]&&(b=Number.parseInt(E[14]),i.push(b),r.push(1),o.push(1),g=!0);v=i.length;const y=new Float32Array(3*v);for(let e=0;e<v;++e)_=i[e]-1,y[3*e+0]=t[3*_+0],y[3*e+1]=t[3*_+1],y[3*e+2]=t[3*_+2];v=r.length;const A=new Float32Array(2*v);for(let e=0;e<v;++e)_=r[e]-1,A[2*e+0]=n[2*_+0],A[2*e+1]=n[2*_+1];v=o.length;const w=new Float32Array(3*v);for(let e=0;e<v;++e)_=o[e]-1,w[3*e+0]=s[3*_+0],w[3*e+1]=s[3*_+1],w[3*e+2]=s[3*_+2];v=i.length;const N=new Uint16Array(v);for(let e=0;e<v;++e)N[e]=e;g&&console.warn("WebGL does not support quad faces, only triangles.");return{positions:y,texcoords:A,normals:w,indices:N}}(await n.text())}const Me={load:async()=>({mainVertexShaderSource:await xe("main.vert"),mainFragmentShaderSource:await xe("main.frag"),cubeObj:await Le("cube.obj"),quadObj:await Le("quad.obj"),gradientClay:await Te("gradient_clay.png"),color:await Te("null.png")})};class Ie{constructor(){this.nodes={},this.roots=[],this._nextAvailableSceneNodeId=1}createSceneNode(e){let t=this._nextAvailableSceneNodeId++,n={parent:0,children:[]};return this.nodes[t]=n,Re(e,t,this),t}createSceneNodes(e,t){let n=[];for(let s=0;s<e;++s)n.push(this.createSceneNode(t));return n}deleteSceneNode(e){if(!(e in this.nodes))throw new Error("Cannot delete non-existant scene node for scene graph.");Oe(this.nodes[e].parent,e,this),Ce(this,e,0,Fe)}deleteSceneNodes(e){for(let t of e)this.deleteSceneNode(t)}getSceneNodeInfo(e){return this.nodes[e]}parentSceneNode(e,t){Oe(this.nodes[e].parent,e,this),Re(t,e,this)}replaceSceneNode(e,t){let n=this.nodes[e],s=n.parent,i=n.children.slice();if(Oe(s,e,this),n.children.length=0,t){let e=this.nodes[t];Oe(e.parent,t,this),e.children.push(...i),Re(s,t,this)}else if(s){this.nodes[s].children.push(...i)}else this.roots.push(...i);for(let e of i)this.nodes[e].parent=s}walk(e,t={}){const{from:n,childFilter:s}=t;let i;i=n?Array.isArray(n)?n:[n]:this.roots,s&&(i=s(i,0,this));for(let t of i)Ce(this,t,0,e,s)}}function Re(e,t,n){e?(n.nodes[e].children.push(t),n.nodes[t].parent=e):(n.roots.push(t),n.nodes[t].parent=0)}function Oe(e,t,n){if(e){let s=n.nodes[e].children,i=s.indexOf(t);s.splice(i,1),n.nodes[t].parentNode=0}else{let e=n.roots,s=e.indexOf(t);e.splice(s,1),n.nodes[t].parentNode=0}}function Ce(e,t,n,s,i){if(n>=100)return;let r=s(t,e);if(!1===r)return;let o=e.nodes[t],a=i?i(o.children,t,e):o.children;for(let t of a)Ce(e,t,n+1,s,i);"function"==typeof r&&r(t,e)}function Fe(e,t){delete t.nodes[e]}class Pe{constructor(e,t,n){this.shaderProgram=t,this.meshData=n;let s=n;{const t=he(e,e.FLOAT,s.positions),n=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,n),e.bufferData(e.ARRAY_BUFFER,t,e.STATIC_DRAW),this.positions={source:t,buffer:n}}{const t=he(e,e.FLOAT,s.texcoords),n=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,n),e.bufferData(e.ARRAY_BUFFER,t,e.STATIC_DRAW),this.texcoords={source:t,buffer:n}}{const t=he(e,e.FLOAT,s.normals),n=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,n),e.bufferData(e.ARRAY_BUFFER,t,e.STATIC_DRAW),this.normals={source:t,buffer:n}}const i=he(e,e.UNSIGNED_SHORT,s.indices),r=e.createBuffer();e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,r),e.bufferData(e.ELEMENT_ARRAY_BUFFER,i,e.STATIC_DRAW),this.elements={source:i,buffer:r},this._drawContext=new ke(this)}begin(e,t,n){let s=this.shaderProgram.bind(e);return s.uniform("u_projection",t),s.uniform("u_view",n),this._drawContext.setProgramContext(s),this._drawContext}}class ke{constructor(e){this.renderer=e,this.ctx=null}setProgramContext(e){return this.ctx=e,this}render(e,t,n){const{ctx:s,renderer:i}=this,{positions:r,texcoords:o,normals:a,elements:l}=i;s.attribute("a_position",e.FLOAT,r.buffer,3),s.attribute("a_texcoord",e.FLOAT,o.buffer,2),s.attribute("a_normal",e.FLOAT,a.buffer,3),s.uniform("u_model",t),n&&s.uniform("u_color",n),s.draw(e,e.TRIANGLES,0,l.source.length,l.buffer)}end(e){return this.renderer}}class De{constructor(e,t,n){this.shaderProgram=t,this.meshData=n;let s=n;const i=he(e,e.FLOAT,s.positions),r=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,r),e.bufferData(e.ARRAY_BUFFER,i,e.STATIC_DRAW),this.positions={source:i,buffer:r};{const t=he(e,e.FLOAT,s.texcoords),n=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,n),e.bufferData(e.ARRAY_BUFFER,t,e.STATIC_DRAW),this.texcoords={source:t,buffer:n}}{const t=he(e,e.FLOAT,s.normals),n=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,n),e.bufferData(e.ARRAY_BUFFER,t,e.STATIC_DRAW),this.normals={source:t,buffer:n}}const o=he(e,e.UNSIGNED_SHORT,s.indices),a=e.createBuffer();e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,a),e.bufferData(e.ELEMENT_ARRAY_BUFFER,o,e.STATIC_DRAW),this.elements={source:o,buffer:a},this._drawContext=new Ue(this)}begin(e,t,n){let s=this.shaderProgram.bind(e);return s.uniform("u_projection",t),s.uniform("u_view",n),this._drawContext.setProgramContext(s),this._drawContext}}class Ue{constructor(e){this.renderer=e,this.ctx=null}setProgramContext(e){return this.ctx=e,this}render(e,t,n){const{ctx:s,renderer:i}=this,{positions:r,texcoords:o,normals:a,elements:l}=i;s.attribute("a_position",e.FLOAT,r.buffer,3),s.attribute("a_texcoord",e.FLOAT,o.buffer,2),s.attribute("a_normal",e.FLOAT,a.buffer,3),s.uniform("u_model",t),n&&s.uniform("u_color",n),s.draw(e,e.TRIANGLES,0,l.source.length,l.buffer)}end(e){return this.renderer}}document.addEventListener("DOMContentLoaded",(async function(){const e=document.querySelector("display-port"),t=document.querySelector("input-context");s=e,s.addEventListener("focus",(()=>{document.pointerLockElement!==s&&s.requestPointerLock()})),document.addEventListener("pointerlockchange",(()=>{document.pointerLockElement!==s&&s.blur()}));var s;const i=e.canvas.getContext("webgl");if(!i)throw new Error("Your browser does not support WebGL.");i.enable(i.DEPTH_TEST);const o=await Me.load(),a=i.createTexture();i.bindTexture(i.TEXTURE_2D,a),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,1,1,0,i.RGBA,i.UNSIGNED_BYTE,new Uint8Array([0,0,255,255])),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,o.gradientClay),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.NEAREST),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.NEAREST);const l=Ne.from(i).shader(i.VERTEX_SHADER,o.mainVertexShaderSource).shader(i.FRAGMENT_SHADER,o.mainFragmentShaderSource).link(),u=new Pe(i,l,o.cubeObj),h=new De(i,l,o.quadObj),c=new re(i.canvas),d=new ae({locky:!0});d.move(-15,0,5),d.look(0,-20);const p=new Map,f=new Ie;function b(e=0,t=0,s=0,i=1,o=1,a=1,l=0,u=0,h=0,c=r(Math.random(),Math.random(),Math.random()),d={}){let b=f.createSceneNode(),_={worldMatrix:n(),localMatrix:n()};return function(e,t,n,s){var i=t[0],r=t[1],o=t[2],a=t[3],l=i+i,u=r+r,h=o+o,c=i*l,d=i*u,p=i*h,m=r*u,f=r*h,b=o*h,_=a*l,v=a*u,g=a*h,E=s[0],y=s[1],A=s[2];e[0]=(1-(m+b))*E,e[1]=(d+g)*E,e[2]=(p-v)*E,e[3]=0,e[4]=(d-g)*y,e[5]=(1-(c+b))*y,e[6]=(f+_)*y,e[7]=0,e[8]=(p+v)*A,e[9]=(f-_)*A,e[10]=(1-(c+m))*A,e[11]=0,e[12]=n[0],e[13]=n[1],e[14]=n[2],e[15]=1}(_.localMatrix,function(e,t,n,s){var i=.5*Math.PI/180;t*=i,n*=i,s*=i;var r=Math.sin(t),o=Math.cos(t),a=Math.sin(n),l=Math.cos(n),u=Math.sin(s),h=Math.cos(s);return e[0]=r*l*h-o*a*u,e[1]=o*a*h+r*l*u,e[2]=o*l*u-r*a*h,e[3]=o*l*h+r*a*u,e}(m(),l,u,h),r(e,t,s),r(i,o,a)),p.set(b,_),{sceneNode:b,transform:_,color:c,...d}}const _=b(),v=((()=>{const e=.01,t=.1,n=.11,s=b(n,0,0,t,e,e,0,0,0,r(1,0,0)),i=b(0,n,0,e,t,e,0,0,0,r(0,1,0)),o=b(0,0,n,e,e,t,0,0,0,r(0,0,1)),a=b(0,0,0,e,e,e,0,0,0,r(1,1,1));f.parentSceneNode(s.sceneNode,_.sceneNode),f.parentSceneNode(i.sceneNode,_.sceneNode),f.parentSceneNode(o.sceneNode,_.sceneNode),f.parentSceneNode(a.sceneNode,_.sceneNode)})(),b()),g=((()=>{let e=b(0,-2.5,0,.8,.5,.8),t=b(0,-2,0,1.05,.2,1.05),n=b(0,-1,0,.6,1,.6),s=b(0,-1.8,0,.7,.2,.7);const i=.3;let r=b(0,.15,0,.6,.2,.6,-5),o=b(0,.05,0,1,.1,1,-5),a=b(-.3,-.3,.6,.1,.1,.1),l=b(.3,-.3,.6,.1,.1,.1),u=b(-.9,-.7,0,.2,.3,.2,0,0,90),h=b(-1,-.7+i,0,.2,.1,.2,0,0,0);h.color=u.color;let c=b(.9,-1,0,.2,.3,.2,0,0,90),d=b(1,-.7,0,.2,.1,.2,0,0,0);d.color=c.color,f.parentSceneNode(t.sceneNode,v.sceneNode),f.parentSceneNode(e.sceneNode,v.sceneNode),f.parentSceneNode(s.sceneNode,v.sceneNode),f.parentSceneNode(r.sceneNode,v.sceneNode),f.parentSceneNode(o.sceneNode,v.sceneNode),f.parentSceneNode(a.sceneNode,v.sceneNode),f.parentSceneNode(l.sceneNode,v.sceneNode),f.parentSceneNode(n.sceneNode,v.sceneNode),f.parentSceneNode(u.sceneNode,v.sceneNode),f.parentSceneNode(h.sceneNode,v.sceneNode),f.parentSceneNode(c.sceneNode,v.sceneNode),f.parentSceneNode(d.sceneNode,v.sceneNode)})(),[b(0,0,0,1,1,1),b(4,0,0,1,.5,1),b(-4,0,0,2,4,2,45)]),E=[b(0,-4,0,2,2,2)];let y=0;e.addEventListener("frame",(e=>{e.detail.deltaTime;t.source.poll();const n=t.context.getInputValue("PointerX"),s=t.context.getInputValue("PointerY"),r=t.context.getInputValue("PointerMovementX"),o=t.context.getInputValue("PointerMovementY"),a=t.context.getInputValue("PointerMovementZ"),l=t.context.getInputValue("MoveRight")-t.context.getInputValue("MoveLeft"),m=t.context.getInputValue("MoveUp")-t.context.getInputValue("MoveDown");i.viewport(0,0,i.canvas.width,i.canvas.height),i.clearColor(0,0,0,0),i.clear(i.COLOR_BUFFER_BIT);let b=c;const v=i.canvas.width/i.canvas.height;d.look(100*r*v,100*-o);d.move(.5*m,.5*l),d.apply(b.viewMatrix),y+=a/1e3;let A,w=se(2*(n-.5),2*(.5-s),b.projectionMatrix,b.viewMatrix);!function(e,t,n,s){e[0]=t[0]+n[0]*s,e[1]=t[1]+n[1]*s,e[2]=t[2]+n[2]*s}(w,d.position,w,1-y),function(e,t){e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1}(_.transform.localMatrix,w),f.walk(((e,t)=>{let{parent:n}=t.getSceneNodeInfo(e);!function(e,t){t?function(e,t,n){var s=t[0],i=t[1],r=t[2],o=t[3],a=t[4],l=t[5],u=t[6],h=t[7],c=t[8],d=t[9],p=t[10],m=t[11],f=t[12],b=t[13],_=t[14],v=t[15],g=n[0],E=n[1],y=n[2],A=n[3];e[0]=g*s+E*a+y*c+A*f,e[1]=g*i+E*l+y*d+A*b,e[2]=g*r+E*u+y*p+A*_,e[3]=g*o+E*h+y*m+A*v,g=n[4],E=n[5],y=n[6],A=n[7],e[4]=g*s+E*a+y*c+A*f,e[5]=g*i+E*l+y*d+A*b,e[6]=g*r+E*u+y*p+A*_,e[7]=g*o+E*h+y*m+A*v,g=n[8],E=n[9],y=n[10],A=n[11],e[8]=g*s+E*a+y*c+A*f,e[9]=g*i+E*l+y*d+A*b,e[10]=g*r+E*u+y*p+A*_,e[11]=g*o+E*h+y*m+A*v,g=n[12],E=n[13],y=n[14],A=n[15],e[12]=g*s+E*a+y*c+A*f,e[13]=g*i+E*l+y*d+A*b,e[14]=g*r+E*u+y*p+A*_,e[15]=g*o+E*h+y*m+A*v}(e.worldMatrix,t.worldMatrix,e.localMatrix):function(e,t){e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]}(e.worldMatrix,e.localMatrix)}(p.get(e),n?p.get(n):null)})),A=u.begin(i,b.projectionMatrix,b.viewMatrix),A.ctx.uniform("u_texture",0);for(let e of g)A.ctx.uniform("u_local",e.transform.localMatrix),A.render(i,e.transform.worldMatrix,e.color);A.end(i),A=h.begin(i,b.projectionMatrix,b.viewMatrix),A.ctx.uniform("u_texture",0);for(let e of E)A.ctx.uniform("u_local",e.transform.localMatrix),A.render(i,e.transform.worldMatrix,e.color);A.end(i)}))}))}();
