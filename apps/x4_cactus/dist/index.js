!function(){"use strict";var e=1e-6,t="undefined"!=typeof Float32Array?Float32Array:Array;function n(){var e=new t(16);return t!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function s(e,t){var n=t[0],s=t[1],i=t[2],r=t[3],o=t[4],a=t[5],l=t[6],u=t[7],h=t[8],d=t[9],c=t[10],p=t[11],m=t[12],f=t[13],b=t[14],y=t[15],_=n*a-s*o,v=n*l-i*o,g=n*u-r*o,E=s*l-i*a,A=s*u-r*a,N=i*u-r*l,T=h*f-d*m,S=h*b-c*m,w=h*y-p*m,x=d*b-c*f,L=d*y-p*f,M=c*y-p*b,I=_*M-v*L+g*x+E*w-A*S+N*T;return I?(I=1/I,e[0]=(a*M-l*L+u*x)*I,e[1]=(i*L-s*M-r*x)*I,e[2]=(f*N-b*A+y*E)*I,e[3]=(c*A-d*N-p*E)*I,e[4]=(l*w-o*M-u*S)*I,e[5]=(n*M-i*w+r*S)*I,e[6]=(b*g-m*N-y*v)*I,e[7]=(h*N-c*g+p*v)*I,e[8]=(o*L-a*w+u*T)*I,e[9]=(s*w-n*L-r*T)*I,e[10]=(m*A-f*g+y*_)*I,e[11]=(d*g-h*A-p*_)*I,e[12]=(a*S-o*x-l*T)*I,e[13]=(n*x-s*S+i*T)*I,e[14]=(f*v-m*E-b*_)*I,e[15]=(h*E-d*v+c*_)*I,e):null}function i(){var e=new t(3);return t!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function r(e,n,s){var i=new t(3);return i[0]=e,i[1]=n,i[2]=s,i}function o(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e}function a(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e}function l(e,t){var n=t[0],s=t[1],i=t[2],r=n*n+s*s+i*i;return r>0&&(r=1/Math.sqrt(r)),e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e}function u(e,t,n){var s=t[0],i=t[1],r=t[2],o=n[0],a=n[1],l=n[2];return e[0]=i*l-r*a,e[1]=r*o-s*l,e[2]=s*a-i*o,e}Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)});var h,d=function(e){var t=e[0],n=e[1],s=e[2];return Math.hypot(t,n,s)};h=i();function c(e,t,n){var s=t[0],i=t[1],r=t[2],o=t[3];return e[0]=n[0]*s+n[4]*i+n[8]*r+n[12]*o,e[1]=n[1]*s+n[5]*i+n[9]*r+n[13]*o,e[2]=n[2]*s+n[6]*i+n[10]*r+n[14]*o,e[3]=n[3]*s+n[7]*i+n[11]*r+n[15]*o,e}!function(){var e,n=(e=new t(4),t!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e)}();function p(){var e=new t(4);return t!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}function m(t,n,s,i){var r,o,a,l,u,h=n[0],d=n[1],c=n[2],p=n[3],m=s[0],f=s[1],b=s[2],y=s[3];return(o=h*m+d*f+c*b+p*y)<0&&(o=-o,m=-m,f=-f,b=-b,y=-y),1-o>e?(r=Math.acos(o),a=Math.sin(r),l=Math.sin((1-i)*r)/a,u=Math.sin(i*r)/a):(l=1-i,u=i),t[0]=l*h+u*m,t[1]=l*d+u*f,t[2]=l*c+u*b,t[3]=l*p+u*y,t}var f,b,y,_,v,g,E,A=function(e,t){var n=t[0],s=t[1],i=t[2],r=t[3],o=n*n+s*s+i*i+r*r;return o>0&&(o=1/Math.sqrt(o)),e[0]=n*o,e[1]=s*o,e[2]=i*o,e[3]=r*o,e};f=i(),b=r(1,0,0),y=r(0,1,0),_=p(),v=p(),g=new t(9),t!=Float32Array&&(g[1]=0,g[2]=0,g[3]=0,g[5]=0,g[6]=0,g[7]=0),g[0]=1,g[4]=1,g[8]=1,E=g;let N=null;function T(e,t){return N||(N=function(e){let t={};if(!(e instanceof WebGLRenderingContext))throw new Error("Unknown gl context provided.");t[e.FLOAT]={TypedArray:Float32Array,size:4,uniform:e.uniform1f,arrayUniform:e.uniform1fv},t[e.FLOAT_VEC2]={TypedArray:Float32Array,size:8,uniform:e.uniform2fv,arrayType:e.FLOAT},t[e.FLOAT_VEC3]={TypedArray:Float32Array,size:12,uniform:e.uniform3fv,arrayType:e.FLOAT},t[e.FLOAT_VEC4]={TypedArray:Float32Array,size:16,uniform:e.uniform4fv,arrayType:e.FLOAT},t[e.INT]={TypedArray:Int32Array,size:4,uniform:e.uniform1i,arrayUniform:e.uniform1iv},t[e.INT_VEC2]={TypedArray:Int32Array,size:8,uniform:e.uniform2iv,arrayType:e.INT},t[e.INT_VEC3]={TypedArray:Int32Array,size:12,uniform:e.uniform3iv,arrayType:e.INT},t[e.INT_VEC4]={TypedArray:Int32Array,size:16,uniform:e.uniform4iv,arrayType:e.INT},t[e.UNSIGNED_INT]={TypedArray:Uint32Array,size:4,uniform:e.uniform1ui,arrayUniform:e.uniform1uiv},t[e.UNSIGNED_INT_VEC2]={TypedArray:Uint32Array,size:8,uniform:e.uniform2uiv,arrayType:e.UNSIGNED_INT},t[e.UNSIGNED_INT_VEC3]={TypedArray:Uint32Array,size:12,uniform:e.uniform3uiv,arrayType:e.UNSIGNED_INT},t[e.UNSIGNED_INT_VEC4]={TypedArray:Uint32Array,size:16,uniform:e.uniform4uiv,arrayType:e.UNSIGNED_INT},t[e.BOOL]={TypedArray:Uint32Array,size:4,uniform:e.uniform1i,arrayUniform:e.uniform1iv},t[e.BOOL_VEC2]={TypedArray:Uint32Array,size:8,uniform:e.uniform2iv,arrayType:e.BOOL},t[e.BOOL_VEC3]={TypedArray:Uint32Array,size:12,uniform:e.uniform3iv,arrayType:e.BOOL},t[e.BOOL_VEC4]={TypedArray:Uint32Array,size:16,uniform:e.uniform4iv,arrayType:e.BOOL},t[e.FLOAT_MAT2]={TypedArray:Float32Array,size:16,uniform:w,arrayType:e.FLOAT},t[e.FLOAT_MAT3]={TypedArray:Float32Array,size:36,uniform:x,arrayType:e.FLOAT},t[e.FLOAT_MAT4]={TypedArray:Float32Array,size:64,uniform:L,arrayType:e.FLOAT},t[e.UNSIGNED_BYTE]={TypedArray:Uint8Array,size:1},t[e.UNSIGNED_SHORT]={TypedArray:Uint16Array,size:2};"undefined"!=typeof WebGL2RenderingContext&&e instanceof WebGL2RenderingContext?(t[e.FLOAT_MAT2x3]={TypedArray:Float32Array,size:24,uniform:M,arrayType:e.FLOAT},t[e.FLOAT_MAT2x4]={TypedArray:Float32Array,size:32,uniform:R,arrayType:e.FLOAT},t[e.FLOAT_MAT3x2]={TypedArray:Float32Array,size:24,uniform:I,arrayType:e.FLOAT},t[e.FLOAT_MAT3x4]={TypedArray:Float32Array,size:48,uniform:C,arrayType:e.FLOAT},t[e.FLOAT_MAT4x2]={TypedArray:Float32Array,size:32,uniform:O,arrayType:e.FLOAT},t[e.FLOAT_MAT4x3]={TypedArray:Float32Array,size:48,uniform:k,arrayType:e.FLOAT},S(e,t,D,U)):S(e,t,P,F);return t}(e)),N[t]}function S(e,t,n,s){return t[e.SAMPLER_2D]={TypedArray:null,size:0,sampler:n,arraySampler:s,bindPoint:e.TEXTURE_2D},t[e.SAMPLER_CUBE]={TypedArray:null,size:0,sampler:n,arraySampler:s,bindPoint:e.TEXTURE_CUBE_MAP},t[e.SAMPLER_3D]={TypedArray:null,size:0,sampler:n,arraySampler:s,bindPoint:e.TEXTURE_3D},t[e.SAMPLER_2D_SHADOW]={TypedArray:null,size:0,sampler:n,arraySampler:s,bindPoint:e.TEXTURE_2D},t[e.SAMPLER_2D_ARRAY]={TypedArray:null,size:0,sampler:n,arraySampler:s,bindPoint:e.TEXTURE_2D_ARRAY},t[e.SAMPLER_2D_ARRAY_SHADOW]={TypedArray:null,size:0,sampler:n,arraySampler:s,bindPoint:e.TEXTURE_2D_ARRAY},t[e.SAMPLER_CUBE_SHADOW]={TypedArray:null,size:0,sampler:n,arraySampler:s,bindPoint:e.TEXTURE_CUBE_MAP},t[e.INT_SAMPLER_2D]={TypedArray:null,size:0,sampler:n,arraySampler:s,bindPoint:e.TEXTURE_2D},t[e.INT_SAMPLER_3D]={TypedArray:null,size:0,sampler:n,arraySampler:s,bindPoint:e.TEXTURE_3D},t[e.INT_SAMPLER_CUBE]={TypedArray:null,size:0,sampler:n,arraySampler:s,bindPoint:e.TEXTURE_CUBE_MAP},t[e.INT_SAMPLER_2D_ARRAY]={TypedArray:null,size:0,sampler:n,arraySampler:s,bindPoint:e.TEXTURE_2D_ARRAY},t[e.UNSIGNED_INT_SAMPLER_2D]={TypedArray:null,size:0,sampler:n,arraySampler:s,bindPoint:e.TEXTURE_2D},t[e.UNSIGNED_INT_SAMPLER_3D]={TypedArray:null,size:0,sampler:n,arraySampler:s,bindPoint:e.TEXTURE_3D},t[e.UNSIGNED_INT_SAMPLER_CUBE]={TypedArray:null,size:0,sampler:n,arraySampler:s,bindPoint:e.TEXTURE_CUBE_MAP},t[e.UNSIGNED_INT_SAMPLER_2D_ARRAY]={TypedArray:null,size:0,sampler:n,arraySampler:s,bindPoint:e.TEXTURE_2D_ARRAY},t}function w(e,t){this.uniformMatrix2fv(e,!1,t)}function x(e,t){this.uniformMatrix3fv(e,!1,t)}function L(e,t){this.uniformMatrix4fv(e,!1,t)}function M(e,t){this.uniformMatrix2x3fv(e,!1,t)}function I(e,t){this.uniformMatrix3x2fv(e,!1,t)}function R(e,t){this.uniformMatrix2x4fv(e,!1,t)}function O(e,t){this.uniformMatrix4x2fv(e,!1,t)}function C(e,t){this.uniformMatrix3x4fv(e,!1,t)}function k(e,t){this.uniformMatrix4x3fv(e,!1,t)}function P(e,t){return function(n,s){this.uniform1i(n,t),this.activeTexture(this.TEXTURE0+t),this.bindTexture(e,s)}}function F(e,t,n){const s=new Int32Array(n);for(let e=0;e<n;++e)s[e]=t+e;return function(t,n){this.uniform1iv(t,s),n.forEach((function(t,n){this.activeTexture(this.TEXTURE0+s[n]),this.bindTexture(e,t)}))}}function D(e,t){return function(n,s){let i,r;s instanceof WebGLTexture?(i=s,r=null):(i=s.texture,r=s.sampler),this.uniform1i(n,t),this.activeTexture(this.TEXTURE0+t),this.bindTexture(e,i),this.bindSampler(t,r)}}function U(e,t,n){const s=new Int32Array(n);for(let e=0;e<n;++e)s[e]=t+e;return function(n,i){this.uniform1iv(n,s),i.forEach((function(n,i){let r,o;this.activeTexture(this.TEXTURE0+s[i]),n instanceof WebGLTexture?(r=n,o=null):(r=n.texture,o=n.sampler),this.bindSampler(t,o),this.bindTexture(e,r)}))}}function B(e,t,n){let{TypedArray:s}=T(e,t);return new s(n)}class j{constructor(e){this.handle=e.createProgram(),this.shaders=[],this.gl=e}shader(e,t){let n=function(e,t,n){let s=e.createShader(t);if(e.shaderSource(s,n),e.compileShader(s),e.getShaderParameter(s,e.COMPILE_STATUS))return s;console.error(e.getShaderInfoLog(s)+"\nFailed to compile shader:\n"+n),e.deleteShader(s)}(this.gl,e,t);return this.shaders.push(n),this}link(){return function(e,t,n){for(let s of n)e.attachShader(t,s);e.linkProgram(t);for(let s of n)e.detachShader(t,s),e.deleteShader(s);if(e.getProgramParameter(t,e.LINK_STATUS))return t;console.error(e.getProgramInfoLog(t)),e.deleteProgram(t)}(this.gl,this.handle,this.shaders),this.shaders.length=0,this.handle}}function z(e){return"undefined"!=typeof WebGL2RenderingContext&&e instanceof WebGL2RenderingContext}function H(e,t){switch(t){case e.FLOAT:return e.uniform1f;case e.FLOAT_VEC2:return e.uniform2fv;case e.FLOAT_VEC3:return e.uniform3fv;case e.FLOAT_VEC4:return e.uniform4fv;case e.INT:return e.uniform1i;case e.INT_VEC2:return e.uniform2iv;case e.INT_VEC3:return e.uniform3iv;case e.INT_VEC4:return e.uniform4iv;case e.BOOL:return e.uniform1i;case e.BOOL_VEC2:return e.uniform2iv;case e.BOOL_VEC3:return e.uniform3iv;case e.BOOL_VEC4:return e.uniform4iv;case e.FLOAT_MAT2:return W;case e.FLOAT_MAT3:return Y;case e.FLOAT_MAT4:return G;case e.SAMPLER_2D:case e.SAMPLER_CUBE:return e.uniform1i}if(z(e))switch(t){case e.UNSIGNED_INT:return e.uniform1ui;case e.UNSIGNED_INT_VEC2:return e.uniform2uiv;case e.UNSIGNED_INT_VEC3:return e.uniform3uiv;case e.UNSIGNED_INT_VEC4:return e.uniform4uiv;case e.FLOAT_MAT2x3:return q;case e.FLOAT_MAT2x4:return X;case e.FLOAT_MAT3x2:return K;case e.FLOAT_MAT3x4:return $;case e.FLOAT_MAT4x2:return J;case e.FLOAT_MAT4x3:return Z;case e.SAMPLER_3D:case e.SAMPLER_2D_SHADOW:case e.SAMPLER_2D_ARRAY:case e.SAMPLER_2D_ARRAY_SHADOW:case e.SAMPLER_CUBE_SHADOW:case e.INT_SAMPLER_2D:case e.INT_SAMPLER_3D:case e.INT_SAMPLER_CUBE:case e.INT_SAMPLER_2D_ARRAY:case e.UNSIGNED_INT_SAMPLER_2D:case e.UNSIGNED_INT_SAMPLER_3D:case e.UNSIGNED_INT_SAMPLER_CUBE:case e.UNSIGNED_INT_SAMPLER_2D_ARRAY:return e.uniform1i}throw new Error("Cannot find uniform function for data type.")}function V(e,t){switch(t){case e.FLOAT:return e.uniform1fv;case e.FLOAT_VEC2:return e.uniform2fv;case e.FLOAT_VEC3:return e.uniform3fv;case e.FLOAT_VEC4:return e.uniform4fv;case e.INT:return e.uniform1iv;case e.INT_VEC2:return e.uniform2iv;case e.INT_VEC3:return e.uniform3iv;case e.INT_VEC4:return e.uniform4iv;case e.BOOL:return e.uniform1iv;case e.BOOL_VEC2:return e.uniform2iv;case e.BOOL_VEC3:return e.uniform3iv;case e.BOOL_VEC4:return e.uniform4iv;case e.FLOAT_MAT2:return W;case e.FLOAT_MAT3:return Y;case e.FLOAT_MAT4:return G;case e.SAMPLER_2D:case e.SAMPLER_CUBE:return e.uniform1iv}if(z(e))switch(t){case e.UNSIGNED_INT:return e.uniform1uiv;case e.UNSIGNED_INT_VEC2:return e.uniform2uiv;case e.UNSIGNED_INT_VEC3:return e.uniform3uiv;case e.UNSIGNED_INT_VEC4:return e.uniform4uiv;case e.FLOAT_MAT2x3:return q;case e.FLOAT_MAT2x4:return X;case e.FLOAT_MAT3x2:return K;case e.FLOAT_MAT3x4:return $;case e.FLOAT_MAT4x2:return J;case e.FLOAT_MAT4x3:return Z;case e.SAMPLER_3D:case e.SAMPLER_2D_SHADOW:case e.SAMPLER_2D_ARRAY:case e.SAMPLER_2D_ARRAY_SHADOW:case e.SAMPLER_CUBE_SHADOW:case e.INT_SAMPLER_2D:case e.INT_SAMPLER_3D:case e.INT_SAMPLER_CUBE:case e.INT_SAMPLER_2D_ARRAY:case e.UNSIGNED_INT_SAMPLER_2D:case e.UNSIGNED_INT_SAMPLER_3D:case e.UNSIGNED_INT_SAMPLER_CUBE:case e.UNSIGNED_INT_SAMPLER_2D_ARRAY:return e.uniform1iv}throw new Error("Cannot find array uniform function for data type.")}function W(e,t){this.uniformMatrix2fv(e,!1,t)}function Y(e,t){this.uniformMatrix3fv(e,!1,t)}function G(e,t){this.uniformMatrix4fv(e,!1,t)}function q(e,t){this.uniformMatrix2x3fv(e,!1,t)}function X(e,t){this.uniformMatrix2x4fv(e,!1,t)}function K(e,t){this.uniformMatrix3x2fv(e,!1,t)}function $(e,t){this.uniformMatrix3x4fv(e,!1,t)}function J(e,t){this.uniformMatrix4x2fv(e,!1,t)}function Z(e,t){this.uniformMatrix4x3fv(e,!1,t)}class Q{constructor(e,t){this.handle=t,this.activeUniforms=function(e,t){let n={};const s=function(e,t){let n=[];const s=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(let i=0;i<s;++i){let s=e.getActiveUniform(t,i);if(!s)break;n.push(s)}return n}(e,t);for(let i of s){const s=i.name,r=i.size,o=i.type,a=e.getUniformLocation(t,s);let l;l=r<=1?H(e,o):V(e,o),n[s]={type:o,length:r,location:a,set:l}}return n}(e,t),this.activeAttributes=function(e,t){let n={};const s=function(e,t){let n=[];const s=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES);for(let i=0;i<s;++i){let s=e.getActiveAttrib(t,i);s&&n.push(s)}return n}(e,t);for(let i of s){const s=i.name,r=i.size,o=i.type,a=e.getAttribLocation(t,s);n[s]={type:o,length:r,location:a}}return n}(e,t),this.drawContext=new ee(this)}bind(e){return e.useProgram(this.handle),this.drawContext.gl=e,this.drawContext}}class ee{constructor(e){this.parent=e,this.gl=null}uniform(e,t){const n=this.parent.activeUniforms;if(e in n){let s=n[e],i=s.location;s.set.call(this.gl,i,t)}return this}attribute(e,t,n,s=!1,i=0,r=0){const o=this.gl,a=this.parent.activeAttributes;if(e in a){let l=a[e],u=l.location;if(t){let e=function(e,t){let n=T(e,t);return"arrayType"in n?n.arrayType:t}(o,l.type);o.bindBuffer(o.ARRAY_BUFFER,t),o.vertexAttribPointer(u,n,e,s,i,r),o.enableVertexAttribArray(u)}else o.disableVertexAttribArray(u)}return this}draw(e,t,n,s,i=null){return function(e,t,n,s,i=null){i?(e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,i),e.drawElements(t,s,e.UNSIGNED_SHORT,n)):e.drawArrays(t,n,s)}(e,t,n,s,i),this.parent}}r(0,1,0);function te(e,i,o,a){let u=function(e,n,s,i){var r=new t(4);return r[0]=e,r[1]=n,r[2]=s,r[3]=i,r}(e,i,-1,1),h=n();s(h,o),c(u,u,h),u[2]=-1,u[3]=0,s(h,a),c(u,u,h);let d=r(u[0],u[1],u[2]);return l(d,d),d}const ne=Math.PI/3;class se extends class{constructor(e,t,n){this.canvas=e,this.projectionMatrix=t,this.viewMatrix=n,this.resize=this.resize.bind(this),e.addEventListener("resize",this.resize),setTimeout(this.resize,0)}destroy(){this.canvas.removeEventListener("resize",this.resize)}resize(){}}{constructor(e,t=ne,s=.1,i=1e3){super(e,n(),n()),this.fieldOfView=t,this.clippingPlane={near:s,far:i}}resize(){const e=this.canvas.width/this.canvas.height,{near:t,far:n}=this.clippingPlane;!function(e,t,n,s,i){var r,o=1/Math.tan(t/2);e[0]=o/n,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=o,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=i&&i!==1/0?(r=1/(s-i),e[10]=(i+s)*r,e[14]=2*i*s*r):(e[10]=-1,e[14]=-2*s)}(this.projectionMatrix,this.fieldOfView,e,t,n)}}const ie="noscale";class re extends HTMLElement{static get[Symbol.for("cuttleTemplate")](){let e=document.createElement("template");return e.innerHTML='<div class="container">\n    <label class="hidden" id="title">display-port</label>\n    <label class="hidden" id="fps">00</label>\n    <label class="hidden" id="dimension">0x0</label>\n    <canvas></canvas>\n    <slot></slot>\n</div>',Object.defineProperty(this,Symbol.for("cuttleTemplate"),{value:e}),e}static get[Symbol.for("cuttleStyle")](){let e=document.createElement("style");return e.innerHTML=":host{display:inline-block;color:#555}.container{display:flex;position:relative;width:100%;height:100%}canvas{background:#000;margin:auto;-ms-interpolation-mode:nearest-neighbor;image-rendering:-moz-crisp-edges;image-rendering:pixelated}label{font-family:monospace;color:currentColor;position:absolute}#title{left:.5rem;top:.5rem}#fps{right:.5rem;top:.5rem}#dimension{left:.5rem;bottom:.5rem}.hidden{display:none}:host([debug]) .container{outline:6px dashed rgba(0,0,0,.1);outline-offset:-4px;background-color:rgba(0,0,0,.1)}:host([mode=noscale]) canvas{margin:0;top:0;left:0}:host([mode=center]),:host([mode=fit]),:host([mode=stretch]){width:100%;height:100%}:host([full]){width:100vw!important;height:100vh!important}:host([disabled]){display:none}slot{display:flex;flex-direction:column;align-items:center;justify-content:center;position:absolute;width:100%;height:100%;top:0;left:0;pointer-events:none}::slotted(*){pointer-events:auto}",Object.defineProperty(this,Symbol.for("cuttleStyle"),{value:e}),e}static get properties(){return{width:Number,height:Number,disabled:Boolean,debug:Boolean,mode:{type:String,value:"fit",observed:!1}}}get mode(){return this.getAttribute("mode")}set mode(e){this.setAttribute("mode",e)}get debug(){return this._debug}set debug(e){this.toggleAttribute("debug",e)}get disabled(){return this._disabled}set disabled(e){this.toggleAttribute("disabled",e)}get height(){return this._height}set height(e){this.setAttribute("height",String(e))}get width(){return this._width}set width(e){this.setAttribute("width",String(e))}static get customEvents(){return["frame"]}get onframe(){return this._onframe}set onframe(e){this._onframe&&this.removeEventListener("frame",this._onframe),this._onframe=e,this._onframe&&this.addEventListener("frame",e)}static get observedAttributes(){return["onframe","width","height","disabled","debug","id","class"]}constructor(){super(),this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(this.constructor[Symbol.for("cuttleTemplate")].content.cloneNode(!0)),this.shadowRoot.appendChild(this.constructor[Symbol.for("cuttleStyle")].cloneNode(!0)),this._canvasElement=this.shadowRoot.querySelector("canvas"),this._titleElement=this.shadowRoot.querySelector("#title"),this._fpsElement=this.shadowRoot.querySelector("#fps"),this._dimensionElement=this.shadowRoot.querySelector("#dimension"),this._animationRequestHandle=0,this._prevAnimationFrameTime=0,this._width=300,this._height=150,this._onframe=null,this.update=this.update.bind(this)}get canvas(){return this._canvasElement}connectedCallback(){if(Object.prototype.hasOwnProperty.call(this,"onframe")){let e=this.onframe;delete this.onframe,this.onframe=e}if(Object.prototype.hasOwnProperty.call(this,"width")){let e=this.width;delete this.width,this.width=e}if(Object.prototype.hasOwnProperty.call(this,"height")){let e=this.height;delete this.height,this.height=e}if(Object.prototype.hasOwnProperty.call(this,"disabled")){let e=this.disabled;delete this.disabled,this.disabled=e}if(Object.prototype.hasOwnProperty.call(this,"debug")){let e=this.debug;delete this.debug,this.debug=e}if(Object.prototype.hasOwnProperty.call(this,"mode")){let e=this.mode;delete this.mode,this.mode=e}this.hasAttribute("mode")||this.setAttribute("mode","fit"),this.hasAttribute("tabindex")||this.setAttribute("tabindex",0),this.updateCanvasSize(),this.resume()}disconnectedCallback(){this.pause()}attributeChangedCallback(e,t,n){switch(e){case"width":this._width=Number(n);break;case"height":this._height=Number(n);break;case"disabled":this._disabled=null!==n;break;case"debug":this._debug=null!==n;break;case"onframe":this.onframe=new Function("event","with(document){with(this){"+n+"}}").bind(this)}((e,t,n)=>{switch(e){case"disabled":n?(this.update(0),this.pause()):this.resume();break;case"id":case"class":this._titleElement.innerHTML=`display-port${this.className?"."+this.className:""}${this.hasAttribute("id")?"#"+this.getAttribute("id"):""}`;break;case"debug":this._titleElement.classList.toggle("hidden",n),this._fpsElement.classList.toggle("hidden",n),this._dimensionElement.classList.toggle("hidden",n)}})(e,0,n)}update(e){this._animationRequestHandle=requestAnimationFrame(this.update),this.updateCanvasSize();const t=e-this._prevAnimationFrameTime;if(this._prevAnimationFrameTime=e,this.debug){const e=t<=0?"--":String(Math.round(1e3/t)).padStart(2,"0");if(this._fpsElement.innerText!==e&&(this._fpsElement.innerText=e),this.mode===ie){let e=`${this._width}x${this._height}`;this._dimensionElement.innerText!==e&&(this._dimensionElement.innerText=e)}else{let e=`${this._width}x${this._height}|${this.shadowRoot.host.clientWidth}x${this.shadowRoot.host.clientHeight}`;this._dimensionElement.innerText!==e&&(this._dimensionElement.innerText=e)}}this.dispatchEvent(new CustomEvent("frame",{detail:{now:e,prevTime:this._prevAnimationFrameTime,deltaTime:t,canvas:this._canvasElement},bubbles:!1,composed:!0}))}pause(){cancelAnimationFrame(this._animationRequestHandle)}resume(){this._animationRequestHandle=requestAnimationFrame(this.update)}updateCanvasSize(){let e=this.shadowRoot.host.getBoundingClientRect();const t=e.width,n=e.height;let s=this._canvasElement,i=this._width,r=this._height;const o=this.mode;if("stretch"===o)i=t,r=n;else if(o!==ie){if(t<i||n<r||"fit"===o){let e=t/i,s=n/r;e<s?(i=t,r*=e):(i*=s,r=n)}}i=Math.floor(i),r=Math.floor(r),s.clientWidth===i&&s.clientHeight===r||(s.width=this._width,s.height=this._height,s.style=`width: ${i}px; height: ${r}px`,this.dispatchEvent(new CustomEvent("resize",{detail:{width:i,height:r},bubbles:!1,composed:!0})))}}window.customElements.define("display-port",re);const oe=1,ae=2,le=3,ue={NULL:0,DOWN:1,UP:2,MOVE:3,parse(e){if("string"!=typeof e)return ue.NULL;switch(e.toLowerCase()){case"down":return ue.DOWN;case"up":return ue.UP;case"move":return ue.MOVE;default:return ue.NULL}}},he="*";class de{constructor(e,t){this.deviceName=e,this.eventTarget=t,this.listeners={}}destroy(){this.listeners={}}addInputListener(e,t){let n=this.listeners[e];n?n.push(t):(n=[t],this.listeners[e]=n)}removeInputListener(e,t){let n=this.listeners[e];n&&(n.indexOf(t),n.splice(t,1))}dispatchInput(e){const{keyCode:t}=e,n=this.listeners[t];let s=!1;if(n){for(let t of n)s|=t(e);return s}for(let t of this.listeners["*"])s|=t(e);return s}}class ce{static createAdapter(e,t,n,s,i,r){return{target:e,adapterId:t,deviceName:n,keyCode:s,scale:i,eventCode:r}}constructor(){this.adapters={"*":pe()}}add(e){for(let t of e){const{deviceName:e,keyCode:n}=t;let s;e in this.adapters?s=this.adapters[e]:(s=pe(),this.adapters[e]=s),n in s?s[n].push(t):s[n]=[t]}}delete(e){for(let t of e){const{deviceName:e,keyCode:n}=t;if(e in this.adapters){let s=this.adapters[e];if(n in s){let e=s[n],i=e.indexOf(t);i>=0&&e.splice(i,1)}}}}clear(){for(let e in this.adapters)this.adapters[e]=pe()}poll(e,t,n){const s=this.findAdapters(e,t);for(let e of s){const t=e.eventCode;if(t===ue.NULL){const{target:t,scale:s}=e,i=n.value*s;t.poll(i,e)}else{const{target:s,scale:i}=e,r=n.getEvent(t)*i;s.poll(r,e)}}return s.length>0}update(e,t,n){let s=!1;for(let i of this.findAdapters(e,t)){const e=i.eventCode;if(e!==ue.NULL){const{target:t,scale:r}=i,o=n.getEvent(e)*r;t.update(o,i),s=!0}}return s}reset(e,t,n){let s=!1;for(let n of this.findAdapters(e,t))n.target.reset(),s=!0;return s}findAdapters(e,t){let n=[];if(e in this.adapters){let s=this.adapters[e];t in s&&n.push(...s[t]),n.push(...s["*"])}let s=this.adapters["*"];return t in s&&n.push(...s[t]),n.push(...s["*"]),n}}function pe(){return{[he]:[]}}class me{constructor(){this.value=0}update(e){this.value=e}poll(){this.value=0}getEvent(e){return 0}getState(){return this.value}}class fe extends me{constructor(e){super(),this.update=this.update.bind(this),Array.isArray(e)||(e=[e]);let t=[],n=0;for(let s of e){"string"==typeof s&&(s={key:s});const{key:e,scale:i=1,event:r="null"}=s,{deviceName:o,keyCode:a}=be(e),l=ue.parse(r),u=Number(i);let h=ce.createAdapter(this,n,o,a,u,l);t.push(h),++n}this.adapters=t,this.values=new Array(t.length).fill(0),this.next={values:new Array(t.length).fill(0),value:0}}poll(e,t){const n=t.adapterId;let s=this.values[n];this.values[n]=e,this.value=this.value-s+e,this.next.values[n]=0,this.next.value+=e-s}update(e,t){const n=t.adapterId;let s=this.next.values[n];this.next.values[n]=e,this.next.value+=e-s}reset(){this.values.fill(0),this.value=0,this.next.values.fill(0),this.next.value=0}}function be(e){let t=e.indexOf(":");if(t>=0)return{deviceName:e.substring(0,t),keyCode:e.substring(t+1)};throw new Error("Invalid key string - missing device separator ':'.")}function ye(e,t){return`${e}:${t}`}class _e extends de{constructor(e,t={}){super("Keyboard",e);const{repeat:n=!1}=t;this.repeat=n,this._eventObject={target:e,deviceName:this.deviceName,keyCode:"",event:ue.NULL,type:oe,value:0,control:!1,shift:!1,alt:!1},this.onKeyDown=this.onKeyDown.bind(this),this.onKeyUp=this.onKeyUp.bind(this),e.addEventListener("keydown",this.onKeyDown),e.addEventListener("keyup",this.onKeyUp)}destroy(){let e=this.eventTarget;e.removeEventListener("keydown",this.onKeyDown),e.removeEventListener("keyup",this.onKeyUp),super.destroy()}onKeyDown(e){if(e.repeat)return e.preventDefault(),e.stopPropagation(),!1;let t=this._eventObject;return t.keyCode=e.code,t.event=ue.DOWN,t.value=1,t.control=e.ctrlKey,t.shift=e.shiftKey,t.alt=e.altKey,this.dispatchInput(t)?(e.preventDefault(),e.stopPropagation(),!1):void 0}onKeyUp(e){let t=this._eventObject;if(t.keyCode=e.code,t.event=ue.UP,t.value=1,t.control=e.ctrlKey,t.shift=e.shiftKey,t.alt=e.altKey,this.dispatchInput(t))return e.preventDefault(),e.stopPropagation(),!1}}class ve extends de{constructor(e,t={eventsOnFocus:!0}){super("Mouse",e),this.canvasTarget=e instanceof HTMLCanvasElement&&e||e.canvas||e.querySelector("canvas")||e.shadowRoot&&e.shadowRoot.querySelector("canvas")||e,this.eventsOnFocus=t.eventsOnFocus,this._downHasFocus=!1,this._eventObject={target:e,deviceName:this.deviceName,keyCode:"",event:ue.NULL,type:oe,value:0,control:!1,shift:!1,alt:!1},this._positionObject={target:e,deviceName:this.deviceName,keyCode:"Position",event:ue.MOVE,type:ae,x:0,y:0,dx:0,dy:0},this._wheelObject={target:e,deviceName:this.deviceName,keyCode:"Wheel",event:ue.MOVE,type:le,dx:0,dy:0,dz:0},this.onMouseDown=this.onMouseDown.bind(this),this.onMouseUp=this.onMouseUp.bind(this),this.onMouseMove=this.onMouseMove.bind(this),this.onContextMenu=this.onContextMenu.bind(this),this.onWheel=this.onWheel.bind(this),e.addEventListener("mousedown",this.onMouseDown),e.addEventListener("contextmenu",this.onContextMenu),e.addEventListener("wheel",this.onWheel),e.addEventListener("mousemove",this.onMouseMove),document.addEventListener("mouseup",this.onMouseUp)}destroy(){let e=this.eventTarget;e.removeEventListener("mousedown",this.onMouseDown),e.removeEventListener("contextmenu",this.onContextMenu),e.removeEventListener("wheel",this.onWheel),e.removeEventListener("mousemove",this.onMouseMove),document.removeEventListener("mouseup",this.onMouseUp),super.destroy()}setPointerLock(e=!0){e?this.eventTarget.requestPointerLock():this.eventTarget.exitPointerLock()}hasPointerLock(){return document.pointerLockElement===this.eventTarget}onMouseDown(e){this._downHasFocus=!0;let t=this._eventObject;if(t.keyCode="Button"+e.button,t.event=ue.DOWN,t.value=1,t.control=e.ctrlKey,t.shift=e.shiftKey,t.alt=e.altKey,this.dispatchInput(t)&&document.activeElement===this.eventTarget)return e.preventDefault(),e.stopPropagation(),!1}onContextMenu(e){return e.preventDefault(),e.stopPropagation(),!1}onWheel(e){let t=this._wheelObject;switch(e.deltaMode){case WheelEvent.DOM_DELTA_LINE:t.dx=10*e.deltaX,t.dy=10*e.deltaY,t.dz=10*e.deltaZ;break;case WheelEvent.DOM_DELTA_PAGE:t.dx=100*e.deltaX,t.dy=100*e.deltaY,t.dz=100*e.deltaZ;break;case WheelEvent.DOM_DELTA_PIXEL:default:t.dx=e.deltaX,t.dy=e.deltaY,t.dz=e.deltaZ}if(this.dispatchInput(t))return e.preventDefault(),e.stopPropagation(),!1}onMouseUp(e){if(!this._downHasFocus)return;this._downHasFocus=!1;let t=this._eventObject;return t.keyCode="Button"+e.button,t.event=ue.UP,t.value=1,t.control=e.ctrlKey,t.shift=e.shiftKey,t.alt=e.altKey,this.dispatchInput(t)?(e.preventDefault(),e.stopPropagation(),!1):void 0}onMouseMove(e){if(this.eventsOnFocus&&document.activeElement!==this.eventTarget)return;const t=this.canvasTarget,{clientWidth:n,clientHeight:s}=t,i=t.getBoundingClientRect();let r=e.movementX/n,o=e.movementY/s,a=(e.clientX-i.left)/n,l=(e.clientY-i.top)/s,u=this._positionObject;u.x=a,u.y=l,u.dx=r,u.dy=o,this.dispatchInput(u)}}class ge extends me{constructor(){super(),this.delta=0,this.next={delta:0}}update(e,t){this.value=e,this.next.delta+=t}poll(){this.delta=this.next.delta,this.next.delta=0}getEvent(e){switch(e){case ue.MOVE:return this.delta;default:return super.getEvent(e)}}}class Ee extends me{constructor(){super(),this.down=!1,this.up=!1,this.next={down:!1,up:!1}}update(e){e?this.next.down=!0:this.next.up=!0}poll(){const{up:e,down:t}=this.next;this.value?this.up&&!e&&(this.value=0):t&&(this.value=1),this.down=t,this.up=e,this.next.down=!1,this.next.up=!1}getEvent(e){switch(e){case ue.DOWN:return 1&this.down;case ue.UP:return 1&this.up;default:return super.getEvent(e)}}}const Ae=1,Ne=2;const Te=Symbol("inputSource");class Se{static for(e){if(Object.prototype.hasOwnProperty.call(e,Te))return e[Te];{let t=new Se([new _e(e),new ve(e)]);return Object.defineProperty(e,Te,{value:t}),t}}constructor(e){this.onInputEvent=this.onInputEvent.bind(this);let t={},n={};for(let s of e){const e=s.deviceName;t[e]=s,n[e]={},s.addInputListener(he,this.onInputEvent)}this.devices=t,this.inputs=n,this.listeners={poll:[],update:[]}}destroy(){this.clear();for(let e in this.devices){let t=this.devices[e];t.removeInputListener(he,this.onInputEvent),t.destroy()}}addEventListener(e,t){e in this.listeners?this.listeners[e].unshift(t):this.listeners[e]=[t]}removeEventListener(e,t){if(e in this.listeners){let n=this.listeners[e],s=n.indexOf(t);n.splice(s,1)}}dispatchEvent(e,t){for(let n of this.listeners[e])n(t)}_dispatchInputEvent(e,t,n,s){this.dispatchEvent("input",{stage:e,deviceName:t,keyCode:n,input:s})}_dispatchPollEvent(){this.dispatchEvent("poll",{})}poll(){for(const e in this.inputs){const t=this.inputs[e];for(const n in t){let s=t[n];s.poll(),this._dispatchInputEvent(Ne,e,n,s)}}this._dispatchPollEvent()}onInputEvent(e){const t=e.deviceName;switch(e.type){case oe:{const n=e.keyCode;let s=this.inputs[t][n];s&&(s.update(e.event===ue.DOWN),this._dispatchInputEvent(Ae,t,n,s))}break;case ae:{let n=this.inputs[t],s=n.PosX;s&&(s.update(e.x,e.dx),this._dispatchInputEvent(Ae,t,"PosX",s));let i=n.PosY;i&&(i.update(e.y,e.dy),this._dispatchInputEvent(Ae,t,"PosY",i))}break;case le:{let n=this.inputs[t],s=n.WheelX;s&&(s.update(e.dx,e.dx),this._dispatchInputEvent(Ae,t,"WheelX",s));let i=n.WheelY;i&&(i.update(e.dy,e.dy),this._dispatchInputEvent(Ae,t,"WheelY",i));let r=n.WheelZ;r&&(r.update(e.dz,e.dz),this._dispatchInputEvent(Ae,t,"WheelZ",r))}}}add(e,t){if(!(e in this.devices))throw new Error("Invalid device name - missing device with name in source.");let n=function(e,t){return"Mouse"===e&&("PosX"===t||"PosY"===t||"WheelX"===t||"WheelY"===t||"WheelZ"===t)}(e,t)?new ge:new Ee;return this.inputs[e][t]=n,this}delete(e,t){delete this.inputs[e][t]}get(e,t){return this.inputs[e][t]}has(e,t){return e in this.inputs&&t in this.inputs[e]}clear(){for(let e in this.devices)this.inputs[e]={}}}class we{constructor(e={}){const{disabled:t=!0}=e;this.source=null,this._disabled=t,this._ignoreInput=t,this.adapters=new ce,this.inputs={},this.onSourceInput=this.onSourceInput.bind(this),this.onSourcePoll=this.onSourcePoll.bind(this)}get disabled(){return this._disabled}set disabled(e){this.toggle(!e)}setInputMap(e){return this._setupInputs(this.source,e),this}attach(e){return this._setupInputs(e,null),this.toggle(!0),this}detach(){return this.toggle(!1),this._setupInputs(null,null),this}_setupInputs(e,t){const n=this.disabled;this.disabled=!0;const s=this.source,i=this.inputs,r=s!==e&&s,o=this.inputs&&t;if(r||o){r&&(s.removeEventListener("poll",this.onSourcePoll),s.removeEventListener("input",this.onSourceInput));for(let e in i){let{adapters:t}=i[e];for(let e of t){const{deviceName:t,keyCode:n}=e;0===Me(s,t,n)&&s.delete(t,n)}}o&&(this.adapters.clear(),this.inputs={})}if(t){let e={};for(let n in t){let s=t[n],i=new fe(s),r=i.adapters;this.adapters.add(r),e[n]=i}this.inputs=e}if(e){!function(e){xe in e||(e[xe]={})}(e);const t=this.inputs;for(let n in t){let{adapters:s}=t[n];for(let t of s){const{deviceName:n,keyCode:s}=t;1===Le(e,n,s)&&e.add(n,s)}}this.source!==e&&(e.addEventListener("poll",this.onSourcePoll),e.addEventListener("input",this.onSourceInput),this.source=e)}this.disabled=n}onSourceInput(e){if(e.consumed||this._ignoreInput){const{deviceName:t,keyCode:n,input:s}=e;this.adapters.reset(t,n,s)}else{const{stage:t,deviceName:n,keyCode:s,input:i}=e;switch(t){case Ne:this.adapters.poll(n,s,i);break;case Ae:this.adapters.update(n,s,i)}e.consumed=!0}}onSourcePoll(e){this._ignoreInput!==this.disabled&&(this._ignoreInput=this.disabled)}toggle(e=this._disabled){if(e){if(!this.source)throw new Error("Input source must be set before enabling input context.");Object.keys(this.inputs).length<=0&&console.warn("No inputs found for enabled input context - did you forget to setInputMap()?")}return this._disabled=!e,this}getInput(e){return this.inputs[e]}getInputValue(e){return e in this.inputs?this.inputs[e].value:0}}const xe=Symbol("inputRefCounts");function Le(e,t,n){const s=ye(t,n);let i=e[xe],r=i[s]+1||1;return i[s]=r,r}function Me(e,t,n){const s=ye(t,n);let i=e[xe],r=i[s]-1||0;return i[s]=Math.max(r,0),r}class Ie extends HTMLElement{static get[Symbol.for("cuttleTemplate")](){let e=document.createElement("template");return e.innerHTML='<kbd>\n    <span id="key"><slot></slot></span>\n    <span id="value" class="hidden"></span>\n</kbd>\n',Object.defineProperty(this,Symbol.for("cuttleTemplate"),{value:e}),e}static get[Symbol.for("cuttleStyle")](){let e=document.createElement("style");return e.innerHTML='kbd{position:relative;display:inline-block;border-radius:3px;border:1px solid #888;font-size:.85em;font-weight:700;text-rendering:optimizeLegibility;line-height:12px;height:14px;padding:2px 4px;color:#444;background-color:#eee;box-shadow:inset 0 -3px 0 #aaa;overflow:hidden}kbd:empty:after{content:"<?>";opacity:.6}.disabled{opacity:.6;box-shadow:none;background-color:#aaa}.hidden{display:none}#value{position:absolute;top:0;bottom:0;right:0;font-size:.85em;padding:2px 4px 0;color:#ccc;background-color:#333;box-shadow:inset 0 3px 0 #222}',Object.defineProperty(this,Symbol.for("cuttleStyle"),{value:e}),e}static get properties(){return{name:String,value:String,disabled:Boolean}}get disabled(){return this._disabled}set disabled(e){this.toggleAttribute("disabled",e)}get value(){return this._value}set value(e){this.setAttribute("value",e)}get name(){return this._name}set name(e){this.setAttribute("name",e)}constructor(){super(),this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(this.constructor[Symbol.for("cuttleTemplate")].content.cloneNode(!0)),this.shadowRoot.appendChild(this.constructor[Symbol.for("cuttleStyle")].cloneNode(!0)),this._keyboardElement=this.shadowRoot.querySelector("kbd"),this._keyElement=this.shadowRoot.querySelector("#key"),this._valueElement=this.shadowRoot.querySelector("#value")}attributeChangedCallback(e,t,n){switch(e){case"name":this._name=n;break;case"value":this._value=n;break;case"disabled":this._disabled=null!==n}((e,t,n)=>{switch(e){case"name":this._keyElement.innerText=n;break;case"value":null!==n?(this._valueElement.classList.toggle("hidden",!1),this._valueElement.innerText=n,this._keyboardElement.style.paddingRight=`${this._valueElement.clientWidth+4}px`):this._valueElement.classList.toggle("hidden",!0);break;case"disabled":this._keyboardElement.classList.toggle("disabled",null!==n)}})(e,0,n)}connectedCallback(){if(Object.prototype.hasOwnProperty.call(this,"name")){let e=this.name;delete this.name,this.name=e}if(Object.prototype.hasOwnProperty.call(this,"value")){let e=this.value;delete this.value,this.value=e}if(Object.prototype.hasOwnProperty.call(this,"disabled")){let e=this.disabled;delete this.disabled,this.disabled=e}}static get observedAttributes(){return["name","value","disabled"]}}window.customElements.define("input-key",Ie);class Re extends HTMLElement{static get[Symbol.for("cuttleTemplate")](){let e=document.createElement("template");return e.innerHTML='<table>\n    <thead>\n        <tr class="tableHeader">\n            <th colspan=4>\n                <slot id="title">input-map</slot>\n            </th>\n        </tr>\n        <tr class="colHeader">\n            <th>name</th>\n            <th>key</th>\n            <th>mod</th>\n            <th>value</th>\n        </tr>\n    </thead>\n    <tbody>\n    </tbody>\n</table>\n',Object.defineProperty(this,Symbol.for("cuttleTemplate"),{value:e}),e}static get[Symbol.for("cuttleStyle")](){let e=document.createElement("style");return e.innerHTML=":host{display:block}table{border-collapse:collapse}table,td,th{border:1px solid #666}td,th{padding:5px 10px}td{text-align:center}thead th{padding:0}.colHeader>th{font-size:.8em;padding:0 10px;letter-spacing:3px;background-color:#aaa;color:#666}.colHeader>th,output{font-family:monospace}output{border-radius:.3em;padding:3px}tr:not(.primary) .name,tr:not(.primary) .value{opacity:.3}tr:nth-child(2n){background-color:#eee}",Object.defineProperty(this,Symbol.for("cuttleStyle"),{value:e}),e}static get observedAttributes(){return["src","id","class"]}constructor(){super(),this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(this.constructor[Symbol.for("cuttleTemplate")].content.cloneNode(!0)),this.shadowRoot.appendChild(this.constructor[Symbol.for("cuttleStyle")].cloneNode(!0)),this._src="",this._inputMap={},this._titleElement=this.shadowRoot.querySelector("#title"),this._tableElements={},this._bodyElement=this.shadowRoot.querySelector("tbody"),this._children=this.shadowRoot.querySelector("slot")}get map(){return this._inputMap}connectedCallback(){!function(e,t){if(Object.prototype.hasOwnProperty.call(e,t)){let n=e[t];delete e[t],e[t]=n}}(this,"src")}attributeChangedCallback(e,t,n){switch(e){case"src":if(this._src!==n)if(this._src=n,n.trim().startsWith("{")){let e=JSON.parse(n);this._setInputMap(e)}else fetch(n).then((e=>e.json())).then((e=>this._setInputMap(e)));break;case"id":case"class":this._titleElement.innerHTML=`input-port${this.className?"."+this.className:""}${this.hasAttribute("id")?"#"+this.getAttribute("id"):""}`}}get src(){return this.getAttribute("src")}set src(e){switch(typeof e){case"object":{let t=JSON.stringify(e);this._src=t,this._setInputMap(e),this.setAttribute("src",t)}break;case"string":this.setAttribute("src",e);break;default:this.setAttribute("src",JSON.stringify(e))}}_setInputMap(e){let t=[];for(let n in e){Oe(t,n,e[n])}this._bodyElement.innerHTML="";for(let e of t)this._bodyElement.appendChild(e);this._inputMap=e}}function Oe(e,t,n){if(Array.isArray(n)){Oe(e,t,n[0]);let s=n.length;for(let i=1;i<s;++i)e.push(Ce(t,n[i],!1))}else e.push(Ce(t,n,!0));return e}function Ce(e,t,n=!0){if("object"==typeof t){const{key:s,event:i,scale:r}=t;return ke(e,s,i,r,0,n)}return ke(e,t,null,1,0,n)}function ke(e,t,n,s,i,r=!0){let o=document.createElement("tr");r&&o.classList.add("primary");{let t=document.createElement("td");t.textContent=e,t.classList.add("name"),o.appendChild(t)}{let e=document.createElement("td");e.classList.add("key");let n=new Ie;n.innerText=t,e.appendChild(n),o.appendChild(e)}{let e=document.createElement("td"),t=document.createElement("samp"),i=[];"string"==typeof n&&"null"!==n&&i.push(n),"number"==typeof s&&1!==s&&i.push(`×${s.toFixed(2)}`),t.innerText=i.join(" "),e.classList.add("mod"),e.appendChild(t),o.appendChild(e)}{let e=document.createElement("td"),t=document.createElement("output");t.innerText=Number(i).toFixed(2),t.classList.add("value"),e.appendChild(t),o.appendChild(e)}return o}window.customElements.define("input-map",Re);class Pe extends HTMLElement{static get[Symbol.for("cuttleTemplate")](){let e=document.createElement("template");return e.innerHTML='<div class="hidden">\n    <label id="title">\n        input-source\n    </label>\n    <span>|</span>\n    <p>\n        <label for="poll">poll</label>\n        <output id="poll"></output>\n    </p>\n    <p>\n        <label for="focus">focus</label>\n        <output id="focus"></output>\n    </p>\n</div>\n',Object.defineProperty(this,Symbol.for("cuttleTemplate"),{value:e}),e}static get[Symbol.for("cuttleStyle")](){let e=document.createElement("style");return e.innerHTML=':host{display:inline-block}.hidden{display:none}div{font-family:monospace;color:#666;outline:1px solid #666;padding:4px}p{display:inline;margin:0;padding:0}#focus:empty:after,#poll:empty:after{content:"✗";color:red}',Object.defineProperty(this,Symbol.for("cuttleStyle"),{value:e}),e}static get properties(){return{for:String,autopoll:Boolean,debug:Boolean}}get debug(){return this._debug}set debug(e){this.toggleAttribute("debug",e)}get autopoll(){return this._autopoll}set autopoll(e){this.toggleAttribute("autopoll",e)}get for(){return this._for}set for(e){this.setAttribute("for",e)}static get customEvents(){return["input","poll"]}get onpoll(){return this._onpoll}set onpoll(e){this._onpoll&&this.removeEventListener("poll",this._onpoll),this._onpoll=e,this._onpoll&&this.addEventListener("poll",e)}get oninput(){return this._oninput}set oninput(e){this._oninput&&this.removeEventListener("input",this._oninput),this._oninput=e,this._oninput&&this.addEventListener("input",e)}static get observedAttributes(){return["oninput","onpoll","for","autopoll","debug","id","class"]}constructor(){super(),this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(this.constructor[Symbol.for("cuttleTemplate")].content.cloneNode(!0)),this.shadowRoot.appendChild(this.constructor[Symbol.for("cuttleStyle")].cloneNode(!0)),this._autopoll=!1,this._containerElement=this.shadowRoot.querySelector("div"),this._titleElement=this.shadowRoot.querySelector("#title"),this._pollElement=this.shadowRoot.querySelector("#poll"),this._focusElement=this.shadowRoot.querySelector("#focus"),this._pollCount=0,this._pollCountDelay=0,this._sourceElement=null,this._inputSource=null,this._animationFrameHandle=null,this.onSourceInput=this.onSourceInput.bind(this),this.onSourcePoll=this.onSourcePoll.bind(this),this.onSourceFocus=this.onSourceFocus.bind(this),this.onSourceBlur=this.onSourceBlur.bind(this),this.onAnimationFrame=this.onAnimationFrame.bind(this)}get source(){return this._inputSource}poll(){this._inputSource.poll()}connectedCallback(){if(Object.prototype.hasOwnProperty.call(this,"oninput")){let e=this.oninput;delete this.oninput,this.oninput=e}if(Object.prototype.hasOwnProperty.call(this,"onpoll")){let e=this.onpoll;delete this.onpoll,this.onpoll=e}if(Object.prototype.hasOwnProperty.call(this,"for")){let e=this.for;delete this.for,this.for=e}if(Object.prototype.hasOwnProperty.call(this,"autopoll")){let e=this.autopoll;delete this.autopoll,this.autopoll=e}if(Object.prototype.hasOwnProperty.call(this,"debug")){let e=this.debug;delete this.debug,this.debug=e}this.hasAttribute("tabindex")||this.setAttribute("tabindex",0),this.hasAttribute("for")||this._setSourceElement(this),this._animationFrameHandle=requestAnimationFrame(this.onAnimationFrame)}disconnectedCallback(){cancelAnimationFrame(this._animationFrameHandle),this._clearSourceElement()}attributeChangedCallback(e,t,n){switch(e){case"for":this._for=n;break;case"autopoll":this._autopoll=null!==n;break;case"debug":this._debug=null!==n;break;case"oninput":this.oninput=new Function("event","with(document){with(this){"+n+"}}").bind(this);break;case"onpoll":this.onpoll=new Function("event","with(document){with(this){"+n+"}}").bind(this)}((e,t,n)=>{switch(e){case"for":this._setSourceElement(n?document.getElementById(n):this);break;case"id":case"class":{let e=this.className?"."+this.className:"",t=this.hasAttribute("id")?"#"+this.getAttribute("id"):"";this._titleElement.innerHTML=e+t}break;case"debug":this._containerElement.classList.toggle("hidden",n)}})(e,0,n)}onSourceInput(e){this.dispatchEvent(new CustomEvent("input",{composed:!0,bubbles:!1,detail:e}))}onSourcePoll(){this._pollCount+=1,this.dispatchEvent(new CustomEvent("poll",{composed:!0,bubbles:!1}))}onSourceFocus(){this._focusElement.innerText="✓"}onSourceBlur(){this._focusElement.innerText=""}onAnimationFrame(e){if(this._animationFrameHandle=requestAnimationFrame(this.onAnimationFrame),this._autopoll&&this.poll(),this.debug){e-this._pollCountDelay>1e3&&(this._pollCountDelay=e,this._pollCount>0?(this._pollElement.innerText="✓",this._pollCount=0):this._pollElement.innerText="")}}_clearSourceElement(){if(this._inputSource){let e=this._inputSource,t=this._sourceElement;this._inputSource=null,this._sourceElement=null,t.removeEventListener("focus",this.onSourceFocus),t.removeEventListener("blur",this.onSourceBlur),e.destroy()}}_setSourceElement(e){if(this._clearSourceElement(),!e)throw new Error("Event target not found.");let t=Se.for(e);t.addEventListener("input",this.onSourceInput),t.addEventListener("poll",this.onSourcePoll),e.addEventListener("focus",this.onSourceFocus),e.addEventListener("blur",this.onSourceBlur),this._sourceElement=e,this._inputSource=t}}window.customElements.define("input-source",Pe);class Fe extends HTMLElement{static get[Symbol.for("cuttleTemplate")](){let e=document.createElement("template");return e.innerHTML='<input-map class="hidden">\n    <input-source debug></input-source>\n</input-map>\n',Object.defineProperty(this,Symbol.for("cuttleTemplate"),{value:e}),e}static get[Symbol.for("cuttleStyle")](){let e=document.createElement("style");return e.innerHTML=":host{display:inline-block}.hidden{display:none}",Object.defineProperty(this,Symbol.for("cuttleStyle"),{value:e}),e}static get properties(){return{for:String,disabled:Boolean,autopoll:Boolean,debug:Boolean}}get debug(){return this._debug}set debug(e){this.toggleAttribute("debug",e)}get autopoll(){return this._autopoll}set autopoll(e){this.toggleAttribute("autopoll",e)}get disabled(){return this._disabled}set disabled(e){this.toggleAttribute("disabled",e)}get for(){return this._for}set for(e){this.setAttribute("for",e)}static get observedAttributes(){return["for","disabled","autopoll","debug","src","id","class"]}constructor(){super(),this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(this.constructor[Symbol.for("cuttleTemplate")].content.cloneNode(!0)),this.shadowRoot.appendChild(this.constructor[Symbol.for("cuttleStyle")].cloneNode(!0)),this._inputContext=new we,this._mapElement=this.shadowRoot.querySelector("input-map"),this._sourceElement=this.shadowRoot.querySelector("input-source")}get context(){return this._inputContext}get source(){return this._sourceElement.source}get map(){return this._mapElement.map}connectedCallback(){if(Object.prototype.hasOwnProperty.call(this,"for")){let e=this.for;delete this.for,this.for=e}if(Object.prototype.hasOwnProperty.call(this,"disabled")){let e=this.disabled;delete this.disabled,this.disabled=e}if(Object.prototype.hasOwnProperty.call(this,"autopoll")){let e=this.autopoll;delete this.autopoll,this.autopoll=e}if(Object.prototype.hasOwnProperty.call(this,"debug")){let e=this.debug;delete this.debug,this.debug=e}!function(e,t){if(Object.prototype.hasOwnProperty.call(e,t)){let n=e[t];delete e[t],e[t]=n}}(this,"src")}attributeChangedCallback(e,t,n){switch(e){case"for":this._for=n;break;case"disabled":this._disabled=null!==n;break;case"autopoll":this._autopoll=null!==n;break;case"debug":this._debug=null!==n}((e,t,n)=>{switch(e){case"for":this._sourceElement.for=n,this._inputContext.attach(this._sourceElement.source);break;case"disabled":this._inputContext.disabled=null!==n;break;case"autopoll":this._sourceElement.autopoll=null!==n;break;case"src":this._mapElement.src=n,this._inputContext.setInputMap(this._mapElement.map);break;case"debug":this._mapElement.classList.toggle("hidden",null===n);break;case"id":this._sourceElement.id=n;break;case"class":this._sourceElement.className=n}})(e,0,n)}get src(){return this._mapElement.src}set src(e){this._mapElement.src=e}}window.customElements.define("input-context",Fe);const De=Math.PI/180;function Ue(e){return e*De}var Be=Object.freeze({__proto__:null,loadImage:async function(e,t){return new Promise(((t,n)=>{let s=new Image;s.addEventListener("load",(()=>{t(s)})),s.addEventListener("error",(e=>{n(e)})),s.src=e}))}});var je=Object.freeze({__proto__:null,loadText:async function(e,t){return(await fetch(e)).text()}});function ze(e){const t=[],n=[],s=[],i=[],r=[],o=[],a=/v\s+(\S+)\s+(\S+)\s+(\S+)/g,l=/vn\s+(\S+)\s+(\S+)\s+(\S+)/g,u=/vt\s+(\S+)\s+(\S+)/g,h=/f\s+(([^/\s]*)\/([^/\s]*)\/?([^/\s]*))\s+(([^/\s]*)\/([^/\s]*)\/?([^/\s]*))\s+(([^/\s]*)\/([^/\s]*)\/?([^/\s]*))(\s+(([^/\s]*)\/([^/\s]*)\/?([^/\s]*)))?/g,d=/f\s+([^/\s]+)\s+([^/\s]+)\s+([^/\s]+)/g;let c,p,m,f,b,y,_=!1,v=null;for(e=e.replace(/^#.*/g,"");null!=(v=a.exec(e));)c=Number.parseFloat(v[1]),p=Number.parseFloat(v[2]),m=Number.parseFloat(v[3]),t.push(c),t.push(p),t.push(m);for(;null!=(v=l.exec(e));)c=Number.parseFloat(v[1]),p=Number.parseFloat(v[2]),m=Number.parseFloat(v[3]),s.push(c),s.push(p),s.push(m);for(;null!=(v=u.exec(e));)c=Number.parseFloat(v[1]),p=Number.parseFloat(v[2]),n.push(c),n.push(p);for(;null!=(v=h.exec(e));)c=Number.parseInt(v[2]),Number.isNaN(c)&&(c=1),p=Number.parseInt(v[6]),Number.isNaN(p)&&(p=1),m=Number.parseInt(v[10]),Number.isNaN(m)&&(m=1),i.push(c),i.push(p),i.push(m),c=Number.parseInt(v[4]),Number.isNaN(c)?(c=Number.parseInt(v[3]),p=Number.parseInt(v[7]),m=Number.parseInt(v[11]),o.push(c),o.push(p),o.push(m),r.push(1),r.push(1),r.push(1)):(p=Number.parseInt(v[8]),Number.isNaN(p)&&(p=1),m=Number.parseInt(v[12]),Number.isNaN(m)&&(m=1),o.push(c),o.push(p),o.push(m),c=Number.parseInt(v[3]),Number.isNaN(c)&&(c=1),p=Number.parseInt(v[7]),Number.isNaN(p)&&(p=1),m=Number.parseInt(v[11]),Number.isNaN(m)&&(m=1),r.push(c),r.push(p),r.push(m)),void 0!==v[13]&&(f=Number.parseInt(v[15]),Number.isNaN(f)&&(f=1),i.push(f),f=Number.parseInt(v[17]),Number.isNaN(f)?(f=Number.parseInt(v[16]),o.push(f),r.push(1)):(o.push(f),f=Number.parseInt(v[16]),r.push(f)),_=!0);for(;null!=(v=d.exec(e));)c=Number.parseInt(v[2]),p=Number.parseInt(v[6]),m=Number.parseInt(v[10]),i.push(c),i.push(p),i.push(m),r.push(1),r.push(1),r.push(1),o.push(1),o.push(1),o.push(1),void 0!==v[13]&&(f=Number.parseInt(v[14]),i.push(f),r.push(1),o.push(1),_=!0);y=i.length;const g=new Float32Array(3*y);for(let e=0;e<y;++e)b=i[e]-1,g[3*e+0]=t[3*b+0],g[3*e+1]=t[3*b+1],g[3*e+2]=t[3*b+2];y=r.length;const E=new Float32Array(2*y);for(let e=0;e<y;++e)b=r[e]-1,E[2*e+0]=n[2*b+0],E[2*e+1]=n[2*b+1];y=o.length;const A=new Float32Array(3*y);for(let e=0;e<y;++e)b=o[e]-1,A[3*e+0]=s[3*b+0],A[3*e+1]=s[3*b+1],A[3*e+2]=s[3*b+2];y=i.length;const N=new Uint16Array(y);for(let e=0;e<y;++e)N[e]=e;return _&&console.warn("WebGL does not support quad faces, only triangles."),{positions:g,texcoords:E,normals:A,indices:N}}function He(e){const t=[],n=[],s=[],i=[],r=[],o=[],a=/v( +[\d|.|+|\-|e]+)( [\d|.|+|\-|e]+)( [\d|.|+|\-|e]+)/g,l=/vn( +[\d|.|+|\-|e]+)( [\d|.|+|\-|e]+)( [\d|.|+|\-|e]+)/g,u=/vt( +[\d|.|+|\-|e]+)( [\d|.|+|\-|e]+)/g,h=/f( +([\d]*)\/([\d]*)\/([\d]*))( ([\d]*)\/([\d]*)\/([\d]*))( ([\d]*)\/([\d]*)\/([\d]*))( ([\d]*)\/([\d]*)\/([\d]*))?/g,d=/f( +[\d|.|+|\-|e]+)( [\d|.|+|\-|e]+)( [\d|.|+|\-|e]+)/g;let c,p,m,f,b,y,_=!1,v=null;for(e=e.replace(/^#.*/g,"");null!=(v=a.exec(e));)c=Number.parseFloat(v[1]),p=Number.parseFloat(v[2]),m=Number.parseFloat(v[3]),t.push(c),t.push(p),t.push(m);for(;null!=(v=l.exec(e));)c=Number.parseFloat(v[1]),p=Number.parseFloat(v[2]),m=Number.parseFloat(v[3]),s.push(c),s.push(p),s.push(m);for(;null!=(v=u.exec(e));)c=Number.parseFloat(v[1]),p=Number.parseFloat(v[2]),n.push(c),n.push(p);for(;null!=(v=h.exec(e));)c=Number.parseInt(v[2]),Number.isNaN(c)&&(c=1),p=Number.parseInt(v[6]),Number.isNaN(p)&&(p=1),m=Number.parseInt(v[10]),Number.isNaN(m)&&(m=1),i.push(c),i.push(p),i.push(m),c=Number.parseInt(v[3]),Number.isNaN(c)&&(c=1),p=Number.parseInt(v[7]),Number.isNaN(p)&&(p=1),m=Number.parseInt(v[11]),Number.isNaN(m)&&(m=1),r.push(c),r.push(p),r.push(m),c=Number.parseInt(v[4]),Number.isNaN(c)&&(c=1),p=Number.parseInt(v[8]),Number.isNaN(p)&&(p=1),m=Number.parseInt(v[12]),Number.isNaN(m)&&(m=1),o.push(c),o.push(p),o.push(m),void 0!==v[13]&&(f=Number.parseInt(v[14]),Number.isNaN(f)&&(f=1),i.push(f),f=Number.parseInt(v[15]),Number.isNaN(f)&&(f=1),r.push(f),f=Number.parseInt(v[16]),Number.isNaN(f)&&(f=1),o.push(f),_=!0);for(;null!=(v=d.exec(e));)c=Number.parseInt(v[2]),p=Number.parseInt(v[6]),m=Number.parseInt(v[10]),i.push(c),i.push(p),i.push(m),r.push(1),r.push(1),r.push(1),o.push(1),o.push(1),o.push(1),void 0!==v[13]&&(f=Number.parseInt(v[14]),i.push(f),r.push(1),o.push(1),_=!0);y=i.length;const g=new Float32Array(3*y);for(let e=0;e<y;++e)b=i[e]-1,g[3*e+0]=t[3*b+0],g[3*e+1]=t[3*b+1],g[3*e+2]=t[3*b+2];y=r.length;const E=new Float32Array(2*y);for(let e=0;e<y;++e)b=r[e]-1,E[2*e+0]=n[2*b+0],E[2*e+1]=n[2*b+1];y=o.length;const A=new Float32Array(3*y);for(let e=0;e<y;++e)b=o[e]-1,A[3*e+0]=s[3*b+0],A[3*e+1]=s[3*b+1],A[3*e+2]=s[3*b+2];y=i.length;const N=new Uint16Array(y);for(let e=0;e<y;++e)N[e]=e;return _&&console.warn("WebGL does not support quad faces, only triangles."),{positions:g,texcoords:E,normals:A,indices:N}}var Ve=Object.freeze({__proto__:null,loadOBJ:async function(e,t){let n=await fetch(e),s=await n.text();{const e=10;for(let t=0;t<e;++t){performance.now();He(s);performance.now()}}{const e=10;for(let t=0;t<e;++t){performance.now();ze(s);performance.now()}}return ze(s)}});!async function(e){document.addEventListener("click",(()=>{"suspended"===e.state&&e.resume()}))}(new AudioContext);r(0,0,0),r(1,0,0),r(0,1,0),r(0,0,1);class We{constructor(e={locky:!1}){this.locky=e.locky,this.position=i(),this.forward=r(0,0,-1),this.right=r(1,0,0),this.up=r(0,1,0),this.forwardAmount=0,this.rightAmount=0,this.upAmount=0,this.pitch=0,this.yaw=-90}look(e,t,n=1){return this.pitch=Math.min(89.9,Math.max(-89.9,this.pitch+t*n)),this.yaw=(this.yaw+e*n)%360,this}move(e,t=0,n=0,s=1){return this.forwardAmount+=e*s,this.rightAmount+=t*s,this.upAmount+=n*s,this}apply(t){let{position:n,forward:s,right:r,up:h,forwardAmount:d,rightAmount:c,upAmount:p,pitch:m,yaw:f}=this,b=Ue(f),y=Ue(m),_=Math.cos(b),v=Math.cos(y),g=Math.sin(b);l(s,function(e,t,n,s){return e[0]=t,e[1]=n,e[2]=s,e}(s,_*v,Math.sin(y),g*v)),l(r,u(r,s,h));let E=i(),A=n[1];return a(E,s,d),o(n,n,E),a(E,r,c),o(n,n,E),this.locky&&(n[1]=A),a(E,h,p),o(n,n,E),this.forwardAmount=0,this.rightAmount=0,this.upAmount=0,function(t,n,s,i){var r,o,a,l,u,h,d,c,p,m,f=n[0],b=n[1],y=n[2],_=i[0],v=i[1],g=i[2],E=s[0],A=s[1],N=s[2];Math.abs(f-E)<e&&Math.abs(b-A)<e&&Math.abs(y-N)<e?function(e){e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1}(t):(d=f-E,c=b-A,p=y-N,r=v*(p*=m=1/Math.hypot(d,c,p))-g*(c*=m),o=g*(d*=m)-_*p,a=_*c-v*d,(m=Math.hypot(r,o,a))?(r*=m=1/m,o*=m,a*=m):(r=0,o=0,a=0),l=c*a-p*o,u=p*r-d*a,h=d*o-c*r,(m=Math.hypot(l,u,h))?(l*=m=1/m,u*=m,h*=m):(l=0,u=0,h=0),t[0]=r,t[1]=l,t[2]=d,t[3]=0,t[4]=o,t[5]=u,t[6]=c,t[7]=0,t[8]=a,t[9]=h,t[10]=p,t[11]=0,t[12]=-(r*f+o*b+a*y),t[13]=-(l*f+u*b+h*y),t[14]=-(d*f+c*b+p*y),t[15]=1)}(t,n,o(E,n,s),h),t}}const Ye={NULL:0,DOWN:1,UP:2,MOVE:3,parse(e){if("string"!=typeof e)return Ye.NULL;switch(e.toLowerCase()){case"down":return Ye.DOWN;case"up":return Ye.UP;case"move":return Ye.MOVE;default:return Ye.NULL}}};const Ge=1,qe=2;class Xe{static createAdapter(e,t,n,s,i,r){return{target:e,adapterId:t,deviceName:n,keyCode:s,scale:i,eventCode:r}}constructor(){this.adapters={"*":Ke()}}add(e){for(let t of e){const{deviceName:e,keyCode:n}=t;let s;e in this.adapters?s=this.adapters[e]:(s=Ke(),this.adapters[e]=s),n in s?s[n].push(t):s[n]=[t]}}delete(e){for(let t of e){const{deviceName:e,keyCode:n}=t;if(e in this.adapters){let s=this.adapters[e];if(n in s){let e=s[n],i=e.indexOf(t);i>=0&&e.splice(i,1)}}}}clear(){for(let e in this.adapters)this.adapters[e]=Ke()}poll(e,t,n){const s=this.findAdapters(e,t);for(let e of s){const t=e.eventCode;if(t===Ye.NULL){const{target:t,scale:s}=e,i=n.value*s;t.poll(i,e)}else{const{target:s,scale:i}=e,r=n.getEvent(t)*i;s.poll(r,e)}}return s.length>0}update(e,t,n){let s=!1;for(let i of this.findAdapters(e,t)){const e=i.eventCode;if(e!==Ye.NULL){const{target:t,scale:r}=i,o=n.getEvent(e)*r;t.update(o,i),s=!0}}return s}reset(e,t,n){let s=!1;for(let n of this.findAdapters(e,t))n.target.reset(),s=!0;return s}findAdapters(e,t){let n=[];if(e in this.adapters){let s=this.adapters[e];t in s&&n.push(...s[t]),n.push(...s["*"])}let s=this.adapters["*"];return t in s&&n.push(...s[t]),n.push(...s["*"]),n}}function Ke(){return{"*":[]}}class $e extends class{constructor(){this.value=0}update(e){this.value=e}poll(){this.value=0}getEvent(e){return 0}getState(){return this.value}}{constructor(e){super(),this.update=this.update.bind(this),Array.isArray(e)||(e=[e]);let t=[],n=0;for(let s of e){"string"==typeof s&&(s={key:s});const{key:e,scale:i=1,event:r="null"}=s,{deviceName:o,keyCode:a}=Je(e),l=Ye.parse(r),u=Number(i);let h=Xe.createAdapter(this,n,o,a,u,l);t.push(h),++n}this.adapters=t,this.values=new Array(t.length).fill(0),this.next={values:new Array(t.length).fill(0),value:0}}poll(e,t){const n=t.adapterId;let s=this.values[n];this.values[n]=e,this.value=this.value-s+e,this.next.values[n]=0,this.next.value+=e-s}update(e,t){const n=t.adapterId;let s=this.next.values[n];this.next.values[n]=e,this.next.value+=e-s}reset(){this.values.fill(0),this.value=0,this.next.values.fill(0),this.next.value=0}}function Je(e){let t=e.indexOf(":");if(t>=0)return{deviceName:e.substring(0,t),keyCode:e.substring(t+1)};throw new Error("Invalid key string - missing device separator ':'.")}function Ze(e,t){return`${e}:${t}`}class Qe{constructor(e={}){const{disabled:t=!0}=e;this.inputSource=null,this._disabled=t,this._ignoreInput=t,this.adapters=new Xe,this.inputs={},this.onSourceInput=this.onSourceInput.bind(this),this.onSourcePoll=this.onSourcePoll.bind(this)}get disabled(){return this._disabled}set disabled(e){this.toggle(!e)}setInputMap(e){return this._setupInputs(this.inputSource,e),this}attach(e){return this._setupInputs(e,null),this.toggle(!0),this}detach(){return this.toggle(!1),this._setupInputs(null,null),this}_setupInputs(e,t){const n=this.disabled;this.disabled=!0;const s=this.inputSource,i=this.inputs,r=s!==e&&s,o=this.inputs&&t;if(r||o){r&&(s.removeEventListener("poll",this.onSourcePoll),s.removeEventListener("input",this.onSourceInput));for(let e in i){let{adapters:t}=i[e];for(let e of t){const{deviceName:t,keyCode:n}=e;0===nt(s,t,n)&&s.delete(t,n)}}o&&(this.adapters.clear(),this.inputs={})}if(t){let e={};for(let n in t){let s=t[n],i=new $e(s),r=i.adapters;this.adapters.add(r),e[n]=i}this.inputs=e}if(e){!function(e){et in e||(e[et]={})}(e);const t=this.inputs;for(let n in t){let{adapters:s}=t[n];for(let t of s){const{deviceName:n,keyCode:s}=t;1===tt(e,n,s)&&e.add(n,s)}}this.inputSource!==e&&(e.addEventListener("poll",this.onSourcePoll),e.addEventListener("input",this.onSourceInput),this.inputSource=e)}this.disabled=n}onSourceInput(e){if(e.consumed||this._ignoreInput){const{deviceName:t,keyCode:n,input:s}=e;this.adapters.reset(t,n,s)}else{const{stage:t,deviceName:n,keyCode:s,input:i}=e;switch(t){case qe:this.adapters.poll(n,s,i);break;case Ge:this.adapters.update(n,s,i)}e.consumed=!0}}onSourcePoll(e){this._ignoreInput!==this.disabled&&(this._ignoreInput=this.disabled)}toggle(e=this._disabled){if(e){if(!this.inputSource)throw new Error("Input source must be set before enabling input context.");Object.keys(this.inputs).length<=0&&console.warn("No inputs found for enabled input context - did you forget to setInputMap()?")}return this._disabled=!e,this}getInput(e){return this.inputs[e]}getInputValue(e){return e in this.inputs?this.inputs[e].value:0}}const et=Symbol("inputRefCounts");function tt(e,t,n){const s=Ze(t,n);let i=e[et],r=i[s]+1||1;return i[s]=r,r}function nt(e,t,n){const s=Ze(t,n);let i=e[et],r=i[s]-1||0;return i[s]=Math.max(r,0),r}const st=(new Qe).setInputMap({PointerX:{key:"Mouse:PosX",scale:1},PointerY:{key:"Mouse:PosY",scale:1},PointerMovementX:{key:"Mouse:PosX",event:"move"},PointerMovementY:{key:"Mouse:PosY",event:"move"},PointerMovementZ:{key:"Mouse:WheelY",event:"move"},PointerDown:[{key:"Mouse:Button0",scale:1},{key:"Mouse:Button2",scale:1}],MoveLeft:[{key:"Keyboard:ArrowLeft",scale:1},{key:"Keyboard:KeyA",scale:1}],MoveRight:[{key:"Keyboard:ArrowRight",scale:1},{key:"Keyboard:KeyD",scale:1}],MoveUp:[{key:"Keyboard:ArrowUp",scale:1},{key:"Keyboard:KeyW",scale:1}],MoveDown:[{key:"Keyboard:ArrowDown",scale:1},{key:"Keyboard:KeyS",scale:1}]}),it={load:async()=>({mainVertexShaderSource:await je.loadText("main.vert"),mainFragmentShaderSource:await je.loadText("main.frag"),cubeObj:await Ve.loadOBJ("cube.obj"),quadObj:await Ve.loadOBJ("quad.obj"),gradientClay:await Be.loadImage("gradient_clay.png"),color:await Be.loadImage("null.png")})};class rt{constructor(){this.nodes={},this.roots=[],this._nextAvailableSceneNodeId=1}createSceneNode(e){let t=this._nextAvailableSceneNodeId++,n={parent:0,children:[]};return this.nodes[t]=n,ot(e,t,this),t}createSceneNodes(e,t){let n=[];for(let s=0;s<e;++s)n.push(this.createSceneNode(t));return n}deleteSceneNode(e){if(!(e in this.nodes))throw new Error("Cannot delete non-existant scene node for scene graph.");at(this.nodes[e].parent,e,this),lt(this,e,0,ut)}deleteSceneNodes(e){for(let t of e)this.deleteSceneNode(t)}getSceneNodeInfo(e){return this.nodes[e]}parentSceneNode(e,t){at(this.nodes[e].parent,e,this),ot(t,e,this)}replaceSceneNode(e,t){let n=this.nodes[e],s=n.parent,i=n.children.slice();if(at(s,e,this),n.children.length=0,t){let e=this.nodes[t];at(e.parent,t,this),e.children.push(...i),ot(s,t,this)}else if(s){this.nodes[s].children.push(...i)}else this.roots.push(...i);for(let e of i)this.nodes[e].parent=s}walk(e,t={}){const{from:n,childFilter:s}=t;let i;i=n?Array.isArray(n)?n:[n]:this.roots,s&&(i=s(i,0,this));for(let t of i)lt(this,t,0,e,s)}}function ot(e,t,n){e?(n.nodes[e].children.push(t),n.nodes[t].parent=e):(n.roots.push(t),n.nodes[t].parent=0)}function at(e,t,n){if(e){let s=n.nodes[e].children,i=s.indexOf(t);s.splice(i,1),n.nodes[t].parentNode=0}else{let e=n.roots,s=e.indexOf(t);e.splice(s,1),n.nodes[t].parentNode=0}}function lt(e,t,n,s,i){if(n>=100)return;let r=s(t,e);if(!1===r)return;let o=e.nodes[t],a=i?i(o.children,t,e):o.children;for(let t of a)lt(e,t,n+1,s,i);"function"==typeof r&&r(t,e)}function ut(e,t){delete t.nodes[e]}class ht{constructor(e,t,n){this.shaderProgram=t,this.meshData=n;let s=n;{const t=B(e,e.FLOAT,s.positions),n=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,n),e.bufferData(e.ARRAY_BUFFER,t,e.STATIC_DRAW),this.positions={source:t,buffer:n}}{const t=B(e,e.FLOAT,s.texcoords),n=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,n),e.bufferData(e.ARRAY_BUFFER,t,e.STATIC_DRAW),this.texcoords={source:t,buffer:n}}{const t=B(e,e.FLOAT,s.normals),n=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,n),e.bufferData(e.ARRAY_BUFFER,t,e.STATIC_DRAW),this.normals={source:t,buffer:n}}const i=B(e,e.UNSIGNED_SHORT,s.indices),r=e.createBuffer();e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,r),e.bufferData(e.ELEMENT_ARRAY_BUFFER,i,e.STATIC_DRAW),this.elements={source:i,buffer:r},this._drawContext=new dt(this)}begin(e,t,n){let s=this.shaderProgram.bind(e);return s.uniform("u_projection",t),s.uniform("u_view",n),this._drawContext.setProgramContext(s),this._drawContext}}class dt{constructor(e){this.renderer=e,this.ctx=null}setProgramContext(e){return this.ctx=e,this}render(e,t,n){const{ctx:s,renderer:i}=this,{positions:r,texcoords:o,normals:a,elements:l}=i;s.attribute("a_position",r.buffer,3),s.attribute("a_texcoord",o.buffer,2),s.attribute("a_normal",a.buffer,3),s.uniform("u_model",t),n&&s.uniform("u_color",n),s.draw(e,e.TRIANGLES,0,l.source.length,l.buffer)}end(e){return this.renderer}}class ct{constructor(e,t,n){this.shaderProgram=t,this.meshData=n;let s=n;const i=B(e,e.FLOAT,s.positions),r=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,r),e.bufferData(e.ARRAY_BUFFER,i,e.STATIC_DRAW),this.positions={source:i,buffer:r};{const t=B(e,e.FLOAT,s.texcoords),n=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,n),e.bufferData(e.ARRAY_BUFFER,t,e.STATIC_DRAW),this.texcoords={source:t,buffer:n}}{const t=B(e,e.FLOAT,s.normals),n=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,n),e.bufferData(e.ARRAY_BUFFER,t,e.STATIC_DRAW),this.normals={source:t,buffer:n}}const o=B(e,e.UNSIGNED_SHORT,s.indices),a=e.createBuffer();e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,a),e.bufferData(e.ELEMENT_ARRAY_BUFFER,o,e.STATIC_DRAW),this.elements={source:o,buffer:a},this._drawContext=new pt(this)}begin(e,t,n){let s=this.shaderProgram.bind(e);return s.uniform("u_projection",t),s.uniform("u_view",n),this._drawContext.setProgramContext(s),this._drawContext}}class pt{constructor(e){this.renderer=e,this.ctx=null}setProgramContext(e){return this.ctx=e,this}render(e,t,n){const{ctx:s,renderer:i}=this,{positions:r,texcoords:o,normals:a,elements:l}=i;s.attribute("a_position",r.buffer,3),s.attribute("a_texcoord",o.buffer,2),s.attribute("a_normal",a.buffer,3),s.uniform("u_model",t),n&&s.uniform("u_color",n),s.draw(e,e.TRIANGLES,0,l.source.length,l.buffer)}end(e){return this.renderer}}const mt=Symbol("template"),ft=Symbol("style");function bt(e,t){if(Object.prototype.hasOwnProperty.call(e,t)){let n=e[t];delete e[t],e[t]=n}}class yt extends HTMLElement{static get[mt](){let e=document.createElement("template");return e.innerHTML='\n        <kbd>\n            <span id="key"><slot></slot></span>\n            <span id="value" class="hidden"></span>\n        </kbd>',Object.defineProperty(this,mt,{value:e}),e}static get[ft](){let e=document.createElement("style");return e.innerHTML='\n        kbd {\n            position: relative;\n            display: inline-block;\n            border-radius: 3px;\n            border: 1px solid #888;\n            font-size: 0.85em;\n            font-weight: 700;\n            text-rendering: optimizeLegibility;\n            line-height: 12px;\n            height: 14px;\n            padding: 2px 4px;\n            color: #444;\n            background-color: #EEE;\n            box-shadow: inset 0 -3px 0 #AAA;\n            overflow: hidden;\n        }\n        \n        kbd:empty:after {\n            content: "<?>";\n            opacity: 0.6;\n        }\n        \n        .disabled {\n            opacity: 0.6;\n            box-shadow: none;\n            background-color: #AAA;\n        }\n\n        .hidden {\n            display: none;\n        }\n        \n        #value {\n            position: absolute;\n            top: 0;\n            bottom: 0;\n            right: 0;\n            font-size: 0.85em;\n            padding: 0 4px;\n            padding-top: 2px;\n            color: #CCC;\n            background-color: #333;\n            box-shadow: inset 0 3px 0 #222;\n        }',Object.defineProperty(this,ft,{value:e}),e}static get observedAttributes(){return["name","value","disabled"]}constructor(){super(),this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(this.constructor[mt].content.cloneNode(!0)),this.shadowRoot.appendChild(this.constructor[ft].cloneNode(!0)),this._keyboardElement=this.shadowRoot.querySelector("kbd"),this._keyElement=this.shadowRoot.querySelector("#key"),this._valueElement=this.shadowRoot.querySelector("#value")}connectedCallback(){bt(this,"name"),bt(this,"value")}attributeChangedCallback(e,t,n){switch(e){case"name":this._keyElement.innerText=n;break;case"value":null!==n?(this._valueElement.classList.toggle("hidden",!1),this._valueElement.innerText=n,this._keyboardElement.style.paddingRight=`${this._valueElement.clientWidth+4}px`):this._valueElement.classList.toggle("hidden",!0);break;case"disabled":this._keyboardElement.classList.toggle("disabled",null!==n)}}get name(){return this.getAttribute("name")}set name(e){this.setAttribute("name",e)}get value(){return this.getAttribute("value")}set value(e){this.setAttribute("value",e)}get disabled(){return this.hasAttribute("disabled")}set disabled(e){e?this.setAttribute("disabled",""):this.removeAttribute("disabled")}}window.customElements.define("input-kbd",yt);const _t=Symbol("template"),vt=Symbol("style");class gt extends HTMLElement{static get[_t](){let e=document.createElement("template");return e.innerHTML='\n        <table>\n            <thead>\n                <tr class="tableHeader">\n                    <th id="title" colspan=4>\n                        <slot></slot>\n                    </th>\n                </tr>\n                <tr class="colHeader">\n                    <th>name</th>\n                    <th>key</th>\n                    <th>mod</th>\n                    <th>value</th>\n                </tr>\n            </thead>\n            <tbody>\n            </tbody>\n        </table>',Object.defineProperty(this,_t,{value:e}),e}static get[vt](){let e=document.createElement("style");return e.innerHTML="\n        :host {\n            display: block;\n        }\n        table {\n            border-collapse: collapse;\n        }\n        table, th, td {\n            border: 1px solid gray;\n        }\n        .colHeader > th {\n            font-size: 0.8em;\n            font-family: monospace;\n            padding: 0 10px;\n            letter-spacing: 3px;\n            background-color: #AAA;\n            color: #666666;\n        }\n        th, td {\n            padding: 5px 10px;\n        }\n        td {\n            text-align: center;\n        }\n        output {\n            font-family: monospace;\n            border-radius: 0.3em;\n            padding: 3px;\n        }\n        tr:not(.primary) .name, tr:not(.primary) .value {\n            opacity: 0.3;\n        }\n        tr:nth-child(2n) {\n            background-color: #EEE;\n        }",Object.defineProperty(this,vt,{value:e}),e}static get observedAttributes(){return["src","id","class"]}constructor(){super(),this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(this.constructor[_t].content.cloneNode(!0)),this.shadowRoot.appendChild(this.constructor[vt].cloneNode(!0)),this._src="",this._titleElement=this.shadowRoot.querySelector("#title"),this._tableElements={},this._bodyElement=this.shadowRoot.querySelector("tbody"),this._children=this.shadowRoot.querySelector("slot")}connectedCallback(){!function(e,t){if(Object.prototype.hasOwnProperty.call(e,t)){let n=e[t];delete e[t],e[t]=n}}(this,"src")}attributeChangedCallback(e,t,n){switch(e){case"src":if(this._src!==n)if(this._src=n,n.trim().startsWith("{")){let e=JSON.parse(n);this._setInputMap(e)}else fetch(n).then((e=>e.json())).then((e=>this._setInputMap(e)));break;case"id":case"class":this._titleElement.innerHTML=`input-port${this.className?"."+this.className:""}${this.hasAttribute("id")?"#"+this.getAttribute("id"):""}`}}get src(){return this.getAttribute("src")}set src(e){switch(typeof e){case"object":{let t=JSON.stringify(e);this._src=t,this._setInputMap(e),this.setAttribute("src",t)}break;case"string":this.setAttribute("src",e);break;default:this.setAttribute("src",String(e))}}_setInputMap(e){let t=[];for(let n in e){Et(t,n,e[n])}this._bodyElement.innerHTML="";for(let e of t)this._bodyElement.appendChild(e)}}function Et(e,t,n){if(Array.isArray(n)){Et(e,t,n[0]);let s=n.length;for(let i=1;i<s;++i){const{key:s,event:r,scale:o}=n[i];let a=At(t,s,r,o,0,!1);e.push(a)}return e}{const{key:s,event:i,scale:r}=n;let o=At(t,s,i,r,0);return e.push(o),e}}function At(e,t,n,s,i,r=!0){let o=document.createElement("tr");r&&o.classList.add("primary");{let t=document.createElement("td");t.textContent=e,t.classList.add("name"),o.appendChild(t)}{let e=document.createElement("td");e.classList.add("key");let n=new yt;n.innerText=t,e.appendChild(n),o.appendChild(e)}{let e=document.createElement("td"),t=document.createElement("samp"),i=[];"string"==typeof n&&"null"!==n&&i.push(n),"number"==typeof s&&1!==s&&i.push(`×${s.toFixed(2)}`),t.innerText=i.join(" "),e.classList.add("mod"),e.appendChild(t),o.appendChild(e)}{let e=document.createElement("td"),t=document.createElement("output");t.innerText=Number(i).toFixed(2),t.classList.add("value"),e.appendChild(t),o.appendChild(e)}return o}window.customElements.define("input-map",gt);const Nt=Symbol("template"),Tt=Symbol("style");function St(e,t){if(Object.prototype.hasOwnProperty.call(e,t)){let n=e[t];delete e[t],e[t]=n}}class wt extends HTMLElement{static get[Nt](){let e=document.createElement("template");return e.innerHTML="",Object.defineProperty(this,Nt,{value:e}),e}static get[Tt](){let e=document.createElement("style");return e.innerHTML="\n        :host {\n            display: inline-block;\n        }",Object.defineProperty(this,Tt,{value:e}),e}static get observedAttributes(){return["for","src","autopoll","disabled","debug","id","class"]}constructor(){super(),this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(this.constructor[Nt].content.cloneNode(!0)),this.shadowRoot.appendChild(this.constructor[Tt].cloneNode(!0)),this._src="",this._titleElement=this.shadowRoot.querySelector("#title"),this._pollElement=this.shadowRoot.querySelector("#poll"),this._tableBody=this.shadowRoot.querySelector("tbody"),this._children=this.shadowRoot.querySelector("slot"),this._inputContext=new Qe}connectedCallback(){St(this,"src"),St(this,"for"),St(this,"disabled"),St(this,"debug"),this.hasAttribute("tabindex")||this.setAttribute("tabindex",0)}disconnectedCallback(){this._inputContext.disabled=!0}attributeChangedCallback(e,t,n){switch(e){case"for":{let e=n?document.getElementById(n):document.querySelector("input-source");e?this._inputContext.attach(e.source):this._inputContext.detach()}break;case"src":if(this._src!==n)if(this._src=n,n.trim().startsWith("{")){let e=JSON.parse(n);this._inputContext.setInputMap(e)}else fetch(n).then((e=>e.json())).then((e=>this._inputContext.setInputMap(e)));break;case"disabled":this._inputContext.disabled=null!==n;break;case"id":case"class":this._titleElement.innerHTML=`input-port${this.className?"."+this.className:""}${this.hasAttribute("id")?"#"+this.getAttribute("id"):""}`}}get src(){return this.getAttribute("src")}set src(e){switch(typeof e){case"object":{let t=JSON.stringify(e);this._src=t,this._inputContext.setInputMap(e),this.setAttribute("src",t)}break;case"string":this.setAttribute("src",e);break;default:this.setAttribute("src",String(e))}}get disabled(){return this.hasAttribute("disabled")}set disabled(e){e?this.setAttribute("disabled",""):this.removeAttribute("disabled")}}window.customElements.define("input-port",wt),document.addEventListener("DOMContentLoaded",(async function(){const e=document.querySelector("display-port"),t=document.querySelector("input-source"),s=st.attach(t.source);i=e,i.addEventListener("focus",(()=>{document.pointerLockElement!==i&&i.requestPointerLock()})),document.addEventListener("pointerlockchange",(()=>{document.pointerLockElement!==i&&i.blur()}));var i;const o=e.canvas.getContext("webgl");if(!o)throw new Error("Your browser does not support WebGL.");o.enable(o.DEPTH_TEST);const a=await it.load(),l=o.createTexture();o.bindTexture(o.TEXTURE_2D,l),o.texImage2D(o.TEXTURE_2D,0,o.RGBA,1,1,0,o.RGBA,o.UNSIGNED_BYTE,new Uint8Array([0,0,255,255])),o.texImage2D(o.TEXTURE_2D,0,o.RGBA,o.RGBA,o.UNSIGNED_BYTE,a.gradientClay),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MAG_FILTER,o.NEAREST),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,o.NEAREST);const u=function(e,t){return new Q(e,t)}(o,function(e){return new j(e)}(o).shader(o.VERTEX_SHADER,a.mainVertexShaderSource).shader(o.FRAGMENT_SHADER,a.mainFragmentShaderSource).link()),h=new ht(o,u,a.cubeObj),d=new ct(o,u,a.quadObj),c=function(e,t=ne,n=.1,s=1e3){return new se(e,t,n,s)}(o.canvas),m=function(e={}){return new We(e)}({locky:!0});m.move(-15,0,5),m.look(0,-20);const f=new Map,b=new rt;function y(e=0,t=0,s=0,i=1,o=1,a=1,l=0,u=0,h=0,d=r(Math.random(),Math.random(),Math.random()),c={}){let m=b.createSceneNode(),y={worldMatrix:n(),localMatrix:n()};return function(e,t,n,s){var i=t[0],r=t[1],o=t[2],a=t[3],l=i+i,u=r+r,h=o+o,d=i*l,c=i*u,p=i*h,m=r*u,f=r*h,b=o*h,y=a*l,_=a*u,v=a*h,g=s[0],E=s[1],A=s[2];e[0]=(1-(m+b))*g,e[1]=(c+v)*g,e[2]=(p-_)*g,e[3]=0,e[4]=(c-v)*E,e[5]=(1-(d+b))*E,e[6]=(f+y)*E,e[7]=0,e[8]=(p+_)*A,e[9]=(f-y)*A,e[10]=(1-(d+m))*A,e[11]=0,e[12]=n[0],e[13]=n[1],e[14]=n[2],e[15]=1}(y.localMatrix,function(e,t,n,s){var i=.5*Math.PI/180;t*=i,n*=i,s*=i;var r=Math.sin(t),o=Math.cos(t),a=Math.sin(n),l=Math.cos(n),u=Math.sin(s),h=Math.cos(s);return e[0]=r*l*h-o*a*u,e[1]=o*a*h+r*l*u,e[2]=o*l*u-r*a*h,e[3]=o*l*h+r*a*u,e}(p(),l,u,h),r(e,t,s),r(i,o,a)),f.set(m,y),{sceneNode:m,transform:y,color:d,...c}}const _=y(),v=((()=>{const e=.01,t=.1,n=.11,s=y(n,0,0,t,e,e,0,0,0,r(1,0,0)),i=y(0,n,0,e,t,e,0,0,0,r(0,1,0)),o=y(0,0,n,e,e,t,0,0,0,r(0,0,1)),a=y(0,0,0,e,e,e,0,0,0,r(1,1,1));b.parentSceneNode(s.sceneNode,_.sceneNode),b.parentSceneNode(i.sceneNode,_.sceneNode),b.parentSceneNode(o.sceneNode,_.sceneNode),b.parentSceneNode(a.sceneNode,_.sceneNode)})(),y()),g=((()=>{let e=y(0,-2.5,0,.8,.5,.8),t=y(0,-2,0,1.05,.2,1.05),n=y(0,-1,0,.6,1,.6),s=y(0,-1.8,0,.7,.2,.7);const i=.3;let r=y(0,.15,0,.6,.2,.6,-5),o=y(0,.05,0,1,.1,1,-5),a=y(-.3,-.3,.6,.1,.1,.1),l=y(.3,-.3,.6,.1,.1,.1),u=y(-.9,-.7,0,.2,.3,.2,0,0,90),h=y(-1,-.7+i,0,.2,.1,.2,0,0,0);h.color=u.color;let d=y(.9,-1,0,.2,.3,.2,0,0,90),c=y(1,-.7,0,.2,.1,.2,0,0,0);c.color=d.color,b.parentSceneNode(t.sceneNode,v.sceneNode),b.parentSceneNode(e.sceneNode,v.sceneNode),b.parentSceneNode(s.sceneNode,v.sceneNode),b.parentSceneNode(r.sceneNode,v.sceneNode),b.parentSceneNode(o.sceneNode,v.sceneNode),b.parentSceneNode(a.sceneNode,v.sceneNode),b.parentSceneNode(l.sceneNode,v.sceneNode),b.parentSceneNode(n.sceneNode,v.sceneNode),b.parentSceneNode(u.sceneNode,v.sceneNode),b.parentSceneNode(h.sceneNode,v.sceneNode),b.parentSceneNode(d.sceneNode,v.sceneNode),b.parentSceneNode(c.sceneNode,v.sceneNode)})(),[y(0,0,0,1,1,1),y(4,0,0,1,.5,1),y(-4,0,0,2,4,2,45)]),E=[y(0,-4,0,2,2,2)];let A=0;e.addEventListener("frame",(e=>{e.detail.deltaTime;s.inputSource.poll();const t=s.getInputValue("PointerX"),n=s.getInputValue("PointerY"),i=s.getInputValue("PointerMovementX"),r=s.getInputValue("PointerMovementY"),a=s.getInputValue("PointerMovementZ"),l=s.getInputValue("MoveRight")-s.getInputValue("MoveLeft"),u=s.getInputValue("MoveUp")-s.getInputValue("MoveDown");o.viewport(0,0,o.canvas.width,o.canvas.height),o.clearColor(0,0,0,0),o.clear(o.COLOR_BUFFER_BIT);let p=c;const y=o.canvas.width/o.canvas.height;m.look(100*i*y,100*-r);m.move(.5*u,.5*l),m.apply(p.viewMatrix),A+=a/1e3;let v,N=te(2*(t-.5),2*(.5-n),p.projectionMatrix,p.viewMatrix);!function(e,t,n,s){e[0]=t[0]+n[0]*s,e[1]=t[1]+n[1]*s,e[2]=t[2]+n[2]*s}(N,m.position,N,1-A),function(e,t){e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1}(_.transform.localMatrix,N),b.walk(((e,t)=>{let{parent:n}=t.getSceneNodeInfo(e);!function(e,t){t?function(e,t,n){var s=t[0],i=t[1],r=t[2],o=t[3],a=t[4],l=t[5],u=t[6],h=t[7],d=t[8],c=t[9],p=t[10],m=t[11],f=t[12],b=t[13],y=t[14],_=t[15],v=n[0],g=n[1],E=n[2],A=n[3];e[0]=v*s+g*a+E*d+A*f,e[1]=v*i+g*l+E*c+A*b,e[2]=v*r+g*u+E*p+A*y,e[3]=v*o+g*h+E*m+A*_,v=n[4],g=n[5],E=n[6],A=n[7],e[4]=v*s+g*a+E*d+A*f,e[5]=v*i+g*l+E*c+A*b,e[6]=v*r+g*u+E*p+A*y,e[7]=v*o+g*h+E*m+A*_,v=n[8],g=n[9],E=n[10],A=n[11],e[8]=v*s+g*a+E*d+A*f,e[9]=v*i+g*l+E*c+A*b,e[10]=v*r+g*u+E*p+A*y,e[11]=v*o+g*h+E*m+A*_,v=n[12],g=n[13],E=n[14],A=n[15],e[12]=v*s+g*a+E*d+A*f,e[13]=v*i+g*l+E*c+A*b,e[14]=v*r+g*u+E*p+A*y,e[15]=v*o+g*h+E*m+A*_}(e.worldMatrix,t.worldMatrix,e.localMatrix):function(e,t){e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]}(e.worldMatrix,e.localMatrix)}(f.get(e),n?f.get(n):null)})),v=h.begin(o,p.projectionMatrix,p.viewMatrix),v.ctx.uniform("u_texture",0);for(let e of g)v.ctx.uniform("u_local",e.transform.localMatrix),v.render(o,e.transform.worldMatrix,e.color);v.end(o),v=d.begin(o,p.projectionMatrix,p.viewMatrix),v.ctx.uniform("u_texture",0);for(let e of E)v.ctx.uniform("u_local",e.transform.localMatrix),v.render(o,e.transform.worldMatrix,e.color);v.end(o)}))}))}();
