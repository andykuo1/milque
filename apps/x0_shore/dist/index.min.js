!function(){"use strict";const t="noscale",e="stretch",n=Symbol("template"),i=Symbol("style");class s extends HTMLElement{static get[n](){let t=document.createElement("template");return t.innerHTML='\n<div class="container">\n    <label class="hidden" id="title">display-port</label>\n    <label class="hidden" id="fps">00</label>\n    <label class="hidden" id="dimension">0x0</label>\n    <canvas></canvas>\n    <slot></slot>\n</div>',Object.defineProperty(this,n,{value:t}),t}static get[i](){let t=document.createElement("style");return t.innerHTML='\n:host {\n    display: inline-block;\n    color: #555555;\n}\n.container {\n    display: flex;\n    position: relative;\n    width: 100%;\n    height: 100%;\n}\ncanvas {\n    background: #000000;\n    margin: auto;\n    image-rendering: pixelated;\n}\nlabel {\n    font-family: monospace;\n    color: currentColor;\n    position: absolute;\n}\n#title {\n    left: 0.5rem;\n    top: 0.5rem;\n}\n#fps {\n    right: 0.5rem;\n    top: 0.5rem;\n}\n#dimension {\n    left: 0.5rem;\n    bottom: 0.5rem;\n}\n.hidden {\n    display: none;\n}\n:host([debug]) .container {\n    outline: 6px dashed rgba(0, 0, 0, 0.1);\n    outline-offset: -4px;\n    background-color: rgba(0, 0, 0, 0.1);\n}\n:host([mode="noscale"]) canvas {\n    margin: 0;\n    top: 0;\n    left: 0;\n}\n:host([mode="fit"]), :host([mode="center"]), :host([mode="stretch"]) {\n    width: 100%;\n    height: 100%;\n}\n:host([full]) {\n    width: 100vw!important;\n    height: 100vh!important;\n}\n:host([disabled]) {\n    display: none;\n}\nslot {\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    justify-content: center;\n\n    position: absolute;\n    width: 100%;\n    height: 100%;\n    top: 0;\n    left: 0;\n\n    pointer-events: none;\n}\n::slotted(*) {\n    pointer-events: auto;\n}',Object.defineProperty(this,i,{value:t}),t}static get observedAttributes(){return["width","height","disabled","onframe","debug","id","class"]}constructor(){super(),this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(this.constructor[n].content.cloneNode(!0)),this.shadowRoot.appendChild(this.constructor[i].cloneNode(!0)),this._canvasElement=this.shadowRoot.querySelector("canvas"),this._titleElement=this.shadowRoot.querySelector("#title"),this._fpsElement=this.shadowRoot.querySelector("#fps"),this._dimensionElement=this.shadowRoot.querySelector("#dimension"),this._animationRequestHandle=0,this._prevAnimationFrameTime=0,this._width=300,this._height=150,this._onframe=null,this.update=this.update.bind(this)}get canvas(){return this._canvasElement}connectedCallback(){this.hasAttribute("mode")||(this.mode="noscale"),this.hasAttribute("tabindex")||this.setAttribute("tabindex",0),this.updateCanvasSize(),this.resume()}disconnectedCallback(){this.pause()}attributeChangedCallback(t,e,n){switch(t){case"width":this._width=n;break;case"height":this._height=n;break;case"disabled":n?(this.update(0),this.pause()):this.resume();break;case"onframe":this.onframe=new Function("event",`with(document){with(this){${n}}}`).bind(this);break;case"id":case"class":this._titleElement.innerHTML=`display-port${this.className?"."+this.className:""}${this.hasAttribute("id")?"#"+this.getAttribute("id"):""}`;break;case"debug":this._titleElement.classList.toggle("hidden",n),this._fpsElement.classList.toggle("hidden",n),this._dimensionElement.classList.toggle("hidden",n)}}update(e){this._animationRequestHandle=requestAnimationFrame(this.update),this.updateCanvasSize();const n=e-this._prevAnimationFrameTime;if(this._prevAnimationFrameTime=e,this.debug){const e=n<=0?"--":String(Math.round(1e3/n)).padStart(2,"0");if(this._fpsElement.innerText!==e&&(this._fpsElement.innerText=e),this.mode===t){let t=`${this._width}x${this._height}`;this._dimensionElement.innerText!==t&&(this._dimensionElement.innerText=t)}else{let t=`${this._width}x${this._height}|${this.shadowRoot.host.clientWidth}x${this.shadowRoot.host.clientHeight}`;this._dimensionElement.innerText!==t&&(this._dimensionElement.innerText=t)}}this.dispatchEvent(new CustomEvent("frame",{detail:{now:e,prevTime:this._prevAnimationFrameTime,deltaTime:n,canvas:this._canvasElement,get context(){let t=this.canvas.getContext("2d");return t.imageSmoothingEnabled=!1,t}},bubbles:!1,composed:!0}))}pause(){cancelAnimationFrame(this._animationRequestHandle)}resume(){this._animationRequestHandle=requestAnimationFrame(this.update)}updateCanvasSize(){let n=this.shadowRoot.host.getBoundingClientRect();const i=n.width,s=n.height;let o=this._canvasElement,r=this._width,a=this._height;const h=this.mode;if(h===e)r=i,a=s;else if(h!==t){if(i<r||s<a||"fit"===h){let t=i/r,e=s/a;t<e?(r=i,a*=t):(r*=e,a=s)}}r=Math.floor(r),a=Math.floor(a),o.clientWidth===r&&o.clientHeight===a||(o.width=this._width,o.height=this._height,o.style=`width: ${r}px; height: ${a}px`,this.dispatchEvent(new CustomEvent("resize",{detail:{width:r,height:a},bubbles:!1,composed:!0})))}get onframe(){return this._onframe}set onframe(t){this._onframe&&this.removeEventListener("frame",this._onframe),this._onframe=t,this._onframe&&this.addEventListener("frame",t)}get width(){return this._width}set width(t){this.setAttribute("width",t)}get height(){return this._height}set height(t){this.setAttribute("height",t)}get mode(){return this.getAttribute("mode")}set mode(t){this.setAttribute("mode",t)}get disabled(){return this.hasAttribute("disabled")}set disabled(t){t?this.setAttribute("disabled",""):this.removeAttribute("disabled")}get debug(){return this.hasAttribute("debug")}set debug(t){t?this.setAttribute("debug",""):this.removeAttribute("debug")}}window.customElements.define("display-port",s);class o{static addInputEventListener(t,e){}static removeInputEventListener(t,e){}constructor(t){this.eventTarget=t}}class r{constructor(){this.down=0,this.up=0,this.value=0,this.next={up:0,down:0}}update(t,e){"down"===t?this.next.down=e:this.next.up=e}poll(){this.value?this.up&&!this.next.up&&(this.value=0):this.next.down&&(this.value=1),this.down=this.next.down,this.up=this.next.up,this.next.down=0,this.next.up=0}toString(){return this.value}}class a{constructor(){this.value=0}update(t,e){this.value=e}poll(){}toString(){return this.value}}class h extends a{constructor(){super(),this.next=0}update(t,e){this.next+=e}poll(){this.value=this.next,this.next=0}}const l=Symbol("keyboardEventContext");class u extends o{static addInputEventListener(t,e){let n;if(l in e)n=e[l];else{n={handler:e,target:t,down:null,up:null,_keyEvent:{type:"key",target:t,device:"keyboard",key:null,event:null,value:null,control:!1,shift:!1,alt:!1}};let i=d.bind(n),s=c.bind(n);n.down=i,n.up=s,e[l]=n}return t.addEventListener("keyup",n.up),t.addEventListener("keydown",n.down),t}static removeInputEventListener(t,e){if(l in e){let n=e[l];t.removeEventListener("keyup",n.up),t.removeEventListener("keydown",n.down)}return t}constructor(t,e){if(super(t),this._buttons=[],this._managed=Array.isArray(e),this.onManagedKeyEvent=this.onManagedKeyEvent.bind(this),this.onUnmanagedKeyEvent=this.onUnmanagedKeyEvent.bind(this),this._managed){for(let t of e){let e=new r;this[t]=e,this._buttons.push(e)}u.addInputEventListener(t,this.onManagedKeyEvent)}else u.addInputEventListener(t,this.onUnmanagedKeyEvent)}get Up(){return Math.min((this.ArrowUp||0)+(this.KeyW||0),1)}get Down(){return Math.min((this.ArrowDown||0)+(this.KeyS||0),1)}get Left(){return Math.min((this.ArrowLeft||0)+(this.KeyA||0),1)}get Right(){return Math.min((this.ArrowRight||0)+(this.KeyD||0),1)}destroy(){this._managed?u.removeInputEventListener(this.eventTarget,this.onManagedKeyEvent):u.removeInputEventListener(this.eventTarget,this.onUnmanagedKeyEvent),this.eventTarget=null}poll(){for(let t of this._buttons)t.poll();return this}onUnmanagedKeyEvent(t){if(!(t.key in this)){let e=new r;this[t.key]=e,this._buttons.push(e)}return this[t.key].update(t.event,t.value),!0}onManagedKeyEvent(t){if(t.key in this)return this[t.key].update(t.event,t.value),!0}}function d(t){if(t.repeat)return t.preventDefault(),t.stopPropagation(),!1;let e=this._keyEvent;return e.key=t.code,e.event="down",e.value=1,e.control=t.ctrlKey,e.shift=t.shiftKey,e.alt=t.altKey,this.handler.call(void 0,e)?(t.preventDefault(),t.stopPropagation(),!1):void 0}function c(t){let e=this._keyEvent;if(e.key=t.code,e.event="up",e.value=1,e.control=t.ctrlKey,e.shift=t.shiftKey,e.alt=t.altKey,this.handler.call(void 0,e))return t.preventDefault(),t.stopPropagation(),!1}const p=Symbol("mouseEventContext");class m extends o{static addInputEventListener(t,e){let n;if(p in e)n=e[p];else{n={handler:e,target:t,down:null,up:null,move:null,contextmenu:null,_down:!1,_keyEvent:{type:"key",target:t,device:"mouse",key:null,event:null,value:null},_posEvent:{type:"pos",target:t,device:"mouse",key:"pos",event:"move",x:0,y:0,dx:0,dy:0}};let i=y.bind(n),s=f.bind(n),o=v.bind(n),r=g.bind(n);n.down=i,n.up=s,n.move=o,n.contextmenu=r,e[p]=n}return t.addEventListener("mousedown",n.down),document.addEventListener("mouseup",n.up),t.addEventListener("contextmenu",n.contextmenu),document.addEventListener("mousemove",n.move),t}static removeInputEventListener(t,e){if(p in e){let n=e[p];t.removeEventListener("mousedown",n.down),document.removeEventListener("mouseup",n.up),t.removeEventListener("contextmenu",n.contextmenu),document.removeEventListener("mousemove",n.move)}return t}constructor(t){super(t),this.x=new a,this.y=new a,this.dx=new h,this.dy=new h,this.Button0=new r,this.Button1=new r,this.Button2=new r,this.Button3=new r,this.Button4=new r,this.onMouseEvent=this.onMouseEvent.bind(this),m.addInputEventListener(t,this.onMouseEvent)}get Left(){return this.Button0}get Middle(){return this.Button1}get Right(){return this.Button2}destroy(){m.removeInputEventListener(this.eventTarget,this.onMouseEvent),this.eventTarget=null}poll(){return this.x.poll(),this.y.poll(),this.dx.poll(),this.dy.poll(),this.Button0.poll(),this.Button1.poll(),this.Button2.poll(),this.Button3.poll(),this.Button4.poll(),this}onMouseEvent(t){let{key:e,event:n}=t;switch(e){case 0:this.Button0.update(n,t.value);break;case 1:this.Button1.update(n,t.value);break;case 2:this.Button2.update(n,t.value);break;case 3:this.Button3.update(n,t.value);break;case 4:this.Button4.update(n,t.value);break;case"pos":return this.x.update(n,t.x),this.y.update(n,t.y),this.dx.update(n,t.dx),void this.dy.update(n,t.dy)}return!0}}function y(t){this._down=!0;let e=this._keyEvent;if(e.key=t.button,e.event="down",e.value=1,this.handler.call(void 0,e)&&document.activeElement===this.target)return t.preventDefault(),t.stopPropagation(),!1}function f(t){if(this._down){this._down=!1;let e=this._keyEvent;if(e.key=t.button,e.event="up",e.value=1,this.handler.call(void 0,e))return t.preventDefault(),t.stopPropagation(),!1}}function v(t){let e=this.target,{clientWidth:n,clientHeight:i}=e,s=this.target.getBoundingClientRect(),o=t.movementX/n,r=t.movementY/i,a=(t.clientX-s.left)/n,h=(t.clientY-s.top)/i,l=this._posEvent;if(l.x=a,l.y=h,l.dx=o,l.dy=r,void 0!==this.handler.call(void 0,l))throw new Error("Return value must be 'undefined'. Mouse position and movement events cannot be consumed.")}function g(t){return t.preventDefault(),t.stopPropagation(),!1}const b=Symbol("template"),w=Symbol("style");class x extends HTMLElement{static toInputMap(t){let e={};for(let n of t)if(n instanceof x){let t,i=n.input;switch(i in e?t=e[i]:e[i]=t=[],n.type){case"action":t.push({key:n.key,event:n.event});break;case"range":t.push({key:n.key,scale:n.scale});break;default:throw new Error("Unknown input type.")}}return e}static get[b](){let t=document.createElement("template");return t.innerHTML="\n<kbd></kbd>",Object.defineProperty(this,b,{value:t}),t}static get[w](){let t=document.createElement("style");return t.innerHTML="\n:host {\n    display: inline-block;\n}\nkbd {\n    background-color: #EEEEEE;\n    border-radius: 3px;\n    border: 1px solid #B4B4B4;\n    box-shadow: 0 1px 1px rgba(0, 0, 0, .2), 0 2px 0 0 rgba(255, 255, 255, .7) inset;\n    color: #333333;\n    font-size: 0.85em;\n    font-weight: 700;\n    line-height: 1;\n    padding: 2px 4px;\n    white-space: nowrap;\n}\n",Object.defineProperty(this,w,{value:t}),t}static get observedAttributes(){return["input","key","scale","event"]}constructor(){super(),this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(this.constructor[b].content.cloneNode(!0)),this.shadowRoot.appendChild(this.constructor[w].cloneNode(!0)),this.keyElement=this.shadowRoot.querySelector("kbd")}attributeChangedCallback(t,e,n){switch(t){case"key":this.keyElement.textContent=n}}get type(){return this.hasAttribute("event")?"action":"range"}get input(){return this.getAttribute("input")}set input(t){this.setAttribute("input",t)}get key(){return this.getAttribute("key")}set key(t){this.setAttribute("key",t)}get scale(){return Number(this.getAttribute("scale"))}set scale(t){this.setAttribute("scale",t)}get event(){return this.getAttribute("event")}set event(t){this.setAttribute("event",t)}}window.customElements.define("input-key",x);class E{constructor(t,e){this.inputName=t,this.inputType=e,this.value=0,this._onchange=null,this._eventListeners=new Map}update(t){if(this.value!==t){if(this.value=t,this._eventListeners.has("change"))for(let t of this._eventListeners.get("change"))t.call(void 0,this);return!0}return!1}get onchange(){return this._onchange}set onchange(t){this._onchange&&this.removeEventListener("change",this._onchange),this._onchange=t,this.addEventListener("change",t)}addEventListener(t,e){if(this._eventListeners.has(t)){this._eventListeners.get(t).push(e)}else this._eventListeners.set(t,[e])}removeEventListener(t,e){if(this._eventListeners.has(t)){let n=this._eventListeners.get(t);n.splice(n.indexOf(e),1)}}toString(){return this.value}}class _{constructor(t,e,n){this.keyName=t,this.keyEvent=e,this.scale=n,this.value=0}consumeKey(){this.value=0}updateKey(t,e){if(e===this.keyName)if(this.keyEvent){if(this.keyEvent===t.event)return this.value=t.value*this.scale,!0}else switch(t.event){case"down":return this.value=this.scale,!0;case"up":return this.value=0,!0;default:return void(this.value=t.value*this.scale)}}}const k=Symbol("template"),M=Symbol("style");class A extends HTMLElement{static get[k](){let t=document.createElement("template");return t.innerHTML='\n<table>\n    <thead>\n        <tr class="header">\n            <th id="title" colspan=3>input-context</th>\n            <th id="poll">&nbsp;</th>\n        </tr>\n        <tr class="hint">\n            <th>input</th>\n            <th>key</th>\n            <th>mod</th>\n            <th>value</th>\n        </tr>\n    </thead>\n    <tbody>\n    </tbody>\n</table>\n<slot></slot>',Object.defineProperty(this,k,{value:t}),t}static get[M](){let t=document.createElement("style");return t.innerHTML='\n:host {\n    display: inline-block;\n}\nslot {\n    display: none;\n}\ntable {\n    border-collapse: collapse;\n}\ntable, th, td {\n    border: 1px solid gray;\n}\n#poll {\n    position: relative;\n    font-size: 0.9em;\n}\n#poll:after {\n    content: "(poll)";\n    position: absolute;\n    left: 0;\n    right: 0;\n    z-index: -1;\n    opacity: 0.1;\n    font-family: monospace;\n    letter-spacing: 3px;\n    overflow: hidden;\n}\n.hint > th {\n    font-size: 0.5em;\n    font-family: monospace;\n    padding: 0 10px;\n    letter-spacing: 3px;\n    background-color: #AAA;\n    color: #666666;\n}\nth, td {\n    padding: 5px 10px;\n}\ntd {\n    text-align: center;\n}\nkbd {\n    display: inline-block;\n    background-color: #EEEEEE;\n    border-radius: 3px;\n    border: 1px solid #B4B4B4;\n    box-shadow: 0 1px 1px rgba(0, 0, 0, .2), 0 2px 0 0 rgba(255, 255, 255, .7) inset;\n    color: #333333;\n    font-size: 0.85em;\n    font-weight: 700;\n    line-height: 1;\n    padding: 2px 4px;\n    white-space: nowrap;\n}\noutput {\n    font-family: monospace;\n    border-radius: 0.3em;\n    padding: 3px;\n}\n.flash {\n    animation: fadein 4s;\n}\n@keyframes fadein {\n    0%, 10% { background-color: rgba(0, 0, 255, 0.3); }\n    100% { background-color: rgba(0, 0, 255, 0); }\n}\n',Object.defineProperty(this,M,{value:t}),t}static get observedAttributes(){return["for","strict","onattach","ondetach","id","class"]}constructor(t=null){super(),this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(this.constructor[k].content.cloneNode(!0)),this.shadowRoot.appendChild(this.constructor[M].cloneNode(!0)),this._onattach=null,this._ondetach=null,this._titleElement=this.shadowRoot.querySelector("#title"),this._pollElement=this.shadowRoot.querySelector("#poll"),this._tableBody=this.shadowRoot.querySelector("tbody"),this._children=this.shadowRoot.querySelector("slot"),this._tableInputs={},this._lastPollTime=0,this._pollWarningTimeoutHandle=0,this._animationFrameHandle=0,this._inputTarget=null,this._inputMap=t,this._inputs={},this._inputKeys={},this._keys={},this.onInputEvent=this.onInputEvent.bind(this),this.onAnimationFrame=this.onAnimationFrame.bind(this),t&&C(this,t)}connectedCallback(){if(this.hasAttribute("for")||this.setAttribute("for",""),!this._inputMap){this._inputMap={};const t=x.toInputMap(this._children.assignedNodes()),e=this.src;e?fetch(e).then(t=>t.json()).then(e=>{this._inputMap={...e,...t},C(this,this._inputMap)}):(this._inputMap={...t},C(this,this._inputMap))}this._lastPollTime=0,this._pollWarningTimeoutHandle=setTimeout(()=>{this._lastPollTime<=0?(this._pollElement.textContent="✗",console.warn("[INPUT] No input updated. Did you forget to poll() the input context?")):this._pollElement.textContent="✓"},3e3),this._animationFrameHandle=requestAnimationFrame(this.onAnimationFrame)}disconnectedCallback(){cancelAnimationFrame(this._animationFrameHandle),clearTimeout(this._pollWarningTimeoutHandle)}attributeChangedCallback(t,e,n){switch(t){case"for":let t;t=n?document.getElementById(n):document.querySelector("display-port")||document.querySelector("canvas"),this._inputTarget&&this.detach(),t&&this.attach(t);break;case"onattach":this.onattach=new Function("event",`with(document){with(this){${n}}}`).bind(this);break;case"ondetach":this.ondetach=new Function("event",`with(document){with(this){${n}}}`).bind(this);break;case"id":case"class":this._titleElement.innerHTML=`input-context${this.className?"."+this.className:""}${this.hasAttribute("id")?"#"+this.getAttribute("id"):""}`}}get src(){return this.getAttribute("src")}set src(t){this.setAttribute("src",t)}get for(){return this.getAttribute("for")}set for(t){this.setAttribute("for",t)}get strict(){return this.hasAttribute("strict")}set strict(t){t?this.setAttribute("strict",""):this.removeAttribute("strict")}get auto(){return this.hasAttribute("auto")}set auto(t){t?this.setAttribute("auto",""):this.removeAttribute("auto")}get onattach(){return this._onattach}set onattach(t){this._onattach&&this.removeEventListener("attach",this._onattach),this._onattach=t,this._onattach&&this.addEventListener("attach",t)}get ondetach(){return this._ondetach}set ondetach(t){this._ondetach&&this.removeEventListener("detach",this._ondetach),this._ondetach=t,this._ondetach&&this.addEventListener("detach",t)}attach(t){if(!t)throw new Error("Cannot attach input context to null.");if(this._inputTarget){if(this._inputTarget!==t)throw new Error("Input context already attached to another element.");return this}let e=t;return e&&(e.canvas?(u.addInputEventListener(e,this.onInputEvent),m.addInputEventListener(e.canvas,this.onInputEvent)):(u.addInputEventListener(e,this.onInputEvent),m.addInputEventListener(e,this.onInputEvent)),this.dispatchEvent(new CustomEvent("attach",{composed:!0,bubbles:!1,detail:{eventTarget:e,inputCallback:this.onInputEvent}}))),this._inputTarget=e,this}detach(){if(!this._inputTarget)return this;let t=this._inputTarget;return this._inputTarget=null,t.canvas?(u.removeInputEventListener(t,this.onInputEvent),m.removeInputEventListener(t.canvas,this.onInputEvent)):(u.removeInputEventListener(t,this.onInputEvent),m.removeInputEventListener(t,this.onInputEvent)),this.dispatchEvent(new CustomEvent("detach",{composed:!0,bubbles:!1,detail:{eventTarget:t,inputCallback:this.onInputEvent}})),this}poll(){this._lastPollTime=performance.now();for(let t in this._inputs){let e=this._inputs[t];switch(e.inputType){case"action":let n=!1;for(let i of this._inputKeys[t]){let t=i.value;if(t){e.update(t,i),i.consumeKey(),n=!0;break}}n||e.update(0,null);break;case"range":let i=0;for(let e of this._inputKeys[t])i+=e.value;e.update(i,null);break;default:throw new Error("Unknown input type.")}}}onInputEvent(t){let e=t.type;switch(e){case"key":{const e=t.device+":"+t.key;if(e in this._keys){let n=!1;for(let i of this._keys[e])i.updateKey(t,e)&&(n=!0);if(n)return!0}}break;case"pos":{const e=["x","y","dx","dy"];for(let n of e){t.value=t[n];const e=t.device+":"+t.key+"."+n;if(e in this._keys){let n=!1;for(let i of this._keys[e])i.updateKey(t,e)&&(n=!0);if(n)return!0}}}break;default:throw new Error(`Unknown input event type '${e}'.`)}}onAnimationFrame(t){this._animationFrameHandle=requestAnimationFrame(this.onAnimationFrame),this.auto&&this.poll();for(let t in this._inputs){let e,n=this._inputs[t];e=n.value?Number(n.value).toFixed(2):0;let i=this._tableInputs[t];if(i.textContent!=e){i.textContent=e;let t=i.parentNode;i.parentNode.removeChild(i),t.appendChild(i)}}}getInput(t){if(t in this._inputs)return this._inputs[t];if(this.strict)throw new Error(`Cannot find input with name '${t}'.`);{let e=new E(t,"range");return this._inputs[t]=e,e}}getInputValue(t){if(t in this._inputs)return this._inputs[t].value;if(this.strict)throw new Error(`Cannot find input with name '${t}'.`);return 0}}function C(t,e){for(let n in e){let i=e[n];if(Array.isArray(i))for(let e of i)I(t,n,e),"string"==typeof e&&(e={key:e,event:"down"}),L(t,n,e);else I(t,n,i),"string"==typeof i&&(i={key:i,event:"down"}),L(t,n,i)}}function T(t){if("object"==typeof t){if("type"in t)return t.type;if("scale"in t)return"range";if("event"in t)return"action";throw new Error(`Missing 'scale' or 'event' for input option '${inputName}'.`)}if("string"==typeof t)return"action";throw new Error("Invalid type for input mapping option.")}function L(t,e,n){let i=document.createElement("tr");{let t=document.createElement("td");t.textContent=e,t.classList.add("name"),i.appendChild(t)}{let t=document.createElement("td");t.classList.add("key");let e=document.createElement("kbd");e.textContent=n.key,t.appendChild(e),i.appendChild(t)}{let t=document.createElement("td"),e=document.createElement("samp");switch(T(n)){case"action":e.textContent=n.event;break;case"range":e.textContent=Number(n.scale).toFixed(2);break;default:e.textContent="<?>"}t.classList.add("mod"),t.appendChild(e),i.appendChild(t)}if(e in t._tableInputs){let t=document.createElement("td");t.classList.add("value"),i.appendChild(t)}else{let n=document.createElement("td"),s=document.createElement("output");s.textContent=0,s.classList.add("flash"),n.classList.add("value"),n.appendChild(s),i.appendChild(n),t._tableInputs[e]=s}t._tableBody.appendChild(i)}function I(t,e,n){let i=T(n);switch(i){case"action":R(t,e,"string"==typeof n?{key:n,event:"down"}:n);break;case"range":!function(t,e,n){const{key:i,scale:s}=n;let o,r,a;if(e in t._inputs){if(o=t._inputs[e],r=t._inputKeys[e],"range"!==o.inputType)throw new Error(`Cannot register mismatched 'range' type input for '${o.inputType}' type input '${e}'.`)}else o=new E(e,"range"),r=[],t._inputs[e]=o,t._inputKeys[e]=r;i in t._keys?a=t._keys[i]:(a=[],t._keys[i]=a);let h=new _(i,null,s);a.push(h),r.push(h)}(t,e,n);break;default:throw new Error(`Unknown input type '${i}'.`)}}function R(t,e,n){const{key:i,event:s}=n;let o,r,a;if(e in t._inputs){if(o=t._inputs[e],r=t._inputKeys[e],"action"!==o.inputType)throw new Error(`Cannot register mismatched 'action' type input for '${o.inputType}' type input '${e}'.`)}else o=new E(e,"action"),r=[],t._inputs[e]=o,t._inputKeys[e]=r;i in t._keys?a=t._keys[i]:(a=[],t._keys[i]=a);let h=new _(i,s,1);a.push(h),r.push(h)}window.customElements.define("input-context",A);var S="undefined"!=typeof Float32Array?Float32Array:Array;function K(){var t=new S(16);return S!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function B(t,e,n){var i=e[0],s=e[1],o=e[2],r=e[3],a=e[4],h=e[5],l=e[6],u=e[7],d=e[8],c=e[9],p=e[10],m=e[11],y=e[12],f=e[13],v=e[14],g=e[15],b=n[0],w=n[1],x=n[2],E=n[3];return t[0]=b*i+w*a+x*d+E*y,t[1]=b*s+w*h+x*c+E*f,t[2]=b*o+w*l+x*p+E*v,t[3]=b*r+w*u+x*m+E*g,b=n[4],w=n[5],x=n[6],E=n[7],t[4]=b*i+w*a+x*d+E*y,t[5]=b*s+w*h+x*c+E*f,t[6]=b*o+w*l+x*p+E*v,t[7]=b*r+w*u+x*m+E*g,b=n[8],w=n[9],x=n[10],E=n[11],t[8]=b*i+w*a+x*d+E*y,t[9]=b*s+w*h+x*c+E*f,t[10]=b*o+w*l+x*p+E*v,t[11]=b*r+w*u+x*m+E*g,b=n[12],w=n[13],x=n[14],E=n[15],t[12]=b*i+w*a+x*d+E*y,t[13]=b*s+w*h+x*c+E*f,t[14]=b*o+w*l+x*p+E*v,t[15]=b*r+w*u+x*m+E*g,t}function F(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t}function $(){var t=new S(3);return S!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function P(t,e,n){var i=new S(3);return i[0]=t,i[1]=e,i[2]=n,i}function q(t,e,n){var i=e[0],s=e[1],o=e[2],r=n[0],a=n[1],h=n[2];return t[0]=s*h-o*a,t[1]=o*r-i*h,t[2]=i*a-s*r,t}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var H,N=function(t){var e=t[0],n=t[1],i=t[2];return Math.hypot(e,n,i)};H=$();!function(){var t,e=(t=new S(4),S!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t)}();function j(){var t=new S(4);return S!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function D(t,e,n,i){var s,o,r,a,h,l=e[0],u=e[1],d=e[2],c=e[3],p=n[0],m=n[1],y=n[2],f=n[3];return(o=l*p+u*m+d*y+c*f)<0&&(o=-o,p=-p,m=-m,y=-y,f=-f),1-o>1e-6?(s=Math.acos(o),r=Math.sin(s),a=Math.sin((1-i)*s)/r,h=Math.sin(i*s)/r):(a=1-i,h=i),t[0]=a*l+h*p,t[1]=a*u+h*m,t[2]=a*d+h*y,t[3]=a*c+h*f,t}var z,O,U,V,W,G,X,Y=function(t,e){var n=e[0],i=e[1],s=e[2],o=e[3],r=n*n+i*i+s*s+o*o;return r>0&&(r=1/Math.sqrt(r)),t[0]=n*r,t[1]=i*r,t[2]=s*r,t[3]=o*r,t};z=$(),O=P(1,0,0),U=P(0,1,0),V=j(),W=j(),G=new S(9),S!=Float32Array&&(G[1]=0,G[2]=0,G[3]=0,G[5]=0,G[6]=0,G[7]=0),G[0]=1,G[4]=1,G[8]=1,X=G;P(0,0,0),P(1,0,0),P(0,1,0),P(0,0,1);const Z=1e-8;function J(t,e,n){return Math.min(Math.max(t,e),n)}function Q(t,e,n,i){return{x:t,y:e,rx:n,ry:i}}function tt(t,e,n){let i=n.x-e.x,s=n.rx+e.rx-Math.abs(i);if(s<0)return null;let o=n.y-e.y,r=n.ry+e.ry-Math.abs(o);if(r<0)return null;if(s<r){let o=Math.sign(i);t.dx=s*o,t.dy=0,t.nx=o,t.ny=0,t.x=e.x+e.rx*o,t.y=n.y}else{let i=Math.sign(o);t.dx=0,t.dy=r*i,t.nx=0,t.ny=i,t.x=n.x,t.y=e.y+e.ry*i}return t}function et(t,e,n,i){let s=n-e.x,o=e.rx-Math.abs(s);if(o<0)return null;let r=i-e.y,a=e.ry-Math.abs(r);if(a<0)return null;if(o<a){let n=Math.sign(s);t.dx=o*n,t.dy=0,t.nx=n,t.ny=0,t.x=e.x+e.rx*n,t.y=i}else{let i=Math.sign(r);t.dx=0,t.dy=a*i,t.nx=0,t.ny=i,t.x=n,t.y=e.y+e.ry*i}return t}function nt(t,e,n,i,s,o,r=0,a=0){if(Math.abs(s)<Z&&Math.abs(o)<Z&&0===r&&0===a)return et(t,e,n,i);let h=e.rx,l=e.ry,u=r,d=a,c=1/(s||Z),p=1/(o||Z),m=Math.sign(c),y=Math.sign(p),f=(e.x-m*(h+u)-n)*c,v=(e.y-y*(l+d)-i)*p,g=(e.x+m*(h+u)-n)*c,b=(e.y+y*(l+d)-i)*p;if(f>b||v>g)return null;let w=Math.max(f,v),x=Math.min(g,b);if(w>1||x<0)return null;let E=J(w,0,1),_=(1-E)*-s,k=(1-E)*-o,M=n+s*E,A=i+o*E;return f>v?(t.time=E,t.nx=-m,t.ny=0,t.dx=_,t.dy=k,t.x=M,t.y=A):(t.time=E,t.nx=0,t.ny=-y,t.dx=_,t.dy=k,t.x=M,t.y=A),t}function it(t,e,n,i,s){if(Math.abs(i)<Z&&Math.abs(s)<Z){let i=tt({},n,e);return i&&(i.time=0),t.x=e.x,t.y=e.y,t.time=i?0:1,t.hit=i,t}let o=function(t,e,n,i,s){return nt(t,e,n.x,n.y,i,s,n.rx,n.ry)}({},n,e,i,s);if(o){let r,a,h=J(o.time,0,1),l=Math.sqrt(i*i+s*s);l?(r=i/l,a=s/l):(r=0,a=0),o.x=J(o.x+r*e.rx,n.x-n.rx,n.x+n.rx),o.y=J(o.y+a*e.ry,n.y-n.ry,n.y+n.ry),t.time=h,t.x=e.x+i*h,t.y=e.y+s*h,t.hit=o}else t.time=1,t.x=e.x+i,t.y=e.y+s,t.hit=o;return t}var st=Object.freeze({__proto__:null,EPSILON:Z,clamp:J,createAABB:Q,createRect:function(t,e,n,i){let s=Math.abs(n-t)/2,o=Math.abs(i-e)/2;return Q(Math.min(t,n)+s,Math.min(e,i)+o,s,o)},testAABB:function(t,e){return!(Math.abs(t.x-e.x)>t.rx+e.rx)&&!(Math.abs(t.y-e.y)>t.ry+e.ry)},intersectAABB:tt,intersectPoint:et,intersectSegment:nt,sweepInto:function(t,e,n,i,s){let o={};t.time=1,t.x=e.x+i,t.y=e.y+s,t.hit=null;for(let r=0,a=n.length;r<a;++r){let a=it(o,e,n[r],i,s);a.time<=t.time&&(t.time=a.time,t.x=a.x,t.y=a.y,t.hit=a.hit)}return t}});!async function(t){document.addEventListener("click",()=>{"suspended"===t.state&&t.resume()})}(new AudioContext);class ot{constructor(t=-1,e=1,n=-1,i=1,s=0,o=1){this.position=$(),this.rotation=j(),this.scale=P(1,1,1),this.clippingPlane={left:t,right:e,top:n,bottom:i,near:s,far:o}}get x(){return this.position[0]}set x(t){this.position[0]=t}get y(){return this.position[1]}set y(t){this.position[1]=t}get z(){return this.position[2]}set z(t){this.position[2]=t}moveTo(t,e,n=0,i=1){let s=P(t,e,n);var o,r,a;return function(t,e,n,i){var s=e[0],o=e[1],r=e[2];t[0]=s+i*(n[0]-s),t[1]=o+i*(n[1]-o),t[2]=r+i*(n[2]-r)}(this.position,this.position,s,(o=i,r=0,a=1,Math.min(a,Math.max(r,o)))),this}getViewMatrix(t){let e=-Math.round(this.x),n=-Math.round(this.y),i=0===this.z?1:1/this.z,s=P(e,n,0),o=P(this.scale[0]*i,this.scale[1]*i,1);return function(t,e,n,i){var s=e[0],o=e[1],r=e[2],a=e[3],h=s+s,l=o+o,u=r+r,d=s*h,c=s*l,p=s*u,m=o*l,y=o*u,f=r*u,v=a*h,g=a*l,b=a*u,w=i[0],x=i[1],E=i[2];t[0]=(1-(m+f))*w,t[1]=(c+b)*w,t[2]=(p-g)*w,t[3]=0,t[4]=(c-b)*x,t[5]=(1-(d+f))*x,t[6]=(y+v)*x,t[7]=0,t[8]=(p+g)*E,t[9]=(y-v)*E,t[10]=(1-(d+m))*E,t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1}(t,this.rotation,s,o),t}getProjectionMatrix(t){let{left:e,right:n,top:i,bottom:s,near:o,far:r}=this.clippingPlane;return function(t,e,n,i,s,o,r){var a=1/(e-n),h=1/(i-s),l=1/(o-r);t[0]=-2*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*h,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*l,t[11]=0,t[12]=(e+n)*a,t[13]=(s+i)*h,t[14]=(r+o)*l,t[15]=1}(t,e,n,i,s,o,r),t}}class rt{constructor(t,e=new ot){this.display=t,this.camera=e,this.viewTransformDOMMatrix=new DOMMatrix}transformScreenToWorld(t,e){let n=K();this.getViewProjectionMatrix(n),function(t,e){var n=e[0],i=e[1],s=e[2],o=e[3],r=e[4],a=e[5],h=e[6],l=e[7],u=e[8],d=e[9],c=e[10],p=e[11],m=e[12],y=e[13],f=e[14],v=e[15],g=n*a-i*r,b=n*h-s*r,w=n*l-o*r,x=i*h-s*a,E=i*l-o*a,_=s*l-o*h,k=u*y-d*m,M=u*f-c*m,A=u*v-p*m,C=d*f-c*y,T=d*v-p*y,L=c*v-p*f,I=g*L-b*T+w*C+x*A-E*M+_*k;I&&(I=1/I,t[0]=(a*L-h*T+l*C)*I,t[1]=(s*T-i*L-o*C)*I,t[2]=(y*_-f*E+v*x)*I,t[3]=(c*E-d*_-p*x)*I,t[4]=(h*A-r*L-l*M)*I,t[5]=(n*L-s*A+o*M)*I,t[6]=(f*w-m*_-v*b)*I,t[7]=(u*_-c*w+p*b)*I,t[8]=(r*T-a*A+l*k)*I,t[9]=(i*A-n*T-o*k)*I,t[10]=(m*E-y*w+v*g)*I,t[11]=(d*w-u*E-p*g)*I,t[12]=(a*M-r*C-h*k)*I,t[13]=(n*C-i*M+s*k)*I,t[14]=(y*b-m*x-f*g)*I,t[15]=(u*x-d*b+c*g)*I)}(n,n);let i=vec3.fromValues(t,e,0);return vec3.transformMat4(i,i,n),i}transformCanvas(t){let e=this.viewTransformDOMMatrix,n=K();this.getViewProjectionMatrix(n),at(e,n);const{a:i,b:s,c:o,d:r,e:a,f:h}=e;t.transform(i,s,o,r,a,h)}getViewProjectionMatrix(t){const e=this.display.width,n=this.display.height;let i=K();const s=this.camera.getProjectionMatrix(i);B(i,this.camera.getViewMatrix(t),s);return B(t,F(t,[e/2,n/2,0]),i),t}}function at(t,e){return t.a=e[0],t.b=e[1],t.c=e[4],t.d=e[5],t.e=e[12],t.f=e[13],t}class ht{constructor(t={}){this.nodeConstructor=t.nodeConstructor||dt,this.nodes=new Map;const e=t.root||{};this.root=new this.nodeConstructor(this,e,null,[]),this.nodes.set(e,this.root)}add(t,e=null){if(this.nodes.has(e)){let n=this.nodes.get(e);if(this.nodes.has(t)){let e=this.nodes.get(t);return ut(e.parent,e),lt(n,e),e}{let e=new this.nodeConstructor(this,t,null,[]);return this.nodes.set(t,e),lt(n,e),e}}if(null===e)return this.add(t,this.root.owner);throw new Error("No node in scene graph exists for parent.")}remove(t){if(this.nodes.has(t)){let e=this.nodes.get(t);return ut(e.parent,e),this.nodeConstructor.walk(e,0,t=>{this.nodes.delete(t)}),!0}return null===t&&(this.clear(),!0)}replace(t,e){if(this.nodes.has(t)){let n=this.nodes.get(t),i=n.parent,s=[...n.children];if(ut(i,n),n.children.length=0,null===e)i.children.push(...s);else{let t;this.nodes.has(e)?(t=this.nodes.get(e),ut(t.parent,t),t.children.push(...s)):(t=new this.nodeConstructor(this,e,null,s),this.nodes.set(e,t)),lt(i,t)}for(let t of s)t.parent=i;return e}if(null===t)return this.replace(this.root.owner,e);throw new Error("Cannot find target object to replace in scene graph.")}clear(){this.nodes.clear();const t={};this.root=new this.nodeConstructor(this,t,null,[]),this.nodes.set(t,this.root)}get(t){return null===t?this.root:this.nodes.get(t)}forEach(t,e={}){if(e.skipRoot)for(let e of this.root.children)this.nodeConstructor.walk(e,1,t);else this.nodeConstructor.walk(this.root,0,t)}}function lt(t,e){t.children.push(e),e.parent=t}function ut(t,e){let n=t.children.indexOf(e);t.children.splice(n,1),e.parent=null}class dt{static walk(t,e,n){if(e>=100)return;let i=n(t.owner,t);if(!1!==i){for(let i of t.children)this.walk(i,e+1,n);"function"==typeof i&&i(t.owner,t)}}constructor(t,e,n,i){this.sceneGraph=t,this.owner=e,this.parent=n,this.children=i}}class ct{constructor(t={}){const{componentFactoryMap:e={},strictMode:n=!1}=t;let i={},s={};for(let t in e){let n,o,r=e[t];if("function"==typeof r)n=r,o=null;else{if("object"!=typeof r)throw new Error("Unsupported component factory options.");n=r.create||null,o=r.destroy||null}i[t]={owner:r,create:n,destroy:o},s[t]={}}this.factoryMap=i,this.instances=s,this.entities=new Set,this.nextAvailableEntityId=1,this.strictMode=n}create(t){let e=this.nextAvailableEntityId++;if(this.entities.add(e),t)if(Array.isArray(t))for(let n of t)this.add(n,e);else{if("object"!=typeof t)throw new Error("Invalid component options.");for(let n in t)this.add(n,e,t[n])}return e}destroy(t){for(let e in this.instances)this.remove(e,t);this.entities.delete(t)}add(t,e,n){if(!(t in this.factoryMap)){if(this.strictMode)throw new Error(`Missing component factory for '${t}'.`);this.factoryMap[t]={owner:{},create:null,destroy:null},this.instances[t]={}}if(!(t in this.instances))throw new Error(`Missing component instance mapping for '${t}'.`);if(!this.entities.has(e))throw new Error(`Entity '${e}' does not exist.`);if(this.instances[t][e])throw new Error(`Entity already has component '${t}'.`);const{create:i}=this.factoryMap[t];let s=i?i(n,t,e,this):n?{...n}:{};s&&(this.instances[t][e]=s)}remove(t,e){if(!(t in this.factoryMap)){if(this.strictMode)throw new Error(`Missing component factory for '${t}'.`);return}if(!(t in this.instances))throw new Error(`Missing component instance mapping for '${t}'.`);let n=this.instances[t],i=n[e];if(i){n[e]=null;const{destroy:s}=this.factoryMap[t];s&&s(i,t,e,this)}}get(t,e){if(!(t in this.instances))throw new Error(`Missing component instance mapping for '${t}'.`);return this.instances[t][e]||null}has(t,e){return t in this.instances&&Boolean(this.instances[t][e])}clear(t){if(!(t in this.factoryMap)){if(this.strictMode)throw new Error(`Missing component factory for '${t}'.`);return}if(!(t in this.instances))throw new Error(`Missing component instance mapping for '${t}'.`);let e=this.instances[t];const{destroy:n}=this.factoryMap[t];if(n)for(let i in e){let s=e[i];e[i]=null,n(s,t,i,this)}this.instances[t]={}}getEntityIds(){return this.entities}getComponentFactory(t){return t in this.factoryMap?this.factoryMap[t].owner:null}getComponentNames(){return Object.keys(this.factoryMap)}getComponentEntityIds(t){return t in this.instances?Object.keys(this.instances[t]):[]}getComponentInstances(t){return t in this.instances?Object.values(this.instances[t]):[]}}var pt=[{key:"keyboard:ArrowUp",scale:1},{key:"keyboard:KeyW",scale:1}],mt=[{key:"keyboard:ArrowDown",scale:1},{key:"keyboard:KeyS",scale:1}],yt=[{key:"keyboard:ArrowLeft",scale:1},{key:"keyboard:KeyA",scale:1}],ft=[{key:"keyboard:ArrowRight",scale:1},{key:"keyboard:KeyD",scale:1}],vt=[{key:"keyboard:KeyE",scale:1},{key:"keyboard:Space",scale:1}],gt=[{key:"keyboard:KeyF",event:"up"},{key:"keyboard:KeyI",event:"up"}],bt=[{key:"keyboard:ShiftLeft",scale:1},{key:"keyboard:ShiftRight",scale:1}],wt=[{key:"keyboard:ControlLeft",scale:1},{key:"keyboard:ControlRight",scale:1}],xt={moveUp:pt,moveDown:mt,moveLeft:yt,moveRight:ft,mainAction:vt,inventory:gt,sprint:bt,sneak:wt},Et=Object.freeze({__proto__:null,moveUp:pt,moveDown:mt,moveLeft:yt,moveRight:ft,mainAction:vt,inventory:gt,sprint:bt,sneak:wt,default:xt});document.addEventListener("DOMContentLoaded",(async function(){const t=document.querySelector("display-port"),e=new A(_t);document.body.appendChild(e);const n=t.canvas.getContext("2d"),i=new rt(t),s=new ht({nodeConstructor:kt}),o=new ct({componentFactoryMap:Mt}),r=o.create({Transform:{sceneGraph:s},Renderable:{renderType:"player"},Motion:{},PlayerControlled:!0}),a=st.createAABB(0,0,8,8);s.add(a,r);const h=[o.create({Transform:{sceneGraph:s,x:0,y:0},Renderable:{renderType:"wall",width:4,height:64}}),o.create({Transform:{sceneGraph:s,x:0,y:0},Renderable:{renderType:"wall",width:64,height:4}}),o.create({Transform:{sceneGraph:s,x:64,y:0},Renderable:{renderType:"wall",width:4,height:16}})];h.forEach(t=>s.add(t));h.map(t=>t.mask);t.addEventListener("frame",r=>{{const t=r.detail.deltaTime/1e3;e.poll();for(let t of o.getComponentEntityIds("Motion")){let n=o.get("Motion",t);if(o.has("PlayerControlled",t)){let t=e.getInputValue("moveRight")-e.getInputValue("moveLeft"),i=e.getInputValue("moveDown")-e.getInputValue("moveUp");if(t||i){let e=Math.atan2(i,t);n.motionX+=Math.cos(e)*n.speed,n.motionY+=Math.sin(e)*n.speed}}let i=1-n.friction;if(n.motionX*=i,n.motionY*=i,o.has("Transform",t)){let e=o.get("Transform",t);e.x+=n.motionX,e.y+=n.motionY}}let n=o.getComponentEntityIds("PlayerControlled")[0],s=o.get("Transform",n);i.camera.moveTo(s.x,s.y,0,4*t)}n.clearRect(0,0,t.width,t.height),function(t,e,n,i,s){let o=e.get(null),{localTransformation:r,worldTransformation:a}=i(o);n.getViewProjectionMatrix(r),function(t,e){t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]}(a,r);let h=new DOMMatrix;e.forEach((e,n)=>{let{parent:o}=n,r=i(o),a=i(n),{localTransformation:l,worldTransformation:u}=a;const{worldTransformation:d}=r;F(l,[a.x,a.y,a.z]),B(u,d,l),at(h,u),t.setTransform(h),s(t,e,n)},{skipRoot:!0}),t.setTransform()}(n,s,i,t=>t,(t,e,n)=>{if(o.has("Renderable",e)){const n=o.get("Renderable",e);switch(n.renderType){case"player":t.fillStyle="blue",t.fillRect(-8,-8,16,16);break;case"wall":t.fillStyle="white",t.fillRect(0,0,n.width,n.height)}}else t.fillStyle="red",t.fillRect(-1,-1,2,2)})})}));const _t=Et;class kt extends dt{constructor(t,e,n,i){super(t,e,n,i),this.x=0,this.y=0,this.z=0,this.pitch=0,this.yaw=0,this.roll=0,this.scaleX=1,this.scaleY=1,this.scaleZ=1,this.worldTransformation=K(),this.localTransformation=K()}}const Mt={Transform:{create(t,e,n,i){const{sceneGraph:s,parent:o,x:r=0,y:a=0,z:h=0}=t;if(!s)throw new Error("Component instantiation is missing required prop 'sceneGraph'.");let l=s.add(n,o);return l.x=r,l.y=a,l.z=h,l},destroy(t,e,n,i){t.sceneGraph.remove(n)}},Renderable:{create(t){const{renderType:e,...n}=t;if(!e)throw new Error("Component instantiation is missing required prop 'renderType'.");return{renderType:e,...n}}},Motion:{create:t=>({motionX:0,motionY:0,speed:.6,friction:.25,...t})},PlayerControlled:{}}}();
