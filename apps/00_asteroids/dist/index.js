!function(){"use strict";const t="noscale";class e extends HTMLElement{static get[Symbol.for("cuttleTemplate")](){let t=document.createElement("template");return t.innerHTML='<div class="container">\r\n    <label class="hidden" id="title">display-port</label>\r\n    <label class="hidden" id="fps">00</label>\r\n    <label class="hidden" id="dimension">0x0</label>\r\n    <canvas></canvas>\r\n    <slot></slot>\r\n</div>',Object.defineProperty(this,Symbol.for("cuttleTemplate"),{value:t}),t}static get[Symbol.for("cuttleStyle")](){let t=document.createElement("style");return t.innerHTML=":host{display:inline-block;color:#555}.container{display:flex;position:relative;width:100%;height:100%}canvas{background:#000;margin:auto;-ms-interpolation-mode:nearest-neighbor;image-rendering:-moz-crisp-edges;image-rendering:pixelated}label{font-family:monospace;color:currentColor;position:absolute}#title{left:.5rem;top:.5rem}#fps{right:.5rem;top:.5rem}#dimension{left:.5rem;bottom:.5rem}.hidden{display:none}:host([debug]) .container{outline:6px dashed rgba(0,0,0,.1);outline-offset:-4px;background-color:rgba(0,0,0,.1)}:host([mode=noscale]) canvas{margin:0;top:0;left:0}:host([mode=center]),:host([mode=fit]),:host([mode=stretch]){width:100%;height:100%}:host([full]){width:100vw!important;height:100vh!important}:host([disabled]){display:none}slot{display:flex;flex-direction:column;align-items:center;justify-content:center;position:absolute;width:100%;height:100%;top:0;left:0;pointer-events:none}::slotted(*){pointer-events:auto}",Object.defineProperty(this,Symbol.for("cuttleStyle"),{value:t}),t}static get observedAttributes(){return["onframe","width","height","disabled","debug","id","class"]}static get properties(){return{width:Number,height:Number,disabled:Boolean,debug:Boolean,mode:{type:String,value:"fit",observed:!1}}}get mode(){return this.getAttribute("mode")}set mode(t){this.setAttribute("mode",t)}get debug(){return this._debug}set debug(t){this.toggleAttribute("debug",t)}get disabled(){return this._disabled}set disabled(t){this.toggleAttribute("disabled",t)}get height(){return this._height}set height(t){this.setAttribute("height",String(t))}get width(){return this._width}set width(t){this.setAttribute("width",String(t))}static get customEvents(){return["frame"]}get onframe(){return this._onframe}set onframe(t){this._onframe&&this.removeEventListener("frame",this._onframe),this._onframe=t,this._onframe&&this.addEventListener("frame",t)}constructor(){super(),this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(this.constructor[Symbol.for("cuttleTemplate")].content.cloneNode(!0)),this.shadowRoot.appendChild(this.constructor[Symbol.for("cuttleStyle")].cloneNode(!0)),this._canvasElement=this.shadowRoot.querySelector("canvas"),this._titleElement=this.shadowRoot.querySelector("#title"),this._fpsElement=this.shadowRoot.querySelector("#fps"),this._dimensionElement=this.shadowRoot.querySelector("#dimension"),this._animationRequestHandle=0,this._prevAnimationFrameTime=0,this._width=300,this._height=150,this.update=this.update.bind(this)}get canvas(){return this._canvasElement}connectedCallback(){if(Object.prototype.hasOwnProperty.call(this,"onframe")){let t=this.onframe;delete this.onframe,this.onframe=t}if(Object.prototype.hasOwnProperty.call(this,"width")){let t=this.width;delete this.width,this.width=t}if(Object.prototype.hasOwnProperty.call(this,"height")){let t=this.height;delete this.height,this.height=t}if(Object.prototype.hasOwnProperty.call(this,"disabled")){let t=this.disabled;delete this.disabled,this.disabled=t}if(Object.prototype.hasOwnProperty.call(this,"debug")){let t=this.debug;delete this.debug,this.debug=t}if(Object.prototype.hasOwnProperty.call(this,"mode")){let t=this.mode;delete this.mode,this.mode=t}this.hasAttribute("mode")||this.setAttribute("mode","fit"),this.hasAttribute("tabindex")||this.setAttribute("tabindex",0),this.updateCanvasSize(),this.resume()}disconnectedCallback(){this.pause()}attributeChangedCallback(t,e,s){switch(t){case"width":this._width=Number(s);break;case"height":this._height=Number(s);break;case"disabled":this._disabled=null!==s;break;case"debug":this._debug=null!==s;break;case"onframe":this.onframe=new Function("event","with(document){with(this){"+s+"}}").bind(this)}((t,e,s)=>{switch(t){case"disabled":s?(this.update(0),this.pause()):this.resume();break;case"id":case"class":this._titleElement.innerHTML=`display-port${this.className?"."+this.className:""}${this.hasAttribute("id")?"#"+this.getAttribute("id"):""}`;break;case"debug":this._titleElement.classList.toggle("hidden",s),this._fpsElement.classList.toggle("hidden",s),this._dimensionElement.classList.toggle("hidden",s)}})(t,0,s)}pause(){cancelAnimationFrame(this._animationRequestHandle)}resume(){this._animationRequestHandle=requestAnimationFrame(this.update)}update(e){this._animationRequestHandle=requestAnimationFrame(this.update),this.updateCanvasSize();const s=e-this._prevAnimationFrameTime;if(this._prevAnimationFrameTime=e,this.debug){const e=s<=0?"--":String(Math.round(1e3/s)).padStart(2,"0");if(this._fpsElement.innerText!==e&&(this._fpsElement.innerText=e),this.mode===t){let t=`${this._width}x${this._height}`;this._dimensionElement.innerText!==t&&(this._dimensionElement.innerText=t)}else{let t=`${this._width}x${this._height}|${this.shadowRoot.host.clientWidth}x${this.shadowRoot.host.clientHeight}`;this._dimensionElement.innerText!==t&&(this._dimensionElement.innerText=t)}}this.dispatchEvent(new CustomEvent("frame",{detail:{now:e,prevTime:this._prevAnimationFrameTime,deltaTime:s,canvas:this._canvasElement},bubbles:!1,composed:!0}))}updateCanvasSize(){let e=this.shadowRoot.host.getBoundingClientRect();const s=e.width,i=e.height;let a=this._canvasElement,h=this._width,r=this._height;const o=this.mode;if("stretch"===o)h=s,r=i;else if(o!==t){if(s<h||i<r||"fit"===o){let t=s/h,e=i/r;t<e?(h=s,r*=t):(h*=e,r=i)}}h=Math.floor(h),r=Math.floor(r),a.clientWidth===h&&a.clientHeight===r||(a.width=this._width,a.height=this._height,a.style=`width: ${h}px; height: ${r}px`,this.dispatchEvent(new CustomEvent("resize",{detail:{width:h,height:r},bubbles:!1,composed:!0})))}}window.customElements.define("display-port",e);class s{next(){return Math.random()}}let i;class a{constructor(t=new s){this.generator=t}static next(){return i.next()}next(){return this.generator.next()}static choose(t){return i.choose(t)}choose(t){return t[Math.floor(this.generator.next()*t.length)]}static range(t,e){return i.range(t,e)}range(t,e){return(e-t)*this.generator.next()+t}static sign(){return i.sign()}sign(){return this.generator.next()<.5?-1:1}}i=new a;const h=[2,4],r=[.3,1];function o(t,e,s="white"){for(let i=0;i<e.length;++i){let a=e.x[i],h=e.y[i],r=e.size[i],o=r/2;t.fillStyle=s,t.fillRect(a-o,h-o,r,r)}}function n(t,e=1,s=0){const{length:i,width:h,height:r}=t;for(let o=0;o<i;++o){let i=e*t.speed[o],n=s*t.speed[o];t.x[o]+=i,t.y[o]+=n,i<0?t.x[o]<0&&(t.x[o]=h,t.y[o]=a.range(0,r)):i>0&&t.x[o]>h&&(t.x[o]=0,t.y[o]=a.range(0,r)),n<0?t.y[o]<0&&(t.x[o]=a.range(0,h),t.y[o]=r):n>0&&t.y[o]>r&&(t.x[o]=a.range(0,h),t.y[o]=0)}}const l=document.querySelector("display-port").canvas,d=l.getContext("2d");let c,p=new AudioContext,g=0,u={load:async function(){c={start:H("space/start.wav"),dead:H("space/dead.wav"),pop:H("space/boop.wav"),music:H("space/music.wav",!0),shoot:H("space/click.wav"),boom:H("space/boom.wav")}},start:function(){this.level=0,this.score=0,this.highScore=Number(localStorage.getItem("highscore")),this.flashScoreDelta=0,this.flashHighScoreDelta=0,this.flashShootDelta=0,this.player={scene:this,x:l.width/2,y:l.height/2,rotation:0,dx:0,dy:0,dr:0,left:0,right:0,up:0,down:0,cooldown:0,powerMode:0,shoot(){if(!(this.scene.bullets.length>100||this.cooldown>0)){if(this.powerMode>0){for(let t=-1;t<=1;++t){let e=this.rotation+t*Math.PI/4,s=P(this.scene,this.x-5*Math.cos(e),this.y-5*Math.sin(e),4*-Math.cos(e)+this.dx,4*-Math.sin(e)+this.dy);this.scene.bullets.push(s)}--this.powerMode}else{let t=P(this.scene,this.x-5*Math.cos(this.rotation),this.y-5*Math.sin(this.rotation),4*-Math.cos(this.rotation)+this.dx,4*-Math.sin(this.rotation)+this.dy);this.scene.bullets.push(t)}this.cooldown=10,c.shoot.play()}}},this.asteroids=[],this.asteroidSpawner={scene:this,spawnTicks:m[1],reset(){this.spawnTicks=m[1]},spawn(){if(this.scene.asteroids.length>100)return;let t=a.choose(f),e=E(this.scene,a.range(t[0],t[0]+t[2]),a.range(t[1],t[1]+t[3]),a.range(-1,1),a.range(-1,1),8);this.scene.asteroids.push(e)},update(t){this.scene.gamePause||(this.spawnTicks-=t,this.spawnTicks<=0&&(this.spawn(),this.spawnTicks=a.range(...m)))}},this.bullets=[],this.particles=[],this.powerUps=[],this.powerUpSpawner={scene:this,reset(){},spawn(){let t=a.choose(f),e=(s=this.scene,i=a.range(t[0],t[0]+t[2]),h=a.range(t[1],t[1]+t[3]),r=a.range(-1,1),o=a.range(-1,1),{scene:s,x:i,y:h,dx:r,dy:o,rotation:Math.atan2(o,r),destroy(){this.scene.powerUps.splice(this.scene.powerUps.indexOf(this),1)}});var s,i,h,r,o;this.scene.powerUps.push(e)},update(t){}},this.starfield=function(t,e){let s={x:[],y:[],size:[],speed:[],length:0,width:t,height:e};for(let i=0;i<30;++i)s.x.push(a.range(0,t)),s.y.push(a.range(0,e)),s.size.push(a.range(...h)),s.speed.push(a.range(...r)),s.length++;return s}(l.width,l.height),this.gamePause=!0,this.showPlayer=!0,this.gameStart=!0,this.gameWait=!0,this.hint="[ wasd_ ]",document.addEventListener("keydown",(t=>U.call(this,t.key))),document.addEventListener("keyup",(t=>C.call(this,t.key)))},update:function(t){if(this.gamePause){for(let e of this.particles)e.age+=t,e.age>b?e.destroy():(e.x+=e.dx,e.y+=e.dy,T(e,8,8));return}const e=this.player.right-this.player.left,s=this.player.down-this.player.up,i=this.player.fire;this.player.dx+=s*Math.cos(this.player.rotation)*.02,this.player.dy+=s*Math.sin(this.player.rotation)*.02,this.player.dx*=.999,this.player.dy*=.999,this.player.dr+=.008*e,this.player.dr*=.9,this.player.x+=this.player.dx,this.player.y+=this.player.dy,this.player.rotation+=this.player.dr,--this.player.cooldown,T(this.player,10,10),i&&(this.player.shoot(),this.flashShootDelta=1);s&&function(t,e,s,i,h,r){if(a.next()>.3){let o=R(t,e+a.range(..._),s+a.range(..._),i,h,r);o.age=a.range(60,240),t.particles.push(o)}}(this,this.player.x,this.player.y,-s*Math.cos(this.player.rotation)*1.5,-s*Math.sin(this.player.rotation)*1.5,a.choose.bind(null,S));for(let e of this.bullets)e.age+=t,e.age>2e3?e.destroy():(e.x+=e.dx,e.y+=e.dy,T(e,4,4));for(let t of this.bullets)for(let e of this.asteroids)if(M(t,e,e.size)){this.flashScore=1,this.score++,this.score>this.highScore&&(this.flashHighScore=this.score-this.highScore,this.highScore=this.score,localStorage.setItem("highscore",this.highScore)),O(this,e.x,e.y,10,a.choose.bind(null,x)),c.pop.play(),t.destroy(),e.breakUp(.1*t.dx,.1*t.dy);break}for(let e of this.particles)e.age+=t,e.age>b?e.destroy():(e.x+=e.dx,e.y+=e.dy,T(e,8,8));for(let t of this.asteroids)t.x+=t.dx,t.y+=t.dy,T(t,2*t.size,2*t.size);for(let t of this.asteroids)if(M(t,this.player,t.size+5)){O(this,t.x,t.y,10,a.choose.bind(null,x)),t.destroy(),z(this);break}for(let t of this.powerUps)t.x+=t.dx,t.y+=t.dy,T(t,8,8);for(let t of this.powerUps)if(M(t,this.player,9)){O(this,t.x,t.y,10,a.choose.bind(null,v)),t.destroy(),this.player.powerMode+=30;break}n(this.starfield),this.asteroidSpawner.update(t),this.powerUpSpawner.update(t),!this.gamePause&&this.asteroids.length<=0&&(this.gamePause=!0,this.showPlayer=!0,c.start.play(),setTimeout((()=>this.gameWait=!0),1e3))},render:function(t){t.fillStyle="black",t.fillRect(0,0,l.width,l.height),o(t,this.starfield),t.fillStyle="rgba(255, 255, 255, 0.2)",t.textAlign="center",t.textBaseline="middle",t.font="16px sans-serif",t.fillText(this.hint,l.width/2,l.height/2-32),this.flashScore>0?(t.fillStyle=`rgba(255, 255, 255, ${this.flashScore+.2})`,this.flashScore-=.1):t.fillStyle="rgba(255, 255, 255, 0.2)";t.font="48px sans-serif",t.fillText("= "+String(this.score).padStart(2,"0")+" =",l.width/2,l.height/2),this.flashHighScore>0?(t.fillStyle=`rgba(255, 255, 255, ${this.flashHighScore+.2})`,this.flashHighScore-=.1):t.fillStyle="rgba(255, 255, 255, 0.2)";t.font="16px sans-serif",t.fillText(String(this.highScore).padStart(2,"0"),l.width/2,l.height/2+32),t.fillStyle="rgba(255, 255, 255, 0.2)",t.font="24px sans-serif",t.textAlign="right",t.fillText(Math.ceil(this.asteroidSpawner.spawnTicks/1e3),l.width,l.height-12);for(let e of this.asteroids)t.translate(e.x,e.y),t.rotate(e.rotation),t.fillStyle="slategray",t.fillRect(-e.size,-e.size,2*e.size,2*e.size),t.setTransform(1,0,0,1,0,0),A(t,e.x,e.y,e.size);for(let e of this.powerUps)t.translate(e.x,e.y),t.rotate(e.rotation),t.beginPath(),t.strokeStyle="violet",t.arc(0,0,4,0,2*Math.PI),t.moveTo(-2,0),t.lineTo(2,0),t.moveTo(0,-2),t.lineTo(0,2),t.stroke(),t.setTransform(1,0,0,1,0,0),A(t,e.x,e.y,4);for(let e of this.bullets)t.translate(e.x,e.y),t.rotate(e.rotation),t.fillStyle="gold",t.fillRect(-2,-2,8,4),t.setTransform(1,0,0,1,0,0),A(t,e.x,e.y,2);for(let e of this.particles){t.translate(e.x,e.y),t.rotate(e.rotation),t.fillStyle=e.color;let s=4*(1-e.age/b);t.fillRect(-s,-s,2*s,2*s),t.setTransform(1,0,0,1,0,0)}if(this.showPlayer){t.translate(this.player.x,this.player.y),t.rotate(this.player.rotation),t.fillStyle="white";let e=5;t.fillRect(-e,-e,2*e,2*e);let s=-1,i=0,a=0;this.flashShootDelta>0?(t.fillStyle=`rgb(${200*this.flashShootDelta+55*Math.sin(performance.now()/20)}, 0, 0)`,this.flashShootDelta-=.1,a=2*this.flashShootDelta,s=this.flashShootDelta):t.fillStyle="black",t.fillRect(-e-a/2+s,-e/4-a/2+i,e+a,e/2+a),t.setTransform(1,0,0,1,0,0)}A(t,this.player.x,this.player.y,5)}};function y(t){requestAnimationFrame(y);const e=t-g;g=t,u.update(e),u.render(d)}const f=[[-8,-8,16+l.width,8],[-8,0,8,l.height],[-8,l.height,16+l.width,8],[l.width,0,8,l.height]],m=[3e3,1e4],b=600,w=["red","red","red","yellow","orange"],x=["blue","blue","blue","dodgerblue","gray","darkgray","yellow"],S=["gray","darkgray","lightgray"],_=[-2,2],v=["violet","white","violet"];let k=!1;function T(t,e,s){t.x<-e&&(t.x=l.width),t.y<-s&&(t.y=l.height),t.x>l.width+e/2&&(t.x=-e),t.y>l.height+s/2&&(t.y=-s)}function M(t,e,s){const i=t.x-e.x,a=t.y-e.y;return i*i+a*a<=s*s}function A(t,e,s,i){k&&(t.translate(e,s),t.beginPath(),t.arc(0,0,i,0,2*Math.PI),t.strokeStyle="lime",t.stroke(),t.setTransform(1,0,0,1,0,0))}function E(t,e,s,i,h,r){return{scene:t,x:e,y:s,dx:i,dy:h,size:r,rotation:Math.atan2(h,i),breakUp(t=0,e=0){if(this.destroy(),this.size>4){let s=[];s.push(E(this.scene,this.x+a.range(-8,8),this.y+a.range(-8,8),a.range(-1,1)+t,a.range(-1,1)+e,4)),s.push(E(this.scene,this.x+a.range(-8,8),this.y+a.range(-8,8),a.range(-1,1)+t,a.range(-1,1)+e,4)),s.push(E(this.scene,this.x+a.range(-8,8),this.y+a.range(-8,8),a.range(-1,1)+t,a.range(-1,1)+e,4)),s.push(E(this.scene,this.x+a.range(-8,8),this.y+a.range(-8,8),a.range(-1,1)+t,a.range(-1,1)+e,4)),this.scene.asteroids.push(...s)}},destroy(){this.scene.asteroids.splice(this.scene.asteroids.indexOf(this),1)}}}function P(t,e,s,i,a){return{scene:t,x:e,y:s,dx:i,dy:a,rotation:Math.atan2(a,i),age:0,destroy(){this.scene.bullets.splice(this.scene.bullets.indexOf(this),1)}}}function R(t,e,s,i,a,h){return"function"==typeof h&&(h=h.call(null)),{scene:t,x:e,y:s,dx:i,dy:a,rotation:Math.atan2(a,i),age:0,color:h,destroy(){this.scene.particles.splice(this.scene.particles.indexOf(this),1)}}}function z(t){t.gamePause=!0,t.showPlayer=!1,O(t,t.player.x,t.player.y,100,a.choose.bind(null,w)),c.dead.play(),c.boom.play(),setTimeout((()=>t.gameStart=t.gameWait=!0),1e3)}function O(t,e,s,i=10,h){for(let r=0;r<i;++r)t.particles.push(R(t,e,s,2*a.range(-1,1),2*a.range(-1,1),h))}function U(t){switch(this.gameWait&&(this.gameStart&&(c.music.play(),this.score=0,this.flashScore=!0,this.level=0,this.gameStart=!1,this.player.powerMode=0,this.powerUps.length=0,this.asteroidSpawner.reset(),this.powerUpSpawner.reset()),this.gameWait=!1,function(t){t.bullets.length=0,t.asteroids.length=0,t.particles.length=0,t.player.x=l.width/2,t.player.y=l.height/2,t.player.dx=0,t.player.dy=0,t.level++,t.gamePause=!1,t.showPlayer=!0;for(let e=0;e<1*t.level;++e)t.asteroidSpawner.spawn();a.next()>.7&&t.powerUpSpawner.spawn(),c.music.playing||c.music.play()}(this)),t){case"w":case"ArrowUp":this.player.up=1;break;case"s":case"ArrowDown":this.player.down=1;break;case"a":case"ArrowLeft":this.player.left=1;break;case"d":case"ArrowRight":this.player.right=1;break;case" ":this.player.fire=1;break;case"\\":break;default:console.log(t)}}function C(t){switch(t){case"w":case"ArrowUp":this.player.up=0;break;case"s":case"ArrowDown":this.player.down=0;break;case"a":case"ArrowLeft":this.player.left=0;break;case"d":case"ArrowRight":this.player.right=0;break;case" ":this.player.fire=0;break;case"\\":k=!k;break;default:console.log(t)}}function H(t,e=!1){const s={_playing:!1,_data:null,_source:null,play(){if(!this._data)return;this._source&&this.destroy();let t=p.createBufferSource();t.loop=e,t.buffer=this._data,t.addEventListener("ended",(()=>{this._playing=!1})),t.connect(p.destination),t.start(0),this._source=t,this._playing=!0},pause(){this._source.stop(),this._playing=!1},destroy(){this._source&&this._source.disconnect(),this._source=null},isPaused(){return!this._playing}};return fetch(t).then((t=>t.arrayBuffer())).then((t=>p.decodeAudioData(t))).then((t=>s._data=t)),s}u.load().then((()=>{u.start(),y(g=performance.now())}))}();
