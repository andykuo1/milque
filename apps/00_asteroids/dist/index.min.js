!function(){"use strict";const t="noscale",e="stretch",s=Symbol("template"),i=Symbol("style");class a extends HTMLElement{static get[s](){let t=document.createElement("template");return t.innerHTML='\n<div class="container">\n    <label class="hidden" id="title">display-port</label>\n    <label class="hidden" id="fps">00</label>\n    <label class="hidden" id="dimension">0x0</label>\n    <canvas></canvas>\n    <slot></slot>\n</div>',Object.defineProperty(this,s,{value:t}),t}static get[i](){let t=document.createElement("style");return t.innerHTML='\n:host {\n    display: inline-block;\n    color: #555555;\n}\n.container {\n    display: flex;\n    position: relative;\n    width: 100%;\n    height: 100%;\n}\ncanvas {\n    background: #000000;\n    margin: auto;\n    image-rendering: pixelated;\n}\nlabel {\n    font-family: monospace;\n    color: currentColor;\n    position: absolute;\n}\n#title {\n    left: 0.5rem;\n    top: 0.5rem;\n}\n#fps {\n    right: 0.5rem;\n    top: 0.5rem;\n}\n#dimension {\n    left: 0.5rem;\n    bottom: 0.5rem;\n}\n.hidden {\n    display: none;\n}\n:host([debug]) .container {\n    outline: 6px dashed rgba(0, 0, 0, 0.1);\n    outline-offset: -4px;\n    background-color: rgba(0, 0, 0, 0.1);\n}\n:host([mode="noscale"]) canvas {\n    margin: 0;\n    top: 0;\n    left: 0;\n}\n:host([mode="fit"]), :host([mode="center"]), :host([mode="stretch"]) {\n    width: 100%;\n    height: 100%;\n}\n:host([full]) {\n    width: 100vw!important;\n    height: 100vh!important;\n}\n:host([disabled]) {\n    display: none;\n}\nslot {\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    justify-content: center;\n\n    position: absolute;\n    width: 100%;\n    height: 100%;\n    top: 0;\n    left: 0;\n\n    pointer-events: none;\n}\n::slotted(*) {\n    pointer-events: auto;\n}',Object.defineProperty(this,i,{value:t}),t}static get observedAttributes(){return["width","height","disabled","onframe","debug","id","class"]}constructor(){super(),this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(this.constructor[s].content.cloneNode(!0)),this.shadowRoot.appendChild(this.constructor[i].cloneNode(!0)),this._canvasElement=this.shadowRoot.querySelector("canvas"),this._titleElement=this.shadowRoot.querySelector("#title"),this._fpsElement=this.shadowRoot.querySelector("#fps"),this._dimensionElement=this.shadowRoot.querySelector("#dimension"),this._animationRequestHandle=0,this._prevAnimationFrameTime=0,this._width=300,this._height=150,this._onframe=null,this.update=this.update.bind(this)}get canvas(){return this._canvasElement}connectedCallback(){this.hasAttribute("mode")||(this.mode="noscale"),this.hasAttribute("tabindex")||this.setAttribute("tabindex",0),this.updateCanvasSize(),this.resume()}disconnectedCallback(){this.pause()}attributeChangedCallback(t,e,s){switch(t){case"width":this._width=s;break;case"height":this._height=s;break;case"disabled":s?(this.update(0),this.pause()):this.resume();break;case"onframe":this.onframe=new Function("event",`with(document){with(this){${s}}}`).bind(this);break;case"id":case"class":this._titleElement.innerHTML=`display-port${this.className?"."+this.className:""}${this.hasAttribute("id")?"#"+this.getAttribute("id"):""}`;break;case"debug":this._titleElement.classList.toggle("hidden",s),this._fpsElement.classList.toggle("hidden",s),this._dimensionElement.classList.toggle("hidden",s)}}update(e){this._animationRequestHandle=requestAnimationFrame(this.update),this.updateCanvasSize();const s=e-this._prevAnimationFrameTime;if(this._prevAnimationFrameTime=e,this.debug){const e=s<=0?"--":String(Math.round(1e3/s)).padStart(2,"0");if(this._fpsElement.innerText!==e&&(this._fpsElement.innerText=e),this.mode===t){let t=`${this._width}x${this._height}`;this._dimensionElement.innerText!==t&&(this._dimensionElement.innerText=t)}else{let t=`${this._width}x${this._height}|${this.shadowRoot.host.clientWidth}x${this.shadowRoot.host.clientHeight}`;this._dimensionElement.innerText!==t&&(this._dimensionElement.innerText=t)}}this.dispatchEvent(new CustomEvent("frame",{detail:{now:e,prevTime:this._prevAnimationFrameTime,deltaTime:s,canvas:this._canvasElement,get context(){let t=this.canvas.getContext("2d");return t.imageSmoothingEnabled=!1,t}},bubbles:!1,composed:!0}))}pause(){cancelAnimationFrame(this._animationRequestHandle)}resume(){this._animationRequestHandle=requestAnimationFrame(this.update)}updateCanvasSize(){let s=this.shadowRoot.host.getBoundingClientRect();const i=s.width,a=s.height;let n=this._canvasElement,h=this._width,r=this._height;const o=this.mode;if(o===e)h=i,r=a;else if(o!==t){if(i<h||a<r||"fit"===o){let t=i/h,e=a/r;t<e?(h=i,r*=t):(h*=e,r=a)}}h=Math.floor(h),r=Math.floor(r),n.clientWidth===h&&n.clientHeight===r||(n.width=this._width,n.height=this._height,n.style=`width: ${h}px; height: ${r}px`,this.dispatchEvent(new CustomEvent("resize",{detail:{width:h,height:r},bubbles:!1,composed:!0})))}get onframe(){return this._onframe}set onframe(t){this._onframe&&this.removeEventListener("frame",this._onframe),this._onframe=t,this._onframe&&this.addEventListener("frame",t)}get width(){return this._width}set width(t){this.setAttribute("width",t)}get height(){return this._height}set height(t){this.setAttribute("height",t)}get mode(){return this.getAttribute("mode")}set mode(t){this.setAttribute("mode",t)}get disabled(){return this.hasAttribute("disabled")}set disabled(t){t?this.setAttribute("disabled",""):this.removeAttribute("disabled")}get debug(){return this.hasAttribute("debug")}set debug(t){t?this.setAttribute("debug",""):this.removeAttribute("debug")}}window.customElements.define("display-port",a);class n{next(){return Math.random()}}let h;class r{constructor(t=new n){this.generator=t}static next(){return h.next()}next(){return this.generator.next()}static choose(t){return h.choose(t)}choose(t){return t[Math.floor(this.generator.next()*t.length)]}static range(t,e){return h.range(t,e)}range(t,e){return(e-t)*this.generator.next()+t}static sign(){return h.sign()}sign(){return this.generator.next()<.5?-1:1}}h=new r;const o=[2,4],l=[.3,1];function d(t,e,s="white"){for(let i=0;i<e.length;++i){let a=e.x[i],n=e.y[i],h=e.size[i],r=h/2;t.fillStyle=s,t.fillRect(a-r,n-r,h,h)}}function c(t,e=1,s=0){const{length:i,width:a,height:n}=t;for(let h=0;h<i;++h){let i=e*t.speed[h],o=s*t.speed[h];t.x[h]+=i,t.y[h]+=o,i<0?t.x[h]<0&&(t.x[h]=a,t.y[h]=r.range(0,n)):i>0&&t.x[h]>a&&(t.x[h]=0,t.y[h]=r.range(0,n)),o<0?t.y[h]<0&&(t.x[h]=r.range(0,a),t.y[h]=n):o>0&&t.y[h]>n&&(t.x[h]=r.range(0,a),t.y[h]=0)}}const p=document.querySelector("display-port").canvas,g=p.getContext("2d");let u,y=new AudioContext,f=0,m={load:async function(){u={start:q("space/start.wav"),dead:q("space/dead.wav"),pop:q("space/boop.wav"),music:q("space/music.wav",!0),shoot:q("space/click.wav"),boom:q("space/boom.wav")}},start:function(){this.level=0,this.score=0,this.highScore=Number(localStorage.getItem("highscore")),this.flashScoreDelta=0,this.flashHighScoreDelta=0,this.flashShootDelta=0,this.player={scene:this,x:p.width/2,y:p.height/2,rotation:0,dx:0,dy:0,dr:0,left:0,right:0,up:0,down:0,cooldown:0,powerMode:0,shoot(){if(!(this.scene.bullets.length>100||this.cooldown>0)){if(this.powerMode>0){for(let t=-1;t<=1;++t){let e=this.rotation+t*Math.PI/4,s=z(this.scene,this.x-5*Math.cos(e),this.y-5*Math.sin(e),4*-Math.cos(e)+this.dx,4*-Math.sin(e)+this.dy);this.scene.bullets.push(s)}--this.powerMode}else{let t=z(this.scene,this.x-5*Math.cos(this.rotation),this.y-5*Math.sin(this.rotation),4*-Math.cos(this.rotation)+this.dx,4*-Math.sin(this.rotation)+this.dy);this.scene.bullets.push(t)}this.cooldown=10,u.shoot.play()}}},this.asteroids=[],this.asteroidSpawner={scene:this,spawnTicks:x[1],reset(){this.spawnTicks=x[1]},spawn(){if(this.scene.asteroids.length>100)return;let t=r.choose(b),e=function t(e,s,i,a,n,h){return{scene:e,x:s,y:i,dx:a,dy:n,size:h,rotation:Math.atan2(n,a),breakUp(e=0,s=0){if(this.destroy(),this.size>4){let i=[];i.push(t(this.scene,this.x+r.range(-8,8),this.y+r.range(-8,8),r.range(-1,1)+e,r.range(-1,1)+s,4)),i.push(t(this.scene,this.x+r.range(-8,8),this.y+r.range(-8,8),r.range(-1,1)+e,r.range(-1,1)+s,4)),i.push(t(this.scene,this.x+r.range(-8,8),this.y+r.range(-8,8),r.range(-1,1)+e,r.range(-1,1)+s,4)),i.push(t(this.scene,this.x+r.range(-8,8),this.y+r.range(-8,8),r.range(-1,1)+e,r.range(-1,1)+s,4)),this.scene.asteroids.push(...i)}},destroy(){this.scene.asteroids.splice(this.scene.asteroids.indexOf(this),1)}}}(this.scene,r.range(t[0],t[0]+t[2]),r.range(t[1],t[1]+t[3]),r.range(-1,1),r.range(-1,1),8);this.scene.asteroids.push(e)},update(t){this.scene.gamePause||(this.spawnTicks-=t,this.spawnTicks<=0&&(this.spawn(),this.spawnTicks=r.range(...x)))}},this.bullets=[],this.particles=[],this.powerUps=[],this.powerUpSpawner={scene:this,reset(){},spawn(){let t=r.choose(b),e=(s=this.scene,i=r.range(t[0],t[0]+t[2]),a=r.range(t[1],t[1]+t[3]),n=r.range(-1,1),h=r.range(-1,1),{scene:s,x:i,y:a,dx:n,dy:h,rotation:Math.atan2(h,n),destroy(){this.scene.powerUps.splice(this.scene.powerUps.indexOf(this),1)}});var s,i,a,n,h;this.scene.powerUps.push(e)},update(t){}},this.starfield=function(t,e){let s={x:[],y:[],size:[],speed:[],length:0,width:t,height:e};for(let i=0;i<30;++i)s.x.push(r.range(0,t)),s.y.push(r.range(0,e)),s.size.push(r.range(...o)),s.speed.push(r.range(...l)),s.length++;return s}(p.width,p.height),this.gamePause=!0,this.showPlayer=!0,this.gameStart=!0,this.gameWait=!0,this.hint="[ wasd_ ]",document.addEventListener("keydown",t=>L.call(this,t.key)),document.addEventListener("keyup",t=>$.call(this,t.key))},update:function(t){if(this.gamePause){for(let e of this.particles)e.age+=t,e.age>S?e.destroy():(e.x+=e.dx,e.y+=e.dy,E(e,8,8));return}const e=this.player.right-this.player.left,s=this.player.down-this.player.up,i=this.player.fire;this.player.dx+=s*Math.cos(this.player.rotation)*.02,this.player.dy+=s*Math.sin(this.player.rotation)*.02,this.player.dx*=.999,this.player.dy*=.999,this.player.dr+=.008*e,this.player.dr*=.9,this.player.x+=this.player.dx,this.player.y+=this.player.dy,this.player.rotation+=this.player.dr,--this.player.cooldown,E(this.player,10,10),i&&(this.player.shoot(),this.flashShootDelta=1);s&&function(t,e,s,i,a,n){if(r.next()>.3){let h=C(t,e+r.range(...T),s+r.range(...T),i,a,n);h.age=r.range(60,240),t.particles.push(h)}}(this,this.player.x,this.player.y,-s*Math.cos(this.player.rotation)*1.5,-s*Math.sin(this.player.rotation)*1.5,r.choose.bind(null,k));for(let e of this.bullets)e.age+=t,e.age>2e3?e.destroy():(e.x+=e.dx,e.y+=e.dy,E(e,4,4));for(let t of this.bullets)for(let e of this.asteroids)if(R(t,e,e.size)){this.flashScore=1,this.score++,this.score>this.highScore&&(this.flashHighScore=this.score-this.highScore,this.highScore=this.score,localStorage.setItem("highscore",this.highScore)),H(this,e.x,e.y,10,r.choose.bind(null,v)),u.pop.play(),t.destroy(),e.breakUp(.1*t.dx,.1*t.dy);break}for(let e of this.particles)e.age+=t,e.age>S?e.destroy():(e.x+=e.dx,e.y+=e.dy,E(e,8,8));for(let t of this.asteroids)t.x+=t.dx,t.y+=t.dy,E(t,2*t.size,2*t.size);for(let t of this.asteroids)if(R(t,this.player,t.size+5)){H(this,t.x,t.y,10,r.choose.bind(null,v)),t.destroy(),U(this);break}for(let t of this.powerUps)t.x+=t.dx,t.y+=t.dy,E(t,8,8);for(let t of this.powerUps)if(R(t,this.player,9)){H(this,t.x,t.y,10,r.choose.bind(null,A)),t.destroy(),this.player.powerMode+=30;break}c(this.starfield),this.asteroidSpawner.update(t),this.powerUpSpawner.update(t),!this.gamePause&&this.asteroids.length<=0&&(this.gamePause=!0,this.showPlayer=!0,u.start.play(),setTimeout(()=>this.gameWait=!0,1e3))},render:function(t){t.fillStyle="black",t.fillRect(0,0,p.width,p.height),d(t,this.starfield),t.fillStyle="rgba(255, 255, 255, 0.2)",t.textAlign="center",t.textBaseline="middle",t.font="16px sans-serif",t.fillText(this.hint,p.width/2,p.height/2-32),this.flashScore>0?(t.fillStyle=`rgba(255, 255, 255, ${this.flashScore+.2})`,this.flashScore-=.1):t.fillStyle="rgba(255, 255, 255, 0.2)";t.font="48px sans-serif",t.fillText("= "+String(this.score).padStart(2,"0")+" =",p.width/2,p.height/2),this.flashHighScore>0?(t.fillStyle=`rgba(255, 255, 255, ${this.flashHighScore+.2})`,this.flashHighScore-=.1):t.fillStyle="rgba(255, 255, 255, 0.2)";t.font="16px sans-serif",t.fillText(String(this.highScore).padStart(2,"0"),p.width/2,p.height/2+32),t.fillStyle="rgba(255, 255, 255, 0.2)",t.font="24px sans-serif",t.textAlign="right",t.fillText(Math.ceil(this.asteroidSpawner.spawnTicks/1e3),p.width,p.height-12);for(let e of this.asteroids)t.translate(e.x,e.y),t.rotate(e.rotation),t.fillStyle="slategray",t.fillRect(-e.size,-e.size,2*e.size,2*e.size),t.setTransform(1,0,0,1,0,0),P(t,e.x,e.y,e.size);for(let e of this.powerUps)t.translate(e.x,e.y),t.rotate(e.rotation),t.beginPath(),t.strokeStyle="violet",t.arc(0,0,4,0,2*Math.PI),t.moveTo(-2,0),t.lineTo(2,0),t.moveTo(0,-2),t.lineTo(0,2),t.stroke(),t.setTransform(1,0,0,1,0,0),P(t,e.x,e.y,4);for(let e of this.bullets)t.translate(e.x,e.y),t.rotate(e.rotation),t.fillStyle="gold",t.fillRect(-2,-2,8,4),t.setTransform(1,0,0,1,0,0),P(t,e.x,e.y,2);for(let e of this.particles){t.translate(e.x,e.y),t.rotate(e.rotation),t.fillStyle=e.color;let s=4*(1-e.age/S);t.fillRect(-s,-s,2*s,2*s),t.setTransform(1,0,0,1,0,0)}if(this.showPlayer){t.translate(this.player.x,this.player.y),t.rotate(this.player.rotation),t.fillStyle="white";let e=5;t.fillRect(-e,-e,2*e,2*e);let s=-1,i=0,a=0;this.flashShootDelta>0?(t.fillStyle=`rgb(${200*this.flashShootDelta+55*Math.sin(performance.now()/20)}, 0, 0)`,this.flashShootDelta-=.1,a=2*this.flashShootDelta,s=this.flashShootDelta):t.fillStyle="black",t.fillRect(-e-a/2+s,-e/4-a/2+i,e+a,e/2+a),t.setTransform(1,0,0,1,0,0)}P(t,this.player.x,this.player.y,5)}};function w(t){requestAnimationFrame(w);const e=t-f;f=t,m.update(e),m.render(g)}const b=[[-8,-8,16+p.width,8],[-8,0,8,p.height],[-8,p.height,16+p.width,8],[p.width,0,8,p.height]],x=[3e3,1e4],S=600,_=["red","red","red","yellow","orange"],v=["blue","blue","blue","dodgerblue","gray","darkgray","yellow"],k=["gray","darkgray","lightgray"],T=[-2,2],A=["violet","white","violet"];let M=!1;function E(t,e,s){t.x<-e&&(t.x=p.width),t.y<-s&&(t.y=p.height),t.x>p.width+e/2&&(t.x=-e),t.y>p.height+s/2&&(t.y=-s)}function R(t,e,s){const i=t.x-e.x,a=t.y-e.y;return i*i+a*a<=s*s}function P(t,e,s,i){M&&(t.translate(e,s),t.beginPath(),t.arc(0,0,i,0,2*Math.PI),t.strokeStyle="lime",t.stroke(),t.setTransform(1,0,0,1,0,0))}function z(t,e,s,i,a){return{scene:t,x:e,y:s,dx:i,dy:a,rotation:Math.atan2(a,i),age:0,destroy(){this.scene.bullets.splice(this.scene.bullets.indexOf(this),1)}}}function C(t,e,s,i,a,n){return"function"==typeof n&&(n=n.call(null)),{scene:t,x:e,y:s,dx:i,dy:a,rotation:Math.atan2(a,i),age:0,color:n,destroy(){this.scene.particles.splice(this.scene.particles.indexOf(this),1)}}}function U(t){t.gamePause=!0,t.showPlayer=!1,H(t,t.player.x,t.player.y,100,r.choose.bind(null,_)),u.dead.play(),u.boom.play(),setTimeout(()=>t.gameStart=t.gameWait=!0,1e3)}function H(t,e,s,i=10,a){for(let n=0;n<i;++n)t.particles.push(C(t,e,s,2*r.range(-1,1),2*r.range(-1,1),a))}function L(t){switch(this.gameWait&&(this.gameStart&&(u.music.play(),this.score=0,this.flashScore=!0,this.level=0,this.gameStart=!1,this.player.powerMode=0,this.powerUps.length=0,this.asteroidSpawner.reset(),this.powerUpSpawner.reset()),this.gameWait=!1,function(t){t.bullets.length=0,t.asteroids.length=0,t.particles.length=0,t.player.x=p.width/2,t.player.y=p.height/2,t.player.dx=0,t.player.dy=0,t.level++,t.gamePause=!1,t.showPlayer=!0;for(let e=0;e<1*t.level;++e)t.asteroidSpawner.spawn();r.next()>.7&&t.powerUpSpawner.spawn(),u.music.playing||u.music.play()}(this)),t){case"w":case"ArrowUp":this.player.up=1;break;case"s":case"ArrowDown":this.player.down=1;break;case"a":case"ArrowLeft":this.player.left=1;break;case"d":case"ArrowRight":this.player.right=1;break;case" ":this.player.fire=1;break;case"\\":break;default:console.log(t)}}function $(t){switch(t){case"w":case"ArrowUp":this.player.up=0;break;case"s":case"ArrowDown":this.player.down=0;break;case"a":case"ArrowLeft":this.player.left=0;break;case"d":case"ArrowRight":this.player.right=0;break;case" ":this.player.fire=0;break;case"\\":M=!M;break;default:console.log(t)}}function q(t,e=!1){const s={_playing:!1,_data:null,_source:null,play(){if(!this._data)return;this._source&&this.destroy();let t=y.createBufferSource();t.loop=e,t.buffer=this._data,t.addEventListener("ended",()=>{this._playing=!1}),t.connect(y.destination),t.start(0),this._source=t,this._playing=!0},pause(){this._source.stop(),this._playing=!1},destroy(){this._source&&this._source.disconnect(),this._source=null},isPaused(){return!this._playing}};return fetch(t).then(t=>t.arrayBuffer()).then(t=>y.decodeAudioData(t)).then(t=>s._data=t),s}m.load().then(()=>{m.start(),w(f=performance.now())})}();
