!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e=e||self).Input={})}(this,(function(e){"use strict";const t=Symbol("any");class s{static parse(e){let n=e.indexOf("["),o=e.indexOf("]"),r=e.indexOf("."),i=null,u=null,h=null;return i=n<=0||0===r?t:e.substring(0,n),u=n<0||o<0||n+1===o?t:e.substring(n+1,o),h=r<0||e.trim().endsWith(".")?t:e.substring(r+1),new s(i,u,h)}constructor(e,t,s){this.source=e,this.code=t,this.mode=s,this.string=`${this.source.toString()}[${this.code.toString()}].${this.mode.toString()}`}matches(e){return!(this.source!==t&&e.source!==t&&this.source!==e.source||this.code!==t&&e.code!==t&&this.code!==e.code||this.mode!==t&&e.mode!==t&&this.mode!==e.mode)}toString(){return this.string}}s.ANY=t;class n{constructor(e){this.prev=e,this.value=e,this.next=e}update(e,t){return!1}consume(){return this.next}poll(){return this.prev=this.value,this.value=this.next,this.next=this.consume(),this}}class o extends n{constructor(e){super(!1),this.eventKeys=[];for(let t of e)this.eventKeys.push(s.parse(t))}consume(){return!1}update(e,t=!0){for(let s of this.eventKeys)if(s.matches(e))return this.next=t,!0;return!1}}class r extends n{constructor(e){super(0),this.eventKey=s.parse(e)}consume(){switch(this.eventKey.string){case"mouse[pos].dx":case"mouse[pos].dy":return 0;case"mouse[pos].x":case"mouse[pos].y":default:return this.next}}update(e,t=1){return!!this.eventKey.matches(e)&&(this.next=t,!0)}}class i extends n{constructor(e){super(0),this.eventKeyEntries=[];for(let t of Object.keys(e))this.eventKeyEntries.push({key:s.parse(t),value:e[t]})}update(e,t=!0){if(t)for(let t of this.eventKeyEntries)if(t.key.matches(e))return this.next=t.value,!0;return!1}}var u=Object.freeze({__proto__:null,MIN_CONTEXT_PRIORITY:-100,MAX_CONTEXT_PRIORITY:100,createContext:function(){return{_source:null,_priority:0,_active:!0,inputs:new Map,get active(){return this._active},get source(){return this._source},get priority(){return this._priority},attach(e){return this._source=e,this._source.addContext(this),this},detach(){return this._source.removeContext(this),this._source=null,this},setPriority(e){if(e>100||e<-100)throw new Error("Context priority must be between [-100, 100].");return this._priority!==e&&(this._source?(this._source.removeContext(this),this._priority=e,this._source.addContext(this)):this._priority=e),this},registerInput(e,t){return this.inputs.set(e,t),t},registerAction(e,...t){return this.registerInput(e,new o(t))},registerRange(e,t){return this.registerInput(e,new r(t))},registerState(e,t){return this.registerInput(e,new i(t))},toggle(e){return void 0===e&&(e=!this._active),this._active=e,this},enable(){return this.toggle(!0)},disable(){return this.toggle(!1)},poll(){for(let e of this.inputs.values())e.poll()},update(e,t){let s;for(let n of this.inputs.values())s|=n.update(e,t);return s}}}});class h{constructor(){this.sourceElement=null,this.eventHandler=null,this.onMouseDown=this.onMouseDown.bind(this),this.onMouseUp=this.onMouseUp.bind(this),this.onMouseMove=this.onMouseMove.bind(this)}attach(e=document){return this.sourceElement=e,this.sourceElement.addEventListener("mousedown",this.onMouseDown),this.sourceElement.addEventListener("mouseup",this.onMouseUp),this.sourceElement.addEventListener("contextmenu",this.onContextMenu),document.addEventListener("mousemove",this.onMouseMove),this}detach(){return this.sourceElement.removeEventListener("mousedown",this.onMouseDown),this.sourceElement.removeEventListener("mouseup",this.onMouseUp),this.sourceElement.removeEventListener("contextmenu",this.onContextMenu),document.removeEventListener("mousemove",this.onMouseMove),this.sourceElement=null,this}setEventHandler(e){return this.eventHandler=e,this}onMouseDown(e){if(!this.eventHandler)return;let t;t=this.eventHandler.call(this,`mouse[${e.button}].down`,!0),t&&(e.preventDefault(),e.stopPropagation())}onMouseUp(e){this.eventHandler&&(e.preventDefault(),e.stopPropagation(),this.eventHandler.call(this,`mouse[${e.button}].up`,!0))}onMouseMove(e){if(!this.eventHandler)return;const t=this.sourceElement,s=t.clientWidth,n=t.clientHeight;this.eventHandler.call(this,"mouse[pos].x",(e.pageX-t.offsetLeft)/s),this.eventHandler.call(this,"mouse[pos].y",(e.pageY-t.offsetTop)/n),this.eventHandler.call(this,"mouse[pos].dx",e.movementX/s),this.eventHandler.call(this,"mouse[pos].dy",e.movementY/n)}onContextMenu(e){e.preventDefault(),e.stopPropagation()}}class l{constructor(){this.sourceElement=null,this.eventHandler=null,this.onKeyDown=this.onKeyDown.bind(this),this.onKeyUp=this.onKeyUp.bind(this)}attach(e=document){return this.sourceElement=e,this.sourceElement.addEventListener("keydown",this.onKeyDown),this.sourceElement.addEventListener("keyup",this.onKeyUp),this}detach(){return this.sourceElement.removeEventListener("keydown",this.onKeyDown),this.sourceElement.removeEventListener("keyup",this.onKeyUp),this.sourceElement=null,this}setEventHandler(e){return this.eventHandler=e,this}onKeyDown(e){if(!this.eventHandler)return;let t;t=e.repeat?this.eventHandler.call(this,`key[${e.key}].repeat`,!0):this.eventHandler.call(this,`key[${e.key}].down`,!0),t&&(e.preventDefault(),e.stopPropagation())}onKeyUp(e){if(!this.eventHandler)return;let t;t=this.eventHandler.call(this,`key[${e.key}].up`,!0),t&&(e.preventDefault(),e.stopPropagation())}}var a=Object.freeze({__proto__:null,createSource:function(){let e={_contexts:new Array(200),element:null,keyboard:new l,mouse:new h,attach(e){return this.element=e,this.keyboard.attach(),this.mouse.attach(e),this},detach(){return this.element=null,this.keyboard.detach(),this.mouse.detach(),this},addContext(e){const t=e.priority- -100;return this._contexts[t]||(this._contexts[t]=[]),this._contexts[t].push(e),this},removeContext(e){const t=e.priority- -100;let s=this._contexts[t];return s&&s.splice(s.indexOf(e),1),this},poll(){for(let e of this._contexts)if(e)for(let t of e)t.active&&t.poll()},handleEvent(e,t){const n=s.parse(e);for(let e of this._contexts)if(e)for(let s of e)if(s.active){let e;if(e=s.update(n,t),e)return!0}return!1}};return e.handleEvent=e.handleEvent.bind(e),e.keyboard.setEventHandler(e.handleEvent),e.mouse.setEventHandler(e.handleEvent),e}});e.AbstractInputAdapter=n,e.ActionInputAdapter=o,e.DOUBLE_ACTION_TIME=300,e.DoubleActionInputAdapter=class extends o{constructor(e){super(e),this.actionTime=0}update(e,t=!0){let s=Date.now();for(let n of this.eventKeys)if(n.matches(e))return t?s-this.actionTime<=300?(this.actionTime=0,this.next=!0,!0):(this.actionTime=s,!1):(this.next=!1,!0);return!1}},e.EventKey=s,e.InputContext=u,e.InputSource=a,e.Keyboard=l,e.Mouse=h,e.RangeInputAdapter=r,e.StateInputAdapter=i,Object.defineProperty(e,"__esModule",{value:!0})}));
