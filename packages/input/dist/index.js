!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).Input={})}(this,(function(e){"use strict";const t={NULL:0,KEY:1,POS:2,WHEEL:3},s={NULL:0,DOWN:1,UP:2,MOVE:3,parse(e){if("string"!=typeof e)return s.NULL;switch(e.toLowerCase()){case"down":return s.DOWN;case"up":return s.UP;case"move":return s.MOVE;default:return s.NULL}}},n="*";class i{static isAxis(e){return!1}static isButton(e){return!1}constructor(e,t){this.deviceName=e,this.eventTarget=t,this.listeners={}}destroy(){this.listeners={}}addInputListener(e,t){let s=this.listeners[e];s?s.push(t):(s=[t],this.listeners[e]=s)}removeInputListener(e,t){let s=this.listeners[e];s&&(s.indexOf(t),s.splice(t,1))}dispatchInput(e){const{keyCode:t}=e,s=this.listeners[t];let n=!1;if(s){for(let t of s)n|=t(e);return n}for(let t of this.listeners["*"])n|=t(e);return n}}class o{static createAdapter(e,t,s,n,i,o){return{target:e,adapterId:t,deviceName:s,keyCode:n,scale:i,eventCode:o}}constructor(){this.adapters={"*":r()}}add(e){for(let t of e){const{deviceName:e,keyCode:s}=t;let n;e in this.adapters?n=this.adapters[e]:(n=r(),this.adapters[e]=n),s in n?n[s].push(t):n[s]=[t]}}delete(e){for(let t of e){const{deviceName:e,keyCode:s}=t;if(e in this.adapters){let n=this.adapters[e];if(s in n){let e=n[s],i=e.indexOf(t);i>=0&&e.splice(i,1)}}}}clear(){for(let e in this.adapters)this.adapters[e]=r()}poll(e,t,n){const i=this.findAdapters(e,t);for(let e of i){const t=e.eventCode;if(t===s.NULL){const{target:t,scale:s}=e,i=n.value*s;t.poll(i,e)}else{const{target:s,scale:i}=e,o=n.getEvent(t)*i;s.poll(o,e)}}return i.length>0}update(e,t,n){let i=!1;for(let o of this.findAdapters(e,t)){const e=o.eventCode;if(e!==s.NULL){const{target:t,scale:s}=o,r=n.getEvent(e)*s;t.update(r,o),i=!0}}return i}reset(e,t,s){let n=!1;for(let s of this.findAdapters(e,t))s.target.reset(),n=!0;return n}findAdapters(e,t){let s=[];if(e in this.adapters){let n=this.adapters[e];t in n&&s.push(...n[t]),s.push(...n["*"])}let n=this.adapters["*"];return t in n&&s.push(...n[t]),s.push(...n["*"]),s}}function r(){return{[n]:[]}}class l{constructor(){this.value=0,this.prev=0}update(e){this.value=e}poll(){this.prev=this.value,this.value=0}getEvent(e){return 0}getState(){return this.value}getPrevState(){return this.prev}}const a=":";class u extends l{constructor(){super(),this.update=this.update.bind(this),this.adapters=[],this.values=[],this.next={values:[],value:0}}hydrate(e){Array.isArray(e)||(e=[e]);let t=[],n=0;for(let i of e){"string"==typeof i&&(i={key:i});const{key:e,scale:r=1,event:l="null"}=i,{deviceName:a,keyCode:u}=h(e),c=s.parse(l),d=Number(r);let p=o.createAdapter(this,n,a,u,d,c);t.push(p),++n}this.adapters=t,this.values=new Array(t.length).fill(0),this.next={values:new Array(t.length).fill(0),value:0}}poll(e,t){this.prev=this.value;const s=t.adapterId;let n=this.values[s];this.values[s]=e,this.value=this.value-n+e,this.next.values[s]=0,this.next.value+=e-n}update(e,t){const s=t.adapterId;let n=this.next.values[s];this.next.values[s]=e,this.next.value+=e-n}reset(){this.prev=0,this.values.fill(0),this.value=0,this.next.values.fill(0),this.next.value=0}}function h(e){let t=e.indexOf(a);if(t>=0)return{deviceName:e.substring(0,t),keyCode:e.substring(t+1)};throw new Error("Invalid key string - missing device separator ':'.")}function c(e,t){return`${e}:${t}`}class d extends l{constructor(){super(),this.delta=0,this.next={delta:0}}update(e,t){this.value=e,this.next.delta+=t}poll(){this.prev=this.value,this.delta=this.next.delta,this.next.delta=0}getEvent(e){switch(e){case s.MOVE:return this.delta;default:return super.getEvent(e)}}}class p extends l{constructor(){super(),this.down=!1,this.up=!1,this.next={down:!1,up:!1}}update(e){e?this.next.down=!0:this.next.up=!0}poll(){this.prev=this.value;const{up:e,down:t}=this.next;this.value?this.up&&!e&&(this.value=0):t&&(this.value=1),this.down=t,this.up=e,this.next.down=!1,this.next.up=!1}getEvent(e){switch(e){case s.DOWN:return 1&this.down;case s.UP:return 1&this.up;default:return super.getEvent(e)}}}const m={NULL:0,UPDATE:1,POLL:2};class v{constructor(e){this.onInputEvent=this.onInputEvent.bind(this),this.onAnimationFrame=this.onAnimationFrame.bind(this);let t={},s={};for(let i of e){const e=i.deviceName;if(e in t)throw new Error(`Another device with name '${e}' already exists.`);t[e]=i,s[e]={},i.addInputListener(n,this.onInputEvent)}this.devices=t,this.keySources=s,this.listeners={poll:[],update:[]},this._autopoll=!1,this._animationFrameHandle=null}destroy(){this.clearKeySources();for(let e in this.devices){let t=this.devices[e];t.removeInputListener(n,this.onInputEvent),t.destroy()}this.devices={}}poll(e=performance.now()){for(const e in this.keySources){const t=this.keySources[e];for(const s in t){let n=t[s];n.poll(),this.dispatchInputEvent(m.POLL,e,s,n)}}this.dispatchPollEvent(e)}addEventListener(e,t){e in this.listeners?this.listeners[e].unshift(t):this.listeners[e]=[t]}removeEventListener(e,t){if(e in this.listeners){let s=this.listeners[e],n=s.indexOf(t);s.splice(n,1)}}countEventListeners(e){if(!(e in this.listeners))throw new Error(`Cannot count listeners for unknown event '${e}'.`);return this.listeners[e].length}dispatchEvent(e,t){for(let s of this.listeners[e])s(t)}dispatchInputEvent(e,t,s,n){this.dispatchEvent("input",{stage:e,deviceName:t,keyCode:s,input:n})}dispatchPollEvent(e){this.dispatchEvent("poll",{now:e})}onInputEvent(e){const n=e.deviceName;switch(e.type){case t.KEY:{const t=e.keyCode;let i=this.keySources[n][t];if(i)return i.update(e.event===s.DOWN),this.dispatchInputEvent(m.UPDATE,n,t,i),!0}break;case t.POS:{let t=this.keySources[n],s=t.PosX;s&&(s.update(e.x,e.dx),this.dispatchInputEvent(m.UPDATE,n,"PosX",s));let i=t.PosY;i&&(i.update(e.y,e.dy),this.dispatchInputEvent(m.UPDATE,n,"PosY",i))}break;case t.WHEEL:{let t=this.keySources[n],s=t.WheelX;s&&(s.update(e.dx,e.dx),this.dispatchInputEvent(m.UPDATE,n,"WheelX",s));let i=t.WheelY;i&&(i.update(e.dy,e.dy),this.dispatchInputEvent(m.UPDATE,n,"WheelY",i));let o=t.WheelZ;o&&(o.update(e.dz,e.dz),this.dispatchInputEvent(m.UPDATE,n,"WheelZ",o))}}}onAnimationFrame(e){this._autopoll&&(this._animationFrameHandle=requestAnimationFrame(this.onAnimationFrame),this.poll(e))}set autopoll(e){this._autopoll=e,this._animationFrameHandle&&(cancelAnimationFrame(this._animationFrameHandle),this._animationFrameHandle=null),e&&(this._animationFrameHandle=requestAnimationFrame(this.onAnimationFrame))}get autopoll(){return this._autopoll}addKeySource(e,t){if(!(e in this.devices))throw new Error("Invalid device name - missing device with name in source.");let s,n=this.devices[e];if(n.constructor.isAxis(t))s=new d;else{if(!n.constructor.isButton(t))throw new Error(`Unknown key code '${t}' for device ${e}.`);s=new p}if(this.keySources[e][t])throw new Error("Cannot add duplicate key source for the same device and key code.");return this.keySources[e][t]=s,this}deleteKeySource(e,t){if(!this.keySources[e][t])throw new Error("Cannot delete missing key source for the device and key code.");delete this.keySources[e][t]}getKeySource(e,t){return this.keySources[e][t]}hasKeySource(e,t){return e in this.keySources&&t in this.keySources[e]}clearKeySources(){for(let e in this.devices)this.keySources[e]={}}}class y extends i{static isAxis(e){return!1}static isButton(e){return!0}constructor(e,n={}){super("Keyboard",e);const{repeat:i=!1}=n;this.repeat=i,this._eventObject={target:e,deviceName:this.deviceName,keyCode:"",event:s.NULL,type:t.KEY,value:0,control:!1,shift:!1,alt:!1},this.onKeyDown=this.onKeyDown.bind(this),this.onKeyUp=this.onKeyUp.bind(this),e.addEventListener("keydown",this.onKeyDown),e.addEventListener("keyup",this.onKeyUp)}destroy(){let e=this.eventTarget;e.removeEventListener("keydown",this.onKeyDown),e.removeEventListener("keyup",this.onKeyUp),super.destroy()}onKeyDown(e){if(e.repeat)return e.preventDefault(),e.stopPropagation(),!1;let t=this._eventObject;return t.keyCode=e.code,t.event=s.DOWN,t.value=1,t.control=e.ctrlKey,t.shift=e.shiftKey,t.alt=e.altKey,this.dispatchInput(t)?(e.preventDefault(),e.stopPropagation(),!1):void 0}onKeyUp(e){let t=this._eventObject;if(t.keyCode=e.code,t.event=s.UP,t.value=1,t.control=e.ctrlKey,t.shift=e.shiftKey,t.alt=e.altKey,this.dispatchInput(t))return e.preventDefault(),e.stopPropagation(),!1}}class f extends i{static isAxis(e){return"PosX"===e||"PosY"===e||"WheelX"===e||"WheelY"===e||"WheelZ"===e}static isButton(e){return!this.isAxis(e)}constructor(e,n={eventsOnFocus:!0}){super("Mouse",e),this.canvasTarget=e instanceof HTMLCanvasElement&&e||e.canvas||e.querySelector("canvas")||e.shadowRoot&&e.shadowRoot.querySelector("canvas")||e,this.eventsOnFocus=n.eventsOnFocus,this._downHasFocus=!1,this._eventObject={target:e,deviceName:this.deviceName,keyCode:"",event:s.NULL,type:t.KEY,value:0,control:!1,shift:!1,alt:!1},this._positionObject={target:e,deviceName:this.deviceName,keyCode:"Position",event:s.MOVE,type:t.POS,x:0,y:0,dx:0,dy:0},this._wheelObject={target:e,deviceName:this.deviceName,keyCode:"Wheel",event:s.MOVE,type:t.WHEEL,dx:0,dy:0,dz:0},this.onMouseDown=this.onMouseDown.bind(this),this.onMouseUp=this.onMouseUp.bind(this),this.onMouseMove=this.onMouseMove.bind(this),this.onContextMenu=this.onContextMenu.bind(this),this.onWheel=this.onWheel.bind(this),e.addEventListener("mousedown",this.onMouseDown),e.addEventListener("contextmenu",this.onContextMenu),e.addEventListener("wheel",this.onWheel),document.addEventListener("mousemove",this.onMouseMove),document.addEventListener("mouseup",this.onMouseUp)}destroy(){let e=this.eventTarget;e.removeEventListener("mousedown",this.onMouseDown),e.removeEventListener("contextmenu",this.onContextMenu),e.removeEventListener("wheel",this.onWheel),document.removeEventListener("mousemove",this.onMouseMove),document.removeEventListener("mouseup",this.onMouseUp),super.destroy()}setPointerLock(e=!0){e?this.eventTarget.requestPointerLock():this.eventTarget.exitPointerLock()}hasPointerLock(){return document.pointerLockElement===this.eventTarget}onMouseDown(e){this._downHasFocus=!0;let t=this._eventObject;if(t.keyCode="Button"+e.button,t.event=s.DOWN,t.value=1,t.control=e.ctrlKey,t.shift=e.shiftKey,t.alt=e.altKey,this.dispatchInput(t)&&document.activeElement===this.eventTarget)return e.preventDefault(),e.stopPropagation(),!1}onContextMenu(e){return e.preventDefault(),e.stopPropagation(),!1}onWheel(e){let t=this._wheelObject;switch(e.deltaMode){case WheelEvent.DOM_DELTA_LINE:t.dx=10*e.deltaX,t.dy=10*e.deltaY,t.dz=10*e.deltaZ;break;case WheelEvent.DOM_DELTA_PAGE:t.dx=100*e.deltaX,t.dy=100*e.deltaY,t.dz=100*e.deltaZ;break;case WheelEvent.DOM_DELTA_PIXEL:default:t.dx=e.deltaX,t.dy=e.deltaY,t.dz=e.deltaZ}if(this.dispatchInput(t))return e.preventDefault(),e.stopPropagation(),!1}onMouseUp(e){if(!this._downHasFocus)return;this._downHasFocus=!1;let t=this._eventObject;return t.keyCode="Button"+e.button,t.event=s.UP,t.value=1,t.control=e.ctrlKey,t.shift=e.shiftKey,t.alt=e.altKey,this.dispatchInput(t)?(e.preventDefault(),e.stopPropagation(),!1):void 0}onMouseMove(e){if(this.eventsOnFocus&&document.activeElement!==this.eventTarget)return;const t=this.canvasTarget,{clientWidth:s,clientHeight:n}=t,i=t.getBoundingClientRect();let o=e.movementX/s,r=e.movementY/n,l=(e.clientX-i.left)/s,a=(e.clientY-i.top)/n,u=this._positionObject;u.x=l,u.y=a,u.dx=o,u.dy=r,this.dispatchInput(u)}}const b=Symbol("keySourceRefCount");const E=Symbol("inputEventSource");function g(e){return Object.prototype.hasOwnProperty.call(e,E)&&Object.getOwnPropertyDescriptor(e,E).value}class _ extends HTMLElement{static get[Symbol.for("cuttleTemplate")](){let e=document.createElement("template");return e.innerHTML='<div>\n    <label id="title">\n        input-source\n    </label>\n    <span>|</span>\n    <p>\n        <label for="poll">poll</label>\n        <output id="poll"></output>\n    </p>\n    <p>\n        <label for="focus">focus</label>\n        <output id="focus"></output>\n    </p>\n</div>\n',Object.defineProperty(this,Symbol.for("cuttleTemplate"),{value:e}),e}static get[Symbol.for("cuttleStyle")](){let e=document.createElement("style");return e.innerHTML=':host{display:inline-block}div{font-family:monospace;color:#666;outline:1px solid #666;padding:4px}p{display:inline;margin:0;padding:0}#focus:empty:after,#poll:empty:after{content:"✗";color:red}',Object.defineProperty(this,Symbol.for("cuttleStyle"),{value:e}),e}static for(e){return new _(e)}static get observedAttributes(){return["oninput","onpoll","for","autopoll","id","class"]}static get properties(){return{for:String,autopoll:Boolean}}get autopoll(){return this._autopoll}set autopoll(e){this.toggleAttribute("autopoll",e)}get for(){return this._for}set for(e){this.setAttribute("for",e)}static get customEvents(){return["input","poll"]}get onpoll(){return this._onpoll}set onpoll(e){this._onpoll&&this.removeEventListener("poll",this._onpoll),this._onpoll=e,this._onpoll&&this.addEventListener("poll",e)}get oninput(){return this._oninput}set oninput(e){this._oninput&&this.removeEventListener("input",this._oninput),this._oninput=e,this._oninput&&this.addEventListener("input",e)}constructor(e){super(),this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(this.constructor[Symbol.for("cuttleTemplate")].content.cloneNode(!0)),this.shadowRoot.appendChild(this.constructor[Symbol.for("cuttleStyle")].cloneNode(!0)),this._containerElement=this.shadowRoot.querySelector("div"),this._titleElement=this.shadowRoot.querySelector("#title"),this._pollElement=this.shadowRoot.querySelector("#poll"),this._focusElement=this.shadowRoot.querySelector("#focus"),this._pollCount=0,this._pollCountDelay=0,this._eventTarget=null,this._eventSource=null,this._keySourceRefCount={},this.onSourcePoll=this.onSourcePoll.bind(this),this.onSourceInput=this.onSourceInput.bind(this),this.onTargetFocus=this.onTargetFocus.bind(this),this.onTargetBlur=this.onTargetBlur.bind(this),e&&this.setEventTarget(e)}connectedCallback(){if(Object.prototype.hasOwnProperty.call(this,"oninput")){let e=this.oninput;delete this.oninput,this.oninput=e}if(Object.prototype.hasOwnProperty.call(this,"onpoll")){let e=this.onpoll;delete this.onpoll,this.onpoll=e}if(Object.prototype.hasOwnProperty.call(this,"for")){let e=this.for;delete this.for,this.for=e}if(Object.prototype.hasOwnProperty.call(this,"autopoll")){let e=this.autopoll;delete this.autopoll,this.autopoll=e}this.hasAttribute("tabindex")||this.setAttribute("tabindex",0),this.hasAttribute("for")||this._eventTarget||this.setEventTarget(this)}disconnectedCallback(){this.clearEventTarget()}attributeChangedCallback(e,t,s){switch(e){case"for":this._for=s;break;case"autopoll":this._autopoll=null!==s;break;case"oninput":this.oninput=new Function("event","with(document){with(this){"+s+"}}").bind(this);break;case"onpoll":this.onpoll=new Function("event","with(document){with(this){"+s+"}}").bind(this)}((e,t,s)=>{switch(e){case"for":this.setEventTarget(s?document.getElementById(s):this);break;case"id":case"class":{let e=this.className?"."+this.className:"",t=this.hasAttribute("id")?"#"+this.getAttribute("id"):"";this._titleElement.innerHTML=e+t}}})(e,0,s)}poll(e){this._eventSource.poll(e)}onSourceInput({stage:e,deviceName:t,keyCode:s,input:n}){this.dispatchEvent(new CustomEvent("input",{composed:!0,bubbles:!1,detail:{stage:e,deviceName:t,keyCode:s,input:n}}))}onSourcePoll({now:e}){this._pollCount+=1,this.dispatchEvent(new CustomEvent("poll",{composed:!0,bubbles:!1})),e-this._pollCountDelay>1e3&&(this._pollCountDelay=e,this._pollCount>0?(this._pollElement.innerHTML="✓",this._pollCount=0):this._pollElement.innerHTML="")}onTargetFocus(){this._focusElement.innerHTML="✓"}onTargetBlur(){this._focusElement.innerHTML=""}setEventTarget(e){if(this.clearEventTarget(),!e)throw new Error("Cannot set null as event target for input source.");let t;g(e)?t=function(e){return Object.getOwnPropertyDescriptor(e,E).value}(e):(t=new v([new y(e),new f(e)]),function(e,t){Object.defineProperty(e,E,{value:t,configurable:!0})}(e,t),function(e){b in e||(e[b]={})}(t)),this._eventSource=t,this._eventTarget=e;let s=this.autopoll;s&&(this._eventSource.autopoll=s),t.addEventListener("poll",this.onSourcePoll),t.addEventListener("input",this.onSourceInput),e.addEventListener("focus",this.onTargetFocus),e.addEventListener("blur",this.onTargetBlur)}clearEventTarget(){let e=this._eventTarget,t=this._eventSource;this._eventTarget=null,this._eventSource=null,e&&(e.removeEventListener("focus",this.onTargetFocus),e.removeEventListener("blur",this.onTargetBlur),t.removeEventListener("poll",this.onSourcePoll),t.removeEventListener("input",this.onSourceInput),t.countEventListeners("input")<=0&&(t.destroy(),function(e){Object.defineProperty(e,E,{value:null,configurable:!0})}(e)))}enableKeySource(e,t){if(!e||!t)throw new Error("Invalid device name or key code for key source.");let s=this._eventSource;1===function(e,t,s){const n=c(t,s);let i=e[b],o=i[n]+1||1;return i[n]=o,o}(s,e,t)&&s.addKeySource(e,t)}disableKeySource(e,t){if(!e||!t)throw new Error("Invalid device name or key code for key source.");let s=this._eventSource;0===function(e,t,s){const n=c(t,s);let i=e[b],o=i[n]-1||0;return i[n]=Math.max(o,0),o}(s,e,t)&&s.deleteKeySource(e,t)}getKeySource(e,t){if(!e||!t)throw new Error("Invalid device name or key code for key source.");return this._eventSource.getKeySource(e,t)}hasKeySource(e,t){if(!e||!t)throw new Error("Invalid device name or key code for key source.");return this._eventSource.hasKeySource(e,t)}clearKeySources(){let e=this._eventSource;e.clearKeySources(),function(e){e[b]={}}(e)}get keySources(){return this._eventSource.keySources}get devices(){return this._eventSource.devices}}window.customElements.define("input-source",_);class w{constructor(e=null,t=null,s=!0){this.source=null,this._disabled=s,this._ignoreInput=s,this.adapters=new o,this.inputs={},this.onSourceInput=this.onSourceInput.bind(this),this.onSourcePoll=this.onSourcePoll.bind(this),(e||t)&&this._setupInputs(S(e),t),s||this.attach()}get disabled(){return this._disabled}set disabled(e){this.toggle(!e)}setInputMap(e){return this._setupInputs(this.source,e),this}setInputSource(e){return this._setupInputs(S(e),null),this}attach(){if(!this.source)throw new Error("Missing input source to attach context.");return this.toggle(!0),this}detach(){return this.toggle(!1),this._setupInputs(null,null),this}_setupInputs(e,t){const s=this.disabled;this.disabled=!0;const n=this.source,i=this.inputs,o=n!==e&&n,r=this.inputs&&t;if(o||r){o&&(n.removeEventListener("poll",this.onSourcePoll),n.removeEventListener("input",this.onSourceInput));for(let e in i){let{adapters:t}=i[e];for(let e of t){const{deviceName:t,keyCode:s}=e;n.disableKeySource(t,s)}}r&&(this.adapters.clear(),this.inputs={})}if(t){let e={};for(let s in t){let n=t[s],o=i[s]||new u;o.hydrate(n);let r=o.adapters;this.adapters.add(r),e[s]=o}this.inputs=e}if(e){const t=this.inputs;for(let s in t){let{adapters:n}=t[s];for(let t of n){const{deviceName:s,keyCode:n}=t;e.enableKeySource(s,n)}}this.source!==e&&(e.addEventListener("poll",this.onSourcePoll),e.addEventListener("input",this.onSourceInput),this.source=e)}this.disabled=s}onSourceInput(e){if(e.detail.consumed||this._ignoreInput){const{deviceName:t,keyCode:s,input:n}=e;this.adapters.reset(t,s,n)}else{const{stage:t,deviceName:s,keyCode:n,input:i}=e.detail;switch(t){case m.POLL:this.adapters.poll(s,n,i);break;case m.UPDATE:this.adapters.update(s,n,i);break;default:throw new Error("Unknown input source stage.")}e.consumed=!0}}onSourcePoll(e){this._ignoreInput!==this.disabled&&(this._ignoreInput=this.disabled)}toggle(e=this._disabled){if(e){if(!this.source)throw new Error("Input source must be set before enabling input context.");Object.keys(this.inputs).length<=0&&console.warn("No inputs found for enabled input context - did you forget to setInputMap()?")}return this._disabled=!e,this}getInput(e){if(e in this.inputs)return this.inputs[e];{let t=new u;return this.inputs[e]=t,t}}hasInput(e){return e in this.inputs&&this.inputs[e].adapters.length>0}getInputValue(e){return e in this.inputs?this.inputs[e].value:0}getInputState(e){return this.getInputValue(e)}getInputChanged(e){if(e in this.inputs){let t=this.inputs[e];return t.value-t.prev}return 0}}function S(e){if(e instanceof _)return e;{let t=e,s=g(t),n=new _(t);return s||(n.autopoll=!0),n}}class k extends HTMLElement{static get[Symbol.for("cuttleTemplate")](){let e=document.createElement("template");return e.innerHTML='<kbd>\n    <span id="key"><slot></slot></span>\n    <span id="value" class="hidden"></span>\n</kbd>\n',Object.defineProperty(this,Symbol.for("cuttleTemplate"),{value:e}),e}static get[Symbol.for("cuttleStyle")](){let e=document.createElement("style");return e.innerHTML='kbd{position:relative;display:inline-block;border-radius:3px;border:1px solid #888;font-size:.85em;font-weight:700;text-rendering:optimizeLegibility;line-height:12px;height:14px;padding:2px 4px;color:#444;background-color:#eee;box-shadow:inset 0 -3px 0 #aaa;overflow:hidden}kbd:empty:after{content:"<?>";opacity:.6}.disabled{opacity:.6;box-shadow:none;background-color:#aaa}.hidden{display:none}#value{position:absolute;top:0;bottom:0;right:0;font-size:.85em;padding:2px 4px 0;color:#ccc;background-color:#333;box-shadow:inset 0 3px 0 #222}',Object.defineProperty(this,Symbol.for("cuttleStyle"),{value:e}),e}static get properties(){return{name:String,value:String,disabled:Boolean}}get disabled(){return this._disabled}set disabled(e){this.toggleAttribute("disabled",e)}get value(){return this._value}set value(e){this.setAttribute("value",e)}get name(){return this._name}set name(e){this.setAttribute("name",e)}constructor(){super(),this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(this.constructor[Symbol.for("cuttleTemplate")].content.cloneNode(!0)),this.shadowRoot.appendChild(this.constructor[Symbol.for("cuttleStyle")].cloneNode(!0)),this._keyboardElement=this.shadowRoot.querySelector("kbd"),this._keyElement=this.shadowRoot.querySelector("#key"),this._valueElement=this.shadowRoot.querySelector("#value")}attributeChangedCallback(e,t,s){switch(e){case"name":this._name=s;break;case"value":this._value=s;break;case"disabled":this._disabled=null!==s}((e,t,s)=>{switch(e){case"name":this._keyElement.innerText=s;break;case"value":null!==s?(this._valueElement.classList.toggle("hidden",!1),this._valueElement.innerText=s,this._keyboardElement.style.paddingRight=`${this._valueElement.clientWidth+4}px`):this._valueElement.classList.toggle("hidden",!0);break;case"disabled":this._keyboardElement.classList.toggle("disabled",null!==s)}})(e,0,s)}connectedCallback(){if(Object.prototype.hasOwnProperty.call(this,"name")){let e=this.name;delete this.name,this.name=e}if(Object.prototype.hasOwnProperty.call(this,"value")){let e=this.value;delete this.value,this.value=e}if(Object.prototype.hasOwnProperty.call(this,"disabled")){let e=this.disabled;delete this.disabled,this.disabled=e}}static get observedAttributes(){return["name","value","disabled"]}}window.customElements.define("input-key",k);class x extends HTMLElement{static get[Symbol.for("cuttleTemplate")](){let e=document.createElement("template");return e.innerHTML='<table>\n    <thead>\n        <tr class="tableHeader">\n            <th colspan=4>\n                <slot id="title">input-map</slot>\n            </th>\n        </tr>\n        <tr class="colHeader">\n            <th>name</th>\n            <th>key</th>\n            <th>mod</th>\n            <th>value</th>\n        </tr>\n    </thead>\n    <tbody>\n    </tbody>\n</table>\n',Object.defineProperty(this,Symbol.for("cuttleTemplate"),{value:e}),e}static get[Symbol.for("cuttleStyle")](){let e=document.createElement("style");return e.innerHTML=":host{display:block}table{border-collapse:collapse}table,td,th{border:1px solid #666}td,th{padding:5px 10px}td{text-align:center}thead th{padding:0}.colHeader>th{font-size:.8em;padding:0 10px;letter-spacing:3px;background-color:#aaa;color:#666}.colHeader>th,output{font-family:monospace}output{border-radius:.3em;padding:3px}tr:not(.primary) .name,tr:not(.primary) .value{opacity:.3}tr:nth-child(2n){background-color:#eee}",Object.defineProperty(this,Symbol.for("cuttleStyle"),{value:e}),e}static get customEvents(){return["load"]}get onload(){return this._onload}set onload(e){this._onload&&this.removeEventListener("load",this._onload),this._onload=e,this._onload&&this.addEventListener("load",e)}static get observedAttributes(){return["onload","src","id","class"]}constructor(){super(),this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(this.constructor[Symbol.for("cuttleTemplate")].content.cloneNode(!0)),this.shadowRoot.appendChild(this.constructor[Symbol.for("cuttleStyle")].cloneNode(!0)),this._src="",this._inputMap=null,this._tableElements={},this._titleElement=this.shadowRoot.querySelector("#title"),this._bodyElement=this.shadowRoot.querySelector("tbody"),this._children=this.shadowRoot.querySelector("slot")}get map(){return this._inputMap}get mapElements(){return this._tableElements}connectedCallback(){if(Object.prototype.hasOwnProperty.call(this,"onload")){let e=this.onload;delete this.onload,this.onload=e}!function(e,t){if(Object.prototype.hasOwnProperty.call(e,t)){let s=e[t];delete e[t],e[t]=s}}(this,"src")}attributeChangedCallback(e,t,s){switch(e){case"onload":this.onload=new Function("event","with(document){with(this){"+s+"}}").bind(this)}((e,t,s)=>{switch(e){case"src":if(this._src!==s)if(this._src=s,s.trim().startsWith("{")){let e=JSON.parse(s);this._setInputMap(e)}else fetch(s).then((e=>e.json())).then((e=>this._setInputMap(e)));break;case"id":case"class":this._titleElement.innerHTML=`input-port${this.className?"."+this.className:""}${this.hasAttribute("id")?"#"+this.getAttribute("id"):""}`}})(e,0,s)}get src(){return this.getAttribute("src")}set src(e){switch(typeof e){case"object":{let t=JSON.stringify(e);this._src=t,this._setInputMap(e),this.setAttribute("src",t)}break;case"string":this.setAttribute("src",e);break;default:this.setAttribute("src",JSON.stringify(e))}}_setInputMap(e){let t={},s=[];for(let n in e){let i=[];L(i,n,e[n]),t[n]=i,s.push(...i)}this._bodyElement.innerHTML="";for(let e of s)this._bodyElement.appendChild(e);this._inputMap=e,this._tableElements=t,this.dispatchEvent(new CustomEvent("load",{bubbles:!1,composed:!0,detail:{map:e}}))}}function L(e,t,s){if(Array.isArray(s)){L(e,t,s[0]);let n=s.length;for(let i=1;i<n;++i)e.push(I(t,s[i],!1))}else e.push(I(t,s,!0));return e}function I(e,t,s=!0){if("object"==typeof t){const{key:n,event:i,scale:o}=t;return C(e,n,i,o,0,s)}return C(e,t,null,1,0,s)}function C(e,t,s,n,i,o=!0){let r=document.createElement("tr");o&&r.classList.add("primary");{let t=document.createElement("td");t.textContent=e,t.classList.add("name"),r.appendChild(t)}{let e=document.createElement("td");e.classList.add("key");let s=new k;s.innerText=t,e.appendChild(s),r.appendChild(e)}{let e=document.createElement("td"),t=document.createElement("samp"),i=[];"string"==typeof s&&"null"!==s&&i.push(s),"number"==typeof n&&1!==n&&i.push(`×(${n.toFixed(2)})`),t.innerText=i.join(" "),e.classList.add("mod"),e.appendChild(t),r.appendChild(e)}{let e=document.createElement("td"),t=document.createElement("output");t.innerText=Number(i).toFixed(2),t.classList.add("value"),e.appendChild(t),r.appendChild(e)}return r}window.customElements.define("input-map",x);class T extends HTMLElement{static get[Symbol.for("cuttleTemplate")](){let e=document.createElement("template");return e.innerHTML="<input-map>\n    <slot></slot>\n    <input-source></input-source>\n</input-map>\n",Object.defineProperty(this,Symbol.for("cuttleTemplate"),{value:e}),e}static get[Symbol.for("cuttleStyle")](){let e=document.createElement("style");return e.innerHTML=":host{display:inline-block}",Object.defineProperty(this,Symbol.for("cuttleStyle"),{value:e}),e}static get properties(){return{for:String,disabled:Boolean}}get disabled(){return this._disabled}set disabled(e){this.toggleAttribute("disabled",e)}get for(){return this._for}set for(e){this.setAttribute("for",e)}static get observedAttributes(){return["for","disabled","src","id","class"]}constructor(){super(),this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(this.constructor[Symbol.for("cuttleTemplate")].content.cloneNode(!0)),this.shadowRoot.appendChild(this.constructor[Symbol.for("cuttleStyle")].cloneNode(!0)),this._inputContext=new w,this._mapElement=this.shadowRoot.querySelector("input-map"),this._sourceElement=this.shadowRoot.querySelector("input-source"),this.onInputMapLoad=this.onInputMapLoad.bind(this),this.onInputSourcePoll=this.onInputSourcePoll.bind(this),this._mapElement.addEventListener("load",this.onInputMapLoad),this._sourceElement.addEventListener("poll",this.onInputSourcePoll)}get context(){return this._inputContext}get source(){return this._sourceElement}get map(){return this._mapElement.map}onInputMapLoad(){let e=this._sourceElement,t=this._mapElement.map;e&&t&&(this._inputContext.setInputMap(t).setInputSource(e).attach(),this._inputContext.disabled=this._disabled)}onInputSourcePoll(){for(let[e,t]of Object.entries(this._mapElement.mapElements)){let s=this._inputContext.getInputValue(e);t[0].querySelector("output").innerText=Number(s).toFixed(2)}}connectedCallback(){if(Object.prototype.hasOwnProperty.call(this,"for")){let e=this.for;delete this.for,this.for=e}if(Object.prototype.hasOwnProperty.call(this,"disabled")){let e=this.disabled;delete this.disabled,this.disabled=e}!function(e,t){if(Object.prototype.hasOwnProperty.call(e,t)){let s=e[t];delete e[t],e[t]=s}}(this,"src")}attributeChangedCallback(e,t,s){switch(e){case"for":this._for=s;break;case"disabled":this._disabled=null!==s}((e,t,s)=>{switch(e){case"for":{let e=document.getElementById(s);g(s?e:this._sourceElement)||(this._sourceElement.autopoll=!0),e instanceof _&&e._eventTarget?(this._sourceElement.setEventTarget(e._eventTarget),this._sourceElement.className=e.className,this._sourceElement.id=e.id):this._sourceElement.for=s;let t=this._sourceElement,n=this._mapElement.map;n&&(this._inputContext.setInputMap(n).setInputSource(t).attach(),this._inputContext.disabled=this._disabled)}break;case"src":this._mapElement.src=s;break;case"disabled":{let e=this._sourceElement,t=this._mapElement.map;e&&t&&(this._inputContext.disabled=this._disabled)}break;case"id":this._sourceElement.id=s;break;case"class":this._sourceElement.className=s}})(e,0,s)}get src(){return this._mapElement.src}set src(e){this._mapElement.src=e}getInput(e){return this._inputContext.getInput(e)}getInputValue(e){return this._inputContext.getInputValue(e)}getInputChanged(e){return this._inputContext.getInputChanged(e)}}window.customElements.define("input-context",T),e.AdapterManager=o,e.Axis=d,e.Button=p,e.Input=l,e.InputContext=w,e.InputContextElement=T,e.InputDevice=i,e.InputEventCode=s,e.InputKeyElement=k,e.InputMapElement=x,e.InputSource=_,e.InputSourceEventStage=m,e.InputType=t,e.KEY_STRING_DEVICE_SEPARATOR=a,e.Keyboard=y,e.Mouse=f,e.Synthetic=u,e.WILDCARD_DEVICE_MATCHER="*",e.WILDCARD_KEY_MATCHER=n,e.parseKeyString=h,e.stringifyDeviceKeyCodePair=c,Object.defineProperty(e,"__esModule",{value:!0})}));
