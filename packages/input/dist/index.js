!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).Input={})}(this,(function(t){"use strict";const e={NULL:0,KEY:1,POS:2,WHEEL:3},s={NULL:0,DOWN:1,UP:2,MOVE:3,parse(t){if("string"!=typeof t)return s.NULL;switch(t.toLowerCase()){case"down":return s.DOWN;case"up":return s.UP;case"move":return s.MOVE;default:return s.NULL}}},n="*";class i{static isAxis(t){return!1}static isButton(t){return!1}constructor(t,e){this.deviceName=t,this.eventTarget=e,this.listeners={}}destroy(){this.listeners={}}addInputListener(t,e){let s=this.listeners[t];s?s.push(e):(s=[e],this.listeners[t]=s)}removeInputListener(t,e){let s=this.listeners[t];s&&(s.indexOf(e),s.splice(e,1))}dispatchInput(t){const{keyCode:e}=t,s=this.listeners[e];let n=!1;if(s){for(let e of s)n|=e(t);return n}for(let e of this.listeners["*"])n|=e(t);return n}}class o{static createAdapter(t,e,s,n,i,o){return{target:t,adapterId:e,deviceName:s,keyCode:n,scale:i,eventCode:o}}constructor(){this.adapters={"*":r()}}add(t){for(let e of t){const{deviceName:t,keyCode:s}=e;let n;t in this.adapters?n=this.adapters[t]:(n=r(),this.adapters[t]=n),s in n?n[s].push(e):n[s]=[e]}}delete(t){for(let e of t){const{deviceName:t,keyCode:s}=e;if(t in this.adapters){let n=this.adapters[t];if(s in n){let t=n[s],i=t.indexOf(e);i>=0&&t.splice(i,1)}}}}clear(){for(let t in this.adapters)this.adapters[t]=r()}poll(t,e,n){const i=this.findAdapters(t,e);for(let t of i){const e=t.eventCode;if(e===s.NULL){const{target:e,scale:s}=t,i=n.value*s;e.poll(i,t)}else{const{target:s,scale:i}=t,o=n.getEvent(e)*i;s.poll(o,t)}}return i.length>0}update(t,e,n){let i=!1;for(let o of this.findAdapters(t,e)){const t=o.eventCode;if(t!==s.NULL){const{target:e,scale:s}=o,r=n.getEvent(t)*s;e.update(r,o),i=!0}}return i}reset(t,e,s){let n=!1;for(let s of this.findAdapters(t,e))s.target.reset(),n=!0;return n}findAdapters(t,e){let s=[];if(t in this.adapters){let n=this.adapters[t];e in n&&s.push(...n[e]),s.push(...n["*"])}let n=this.adapters["*"];return e in n&&s.push(...n[e]),s.push(...n["*"]),s}}function r(){return{[n]:[]}}class l{constructor(){this.value=0,this.prev=0}update(t){this.value=t}poll(){this.prev=this.value,this.value=0}getEvent(t){return 0}getState(){return this.value}getPrevState(){return this.prev}}class a extends l{constructor(){super(),this.delta=0,this.next={delta:0}}update(t,e){this.value=t,this.next.delta+=e}poll(){this.prev=this.value,this.delta=this.next.delta,this.next.delta=0}getEvent(t){switch(t){case s.MOVE:return this.delta;default:return super.getEvent(t)}}}class h extends l{constructor(){super(),this.down=!1,this.up=!1,this.next={down:!1,up:!1}}update(t){t?this.next.down=!0:this.next.up=!0}poll(){this.prev=this.value;const{up:t,down:e}=this.next;this.value?this.up&&!t&&(this.value=0):e&&(this.value=1),this.down=e,this.up=t,this.next.down=!1,this.next.up=!1}getEvent(t){switch(t){case s.DOWN:return 1&this.down;case s.UP:return 1&this.up;default:return super.getEvent(t)}}}const u={NULL:0,UPDATE:1,POLL:2};class c{constructor(t=[]){this.onInputEvent=this.onInputEvent.bind(this),this.onAnimationFrame=this.onAnimationFrame.bind(this);let e={},s={};for(let i of t){const t=i.deviceName;if(t in e)throw new Error(`Another device with name '${t}' already exists.`);e[t]=i,s[t]={},i.addInputListener(n,this.onInputEvent)}this.devices=e,this.keyMap=s,this.listeners={poll:[],update:[]},this._lastPollTime=-1,this._autopoll=!1,this._animationFrameHandle=null}get polling(){return performance.now()-this._lastPollTime<1e3}destroy(){this.clearKeys();for(let t in this.devices){let e=this.devices[t];e.removeInputListener(n,this.onInputEvent),e.destroy()}this.devices={}}poll(t=performance.now()){for(const t in this.keyMap){let e=this.keyMap[t];for(const s in e){let n=d(e[s]);n.poll(),this.dispatchInputEvent(u.POLL,t,s,n)}}this.dispatchPollEvent(t),this._lastPollTime=t}addEventListener(t,e){t in this.listeners?this.listeners[t].unshift(e):this.listeners[t]=[e]}removeEventListener(t,e){if(t in this.listeners){let s=this.listeners[t],n=s.indexOf(e);s.splice(n,1)}}countEventListeners(t){if(!(t in this.listeners))throw new Error(`Cannot count listeners for unknown event '${t}'.`);return this.listeners[t].length}dispatchEvent(t,e){for(let s of this.listeners[t])s(e)}dispatchInputEvent(t,e,s,n){this.dispatchEvent("input",{stage:t,deviceName:e,keyCode:s,input:n})}dispatchPollEvent(t){this.dispatchEvent("poll",{now:t})}onInputEvent(t){const n=t.deviceName,i=this.keyMap[n];switch(t.type){case e.KEY:{const e=t.keyCode;let o=d(i[e]);if(o)return o.update(t.event===s.DOWN),this.dispatchInputEvent(u.UPDATE,n,e,o),!0}break;case e.POS:{let e=d(i.PosX);e&&(e.update(t.x,t.dx),this.dispatchInputEvent(u.UPDATE,n,"PosX",e));let s=d(i.PosY);s&&(s.update(t.y,t.dy),this.dispatchInputEvent(u.UPDATE,n,"PosY",s))}break;case e.WHEEL:{let e=d(i.WheelX);e&&(e.update(t.dx,t.dx),this.dispatchInputEvent(u.UPDATE,n,"WheelX",e));let s=d(i.WheelY);s&&(s.update(t.dy,t.dy),this.dispatchInputEvent(u.UPDATE,n,"WheelY",s));let o=d(i.WheelZ);o&&(o.update(t.dz,t.dz),this.dispatchInputEvent(u.UPDATE,n,"WheelZ",o))}}}onAnimationFrame(t){this._autopoll&&(this._animationFrameHandle=requestAnimationFrame(this.onAnimationFrame),this.poll(t))}set autopoll(t){this._autopoll=t,this._animationFrameHandle&&(cancelAnimationFrame(this._animationFrameHandle),this._animationFrameHandle=null),t&&(this._animationFrameHandle=requestAnimationFrame(this.onAnimationFrame))}get autopoll(){return this._autopoll}registerKey(t,e){if(!(t in this.devices))throw new Error(`Invalid device name - missing device with name '${t}' in source.`);let s=this.keyMap[t];if(e in s)s[e].refs+=1;else{let n,i=this.devices[t];if(i.constructor.isAxis(e))n=new a;else{if(!i.constructor.isButton(e))throw new Error(`Unknown key code '${e}' for device ${t}.`);n=new h}s[e]=function(t=null){return{refs:1,input:t}}(n)}return this}unregisterKey(t,e){let s=this.keyMap[t];if(s){let t=s[e];t&&(!function(t){t.refs-=1}(t),t.refs<=0&&delete s[e])}}hasKey(t,e){return t in this.keyMap&&e in this.keyMap[t]}clearKeys(){for(let t in this.devices){let e=this.keyMap[t];for(let t in e)e[t].refs=0;this.keyMap[t]={}}}getInputByKey(t,e){return d(this.keyMap[t][e])}}function d(t){return t?t.input:null}class p extends l{constructor(){super(),this.update=this.update.bind(this),this.adapters=[],this.values=[],this.next={values:[],value:0}}hydrate(t){if(!t)return;Array.isArray(t)||(t=[t]);let e=[],n=0;for(let i of t){"string"==typeof i&&(i={key:i});const{key:t,scale:r=1,event:l="null"}=i,{deviceName:a,keyCode:h}=v(t),u=s.parse(l),c=Number(r);let d=o.createAdapter(this,n,a,h,c,u);e.push(d),++n}this.adapters=e,this.values=new Array(e.length).fill(0),this.next={values:new Array(e.length).fill(0),value:0}}poll(t,e){this.prev=this.value;const s=e.adapterId;let n=this.values[s];this.values[s]=t,this.value=this.value-n+t,this.next.values[s]=0,this.next.value+=t-n}update(t,e){const s=e.adapterId;let n=this.next.values[s];this.next.values[s]=t,this.next.value+=t-n}reset(){this.prev=0,this.values.fill(0),this.value=0,this.next.values.fill(0),this.next.value=0}}function v(t){let e=t.indexOf(":");if(e>=0)return{deviceName:t.substring(0,e),keyCode:t.substring(e+1)};throw new Error("Invalid key string - missing device separator ':'.")}class m{constructor(){this._source=null,this._mapping=null,this._disabled=!0,this._ignoreInputs=this._disabled,this.adapters=new o,this.inputs={},this.listeners={change:[],attach:[],detach:[]},this.onSourceInput=this.onSourceInput.bind(this),this.onSourcePoll=this.onSourcePoll.bind(this)}get source(){return this._source}get mapping(){return this._mapping}get disabled(){return this._disabled}set disabled(t){this.toggle(!t)}setInputMapping(t){const e=this.disabled;this.disabled=!0;let s=this.source,n=this.inputs;s&&b(s,n),this.adapters.clear();let i=this.source,o={};if(t){for(let e in t){let s=t[e],i=n[e]||new p;i.hydrate(s);let r=i.adapters;this.adapters.add(r),o[e]=i}i&&f(i,o)}return this.inputs=o,this._mapping=t,this.dispatchChangeEvent(),this.disabled=!this.source||!this.inputs||e,this}attach(t){if(this.source)throw new Error("Already attached to existing input source.");if(!t)throw new Error("Missing input source to attach context.");return f(t,this.inputs),t.addEventListener("poll",this.onSourcePoll),t.addEventListener("input",this.onSourceInput),this._source=t,this.toggle(!0),this.dispatchAttachEvent(),this}detach(){let t=this.source,e=this.inputs;return t&&(this.toggle(!1),t.removeEventListener("poll",this.onSourcePoll),t.removeEventListener("input",this.onSourceInput),e&&b(t,e),this._source=null,this.dispatchDetachEvent()),this}addEventListener(t,e){t in this.listeners?this.listeners[t].unshift(e):this.listeners[t]=[e]}removeEventListener(t,e){if(t in this.listeners){let s=this.listeners[t],n=s.indexOf(e);s.splice(n,1)}}countEventListeners(t){if(!(t in this.listeners))throw new Error(`Cannot count listeners for unknown event '${t}'.`);return this.listeners[t].length}dispatchEvent(t,e){for(let s of this.listeners[t])s(e)}dispatchChangeEvent(){this.dispatchEvent("change",{})}dispatchAttachEvent(){this.dispatchEvent("attach",{})}dispatchDetachEvent(){this.dispatchEvent("detach",{})}onSourceInput(t){if(t.consumed||this._ignoreInputs){const{deviceName:e,keyCode:s,input:n}=t;this.adapters.reset(e,s,n)}else{const{stage:e,deviceName:s,keyCode:n,input:i}=t;switch(e){case u.POLL:this.adapters.poll(s,n,i);break;case u.UPDATE:this.adapters.update(s,n,i);break;default:throw new Error("Unknown input source stage.")}t.consumed=!0}}onSourcePoll(t){this._ignoreInputs!==this.disabled&&(this._ignoreInputs=this.disabled)}toggle(t=this._disabled){let e=!t;if(!e&&!this.source)throw new Error("Input source must be set before enabling input context.");return this._disabled=e,this}hasInput(t){return t in this.inputs&&this.inputs[t].adapters.length>0}getInput(t){if(t in this.inputs)return this.inputs[t];{let e=new p;return this.inputs[t]=e,this._mapping[t]="",this.dispatchChangeEvent(),e}}getInputState(t){return t in this.inputs?this.inputs[t].value:0}getInputChanged(t){if(t in this.inputs){let e=this.inputs[t];return e.value-e.prev}return 0}}function f(t,e){for(let s in e){let{adapters:n}=e[s];for(let e of n){const{deviceName:s,keyCode:n}=e;t.registerKey(s,n)}}}function b(t,e){for(let s in e){let{adapters:n}=e[s];for(let e of n){const{deviceName:s,keyCode:n}=e;t.unregisterKey(s,n)}}}class y extends i{static isAxis(t){return!1}static isButton(t){return!0}constructor(t,n={}){super("Keyboard",t);const{repeat:i=!1}=n;this.repeat=i,this._eventObject={target:t,deviceName:this.deviceName,keyCode:"",event:s.NULL,type:e.KEY,value:0,control:!1,shift:!1,alt:!1},this.onKeyDown=this.onKeyDown.bind(this),this.onKeyUp=this.onKeyUp.bind(this),t.addEventListener("keydown",this.onKeyDown),t.addEventListener("keyup",this.onKeyUp)}destroy(){let t=this.eventTarget;t.removeEventListener("keydown",this.onKeyDown),t.removeEventListener("keyup",this.onKeyUp),super.destroy()}onKeyDown(t){if(t.repeat)return t.preventDefault(),t.stopPropagation(),!1;let e=this._eventObject;return e.keyCode=t.code,e.event=s.DOWN,e.value=1,e.control=t.ctrlKey,e.shift=t.shiftKey,e.alt=t.altKey,this.dispatchInput(e)?(t.preventDefault(),t.stopPropagation(),!1):void 0}onKeyUp(t){let e=this._eventObject;if(e.keyCode=t.code,e.event=s.UP,e.value=1,e.control=t.ctrlKey,e.shift=t.shiftKey,e.alt=t.altKey,this.dispatchInput(e))return t.preventDefault(),t.stopPropagation(),!1}}class g extends i{static isAxis(t){return"PosX"===t||"PosY"===t||"WheelX"===t||"WheelY"===t||"WheelZ"===t}static isButton(t){return!this.isAxis(t)}constructor(t,n={eventsOnFocus:!0}){super("Mouse",t),this.canvasTarget=t instanceof HTMLCanvasElement&&t||t.canvas||t.querySelector("canvas")||t.shadowRoot&&t.shadowRoot.querySelector("canvas")||t,this.eventsOnFocus=n.eventsOnFocus,this._downHasFocus=!1,this._eventObject={target:t,deviceName:this.deviceName,keyCode:"",event:s.NULL,type:e.KEY,value:0,control:!1,shift:!1,alt:!1},this._positionObject={target:t,deviceName:this.deviceName,keyCode:"Position",event:s.MOVE,type:e.POS,x:0,y:0,dx:0,dy:0},this._wheelObject={target:t,deviceName:this.deviceName,keyCode:"Wheel",event:s.MOVE,type:e.WHEEL,dx:0,dy:0,dz:0},this.onMouseDown=this.onMouseDown.bind(this),this.onMouseUp=this.onMouseUp.bind(this),this.onMouseMove=this.onMouseMove.bind(this),this.onContextMenu=this.onContextMenu.bind(this),this.onWheel=this.onWheel.bind(this),t.addEventListener("mousedown",this.onMouseDown),t.addEventListener("contextmenu",this.onContextMenu),t.addEventListener("wheel",this.onWheel),document.addEventListener("mousemove",this.onMouseMove),document.addEventListener("mouseup",this.onMouseUp)}destroy(){let t=this.eventTarget;t.removeEventListener("mousedown",this.onMouseDown),t.removeEventListener("contextmenu",this.onContextMenu),t.removeEventListener("wheel",this.onWheel),document.removeEventListener("mousemove",this.onMouseMove),document.removeEventListener("mouseup",this.onMouseUp),super.destroy()}setPointerLock(t=!0){t?this.eventTarget.requestPointerLock():this.eventTarget.exitPointerLock()}hasPointerLock(){return document.pointerLockElement===this.eventTarget}onMouseDown(t){this._downHasFocus=!0;let e=this._eventObject;if(e.keyCode="Button"+t.button,e.event=s.DOWN,e.value=1,e.control=t.ctrlKey,e.shift=t.shiftKey,e.alt=t.altKey,this.dispatchInput(e)&&document.activeElement===this.eventTarget)return t.preventDefault(),t.stopPropagation(),!1}onContextMenu(t){return t.preventDefault(),t.stopPropagation(),!1}onWheel(t){let e=this._wheelObject;switch(t.deltaMode){case WheelEvent.DOM_DELTA_LINE:e.dx=10*t.deltaX,e.dy=10*t.deltaY,e.dz=10*t.deltaZ;break;case WheelEvent.DOM_DELTA_PAGE:e.dx=100*t.deltaX,e.dy=100*t.deltaY,e.dz=100*t.deltaZ;break;case WheelEvent.DOM_DELTA_PIXEL:default:e.dx=t.deltaX,e.dy=t.deltaY,e.dz=t.deltaZ}if(this.dispatchInput(e))return t.preventDefault(),t.stopPropagation(),!1}onMouseUp(t){if(!this._downHasFocus)return;this._downHasFocus=!1;let e=this._eventObject;return e.keyCode="Button"+t.button,e.event=s.UP,e.value=1,e.control=t.ctrlKey,e.shift=t.shiftKey,e.alt=t.altKey,this.dispatchInput(e)?(t.preventDefault(),t.stopPropagation(),!1):void 0}onMouseMove(t){if(this.eventsOnFocus&&document.activeElement!==this.eventTarget)return;const e=this.canvasTarget,{clientWidth:s,clientHeight:n}=e,i=e.getBoundingClientRect();let o=t.movementX/s,r=t.movementY/n,l=(t.clientX-i.left)/s,a=(t.clientY-i.top)/n,h=this._positionObject;h.x=l,h.y=a,h.dx=o,h.dy=r,this.dispatchInput(h)}}const E=Symbol("inputSourceState");class _ extends c{static for(t){if(t)return function(t){if(w(t)){let e=Object.getOwnPropertyDescriptor(t,E);return e.value.refs+=1,e.value.state}{let e=new c([new y(t),new g(t)]);return Object.defineProperty(t,E,{value:{state:e,refs:1},configurable:!0}),e}}(t);throw new Error("Cannot get input source for null event target.")}static delete(t){t&&function(t){if(w(t)){let e=Object.getOwnPropertyDescriptor(t,E);if(e.value.refs-=1,e.value.refs<=0){let s=e.value.state;delete t[E],s.destroy()}}}(t)}constructor(){throw super(),new Error("Cannot construct InputSource with new - use InputSourceState() instead.")}}function w(t){return Object.prototype.hasOwnProperty.call(t,E)&&Object.getOwnPropertyDescriptor(t,E).value}class S extends HTMLElement{static get[Symbol.for("cuttleTemplate")](){let t=document.createElement("template");return t.innerHTML='<div>\n    <label id="title">\n        input-source\n    </label>\n    <span>|</span>\n    <p>\n        <label for="poll">poll</label>\n        <output id="poll"></output>\n    </p>\n    <p>\n        <label for="focus">focus</label>\n        <output id="focus"></output>\n    </p>\n</div>\n',Object.defineProperty(this,Symbol.for("cuttleTemplate"),{value:t}),t}static get[Symbol.for("cuttleStyle")](){let t=document.createElement("style");return t.innerHTML=':host{display:inline-block}div{font-family:monospace;color:#666;outline:1px solid #666;padding:4px}p{display:inline;margin:0;padding:0}#focus:empty:after,#poll:empty:after{content:"✗";color:red}',Object.defineProperty(this,Symbol.for("cuttleStyle"),{value:t}),t}static get properties(){return{for:String,autopoll:Boolean}}get autopoll(){return this._autopoll}set autopoll(t){this.toggleAttribute("autopoll",t)}get for(){return this._for}set for(t){this.setAttribute("for",t)}static get customEvents(){return["input","poll"]}get onpoll(){return this._onpoll}set onpoll(t){this._onpoll&&this.removeEventListener("poll",this._onpoll),this._onpoll=t,this._onpoll&&this.addEventListener("poll",t)}get oninput(){return this._oninput}set oninput(t){this._oninput&&this.removeEventListener("input",this._oninput),this._oninput=t,this._oninput&&this.addEventListener("input",t)}constructor(){super(),this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(this.constructor[Symbol.for("cuttleTemplate")].content.cloneNode(!0)),this.shadowRoot.appendChild(this.constructor[Symbol.for("cuttleStyle")].cloneNode(!0)),this._containerElement=this.shadowRoot.querySelector("div"),this._titleElement=this.shadowRoot.querySelector("#title"),this._pollElement=this.shadowRoot.querySelector("#poll"),this._focusElement=this.shadowRoot.querySelector("#focus"),this._eventTarget=null,this._sourceState=null,this.onSourcePoll=this.onSourcePoll.bind(this),this.onSourceInput=this.onSourceInput.bind(this),this.onTargetFocus=this.onTargetFocus.bind(this),this.onTargetBlur=this.onTargetBlur.bind(this),this.onPollStatusCheck=this.onPollStatusCheck.bind(this),this._intervalHandle=0}get eventTarget(){return this._eventTarget}get source(){return this._sourceState}connectedCallback(){if(Object.prototype.hasOwnProperty.call(this,"oninput")){let t=this.oninput;delete this.oninput,this.oninput=t}if(Object.prototype.hasOwnProperty.call(this,"onpoll")){let t=this.onpoll;delete this.onpoll,this.onpoll=t}if(Object.prototype.hasOwnProperty.call(this,"for")){let t=this.for;delete this.for,this.for=t}if(Object.prototype.hasOwnProperty.call(this,"autopoll")){let t=this.autopoll;delete this.autopoll,this.autopoll=t}this.hasAttribute("tabindex")||this.setAttribute("tabindex",0),this.hasAttribute("for")||this._eventTarget||this.setEventTarget(this),this._intervalHandle=setInterval(this.onPollStatusCheck,1e3)}disconnectedCallback(){this.clearEventTarget(),clearInterval(this._intervalHandle)}attributeChangedCallback(t,e,s){switch(t){case"for":this._for=s;break;case"autopoll":this._autopoll=null!==s;break;case"oninput":this.oninput=new Function("event","with(document){with(this){"+s+"}}").bind(this);break;case"onpoll":this.onpoll=new Function("event","with(document){with(this){"+s+"}}").bind(this)}((t,e,s)=>{switch(t){case"for":{let t,e;s?(t=document.getElementById(s),e=`${t.tagName.toLowerCase()}#${s}`):(t=this,e="input-source"),this.setEventTarget(s?document.getElementById(s):this),this._titleElement.innerHTML=`for(${e})`}break;case"autopoll":this._sourceState&&(this._sourceState.autopoll=this._autopoll)}})(t,0,s)}setEventTarget(t){if(this.clearEventTarget(),t){let e=_.for(t);this._sourceState=e,this._eventTarget=t,e.autopoll=this.autopoll,e.addEventListener("poll",this.onSourcePoll),e.addEventListener("input",this.onSourceInput),t.addEventListener("focus",this.onTargetFocus),t.addEventListener("blur",this.onTargetBlur)}return this}clearEventTarget(){if(this._eventTarget){let t=this._eventTarget,e=this._sourceState;this._eventTarget=null,this._sourceState=null,t&&(t.removeEventListener("focus",this.onTargetFocus),t.removeEventListener("blur",this.onTargetBlur),e.removeEventListener("poll",this.onSourcePoll),e.removeEventListener("input",this.onSourceInput),_.delete(t))}}poll(t){this._sourceState.poll(t)}onPollStatusCheck(){this._sourceState&&this._sourceState.polling?this._pollElement.innerHTML="✓":this._pollElement.innerHTML=""}onSourceInput({stage:t,deviceName:e,keyCode:s,input:n}){this.dispatchEvent(new CustomEvent("input",{composed:!0,bubbles:!1,detail:{stage:t,deviceName:e,keyCode:s,input:n}}))}onSourcePoll({now:t}){this.dispatchEvent(new CustomEvent("poll",{composed:!0,bubbles:!1,detail:{now:t}}))}onTargetFocus(){this._focusElement.innerHTML="✓"}onTargetBlur(){this._focusElement.innerHTML=""}static get observedAttributes(){return["oninput","onpoll","for","autopoll"]}}window.customElements.define("input-source",S);class x extends HTMLElement{static get[Symbol.for("cuttleTemplate")](){let t=document.createElement("template");return t.innerHTML='<kbd>\n    <span id="key"><slot></slot></span>\n    <span id="value" class="hidden"></span>\n</kbd>\n',Object.defineProperty(this,Symbol.for("cuttleTemplate"),{value:t}),t}static get[Symbol.for("cuttleStyle")](){let t=document.createElement("style");return t.innerHTML='kbd{position:relative;display:inline-block;border-radius:3px;border:1px solid #888;font-size:.85em;font-weight:700;text-rendering:optimizeLegibility;line-height:12px;height:14px;padding:2px 4px;color:#444;background-color:#eee;box-shadow:inset 0 -3px 0 #aaa;overflow:hidden}kbd:empty:after{content:"<?>";opacity:.6}.disabled{opacity:.6;box-shadow:none;background-color:#aaa}.hidden{display:none}#value{position:absolute;top:0;bottom:0;right:0;font-size:.85em;padding:2px 4px 0;color:#ccc;background-color:#333;box-shadow:inset 0 3px 0 #222}',Object.defineProperty(this,Symbol.for("cuttleStyle"),{value:t}),t}static get properties(){return{name:String,value:String,disabled:Boolean}}get disabled(){return this._disabled}set disabled(t){this.toggleAttribute("disabled",t)}get value(){return this._value}set value(t){this.setAttribute("value",t)}get name(){return this._name}set name(t){this.setAttribute("name",t)}constructor(){super(),this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(this.constructor[Symbol.for("cuttleTemplate")].content.cloneNode(!0)),this.shadowRoot.appendChild(this.constructor[Symbol.for("cuttleStyle")].cloneNode(!0)),this._keyboardElement=this.shadowRoot.querySelector("kbd"),this._keyElement=this.shadowRoot.querySelector("#key"),this._valueElement=this.shadowRoot.querySelector("#value")}attributeChangedCallback(t,e,s){switch(t){case"name":this._name=s;break;case"value":this._value=s;break;case"disabled":this._disabled=null!==s}((t,e,s)=>{switch(t){case"name":this._keyElement.innerText=s;break;case"value":null!==s?(this._valueElement.classList.toggle("hidden",!1),this._valueElement.innerText=s,this._keyboardElement.style.paddingRight=`${this._valueElement.clientWidth+4}px`):this._valueElement.classList.toggle("hidden",!0);break;case"disabled":this._keyboardElement.classList.toggle("disabled",null!==s)}})(t,0,s)}connectedCallback(){if(Object.prototype.hasOwnProperty.call(this,"name")){let t=this.name;delete this.name,this.name=t}if(Object.prototype.hasOwnProperty.call(this,"value")){let t=this.value;delete this.value,this.value=t}if(Object.prototype.hasOwnProperty.call(this,"disabled")){let t=this.disabled;delete this.disabled,this.disabled=t}}static get observedAttributes(){return["name","value","disabled"]}}window.customElements.define("input-key",x);class L extends HTMLElement{static get[Symbol.for("cuttleTemplate")](){let t=document.createElement("template");return t.innerHTML='<table>\n    <thead>\n        <tr class="tableHeader">\n            <th colspan=4>\n                <slot></slot>\n            </th>\n        </tr>\n        <tr class="colHeader">\n            <th>name</th>\n            <th>key</th>\n            <th>mod</th>\n            <th>value</th>\n        </tr>\n    </thead>\n    <tbody>\n    </tbody>\n</table>\n',Object.defineProperty(this,Symbol.for("cuttleTemplate"),{value:t}),t}static get[Symbol.for("cuttleStyle")](){let t=document.createElement("style");return t.innerHTML=":host{display:block}table{border-collapse:collapse}table,td,th{border:1px solid #666}td,th{padding:5px 10px}td{text-align:center}thead th{padding:0}.colHeader>th{font-size:.8em;padding:0 10px;letter-spacing:3px;background-color:#aaa;color:#666}.colHeader>th,output{font-family:monospace}output{border-radius:.3em;padding:3px}tr:not(.primary) .name,tr:not(.primary) .value{opacity:.3}tr:nth-child(2n){background-color:#eee}",Object.defineProperty(this,Symbol.for("cuttleStyle"),{value:t}),t}static get customEvents(){return["load"]}get onload(){return this._onload}set onload(t){this._onload&&this.removeEventListener("load",this._onload),this._onload=t,this._onload&&this.addEventListener("load",t)}static get observedAttributes(){return["onload","src"]}constructor(){super(),this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(this.constructor[Symbol.for("cuttleTemplate")].content.cloneNode(!0)),this.shadowRoot.appendChild(this.constructor[Symbol.for("cuttleStyle")].cloneNode(!0)),this._src="",this._inputMap=null,this._tableElements={},this._titleElement=this.shadowRoot.querySelector("#title"),this._bodyElement=this.shadowRoot.querySelector("tbody"),this._children=this.shadowRoot.querySelector("slot")}get map(){return this._inputMap}get mapElements(){return this._tableElements}connectedCallback(){if(Object.prototype.hasOwnProperty.call(this,"onload")){let t=this.onload;delete this.onload,this.onload=t}!function(t,e){if(Object.prototype.hasOwnProperty.call(t,e)){let s=t[e];delete t[e],t[e]=s}}(this,"src")}attributeChangedCallback(t,e,s){switch(t){case"onload":this.onload=new Function("event","with(document){with(this){"+s+"}}").bind(this)}((t,e,s)=>{switch(t){case"src":if(this._src!==s)if(this._src=s,s.trim().startsWith("{")){let t=JSON.parse(s);this._setInputMap(t)}else fetch(s).then((t=>t.json())).then((t=>this._setInputMap(t)))}})(t,0,s)}get src(){return this.getAttribute("src")}set src(t){switch(typeof t){case"object":{let e=JSON.stringify(t);this._src=e,this._setInputMap(t),this.setAttribute("src",e)}break;case"string":this.setAttribute("src",t);break;default:this.setAttribute("src",JSON.stringify(t))}}_setInputMap(t){let e={},s=[];for(let n in t){let i=[];k(i,n,t[n]),e[n]=i,s.push(...i)}this._bodyElement.innerHTML="";for(let t of s)this._bodyElement.appendChild(t);this._inputMap=t,this._tableElements=e,this.dispatchEvent(new CustomEvent("load",{bubbles:!1,composed:!0,detail:{map:t}}))}}function k(t,e,s){if(Array.isArray(s)){k(t,e,s[0]);let n=s.length;for(let i=1;i<n;++i)t.push(C(e,s[i],!1))}else t.push(C(e,s,!0));return t}function C(t,e,s=!0){if("object"==typeof e){const{key:n,event:i,scale:o}=e;return T(t,n,i,o,0,s)}return T(t,e,null,1,0,s)}function T(t,e,s,n,i,o=!0){let r=document.createElement("tr");o&&r.classList.add("primary");{let e=document.createElement("td");e.textContent=t,e.classList.add("name"),r.appendChild(e)}{let t=document.createElement("td");t.classList.add("key");let s=new x;s.innerText=e,t.appendChild(s),r.appendChild(t)}{let t=document.createElement("td"),e=document.createElement("samp"),i=[];"string"==typeof s&&"null"!==s&&i.push(s),"number"==typeof n&&1!==n&&i.push(`×(${n.toFixed(2)})`),e.innerText=i.join(" "),t.classList.add("mod"),t.appendChild(e),r.appendChild(t)}{let t=document.createElement("td"),e=document.createElement("output");e.innerText=Number(i).toFixed(2),e.classList.add("value"),t.appendChild(e),r.appendChild(t)}return r}window.customElements.define("input-map",L);class P extends HTMLElement{static get[Symbol.for("cuttleTemplate")](){let t=document.createElement("template");return t.innerHTML="<input-map>\n    <slot></slot>\n    <input-source></input-source>\n</input-map>\n",Object.defineProperty(this,Symbol.for("cuttleTemplate"),{value:t}),t}static get[Symbol.for("cuttleStyle")](){let t=document.createElement("style");return t.innerHTML=":host{display:inline-block}",Object.defineProperty(this,Symbol.for("cuttleStyle"),{value:t}),t}static get properties(){return{for:String,autopoll:Boolean,disabled:Boolean}}get disabled(){return this._disabled}set disabled(t){this.toggleAttribute("disabled",t)}get autopoll(){return this._autopoll}set autopoll(t){this.toggleAttribute("autopoll",t)}get for(){return this._for}set for(t){this.setAttribute("for",t)}static get observedAttributes(){return["for","autopoll","disabled","src"]}constructor(t){super(),this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(this.constructor[Symbol.for("cuttleTemplate")].content.cloneNode(!0)),this.shadowRoot.appendChild(this.constructor[Symbol.for("cuttleStyle")].cloneNode(!0)),this._src="",this._mapElement=this.shadowRoot.querySelector("input-map"),this._sourceElement=this.shadowRoot.querySelector("input-source"),this._context=t||new m,this.onSourcePoll=this.onSourcePoll.bind(this),this.onContextChange=this.onContextChange.bind(this),this._sourceElement.addEventListener("poll",this.onSourcePoll),this._context.addEventListener("change",this.onContextChange)}get context(){return this._context}get source(){return this._sourceElement.source}get mapping(){return this._mapElement.map}get src(){return this._src}set src(t){this.setAttribute("src","string"==typeof t?t:JSON.stringify(t))}connectedCallback(){if(Object.prototype.hasOwnProperty.call(this,"for")){let t=this.for;delete this.for,this.for=t}if(Object.prototype.hasOwnProperty.call(this,"autopoll")){let t=this.autopoll;delete this.autopoll,this.autopoll=t}if(Object.prototype.hasOwnProperty.call(this,"disabled")){let t=this.disabled;delete this.disabled,this.disabled=t}!function(t,e){if(Object.prototype.hasOwnProperty.call(t,e)){let s=t[e];delete t[e],t[e]=s}}(this,"src")}attributeChangedCallback(t,e,s){switch(t){case"for":this._for=s;break;case"autopoll":this._autopoll=null!==s;break;case"disabled":this._disabled=null!==s}((t,e,s)=>{switch(t){case"for":{let t=document.getElementById(s);t instanceof S&&(t=t.eventTarget),this._sourceElement.setEventTarget(t),this._context.source&&this._context.detach(),this._context.attach(this._sourceElement.source),this._context.disabled=this._disabled}break;case"src":if(this._src!==s)if(this._src=s,s.trim().startsWith("{")){let t=JSON.parse(s);this.updateMapping(t)}else fetch(s).then((t=>t.json())).then((t=>this.updateMapping(t)));break;case"autopoll":this._sourceElement.autopoll=this._autopoll;break;case"disabled":this._context.source&&(this._context.disabled=this._disabled)}})(t,0,s)}updateMapping(t){this._context.setInputMapping(t),this._mapElement.src=t}onSourcePoll(){for(let[t,e]of Object.entries(this._mapElement.mapElements)){let s=this._context.getInputState(t);e[0].querySelector("output").innerText=Number(s).toFixed(2)}}onContextChange(){this._mapElement.src=this._context.mapping}}window.customElements.define("input-port",P),t.AdapterManager=o,t.InputContext=m,t.InputDevice=i,t.InputEventCode=s,t.InputKeyElement=x,t.InputMapElement=L,t.InputPort=P,t.InputSource=_,t.InputSourceElement=S,t.InputSourceEventStage=u,t.InputSourceState=c,t.InputType=e,t.Keyboard=y,t.Mouse=g,t.WILDCARD_DEVICE_MATCHER="*",t.WILDCARD_KEY_MATCHER=n,Object.defineProperty(t,"__esModule",{value:!0})}));
