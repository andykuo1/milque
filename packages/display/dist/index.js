!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).Display={})}(this,(function(e){"use strict";var t='<div class="container">\r\n    <label class="hidden" id="title">display-port</label>\r\n    <label class="hidden" id="fps">00</label>\r\n    <label class="hidden" id="dimension">0x0</label>\r\n    <canvas></canvas>\r\n    <slot></slot>\r\n</div>',i=":host{display:inline-block;color:#555}.container{display:flex;position:relative;width:100%;height:100%}canvas{background:#000;margin:auto;-ms-interpolation-mode:nearest-neighbor;image-rendering:-moz-crisp-edges;image-rendering:pixelated}label{font-family:monospace;color:currentColor;position:absolute}#title{left:.5rem;top:.5rem}#fps{right:.5rem;top:.5rem}#dimension{left:.5rem;bottom:.5rem}.hidden{display:none}:host([debug]) .container{outline:6px dashed rgba(0,0,0,.1);outline-offset:-4px;background-color:rgba(0,0,0,.1)}:host([mode=noscale]) canvas{margin:0;top:0;left:0}:host([mode=center]),:host([mode=fit]),:host([mode=stretch]){width:100%;height:100%}:host([full]){width:100vw!important;height:100vh!important}:host([disabled]){display:none}slot{display:flex;flex-direction:column;align-items:center;justify-content:center;position:absolute;width:100%;height:100%;top:0;left:0;pointer-events:none}::slotted(*){pointer-events:auto}";const s="noscale",n=Symbol("template"),o=Symbol("style");class h extends HTMLElement{static get[Symbol.for("cuttleTemplate")](){let e=document.createElement("template");return e.innerHTML=i,Object.defineProperty(this,Symbol.for("cuttleTemplate"),{value:e}),e}static get[Symbol.for("cuttleStyle")](){let e=document.createElement("style");return e.innerHTML={mode:"open"},Object.defineProperty(this,Symbol.for("cuttleStyle"),{value:e}),e}static get[n](){let e=document.createElement("template");return e.innerHTML=t,Object.defineProperty(this,n,{value:e}),e}static get[o](){let e=document.createElement("style");return e.innerHTML=i,Object.defineProperty(this,o,{value:e}),e}static get properties(){return{width:Number,height:Number,disabled:Boolean,debug:Boolean,mode:{type:String,value:"fit",observed:!1}}}get mode(){return this.getAttribute("mode")}set mode(e){this.setAttribute("mode",e)}get debug(){return this._debug}set debug(e){this.toggleAttribute("debug",e)}get disabled(){return this._disabled}set disabled(e){this.toggleAttribute("disabled",e)}get height(){return this._height}set height(e){this.setAttribute("height",String(e))}get width(){return this._width}set width(e){this.setAttribute("width",String(e))}static get customEvents(){return["frame"]}get onframe(){return this._onframe}set onframe(e){this._onframe&&this.removeEventListener("frame",this._onframe),this._onframe=e,this._onframe&&this.addEventListener("frame",e)}static get observedAttributes(){return["onframe","width","height","disabled","debug","id","class"]}constructor(){super(),t.attachShadow(),t.shadowRoot.appendChild(t.constructor[Symbol.for("cuttleTemplate")].content.cloneNode(!0)),t.shadowRoot.appendChild(t.constructor[Symbol.for("cuttleStyle")].cloneNode(!0)),this._canvasElement=this.shadowRoot.querySelector("canvas"),this._titleElement=this.shadowRoot.querySelector("#title"),this._fpsElement=this.shadowRoot.querySelector("#fps"),this._dimensionElement=this.shadowRoot.querySelector("#dimension"),this._animationRequestHandle=0,this._prevAnimationFrameTime=0,this._width=300,this._height=150,this._onframe=null,this.update=this.update.bind(this)}get canvas(){return this._canvasElement}connectedCallback(){if(Object.prototype.hasOwnProperty.call(this,"onframe")){let e=this.onframe;delete this.onframe,this.onframe=e}if(Object.prototype.hasOwnProperty.call(this,"width")){let e=this.width;delete this.width,this.width=e}if(Object.prototype.hasOwnProperty.call(this,"height")){let e=this.height;delete this.height,this.height=e}if(Object.prototype.hasOwnProperty.call(this,"disabled")){let e=this.disabled;delete this.disabled,this.disabled=e}if(Object.prototype.hasOwnProperty.call(this,"debug")){let e=this.debug;delete this.debug,this.debug=e}if(Object.prototype.hasOwnProperty.call(this,"mode")){let e=this.mode;delete this.mode,this.mode=e}this.hasAttribute("mode")||this.setAttribute("mode","fit"),this.hasAttribute("tabindex")||this.setAttribute("tabindex",0),this.updateCanvasSize(),this.resume()}disconnectedCallback(){this.pause()}attributeChangedCallback(e,t,i){switch(e){case"width":this._width=Number(i);break;case"height":this._height=Number(i);break;case"disabled":this._disabled=null!==i;break;case"debug":this._debug=null!==i;break;case"onframe":this.onframe=new Function("event","with(document){with(this){"+i+"}}").bind(this)}((e,t,i)=>{switch(e){case"disabled":i?(this.update(0),this.pause()):this.resume();break;case"id":case"class":this._titleElement.innerHTML=`display-port${this.className?"."+this.className:""}${this.hasAttribute("id")?"#"+this.getAttribute("id"):""}`;break;case"debug":this._titleElement.classList.toggle("hidden",i),this._fpsElement.classList.toggle("hidden",i),this._dimensionElement.classList.toggle("hidden",i)}})(e,0,i)}update(e){this._animationRequestHandle=requestAnimationFrame(this.update),this.updateCanvasSize();const t=e-this._prevAnimationFrameTime;if(this._prevAnimationFrameTime=e,this.debug){const e=t<=0?"--":String(Math.round(1e3/t)).padStart(2,"0");if(this._fpsElement.innerText!==e&&(this._fpsElement.innerText=e),this.mode===s){let e=`${this._width}x${this._height}`;this._dimensionElement.innerText!==e&&(this._dimensionElement.innerText=e)}else{let e=`${this._width}x${this._height}|${this.shadowRoot.host.clientWidth}x${this.shadowRoot.host.clientHeight}`;this._dimensionElement.innerText!==e&&(this._dimensionElement.innerText=e)}}this.dispatchEvent(new CustomEvent("frame",{detail:{now:e,prevTime:this._prevAnimationFrameTime,deltaTime:t,canvas:this._canvasElement},bubbles:!1,composed:!0}))}pause(){cancelAnimationFrame(this._animationRequestHandle)}resume(){this._animationRequestHandle=requestAnimationFrame(this.update)}updateCanvasSize(){let e=this.shadowRoot.host.getBoundingClientRect();const t=e.width,i=e.height;let n=this._canvasElement,o=this._width,h=this._height;const a=this.mode;if("stretch"===a)o=t,h=i;else if(a!==s){if(t<o||i<h||"fit"===a){let e=t/o,s=i/h;e<s?(o=t,h*=e):(o*=s,h=i)}}o=Math.floor(o),h=Math.floor(h),n.clientWidth===o&&n.clientHeight===h||(n.width=this._width,n.height=this._height,n.style=`width: ${o}px; height: ${h}px`,this.dispatchEvent(new CustomEvent("resize",{detail:{width:o,height:h},bubbles:!1,composed:!0})))}}window.customElements.define("display-port",h),e.DisplayPort=h,Object.defineProperty(e,"__esModule",{value:!0})}));
