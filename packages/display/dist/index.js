!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(((t="undefined"!=typeof globalThis?globalThis:t||self).milque=t.milque||{},t.milque.display={}))}(this,(function(t){"use strict";const e="noscale",n="fit",i="scale";class s extends HTMLElement{static get[Symbol.for("templateNode")](){let t=document.createElement("template");return t.innerHTML='<div class="container">\n    <label class="hidden" id="title">display-port</label>\n    <label class="hidden" id="fps">00</label>\n    <label class="hidden" id="dimension">0x0</label>\n    <div class="content">\n        <canvas>\n            Oh no! Your browser does not support canvas.\n        </canvas>\n        <slot id="inner"></slot>\n    </div>\n    <slot name="frame"></slot>\n</div>',Object.defineProperty(this,Symbol.for("templateNode"),{value:t}),t}static get[Symbol.for("styleNode")](){let t=document.createElement("style");return t.innerHTML=':host {\n    display: inline-block;\n    color: #555555;\n}\n\n.container {\n    display: flex;\n    position: relative;\n    width: 100%;\n    height: 100%;\n}\n\n.content {\n    position: relative;\n    margin: auto;\n}\n\n.content > * {\n    width: 100%;\n    height: 100%;\n}\n\ncanvas {\n    background: #000000;\n    image-rendering: pixelated;\n}\n\nlabel {\n    position: absolute;\n    font-family: monospace;\n    color: currentColor;\n}\n\n#inner {\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    justify-content: center;\n    position: absolute;\n    top: 0;\n    left: 0;\n    pointer-events: none;\n}\n\n#title {\n    left: 0.5rem;\n    top: 0.5rem;\n}\n\n#fps {\n    right: 0.5rem;\n    top: 0.5rem;\n}\n\n#dimension {\n    left: 0.5rem;\n    bottom: 0.5rem;\n}\n\n.hidden {\n    display: none;\n}\n\n:host([debug]) .container {\n    outline: 6px dashed rgba(0, 0, 0, 0.1);\n    outline-offset: -4px;\n    background-color: rgba(0, 0, 0, 0.1);\n}\n\n:host([mode="noscale"]) canvas {\n    margin: 0;\n    top: 0;\n    left: 0;\n}\n\n:host([mode="fit"]),\n:host([mode="scale"]),\n:host([mode="center"]),\n:host([mode="stretch"]) {\n    width: 100%;\n    height: 100%;\n}\n\n:host([full]) {\n    width: 100vw !important;\n    height: 100vh !important;\n}\n\n:host([disabled]) {\n    display: none;\n}\n\nslot {\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    justify-content: center;\n    position: absolute;\n    width: 100%;\n    height: 100%;\n    top: 0;\n    left: 0;\n    pointer-events: none;\n}\n\n::slotted(*) {\n    pointer-events: auto;\n}\n',Object.defineProperty(this,Symbol.for("styleNode"),{value:t}),t}static define(t=window.customElements){t.define("display-port",this)}static get observedAttributes(){return["debug","disabled","width","height","onframe","id","class"]}get mode(){return this.getAttribute("mode")}set mode(t){this.setAttribute("mode",t)}get debug(){return this._debug}set debug(t){this.toggleAttribute("debug",t)}get disabled(){return this._disabled}set disabled(t){this.toggleAttribute("disabled",t)}get width(){return this._width}set width(t){this.setAttribute("width",String(t))}get height(){return this._height}set height(t){this.setAttribute("height",String(t))}get onframe(){return this._onframe}set onframe(t){this._onframe&&this.removeEventListener("frame",this._onframe),this._onframe=t,this._onframe&&this.addEventListener("frame",t)}constructor(){super(),this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(this.constructor[Symbol.for("templateNode")].content.cloneNode(!0)),this.shadowRoot.appendChild(this.constructor[Symbol.for("styleNode")].cloneNode(!0)),this._canvasElement=this.shadowRoot.querySelector("canvas"),this._contentElement=this.shadowRoot.querySelector(".content"),this._innerElement=this.shadowRoot.querySelector("#inner"),this._titleElement=this.shadowRoot.querySelector("#title"),this._fpsElement=this.shadowRoot.querySelector("#fps"),this._dimensionElement=this.shadowRoot.querySelector("#dimension"),this._debug=!1,this._disabled=!1,this._width=300,this._height=150,this._onframe=void 0,this._animationRequestHandle=0,this._prevAnimationFrameTime=0,this.update=this.update.bind(this)}get canvas(){return this._canvasElement}connectedCallback(){o(this,"mode"),o(this,"debug"),o(this,"disabled"),o(this,"width"),o(this,"height"),o(this,"onframe"),this.hasAttribute("mode")||this.setAttribute("mode","fit"),this.hasAttribute("tabindex")||this.setAttribute("tabindex","0"),this.updateCanvasSize(),this.resume()}disconnectedCallback(){this.pause()}attributeChangedCallback(t,e,n){switch(t){case"debug":this._debug=null!==n;break;case"disabled":this._disabled=null!==n;break;case"width":this._width=Number(n);break;case"height":this._height=Number(n);break;case"onframe":this.onframe=new Function("event","with(document){with(this){"+n+"}}").bind(this)}switch(t){case"disabled":n?(this.update(0),this.pause()):this.resume();break;case"id":case"class":this._titleElement.innerHTML=`display-port${this.className?"."+this.className:""}${this.hasAttribute("id")?"#"+this.getAttribute("id"):""}`;break;case"debug":this._titleElement.classList.toggle("hidden",n),this._fpsElement.classList.toggle("hidden",n),this._dimensionElement.classList.toggle("hidden",n)}}pause(){cancelAnimationFrame(this._animationRequestHandle)}resume(){this._animationRequestHandle=requestAnimationFrame(this.update)}update(t){this._animationRequestHandle=requestAnimationFrame(this.update),this.updateCanvasSize();const n=t-this._prevAnimationFrameTime;if(this._prevAnimationFrameTime=t,this._debug){const t=n<=0?"--":String(Math.round(1e3/n)).padStart(2,"0");this._fpsElement.textContent!==t&&(this._fpsElement.textContent=t);if(this.mode===e){let t=`${this._width}x${this._height}`;this._dimensionElement.textContent!==t&&(this._dimensionElement.textContent=t)}else{let t=`${this._width}x${this._height}|${this.shadowRoot.host.clientWidth}x${this.shadowRoot.host.clientHeight}`;this._dimensionElement.textContent!==t&&(this._dimensionElement.textContent=t)}}this.dispatchEvent(new CustomEvent("frame",{detail:{now:t,prevTime:this._prevAnimationFrameTime,deltaTime:n,canvas:this._canvasElement},bubbles:!1,composed:!0}))}updateCanvasSize(){let t=this.shadowRoot.host.getBoundingClientRect();const s=t.width,o=t.height;let h=this._canvasElement,a=this._width,d=this._height;const l=this.mode;if("stretch"===l)a=s,d=o;else if(l!==e&&(s<a||o<d||l===n||l==i)){let t=s/a,e=o/d;t<e?(a=s,d*=t):(a*=e,d=o)}a=Math.floor(a),d=Math.floor(d);let r=.5*Math.min(a/this._width,d/this._height);if(this._innerElement.style.fontSize=`font-size: ${r}em`,h.clientWidth!==a||h.clientHeight!==d){l===i?(h.width=this._width,h.height=this._height):(h.width=a,h.height=d);let t=this._contentElement.style;t.width=`${a}px`,t.height=`${d}px`,l===n&&(this._width=a,this._height=d),this.dispatchEvent(new CustomEvent("resize",{detail:{width:a,height:d},bubbles:!1,composed:!0}))}}}function o(t,e){if(Object.prototype.hasOwnProperty.call(t,e)){let n=t[e];delete t[e],t[e]=n}}s.define(),t.DisplayPort=s,Object.defineProperty(t,"__esModule",{value:!0})}));
