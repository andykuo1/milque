class t extends HTMLElement{static currentTime(){return performance.now()}constructor(t=!0,e=!1){super(),this._controlled=e,this._connectedStart=t,this._animationFrameHandle=null,this.prevFrameTime=0,this.started=!1,this.paused=!1,this.deltaTimeFactor=.001,this.onWindowFocus=this.onWindowFocus.bind(this),this.onWindowBlur=this.onWindowBlur.bind(this)}setDeltaTimeFactor(t){return this.deltaTimeFactor=t,this}connectedCallback(){window.addEventListener("focus",this.onWindowFocus),window.addEventListener("blur",this.onWindowBlur),this._connectedStart&&this.start()}disconnectedCallback(){window.removeEventListener("focus",this.onWindowFocus),window.removeEventListener("blur",this.onWindowBlur),this.stop()}onWindowFocus(){this.started&&this.resume()}onWindowBlur(){this.started&&this.pause()}run(t){if(this._controlled)throw new Error("Cannot run controlled game loop; call step() instead.");if(!this.started)throw new Error("Must call start() before run().");this.animationFrameHandle=requestAnimationFrame(this.run),this.step(t)}step(e=t.currentTime()){if(!this.started)return;const s=(e-this.prevFrameTime)*this.deltaTimeFactor;this.prevFrameTime=e,this.paused||this.dispatchEvent(new CustomEvent("update",{detail:{dt:s},bubbles:!1,composed:!0}))}start(){if(this.started)throw new Error("Loop already started.");this.started=!0,this.prevFrameTime=t.currentTime(),this.dispatchEvent(new CustomEvent("start",{bubbles:!1,composed:!0})),this.controlled||this.run(this.prevFrameTime)}stop(){if(!this.started)throw new Error("Loop not yet started.");this.started=!1,this.dispatchEvent(new CustomEvent("stop",{bubbles:!1,composed:!0})),this._controlled||this.animationFrameHandle&&(cancelAnimationFrame(this.animationFrameHandle),this.animationFrameHandle=null)}pause(){this.paused||(this.paused=!0,this.dispatchEvent(new CustomEvent("pause",{bubbles:!1,composed:!0})))}resume(){this.pause&&(this.paused=!1,this.dispatchEvent(new CustomEvent("resume",{bubbles:!1,composed:!0})))}}window.customElements.define("game-loop",t);export{t as GameLoop};
