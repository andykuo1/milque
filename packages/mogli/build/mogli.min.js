!function(t,r){"object"==typeof exports&&"undefined"!=typeof module?r(exports):"function"==typeof define&&define.amd?define(["exports"],r):r((t=t||self).Mogli={})}(this,(function(t){"use strict";var r=1e-6,e="undefined"!=typeof Float32Array?Float32Array:Array;function n(){var t=new e(9);return e!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function o(t,r,e){var n=e[0],o=e[1];return t[0]=n*r[0],t[1]=n*r[1],t[2]=n*r[2],t[3]=o*r[3],t[4]=o*r[4],t[5]=o*r[5],t[6]=r[6],t[7]=r[7],t[8]=r[8],t}function i(t,r){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=r[0],t[7]=r[1],t[8]=1,t}function a(){var t=new e(16);return e!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function u(t,r,e){var n,o,i,a,u,c,s,f,l,h,d,A,y=e[0],p=e[1],m=e[2];return r===t?(t[12]=r[0]*y+r[4]*p+r[8]*m+r[12],t[13]=r[1]*y+r[5]*p+r[9]*m+r[13],t[14]=r[2]*y+r[6]*p+r[10]*m+r[14],t[15]=r[3]*y+r[7]*p+r[11]*m+r[15]):(n=r[0],o=r[1],i=r[2],a=r[3],u=r[4],c=r[5],s=r[6],f=r[7],l=r[8],h=r[9],d=r[10],A=r[11],t[0]=n,t[1]=o,t[2]=i,t[3]=a,t[4]=u,t[5]=c,t[6]=s,t[7]=f,t[8]=l,t[9]=h,t[10]=d,t[11]=A,t[12]=n*y+u*p+l*m+r[12],t[13]=o*y+c*p+h*m+r[13],t[14]=i*y+s*p+d*m+r[14],t[15]=a*y+f*p+A*m+r[15]),t}function c(t,r,e){var n=e[0],o=e[1],i=e[2];return t[0]=r[0]*n,t[1]=r[1]*n,t[2]=r[2]*n,t[3]=r[3]*n,t[4]=r[4]*o,t[5]=r[5]*o,t[6]=r[6]*o,t[7]=r[7]*o,t[8]=r[8]*i,t[9]=r[9]*i,t[10]=r[10]*i,t[11]=r[11]*i,t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15],t}function s(t,r){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=r[0],t[13]=r[1],t[14]=r[2],t[15]=1,t}function f(t,r){var e=Math.sin(r),n=Math.cos(r);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=n,t[6]=e,t[7]=0,t[8]=0,t[9]=-e,t[10]=n,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function l(t,r){var e=Math.sin(r),n=Math.cos(r);return t[0]=n,t[1]=0,t[2]=-e,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=e,t[9]=0,t[10]=n,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function h(){var t=new e(3);return e!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function d(t,r,n){var o=new e(3);return o[0]=t,o[1]=r,o[2]=n,o}function A(t,r){var e=r[0],n=r[1],o=r[2],i=e*e+n*n+o*o;return i>0&&(i=1/Math.sqrt(i)),t[0]=r[0]*i,t[1]=r[1]*i,t[2]=r[2]*i,t}function y(t,r){return t[0]*r[0]+t[1]*r[1]+t[2]*r[2]}function p(t,r,e){var n=r[0],o=r[1],i=r[2],a=e[0],u=e[1],c=e[2];return t[0]=o*c-i*u,t[1]=i*a-n*c,t[2]=n*u-o*a,t}function m(t,r,e){var n=r[0],o=r[1],i=r[2],a=e[3]*n+e[7]*o+e[11]*i+e[15];return a=a||1,t[0]=(e[0]*n+e[4]*o+e[8]*i+e[12])/a,t[1]=(e[1]*n+e[5]*o+e[9]*i+e[13])/a,t[2]=(e[2]*n+e[6]*o+e[10]*i+e[14])/a,t}function _(t,r,e){var n=r[0],o=r[1],i=r[2];return t[0]=n*e[0]+o*e[3]+i*e[6],t[1]=n*e[1]+o*e[4]+i*e[7],t[2]=n*e[2]+o*e[5]+i*e[8],t}function T(t,r,e){var n=e[0],o=e[1],i=e[2],a=e[3],u=r[0],c=r[1],s=r[2],f=o*s-i*c,l=i*u-n*s,h=n*c-o*u,d=o*h-i*l,A=i*f-n*h,y=n*l-o*f,p=2*a;return f*=p,l*=p,h*=p,d*=2,A*=2,y*=2,t[0]=u+f+d,t[1]=c+l+A,t[2]=s+h+y,t}Math.hypot||(Math.hypot=function(){for(var t=0,r=arguments.length;r--;)t+=arguments[r]*arguments[r];return Math.sqrt(t)});var b,E=function(t){var r=t[0],e=t[1],n=t[2];return Math.hypot(r,e,n)};b=h();!function(){var t,r=(t=new e(4),e!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t)}();function g(){var t=new e(4);return e!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function M(t,e,n,o){var i,a,u,c,s,f=e[0],l=e[1],h=e[2],d=e[3],A=n[0],y=n[1],p=n[2],m=n[3];return(a=f*A+l*y+h*p+d*m)<0&&(a=-a,A=-A,y=-y,p=-p,m=-m),1-a>r?(i=Math.acos(a),u=Math.sin(i),c=Math.sin((1-o)*i)/u,s=Math.sin(o*i)/u):(c=1-o,s=o),t[0]=c*f+s*A,t[1]=c*l+s*y,t[2]=c*h+s*p,t[3]=c*d+s*m,t}var v,S,R,F,I,x,z=function(t,r,e,n,o){return t[0]=r,t[1]=e,t[2]=n,t[3]=o,t},O=function(t,r){var e=r[0],n=r[1],o=r[2],i=r[3],a=e*e+n*n+o*o+i*i;return a>0&&(a=1/Math.sqrt(a)),t[0]=e*a,t[1]=n*a,t[2]=o*a,t[3]=i*a,t};v=h(),S=d(1,0,0),R=d(0,1,0),F=g(),I=g(),x=n();const U=d(0,0,0),B=d(1,0,0),w=d(0,1,0),P=d(0,0,1);function L(){return{translation:h(),rotation:g(),scale:d(1,1,1)}}function C(t,r=a()){return e=r,n=t.rotation,o=t.translation,i=t.scale,u=n[0],c=n[1],s=n[2],f=n[3],A=u*(l=u+u),y=u*(h=c+c),p=u*(d=s+s),m=c*h,_=c*d,T=s*d,b=f*l,E=f*h,g=f*d,M=i[0],v=i[1],S=i[2],e[0]=(1-(m+T))*M,e[1]=(y+g)*M,e[2]=(p-E)*M,e[3]=0,e[4]=(y-g)*v,e[5]=(1-(A+T))*v,e[6]=(_+b)*v,e[7]=0,e[8]=(p+E)*S,e[9]=(_-b)*S,e[10]=(1-(A+m))*S,e[11]=0,e[12]=o[0],e[13]=o[1],e[14]=o[2],e[15]=1,e;var e,n,o,i,u,c,s,f,l,h,d,A,y,p,m,_,T,b,E,g,M,v,S}var N=Object.freeze({__proto__:null,ORIGIN:U,XAXIS:B,YAXIS:w,ZAXIS:P,create:L,lookAt:function(t,r=U){const e=h();var n,o,i;n=e,o=r,i=t.position,n[0]=o[0]-i[0],n[1]=o[1]-i[1],n[2]=o[2]-i[2],A(e,e);const a=y(P,e);if(Math.abs(a- -1)<Number.EPSILON)return z(t.rotation,0,0,1,Math.PI),t;if(Math.abs(dot-1)<Number.EPSILON)return z(t.rotation,0,0,0,1),t;p(e,P,e),A(e,e);const u=Math.acos(a)/2,c=Math.sin(u);return t.rotation[0]=e[0]*c,t.rotation[1]=e[1]*c,t.rotation[2]=e[2]*c,t.rotation[3]=Math.cos(u),t},getTransformationMatrix:C,getForwardVector:function(t,r=h()){return T(r,P,t.rotation),r},getUpVector:function(t,r=h()){return T(r,w,t.rotation),r},getRightVector:function(t,r=h()){return T(r,B,t.rotation),r}});function D(t,r,e,n,o){if(!o){const r=Math.random(),e=Math.random(),n=Math.random();o=[];for(let i=0;i<t.length;i+=3)o.push(r,e,n)}return{position:t,texcoord:r,normal:e,indices:n,color:o,elementSize:3,elementCount:n.length}}function V(t,r,e,n){for(let o=0;o<n.color.length;o+=3)n.color[o+0]=t,n.color[o+1]=r,n.color[o+2]=e;return n}function j(t,r){const e=r.position,o=r.normal,i=n();var a,u,c,s,f,l,d,A,y,p,T,b,E,g,M,v,S,R,F,I,x,z,O,U,B,w,P,L,C,N,D;a=i,c=(u=t)[0],s=u[1],f=u[2],l=u[3],d=u[4],A=u[5],y=u[6],p=u[7],T=u[8],b=u[9],E=u[10],g=u[11],M=u[12],v=u[13],S=u[14],R=u[15],(D=(F=c*A-s*d)*(N=E*R-g*S)-(I=c*y-f*d)*(C=b*R-g*v)+(x=c*p-l*d)*(L=b*S-E*v)+(z=s*y-f*A)*(P=T*R-g*M)-(O=s*p-l*A)*(w=T*S-E*M)+(U=f*p-l*y)*(B=T*v-b*M))&&(D=1/D,a[0]=(A*N-y*C+p*L)*D,a[1]=(y*P-d*N-p*w)*D,a[2]=(d*C-A*P+p*B)*D,a[3]=(f*C-s*N-l*L)*D,a[4]=(c*N-f*P+l*w)*D,a[5]=(s*P-c*C-l*B)*D,a[6]=(v*U-S*O+R*z)*D,a[7]=(S*x-M*U-R*I)*D,a[8]=(M*O-v*x+R*F)*D);const V=h();for(let r=0;r<e.length;r+=3)V[0]=e[r+0],V[1]=e[r+1],V[2]=e[r+2],m(V,V,t),e[r+0]=V[0],e[r+1]=V[1],e[r+2]=V[2],V[0]=o[r+0],V[1]=o[r+1],V[2]=o[r+2],_(V,V,i),o[r+0]=V[0],o[r+1]=V[1],o[r+2]=V[2];return r}function G(...t){const r=[],e=[],n=[],o=[],i=[];let a=0;for(const u of t)r.push(...u.position),e.push(...u.texcoord),n.push(...u.normal),i.push(...u.color),o.push(...u.indices.map(t=>t+a)),a+=u.position.length/3;return D(r,e,n,o,i)}function Y(t=!1){let r;if(t){const t=.5,e=.5;r=[0-t,0-e,0,0+t,0-e,0,0-t,0+e,0,0+t,0+e,0]}else r=[0,0,0,1,0,0,0,1,0,1,1,0];return D(r,[0,0,1,0,0,1,1,1],[0,0,1,0,0,1,0,0,1,0,0,1],[0,1,2,2,1,3])}var X=Object.freeze({__proto__:null,create:Y});function k(t=!0){const r=Y(!0);if(t){const t=Y(!0);return j(l(a(),Math.PI),t),V(r.color[0],r.color[1],r.color[2],t),G(r,t)}return r}var W=Object.freeze({__proto__:null,create:k});function H(t=!0,r=!0,e=!0,n=!0,o=!0,i=!0){const c=Math.PI/2,h=a(),d=[];if(t){const t=k(!1);s(h,[0,0,.5]),j(h,t),d.push(t)}if(e){const t=k(!1);f(h,-c),u(h,h,[0,0,.5]),j(h,t),d.push(t)}if(r){const t=k(!1);l(h,Math.PI),u(h,h,[0,0,.5]),j(h,t),d.push(t)}if(n){const t=k(!1);f(h,c),u(h,h,[0,0,.5]),j(h,t),d.push(t)}if(o){const t=k(!1);l(h,-c),u(h,h,[0,0,.5]),j(h,t),d.push(t)}if(i){const t=k(!1);l(h,c),u(h,h,[0,0,.5]),j(h,t),d.push(t)}return G(...d)}var q=Object.freeze({__proto__:null,create:H});var Q=Object.freeze({__proto__:null,create:function(){const t=a(),r=H(!0,!0,!0,!0,!1,!0);s(t,[.1,.4,0]),c(t,t,[.4,.2,.2]),j(t,r),V(r.color[0],r.color[1],r.color[2],r);const e=H(!0,!0,!0,!0,!1,!0);var n,o;o=[.2,.2,.2],(n=t)[0]=o[0],n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=o[1],n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=o[2],n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,j(t,e),V(r.color[0],r.color[1],r.color[2],e);const i=H(!0,!0,!0,!0,!0,!0);return s(t,[-.2,0,0]),c(t,t,[.2,1,.2]),j(t,i),V(r.color[0],r.color[1],r.color[2],i),G(i,r,e)}}),Z=Object.freeze({__proto__:null,Quad:X,Plane:W,Cube:q,GlyphF:Q,create:D,applyColor:V,applyTransformation:j,joinGeometry:G});function $(t,r,e,n){if(!n){const r=Math.random(),e=Math.random(),o=Math.random();n=[];for(let i=0;i<t.length;i+=3)n.push(r,e,o)}return{position:t,texcoord:r,indices:e,color:n,elementSize:2,elementCount:e.length}}function K(t,r){const e=r.position,n=vec2.create();for(let r=0;r<e.length;r+=2)n[0]=e[r+0],n[1]=e[r+1],vec3.transformMat3(n,n,t),e[r+0]=n[0],e[r+1]=n[1];return r}function J(...t){const r=[],e=[],n=[],o=[];let i=0;for(const a of t){r.push(...a.position),e.push(...a.texcoord),o.push(...a.color);for(let t=0;t<a.indices.length;++t){const r=a.indices[t];n.push(r+i)}i+=a.position.length/2}return $(r,e,n,o)}function tt(t=!1){let r;if(t){const t=.5,e=.5;r=[0-t,0-e,0+t,0-e,0-t,0+e,0+t,0+e]}else r=[0,0,1,0,0,1,1,1];return $(r,[0,0,1,0,0,1,1,1],[0,1,2,2,1,3])}var rt=Object.freeze({__proto__:null,create:tt});var et=Object.freeze({__proto__:null,create:function(){const t=n(),r=tt();i(t,[.1,.4]),o(t,t,[.4,.2]),K(t,r),V(r.color[0],r.color[1],r.color[2],r);const e=tt();var a,u;u=[.2,.2],(a=t)[0]=u[0],a[1]=0,a[2]=0,a[3]=0,a[4]=u[1],a[5]=0,a[6]=0,a[7]=0,a[8]=1,K(t,e),V(r.color[0],r.color[1],r.color[2],e);const c=tt();return i(t,[-.2,0]),o(t,t,[.2,1]),K(t,c),V(r.color[0],r.color[1],r.color[2],c),J(c,r,e)}}),nt=Object.freeze({__proto__:null,Quad2D:rt,GlyphF2D:et,create:$,applyTransformation2D:K,joinGeometry2D:J,applyColor2D:V});function ot(t,r,e){const n=t.createShader(r);if(t.shaderSource(n,e),t.compileShader(n),!t.getShaderParameter(n,t.COMPILE_STATUS)){const r=t.getShaderInfoLog(n);throw t.deleteShader(n),new Error(r)}return n}function it(t,r,e,n=[]){const o=t.createProgram();t.attachShader(o,r),t.attachShader(o,e);for(let r=0;r<n.length;++r)t.bindAttribLocation(o,r,n[r]);if(t.linkProgram(o),!t.getProgramParameter(o,t.LINK_STATUS)){const r=t.getProgramInfoLog(o);throw t.deleteProgram(o),new Error(r)}return o}function at(t,r){const e={},n=t.getProgramParameter(r,t.ACTIVE_ATTRIBUTES);for(let o=0;o<n;++o){const n=t.getActiveAttrib(r,o);if(!n)break;const i=n.name,a=t.getAttribLocation(r,i);e[i]=ut(a)}return e}function ut(t){const r=function(t,r,e){r.enableVertexAttribArray(t),r.bindBuffer(r.ARRAY_BUFFER,e.handle),r.vertexAttribPointer(t,e.size,e.type,e.normalize,e.stride,e.offset)}.bind(null,t);return r.location=t,r}function ct(t,r){const e={},n={textureUnit:0},o=t.getProgramParameter(r,t.ACTIVE_UNIFORMS);for(let i=0;i<o;++i){const o=t.getActiveUniform(r,i);if(!o)break;let a=o.name;"[0]"===a.substring(a.length-3)&&(a=a.substring(0,a.length-3));const u=st(t,r,o,n);e[a]=u}return e}function st(t,r,e,n){const o=e.name,i=t.getUniformLocation(r,o),a=e.type,u=e.size>1&&"[0]"===o.substring(o.length-3),c=lt(t,a);if(!c)throw new Error(`Unknown uniform type 0x${a.toString(16)}.`);switch(a){case t.FLOAT:case t.INT:case t.BOOL:return c.setter(i,u);case t.SAMPLER_2D:case t.SAMPLER_CUBE:let r;if(u){r=[];for(let t=0;t<e.size;++t)r.push(n.textureUnit++)}else r=n.textureUnit++;return c.setter(i,u,r);default:return c.setter(i)}}let ft=null;function lt(t,r){if(ft)return ft[r];function e(t,r,e=!1,n=0){if(e&&!Array.isArray(n))throw new Error("Cannot create sampler array for non-array texture unit.");const o=(e?function(t,r,e,n,o){n.uniform1fv(t,r),o.forEach((t,o)=>{n.activeTexture(n.TEXTURE0+r[o]),n.bindTexture(e,t)})}:function(t,r,e,n,o){n.uniform1i(t,r),n.activeTexture(n.TEXTURE0+r),n.bindTexture(e,o)}).bind(null,r,n,t);return o.location=r,o}return(ft={[t.FLOAT]:{TypedArray:Float32Array,size:4,setter(t,r=!1){const e=(r?function(t,r,e){r.uniform1fv(t,e)}:function(t,r,e){r.uniform1f(t,e)}).bind(null,t);return e.location=t,e}},[t.FLOAT_VEC2]:{TypedArray:Float32Array,size:8,setter(t){const r=function(t,r,e){r.uniform2fv(t,e)}.bind(null,t);return r.location=t,r}},[t.FLOAT_VEC3]:{TypedArray:Float32Array,size:12,setter(t){const r=function(t,r,e){r.uniform3fv(t,e)}.bind(null,t);return r.location=t,r}},[t.FLOAT_VEC4]:{TypedArray:Float32Array,size:16,setter(t){const r=function(t,r,e){r.uniform4fv(t,e)}.bind(null,t);return r.location=t,r}},[t.INT]:{TypedArray:Int32Array,size:4,setter(t,r=!1){const e=(r?function(t,r,e){r.uniform1iv(t,e)}:function(t,r,e){r.uniform1i(t,e)}).bind(null,t);return e.location=t,e}},[t.INT_VEC2]:{TypedArray:Int32Array,size:8,setter(t){const r=function(t,r,e){r.uniform2iv(t,e)}.bind(null,t);return r.location=t,r}},[t.INT_VEC3]:{TypedArray:Int32Array,size:12,setter(t){const r=function(t,r,e){r.uniform3iv(t,e)}.bind(null,t);return r.location=t,r}},[t.INT_VEC4]:{TypedArray:Int32Array,size:16,setter(t){const r=function(t,r,e){r.uniform4iv(t,e)}.bind(null,t);return r.location=t,r}},[t.BOOL]:{TypedArray:Uint32Array,size:4,setter(t,r=!1){const e=(r?function(t,r,e){r.uniform1iv(t,e)}:function(t,r,e){r.uniform1i(t,e)}).bind(null,t);return e.location=t,e}},[t.BOOL_VEC2]:{TypedArray:Uint32Array,size:8,setter(t){const r=function(t,r,e){r.uniform2iv(t,e)}.bind(null,t);return r.location=t,r}},[t.BOOL_VEC3]:{TypedArray:Uint32Array,size:12,setter(t){const r=function(t,r,e){r.uniform3iv(t,e)}.bind(null,t);return r.location=t,r}},[t.BOOL_VEC4]:{TypedArray:Uint32Array,size:16,setter(t){const r=function(t,r,e){r.uniform4iv(t,e)}.bind(null,t);return r.location=t,r}},[t.FLOAT_MAT2]:{TypedArray:Float32Array,size:16,setter(t){const r=function(t,r,e){r.uniformMatrix2fv(t,!1,e)}.bind(null,t);return r.location=t,r}},[t.FLOAT_MAT3]:{TypedArray:Float32Array,size:36,setter(t){const r=function(t,r,e){r.uniformMatrix3fv(t,!1,e)}.bind(null,t);return r.location=t,r}},[t.FLOAT_MAT4]:{TypedArray:Float32Array,size:64,setter(t){const r=function(t,r,e){r.uniformMatrix4fv(t,!1,e)}.bind(null,t);return r.location=t,r}},[t.SAMPLER_2D]:{TypedArray:null,size:0,setter:e.bind(null,t.TEXTURE_2D)},[t.SAMPLER_CUBE]:{TypedArray:null,size:0,setter:e.bind(null,t.TEXTURE_CUBE)}})[r]}function ht(t,r,e,n,o=!1,i=0,a=0,u=t.ARRAY_BUFFER,c=t.STATIC_DRAW){const s=t.createBuffer(),f=At(t,r);if(!f)throw new Error(`Unknown uniform type 0x${r.toString(16)}.`);if(e instanceof f.TypedArray)t.bindBuffer(u,s),t.bufferData(u,e,c);else if(Array.isArray(e))e=new f.TypedArray(e),t.bindBuffer(u,s),t.bufferData(u,e,c);else{if("number"!=typeof e)throw new Error("Unknown buffer data type - can only be a TypedArray, an Array, or a number.");t.bindBuffer(u,s),t.bufferData(u,e,c)}return{handle:s,size:n,type:r,normalize:o,stride:i,offset:a,updateData(t,e,n=0,o=t.STATIC_DRAW){t.bindBuffer(t.ARRAY_BUFFER,this.handle);const i=At(t,r);e instanceof i.TypedArray||(e=new i.TypedArray(e)),n>0?t.bufferSubData(t.ARRAY_BUFFER,n,e):t.bufferData(t.ARRAY_BUFFER,e,o)}}}let dt=null;function At(t,r){return dt?dt[r]:(dt={[t.BYTE]:{TypedArray:Int8Array,size:1},[t.SHORT]:{TypedArray:Int16Array,size:2},[t.UNSIGNED_BYTE]:{TypedArray:Uint8Array,size:1},[t.UNSIGNED_SHORT]:{TypedArray:Uint16Array,size:2},[t.FLOAT]:{TypedArray:Float32Array,size:4}})[r]}t.Geometry=Z,t.Geometry2D=nt,t.SceneGraph=class{constructor(){this.root=this.createSceneNode(L(),null)}update(){this.root.updateWorldMatrix()}createSceneNode(t=L(),r=this.root){const e={sceneGraph:this,transform:t,localMatrix:a(),worldMatrix:a(),parent:null,children:[],setParent(t){if(this.parent){const t=this.parent.children.indexOf(this);this.parent.children.splice(t,1)}return t&&t.children.push(this),this.parent=r,this},updateWorldMatrix(t){var r,e,n,o,i,a,u,c,s,f,l,h,d,A,y,p,m,_,T,b,E,g,M;C(this.transform,this.localMatrix),t?(r=this.worldMatrix,e=t,n=this.localMatrix,o=e[0],i=e[1],a=e[2],u=e[3],c=e[4],s=e[5],f=e[6],l=e[7],h=e[8],d=e[9],A=e[10],y=e[11],p=e[12],m=e[13],_=e[14],T=e[15],b=n[0],E=n[1],g=n[2],M=n[3],r[0]=b*o+E*c+g*h+M*p,r[1]=b*i+E*s+g*d+M*m,r[2]=b*a+E*f+g*A+M*_,r[3]=b*u+E*l+g*y+M*T,b=n[4],E=n[5],g=n[6],M=n[7],r[4]=b*o+E*c+g*h+M*p,r[5]=b*i+E*s+g*d+M*m,r[6]=b*a+E*f+g*A+M*_,r[7]=b*u+E*l+g*y+M*T,b=n[8],E=n[9],g=n[10],M=n[11],r[8]=b*o+E*c+g*h+M*p,r[9]=b*i+E*s+g*d+M*m,r[10]=b*a+E*f+g*A+M*_,r[11]=b*u+E*l+g*y+M*T,b=n[12],E=n[13],g=n[14],M=n[15],r[12]=b*o+E*c+g*h+M*p,r[13]=b*i+E*s+g*d+M*m,r[14]=b*a+E*f+g*A+M*_,r[15]=b*u+E*l+g*y+M*T):function(t,r){t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t[8]=r[8],t[9]=r[9],t[10]=r[10],t[11]=r[11],t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15]}(this.worldMatrix,this.localMatrix);for(const t of this.children)t.updateWorldMatrix(this.worldMatrix)}};return r&&e.setParent(r),e}},t.Transform=N,t.createBufferInfo=ht,t.createDrawInfo=function(t,r,e,n=0,o=null){return{programInfo:t,vertexArrayInfo:r,uniforms:e,drawArrayOffset:n,drawMode:o}},t.createElementBufferInfo=function(t,r,e,n=0,o=0,i=t.STATIC_DRAW){return ht(t,r,e,1,!1,n,o,t.ELEMENT_ARRAY_BUFFER,i)},t.createShader=ot,t.createShaderProgram=it,t.createShaderProgramAttributeSetter=ut,t.createShaderProgramAttributeSetters=at,t.createShaderProgramInfo=function(t,r,e,n=[]){const o=ot(t,t.VERTEX_SHADER,r),i=ot(t,t.FRAGMENT_SHADER,e),a=it(t,o,i,n);return t.detachShader(a,o),t.detachShader(a,i),t.deleteShader(o),t.deleteShader(i),{handle:a,_gl:t,uniforms:ct(t,a),attributes:at(t,a),uniform(t,r){return t in this.uniforms&&this.uniforms[t](this._gl,r),this},attribute(t,r){return t in this.attributes&&this.attributes[t](this._gl,r),this},elementAttribute(t){return this._gl.bindBuffer(this._gl.ELEMENT_ARRAY_BUFFER,t),this}}},t.createShaderProgramUniformSetter=st,t.createShaderProgramUniformSetters=ct,t.createTextureInfo=function(t){return{handle:t.createTexture()}},t.createVertexArrayInfo=function(t,r=[]){const e=t.createVertexArray(),n={};for(let t=0;t<r.length;++t)n[r[t]]={location:t,setter:ut(t)};return{handle:e,attributes:n,_gl:t,elementBuffer:null,elementType:null,elementCount:0,attributeBuffers:{},setElementCount(t){return this.elementCount=t,this},elementAttribute(t){this._gl.bindBuffer(this._gl.ELEMENT_ARRAY_BUFFER,t.handle);const r=At(this._gl,t.type);return this.elementCount=this._gl.getBufferParameter(this._gl.ELEMENT_ARRAY_BUFFER,this._gl.BUFFER_SIZE)/r.size,this.elementBuffer=t,this.elementType=t.type,this},sharedAttribute(t,r){return t in this.attributes&&this.attributes[t].setter(this._gl,r),this.attributeBuffers[t]=r,this},programAttribute(t,r,...e){for(const n of e)n.attribute(t,r);return this.attributeBuffers[t]=r,this}}},t.draw=function(t,r,e={}){for(const n of r){const r=n.programInfo,o=n.vertexArrayInfo,i=n.uniforms,a=n.drawArrayOffset,u=n.drawMode||t.TRIANGLES;t.useProgram(r.handle),t.bindVertexArray(o.handle);for(const[t,n]of Object.entries(e))r.uniform(t,n);for(const[t,e]of Object.entries(i))r.uniform(t,e);o.elementBuffer?t.drawElements(u,o.elementCount,o.elementType,a*o.elementBuffer.size):t.drawArrays(u,a,o.elementCount)}},t.getBufferTypeInfo=At,t.getUniformTypeInfo=lt,Object.defineProperty(t,"__esModule",{value:!0})}));
