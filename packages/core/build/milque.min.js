!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t=t||self).Milque={})}(this,(function(t){"use strict";var e=Object.freeze({__proto__:null,get Display(){return Ot},get Audio(){return jt},get Input(){return Nt},get Random(){return Bt},get Utils(){return Mt},get default(){return e},get MODE_NOSCALE(){return p},get MODE_CENTER(){return m},get MODE_FIT(){return g},get MODE_STRETCH(){return _},get DisplayPort(){return E},get EventKey(){return x},get MIN_CONTEXT_PRIORITY(){return A},get MAX_CONTEXT_PRIORITY(){return I},get createContext(){return O},get createSource(){return D},get AbstractInputAdapter(){return k},get ActionInputAdapter(){return M},get DOUBLE_ACTION_TIME(){return H},get DoubleActionInputAdapter(){return P},get RangeInputAdapter(){return T},get StateInputAdapter(){return S},get Keyboard(){return j},get Mouse(){return R},get RandomGenerator(){return L},get SimpleRandomGenerator(){return F},get Eventable(){return z},get View(){return W},get ViewHelper(){return X},get ViewPort(){return Y},get AbstractCamera(){return G},get DEFAULT_FRAME_TIME(){return Q},get GameLoop(){return Z},get QueryOperator(){return lt},get ComponentFactory(){return ft},get Component(){return tt},get Entity(){return wt},get EntityWorld(){return at},get EntityQuery(){return rt},get ComponentBase(){return yt},get TagComponent(){return pt},get EntityComponent(){return mt},get EntityBase(){return gt},get HybridEntity(){return _t}});function n(t){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function i(t,e,n){return e&&o(t.prototype,e),n&&o(t,n),t}function a(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&l(t,e)}function u(t){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function l(t,e){return(l=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function c(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}function h(t,e,n){return(h=c()?Reflect.construct:function(t,e,n){var r=[null];r.push.apply(r,e);var o=new(Function.bind.apply(t,r));return n&&l(o,n.prototype),o}).apply(null,arguments)}function d(t){var e="function"==typeof Map?new Map:void 0;return(d=function(t){if(null===t||(n=t,-1===Function.toString.call(n).indexOf("[native code]")))return t;var n;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,r)}function r(){return h(t,arguments,u(this).constructor)}return r.prototype=Object.create(t.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),l(r,t)})(t)}function f(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function v(t,e){return!e||"object"!=typeof e&&"function"!=typeof e?f(t):e}function y(t){return function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var p="noscale",m="center",g="fit",_="stretch",w=m,b='\n<style>\n    :host {\n        display: inline-block;\n        color: #555555;\n    }\n    div {\n        display: flex;\n        position: relative;\n        width: 100%;\n        height: 100%;\n    }\n    canvas {\n        background: #000000;\n        margin: auto;\n    }\n    label {\n        font-family: monospace;\n        color: currentColor;\n        position: absolute;\n    }\n    #title {\n        left: 0.5rem;\n        top: 0.5rem;\n    }\n    #fps {\n        right: 0.5rem;\n        top: 0.5rem;\n    }\n    #dimension {\n        left: 0.5rem;\n        bottom: 0.5rem;\n    }\n    .hidden {\n        display: none;\n    }\n    :host([debug]) div {\n        outline: 8px dashed rgba(0, 0, 0, 0.4);\n        outline-offset: -4px;\n        background-color: rgba(0, 0, 0, 0.1);\n    }\n    :host([mode="'.concat(p,'"]) canvas {\n        margin: 0;\n        top: 0;\n        left: 0;\n    }\n    :host([mode="').concat(g,'"]), :host([mode="').concat(m,'"]), :host([mode="').concat(_,'"]) {\n        width: 100%;\n        height: 100%;\n    }\n    :host([full]) {\n        width: 100vw!important;\n        height: 100vh!important;\n    }\n    :host([disabled]) {\n        display: none;\n    }\n</style>'),E=function(t){function e(){var t;return r(this,e),(t=v(this,u(e).call(this))).attachShadow({mode:"open"}),t.shadowRoot.innerHTML="<div>".concat(b).concat('\n<label class="hidden" id="title">display-port</label>\n<label class="hidden" id="fps">00</label>\n<label class="hidden" id="dimension">0x0</label>\n<canvas></canvas>',"</div>"),t._canvasElement=t.shadowRoot.querySelector("canvas"),t._canvasContext=t._canvasElement.getContext("2d"),t._canvasContext.imageSmoothingEnabled=!1,t._titleElement=t.shadowRoot.querySelector("#title"),t._fpsElement=t.shadowRoot.querySelector("#fps"),t._dimensionElement=t.shadowRoot.querySelector("#dimension"),t._animationRequestHandle=0,t._prevAnimationFrameTime=0,t._width=640,t._height=480,t.update=t.update.bind(f(t)),t}return s(e,t),i(e,null,[{key:"observedAttributes",get:function(){return["width","height","disabled","debug","id","class"]}}]),i(e,[{key:"connectedCallback",value:function(){this.hasAttribute("mode")||(this.mode=w),this.updateCanvasSize(),this.resume()}},{key:"disconnectedCallback",value:function(){this.pause()}},{key:"attributeChangedCallback",value:function(t,e,n){switch(t){case"width":this._width=n;break;case"height":this._height=n;break;case"disabled":n?(this.update(0),this.pause()):this.resume();break;case"id":case"class":this._titleElement.innerHTML="display-port".concat(this.className?"."+this.className:"").concat(this.hasAttribute("id")?"#"+this.getAttribute("id"):"");break;case"debug":this._titleElement.classList.toggle("hidden",n),this._fpsElement.classList.toggle("hidden",n),this._dimensionElement.classList.toggle("hidden",n)}}},{key:"update",value:function(t){if(this._animationRequestHandle=requestAnimationFrame(this.update),this.updateCanvasSize(),this.debug){var e=t-this._prevAnimationFrameTime,n=e<=0?"--":String(Math.round(1e3/e)).padStart(2,"0");if(this._prevAnimationFrameTime=t,this._fpsElement.innerText!==n&&(this._fpsElement.innerText=n),this.mode===p){var r="".concat(this._width,"x").concat(this._height);this._dimensionElement.innerText!==r&&(this._dimensionElement.innerText=r)}else{var o="".concat(this._width,"x").concat(this._height,"|").concat(this.shadowRoot.host.clientWidth,"x").concat(this.shadowRoot.host.clientHeight);this._dimensionElement.innerText!==o&&(this._dimensionElement.innerText=o)}}this.dispatchEvent(new CustomEvent("frame",{detail:{now:t,context:this._canvasContext},bubbles:!1,composed:!0}))}},{key:"pause",value:function(){cancelAnimationFrame(this._animationRequestHandle)}},{key:"resume",value:function(){this._animationRequestHandle=requestAnimationFrame(this.update)}},{key:"updateCanvasSize",value:function(){var t=this.shadowRoot.host.getBoundingClientRect(),e=t.width,n=t.height,r=this._canvasElement,o=this._width,i=this._height,a=this.mode;if(a===_)o=e,i=n;else if(a!==p){if(e<o||n<i||a===g){var s=e/o,u=n/i;s<u?(o=e,i*=s):(o*=u,i=n)}}o=Math.floor(o),i=Math.floor(i),r.width===o&&r.height===i||(r.width=o,r.height=i,r.style="width: ".concat(o,"px; height: ").concat(i,"px"),this.dispatchEvent(new CustomEvent("resize",{detail:{width:o,height:i},bubbles:!1,composed:!0})))}},{key:"getCanvas",value:function(){return this._canvasElement}},{key:"getContext",value:function(){return this._canvasContext}},{key:"width",get:function(){return this._width},set:function(t){this.setAttribute("width",t)}},{key:"height",get:function(){return this._height},set:function(t){this.setAttribute("height",t)}},{key:"mode",get:function(){return this.getAttribute("mode")},set:function(t){this.setAttribute("mode",t)}},{key:"disabled",get:function(){return this.hasAttribute("disabled")},set:function(t){t?this.setAttribute("disabled",""):this.removeAttribute("disabled")}},{key:"debug",get:function(){return this.hasAttribute("debug")},set:function(t){t?this.setAttribute("debug",""):this.removeAttribute("debug")}}]),e}(d(HTMLElement));window.customElements.define("display-port",E);var C=Symbol("any"),x=function(){function t(e,n,o){r(this,t),this.source=e,this.code=n,this.mode=o,this.string="".concat(this.source.toString(),"[").concat(this.code.toString(),"].").concat(this.mode.toString())}return i(t,null,[{key:"parse",value:function(e){var n=e.indexOf("["),r=e.indexOf("]"),o=e.indexOf(".");return new t(n<=0||0===o?C:e.substring(0,n),n<0||r<0||n+1===r?C:e.substring(n+1,r),o<0||e.trim().endsWith(".")?C:e.substring(o+1))}}]),i(t,[{key:"matches",value:function(t){return!(this.source!==C&&t.source!==C&&this.source!==t.source||this.code!==C&&t.code!==C&&this.code!==t.code||this.mode!==C&&t.mode!==C&&this.mode!==t.mode)}},{key:"toString",value:function(){return this.string}}]),t}();x.ANY=C;var k=function(){function t(e){r(this,t),this.prev=e,this.value=e,this.next=e}return i(t,[{key:"update",value:function(t,e){return!1}},{key:"consume",value:function(){return this.next}},{key:"poll",value:function(){return this.prev=this.value,this.value=this.next,this.next=this.consume(),this}}]),t}(),M=function(t){function e(t){var n;r(this,e),(n=v(this,u(e).call(this,!1))).eventKeys=[];var o=!0,i=!1,a=void 0;try{for(var s,l=t[Symbol.iterator]();!(o=(s=l.next()).done);o=!0){var c=s.value;n.eventKeys.push(x.parse(c))}}catch(t){i=!0,a=t}finally{try{o||null==l.return||l.return()}finally{if(i)throw a}}return n}return s(e,t),i(e,[{key:"consume",value:function(){return!1}},{key:"update",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=!0,r=!1,o=void 0;try{for(var i,a=this.eventKeys[Symbol.iterator]();!(n=(i=a.next()).done);n=!0){var s=i.value;if(s.matches(t))return this.next=e,!0}}catch(t){r=!0,o=t}finally{try{n||null==a.return||a.return()}finally{if(r)throw o}}return!1}}]),e}(k),T=function(t){function e(t){var n;return r(this,e),(n=v(this,u(e).call(this,0))).eventKey=x.parse(t),n}return s(e,t),i(e,[{key:"consume",value:function(){switch(this.eventKey.string){case"mouse[pos].dx":case"mouse[pos].dy":return 0;case"mouse[pos].x":case"mouse[pos].y":default:return this.next}}},{key:"update",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return!!this.eventKey.matches(t)&&(this.next=e,!0)}}]),e}(k),S=function(t){function e(t){var n;r(this,e),(n=v(this,u(e).call(this,0))).eventKeyEntries=[];for(var o=0,i=Object.keys(t);o<i.length;o++){var a=i[o];n.eventKeyEntries.push({key:x.parse(a),value:t[a]})}return n}return s(e,t),i(e,[{key:"update",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(e){var n=!0,r=!1,o=void 0;try{for(var i,a=this.eventKeyEntries[Symbol.iterator]();!(n=(i=a.next()).done);n=!0){var s=i.value;if(s.key.matches(t))return this.next=s.value,!0}}catch(t){r=!0,o=t}finally{try{n||null==a.return||a.return()}finally{if(r)throw o}}}return!1}}]),e}(k),A=-100,I=100;function O(){return{_source:null,_priority:0,_active:!0,inputs:new Map,get active(){return this._active},get source(){return this._source},get priority(){return this._priority},attach:function(t){return this._source=t,this._source.addContext(this),this},detach:function(){return this._source.removeContext(this),this._source=null,this},setPriority:function(t){if(t>I||t<A)throw new Error("Context priority must be between [".concat(A,", ").concat(I,"]."));return this._priority!==t&&(this._source?(this._source.removeContext(this),this._priority=t,this._source.addContext(this)):this._priority=t),this},registerInput:function(t,e){return this.inputs.set(t,e),e},registerAction:function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return this.registerInput(t,new M(n))},registerRange:function(t,e){return this.registerInput(t,new T(e))},registerState:function(t,e){return this.registerInput(t,new S(e))},toggle:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;return void 0===t&&(t=!this._active),this._active=t,this},enable:function(){return this.toggle(!0)},disable:function(){return this.toggle(!1)},poll:function(){var t=!0,e=!1,n=void 0;try{for(var r,o=this.inputs.values()[Symbol.iterator]();!(t=(r=o.next()).done);t=!0){r.value.poll()}}catch(t){e=!0,n=t}finally{try{t||null==o.return||o.return()}finally{if(e)throw n}}},update:function(t,e){var n,r=!0,o=!1,i=void 0;try{for(var a,s=this.inputs.values()[Symbol.iterator]();!(r=(a=s.next()).done);r=!0){n|=a.value.update(t,e)}}catch(t){o=!0,i=t}finally{try{r||null==s.return||s.return()}finally{if(o)throw i}}return n}}}var R=function(){function t(){r(this,t),this.sourceElement=null,this.eventHandler=null,this.onMouseDown=this.onMouseDown.bind(this),this.onMouseUp=this.onMouseUp.bind(this),this.onMouseMove=this.onMouseMove.bind(this)}return i(t,[{key:"attach",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:document;return this.sourceElement=t,this.sourceElement.addEventListener("mousedown",this.onMouseDown),this.sourceElement.addEventListener("mouseup",this.onMouseUp),this.sourceElement.addEventListener("contextmenu",this.onContextMenu),document.addEventListener("mousemove",this.onMouseMove),this}},{key:"detach",value:function(){return this.sourceElement.removeEventListener("mousedown",this.onMouseDown),this.sourceElement.removeEventListener("mouseup",this.onMouseUp),this.sourceElement.removeEventListener("contextmenu",this.onContextMenu),document.removeEventListener("mousemove",this.onMouseMove),this.sourceElement=null,this}},{key:"setEventHandler",value:function(t){return this.eventHandler=t,this}},{key:"onMouseDown",value:function(t){this.eventHandler&&(this.eventHandler.call(this,"mouse[".concat(t.button,"].down"),!0)&&(t.preventDefault(),t.stopPropagation()))}},{key:"onMouseUp",value:function(t){this.eventHandler&&(t.preventDefault(),t.stopPropagation(),this.eventHandler.call(this,"mouse[".concat(t.button,"].up"),!0))}},{key:"onMouseMove",value:function(t){if(this.eventHandler){var e=this.sourceElement,n=e.clientWidth,r=e.clientHeight;this.eventHandler.call(this,"mouse[pos].x",(t.pageX-e.offsetLeft)/n),this.eventHandler.call(this,"mouse[pos].y",(t.pageY-e.offsetTop)/r),this.eventHandler.call(this,"mouse[pos].dx",t.movementX/n),this.eventHandler.call(this,"mouse[pos].dy",t.movementY/r)}}},{key:"onContextMenu",value:function(t){t.preventDefault(),t.stopPropagation()}}]),t}(),j=function(){function t(){r(this,t),this.sourceElement=null,this.eventHandler=null,this.onKeyDown=this.onKeyDown.bind(this),this.onKeyUp=this.onKeyUp.bind(this)}return i(t,[{key:"attach",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:document;return this.sourceElement=t,this.sourceElement.addEventListener("keydown",this.onKeyDown),this.sourceElement.addEventListener("keyup",this.onKeyUp),this}},{key:"detach",value:function(){return this.sourceElement.removeEventListener("keydown",this.onKeyDown),this.sourceElement.removeEventListener("keyup",this.onKeyUp),this.sourceElement=null,this}},{key:"setEventHandler",value:function(t){return this.eventHandler=t,this}},{key:"onKeyDown",value:function(t){this.eventHandler&&((t.repeat?this.eventHandler.call(this,"key[".concat(t.key,"].repeat"),!0):this.eventHandler.call(this,"key[".concat(t.key,"].down"),!0))&&(t.preventDefault(),t.stopPropagation()))}},{key:"onKeyUp",value:function(t){this.eventHandler&&(this.eventHandler.call(this,"key[".concat(t.key,"].up"),!0)&&(t.preventDefault(),t.stopPropagation()))}}]),t}();function D(){var t={_contexts:new Array(I-A),element:null,keyboard:new j,mouse:new R,attach:function(t){return this.element=t,this.keyboard.attach(),this.mouse.attach(t),this},detach:function(){return this.element=null,this.keyboard.detach(),this.mouse.detach(),this},addContext:function(t){var e=t.priority-A;return this._contexts[e]||(this._contexts[e]=[]),this._contexts[e].push(t),this},removeContext:function(t){var e=t.priority-A,n=this._contexts[e];return n&&n.splice(n.indexOf(t),1),this},poll:function(){var t=!0,e=!1,n=void 0;try{for(var r,o=this._contexts[Symbol.iterator]();!(t=(r=o.next()).done);t=!0){var i=r.value;if(i){var a=!0,s=!1,u=void 0;try{for(var l,c=i[Symbol.iterator]();!(a=(l=c.next()).done);a=!0){var h=l.value;h.active&&h.poll()}}catch(t){s=!0,u=t}finally{try{a||null==c.return||c.return()}finally{if(s)throw u}}}}}catch(t){e=!0,n=t}finally{try{t||null==o.return||o.return()}finally{if(e)throw n}}},handleEvent:function(t,e){var n=x.parse(t),r=!0,o=!1,i=void 0;try{for(var a,s=this._contexts[Symbol.iterator]();!(r=(a=s.next()).done);r=!0){var u=a.value;if(u){var l=!0,c=!1,h=void 0;try{for(var d,f=u[Symbol.iterator]();!(l=(d=f.next()).done);l=!0){var v=d.value;if(v.active){if(v.update(n,e))return!0}}}catch(t){c=!0,h=t}finally{try{l||null==f.return||f.return()}finally{if(c)throw h}}}}}catch(t){o=!0,i=t}finally{try{r||null==s.return||s.return()}finally{if(o)throw i}}return!1}};return t.handleEvent=t.handleEvent.bind(t),t.keyboard.setEventHandler(t.handleEvent),t.mouse.setEventHandler(t.handleEvent),t}var H=300,P=function(t){function e(t){var n;return r(this,e),(n=v(this,u(e).call(this,t))).actionTime=0,n}return s(e,t),i(e,[{key:"update",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=Date.now(),r=!0,o=!1,i=void 0;try{for(var a,s=this.eventKeys[Symbol.iterator]();!(r=(a=s.next()).done);r=!0){var u=a.value;if(u.matches(t))return e?n-this.actionTime<=H?(this.actionTime=0,this.next=!0,!0):(this.actionTime=n,!1):(this.next=!1,!0)}}catch(t){o=!0,i=t}finally{try{r||null==s.return||s.return()}finally{if(o)throw i}}return!1}}]),e}(M),L=function(){function t(e){r(this,t),this._seed=e}return i(t,[{key:"random",value:function(){return Math.random()}},{key:"randomRange",value:function(t,e){return this.random()*(e-t)+t}},{key:"randomChoose",value:function(t){return t[Math.floor(this.random()*t.length)]}},{key:"randomSign",value:function(){return this.random()<.5?-1:1}},{key:"seed",get:function(){return this._seed}}]),t}(),F=function(t){function e(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return r(this,e),(t=v(this,u(e).call(this,Math.abs(n%2147483647))))._next=t.seed,t}return s(e,t),i(e,[{key:"random",value:function(){return this._next=Math.abs(16807*this._next%2147483647-1),this._next/2147483646}}]),e}(L),N={on:function(t,e){var n,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e;if(this.__events.has(t)?n=this.__events.get(t):(n=new Map,this.__events.set(t,n)),n.has(r))throw new Error("Found callback for event '".concat(t,"' with the same handle '").concat(r,"'."));return n.set(r,e),this},off:function(t,e){if(!this.__events.has(t))throw new Error("Unable to find event '".concat(t,"'."));var n=this.__events.get(t);if(!n.has(e))throw new Error("Unable to find callback for event '".concat(t,"' with handle '").concat(e,"'."));return n.delete(e),this},once:function(t,e){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e,o=function(){n.off(t,r);for(var o=arguments.length,i=new Array(o),a=0;a<o;a++)i[a]=arguments[a];e.apply(n.__context||n,i)};return this.on(t,o,r)},emit:function(t){if(this.__events.has(t)){for(var e=Array.from(this.__events.get(t).values()),n=arguments.length,r=new Array(n>1?n-1:0),o=1;o<n;o++)r[o-1]=arguments[o];for(var i=0,a=e;i<a.length;i++){var s=a[i];s.apply(this.__context||this,r)}}else this.__events.set(t,new Map);return this}};function K(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0,e=Object.create(N);return e.__events=new Map,e.__context=t,e}function B(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,n=Object.assign(t,N);return n.__events=new Map,n.__context=e,n}function U(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,n=t.prototype;return Object.assign(n,N),n.__events=new Map,n.__context=e,n}var q={create:K,assign:B,mixin:U},z=Object.freeze({__proto__:null,create:K,assign:B,mixin:U,default:q});function V(t,e){var n=document.createElement("canvas");n.width=t,n.height=e,n.style="image-rendering: pixelated";var r=n.getContext("2d");return r.imageSmoothingEnabled=!1,{canvas:n,context:r}}var W=Object.freeze({__proto__:null,createView:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:640,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:480,n=V(t,e),r=n.canvas,o=n.context;return{_canvas:r,_context:o,_width:t,_height:e,get canvas(){return this._canvas},get context(){return this._context},get width(){return this._width},set width(t){this._width=t,this._canvas.width=t},get height(){return this._height},set height(t){this._height=t,this._canvas.height=t}}},createViewBuffer:V,drawBufferToCanvas:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:t.canvas.clientWidth,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:t.canvas.clientHeight;t.drawImage(e,n,r,o,i)}});var X=Object.freeze({__proto__:null,setViewTransform:function(t){var e,n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;r?((e=t.context).setTransform.apply(e,y(r.getProjectionMatrix())),(n=t.context).transform.apply(n,y(r.getViewMatrix()))):t.context.setTransform(1,0,0,1,0,0)}}),Y=function(){function t(e,n){r(this,t),this._canvas=e,this._context=n}return i(t,[{key:"getX",value:function(){return 0}},{key:"getY",value:function(){return 0}},{key:"getWidth",value:function(){return this._canvas.clientWidth}},{key:"getHeight",value:function(){return this._canvas.clientHeight}},{key:"getCanvas",value:function(){return this._canvas}},{key:"getContext",value:function(){return this._context}}]),t}(),G=function(){function t(){r(this,t)}return i(t,[{key:"update",value:function(t){}},{key:"getProjectionMatrix",value:function(){return[1,0,0,1,0,0]}},{key:"getViewMatrix",value:function(){return[1,0,0,1,0,0]}}]),t}(),Q=1e3/60,J=new Map,Z=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};r(this,t),this.prevFrameTime=0,this.animationFrameHandle=null,this.frameTime=Q,this.started=!1,this.paused=!1,this.gameContext=e,this.run=this.run.bind(this),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this.pause=this.pause.bind(this),this.resume=this.resume.bind(this),this.__context=e}return i(t,null,[{key:"start",value:function(){var e,r,o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;if(J.has(o))throw new Error("Cannot start game loop with duplicate handle.");return r="object"===n(o)?o:{},e=new t(r),J.set(o,e),setTimeout((function(){return e.start()}),0),e}},{key:"stop",value:function(t){if(J.has(t)){var e=J.get(t);return e.stop(),J.delete(t),e}return null}}]),i(t,[{key:"setFrameTime",value:function(t){return this.frameTime=t,this}},{key:"run",value:function(t){this.animationFrameHandle=requestAnimationFrame(this.run);var e=(t-this.prevFrameTime)/this.frameTime;this.prevFrameTime=t,"function"==typeof this.gameContext.update&&this.gameContext.update.call(this.gameContext,e),this.emit("update",e)}},{key:"start",value:function(){if(this.started)throw new Error("Loop already started.");window.addEventListener("focus",this.resume),window.addEventListener("blur",this.pause),this.prevFrameTime=performance.now(),this.started=!0,"function"==typeof this.gameContext.start&&this.gameContext.start.call(this.gameContext),this.emit("start"),this.run(this.prevFrameTime)}},{key:"stop",value:function(){if(!this.started)throw new Error("Loop not yet started.");window.removeEventListener("focus",this.resume),window.removeEventListener("blur",this.pause),cancelAnimationFrame(this.animationFrameHandle),this.animationFrameHandle=null,this.started=!1,"function"==typeof this.gameContext.stop&&this.gameContext.stop.call(this.gameContext),this.emit("stop")}},{key:"pause",value:function(){this.started&&!this.paused&&(cancelAnimationFrame(this.animationFrameHandle),this.animationFrameHandle=null,this.paused=!0,"function"==typeof this.gameContext.pause&&this.gameContext.pause.call(this.gameContext),this.emit("pause"))}},{key:"resume",value:function(){this.started&&this.pause&&(this.prevFrameTime=performance.now(),this.paused=!1,"function"==typeof this.gameContext.resume&&this.gameContext.resume.call(this.gameContext),this.emit("resume"),this.run(this.prevFrameTime))}}]),t}();function $(t){return t.name||t.toString()}U(Z);var tt=Object.freeze({__proto__:null,getComponentTypeName:$}),et=Symbol("operator"),nt=Symbol("handler"),rt=function(){function t(e){r(this,t),this._included=[],this._operated={};var o=!0,i=!1,a=void 0;try{for(var s,u=e[Symbol.iterator]();!(o=(s=u.next()).done);o=!0){var l=s.value;if("object"===n(l)&&et in l){var c=l[et];c in this._operated?this._operated[c].components.push(l.component):this._operated[c]={components:[l.component],handler:l[nt]}}else this._included.push(l)}}catch(t){i=!0,a=t}finally{try{o||null==u.return||u.return()}finally{if(i)throw a}}this.world=null,this.persistent=!1,this.entityIds=new Set,this.key=t.computeKey(e),this.onEntityCreate=this.onEntityCreate.bind(this),this.onEntityDestroy=this.onEntityDestroy.bind(this),this.onComponentAdd=this.onComponentAdd.bind(this),this.onComponentRemove=this.onComponentRemove.bind(this)}return i(t,null,[{key:"select",value:function(e,n){return new t(n).select(e,!1)}},{key:"computeKey",value:function(t){var e=[],r=!0,o=!1,i=void 0;try{for(var a,s=t[Symbol.iterator]();!(r=(a=s.next()).done);r=!0){var u=a.value;"object"===n(u)&&et in u?e.push(u[et].toString()+$(u)):e.push($(u))}}catch(t){o=!0,i=t}finally{try{r||null==s.return||s.return()}finally{if(o)throw i}}return e.sort().join("-")}}]),i(t,[{key:"matches",value:function(t,e){if(this.world!==t)return!1;if(!t.hasComponent.apply(t,[e].concat(y(this._included))))return!1;var n=!0,r=!1,o=void 0;try{for(var i,a=Object.getOwnPropertyNames(this._operated)[Symbol.iterator]();!(n=(i=a.next()).done);n=!0){var s=i.value;if(!s[nt].call(this,t,e,s.components))return!1}}catch(t){r=!0,o=t}finally{try{n||null==a.return||a.return()}finally{if(r)throw o}}return!0}},{key:"select",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.persistent)return this.entityIds;this.world=t,this.entityIds.clear();var n=!0,r=!1,o=void 0;try{for(var i,a=t.getEntityIds()[Symbol.iterator]();!(n=(i=a.next()).done);n=!0){var s=i.value;this.matches(t,s)&&this.entityIds.add(s)}}catch(t){r=!0,o=t}finally{try{n||null==a.return||a.return()}finally{if(r)throw o}}return e&&(t.entityManager.on("create",this.onEntityCreate),t.entityManager.on("destroy",this.onEntityDestroy),t.componentManager.on("add",this.onComponentAdd),t.componentManager.on("remove",this.onComponentRemove),this.persistent=!0),this.entityIds}},{key:"clear",value:function(){this.persistent&&(this.world.entityManager.off("create",this.onEntityCreate),this.world.entityManager.off("destroy",this.onEntityDestroy),this.world.componentManager.off("add",this.onComponentAdd),this.world.componentManager.off("remove",this.onComponentRemove),this.persistent=!1),this.entityIds.clear(),this.world=null}},{key:"onEntityCreate",value:function(t){this.matches(this.world,t)&&this.entityIds.add(t)}},{key:"onEntityDestroy",value:function(t){this.entityIds.has(t)&&this.entityIds.delete(t)}},{key:"onComponentAdd",value:function(t,e,n,r){this.onComponentRemove(t,e,n)}},{key:"onComponentRemove",value:function(t,e,n){this.matches(this.world,t)?this.entityIds.add(t):this.entityIds.has(t)&&this.entityIds.delete(t)}}]),t}(),ot=function(){function t(){r(this,t),this._entities=new Set,this._nextAvailableEntityId=1}return i(t,[{key:"addEntityId",value:function(t){this._entities.add(t),this.emit("create",t)}},{key:"deleteEntityId",value:function(t){this._entities.delete(t),this.emit("destroy",t)}},{key:"getNextAvailableEntityId",value:function(){return this._nextAvailableEntityId++}},{key:"getEntityIds",value:function(){return this._entities}}]),t}();U(ot);var it=function(){function t(){r(this,t),this.componentTypeInstanceMap=new Map}return i(t,[{key:"createComponent",value:function(t,e,r){var o,i=n(e);if("object"===i){if(!("create"in e))throw new Error("Instanced component class '".concat(getComponentTypeName(e),"' must at least have a create() function."));o=e.create(this,t)}else if("function"===i)o=new e(this,t);else{if("symbol"===i)throw new Error("Symbols are not yet supported as components.");o=e}if(r)if("copy"in e)e.copy(o,r);else if("copy"in o)o.copy(r);else{var a=!0,s=!1,u=void 0;try{for(var l,c=Object.getOwnPropertyNames(r)[Symbol.iterator]();!(a=(l=c.next()).done);a=!0){var h=l.value;o[h]=r[h]}}catch(t){s=!0,u=t}finally{try{a||null==c.return||c.return()}finally{if(s)throw u}}}return o}},{key:"putComponent",value:function(t,e,n,r){var o;if(this.componentTypeInstanceMap.has(e)?o=this.componentTypeInstanceMap.get(e):this.componentTypeInstanceMap.set(e,o=new Map),o.has(t))throw new Error("Cannot add more than one instance of component class '".concat(getComponentTypeName(e),"' for entity '").concat(t,"'."));o.set(t,n),this.emit("add",t,e,n,r)}},{key:"deleteComponent",value:function(t,e,n){this.componentTypeInstanceMap.get(e).delete(t),"reset"in e?e.reset(n):"reset"in n&&n.reset(),this.emit("remove",t,e,n)}},{key:"hasComponentType",value:function(t){return this.componentTypeInstanceMap.has(t)}},{key:"getComponentTypes",value:function(){return this.componentTypeInstanceMap.keys()}},{key:"getComponentInstanceMapByType",value:function(t){return this.componentTypeInstanceMap.get(t)}},{key:"getComponentInstanceMaps",value:function(){return this.componentTypeInstanceMap.values()}}]),t}();U(it);var at=function(){function t(){r(this,t),this.entityManager=new ot(this),this.componentManager=new it(this)}return i(t,[{key:"clear",value:function(){var t=!0,e=!1,n=void 0;try{for(var r,o=this.entityManager.getEntityIds()[Symbol.iterator]();!(t=(r=o.next()).done);t=!0){var i=r.value;this.destroyEntity(i,opts)}}catch(t){e=!0,n=t}finally{try{t||null==o.return||o.return()}finally{if(e)throw n}}}},{key:"createEntity",value:function(){var t=this.entityManager.getNextAvailableEntityId();this.entityManager.addEntityId(t);for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];for(var o=0,i=n;o<i.length;o++){var a=i[o];this.addComponent(t,a)}return t}},{key:"destroyEntity",value:function(t){var e=!0,n=!1,r=void 0;try{for(var o,i=this.componentManager.getComponentTypes()[Symbol.iterator]();!(e=(o=i.next()).done);e=!0){var a=o.value;this.componentManager.getComponentInstanceMapByType(a).has(t)&&this.removeComponent(t,a)}}catch(t){n=!0,r=t}finally{try{e||null==i.return||i.return()}finally{if(n)throw r}}this.entityManager.deleteEntityId(t)}},{key:"getEntityIds",value:function(){return this.entityManager.getEntityIds()}},{key:"addComponent",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;try{var r=this.componentManager.createComponent(t,e,n);return this.componentManager.putComponent(t,e,r,n),r}catch(n){console.error("Failed to add component '".concat($(e),"' to entity '").concat(t,"'.")),console.error(n)}}},{key:"removeComponent",value:function(t,e){try{var n=this.getComponent(t,e);this.componentManager.deleteComponent(t,e,n)}catch(n){console.error("Failed to remove component '".concat($(e),"' from entity '").concat(t,"'.")),console.error(n)}}},{key:"clearComponents",value:function(t){var e=!0,n=!1,r=void 0;try{for(var o,i=this.componentManager.getComponentInstanceMaps()[Symbol.iterator]();!(e=(o=i.next()).done);e=!0){var a=o.value;if(a.has(t)){var s=a.get(t);this.componentManager.deleteComponent(t,componentType,s)}}}catch(t){n=!0,r=t}finally{try{e||null==i.return||i.return()}finally{if(n)throw r}}}},{key:"getComponent",value:function(t,e){return this.componentManager.getComponentInstanceMapByType(e).get(t)}},{key:"hasComponent",value:function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];for(var o=0,i=n;o<i.length;o++){var a=i[o];if(!this.componentManager.hasComponentType(a))return!1;if(!this.componentManager.getComponentInstanceMapByType(a).has(t))return!1}return!0}},{key:"countComponents",value:function(t){var e=0,n=!0,r=!1,o=void 0;try{for(var i,a=this.componentManager.getComponentInstanceMaps()[Symbol.iterator]();!(n=(i=a.next()).done);n=!0){i.value.has(t)&&++e}}catch(t){r=!0,o=t}finally{try{n||null==a.return||a.return()}finally{if(r)throw o}}return e}},{key:"query",value:function(t){return rt.select(this,t)}}]),t}();function st(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Symbol(t.name),n=function(n){var r;return a(r={},OPERATOR,e),a(r,HANDLER,t),a(r,"component",n),r};return Object.defineProperty(n,"name",{value:name,configurable:!0}),n}var ut=st((function(t,e,n){return!t.hasComponent.apply(t,[e].concat(y(n)))}),Symbol("!")),lt=Object.freeze({__proto__:null,createQueryOperator:st,Not:ut});function ct(t,e){return{}}function ht(t,e){Object.assign(t,e)}function dt(t){Object.getOwnPropertyNames(t).forEach((function(e){return delete t[e]}))}var ft=Object.freeze({__proto__:null,createComponentFactory:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:ct,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:ht,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:dt;return{name:t,create:e,copy:n,reset:r}}}),vt=Symbol("defaultUndefined"),yt=function(){function t(e,n){var o=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];r(this,t),"defaultValues"in this.constructor||(o?(this.constructor.defaultValues=null,this.constructor.defaultValues=new this.constructor):this.constructor.defaultValues=vt)}return i(t,null,[{key:"defaultValues",get:function(){return null}}]),i(t,[{key:"copy",value:function(t){var e=!0,n=!1,r=void 0;try{for(var o,i=Object.getOwnPropertyNames(t)[Symbol.iterator]();!(e=(o=i.next()).done);e=!0){var a=o.value;this[a]=t[a]}}catch(t){n=!0,r=t}finally{try{e||null==i.return||i.return()}finally{if(n)throw r}}}},{key:"reset",value:function(){if("defaultValues"in this.constructor){var t=this.constructor.defaultValues;if(t===vt){var e=!0,n=!1,r=void 0;try{for(var o,i=Object.getOwnPropertyNames(this)[Symbol.iterator]();!(e=(o=i.next()).done);e=!0){this[o.value]=void 0}}catch(t){n=!0,r=t}finally{try{e||null==i.return||i.return()}finally{if(n)throw r}}return!0}return!!t&&(this.copy(this,this.constructor.defaultValues),!0)}return!1}}]),t}(),pt=function t(){r(this,t)},mt=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;if(r(this,t),void 0!==n)throw new Error("This component cannot be added to an existing entity; it can only initialize itself.");if(!e)throw new Error("Cannot create entity in null world.");var o=e.createEntity();e.componentManager.putComponent(o,t,this,void 0),this.id=o}return i(t,[{key:"copy",value:function(t){throw new Error("Unsupported operation; cannot be initialized by existing values.")}},{key:"reset",value:function(){return!1}}]),t}(),gt=function(t){function e(t){var n;return r(this,e),(n=v(this,u(e).call(this,t))).world=t,n}return s(e,t),i(e,[{key:"destroy",value:function(){this.world.destroyEntity(this.entityId),this.world=null}},{key:"addComponent",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;return this.world.addComponent(this.id,t,e),this}},{key:"removeComponent",value:function(t){return this.world.removeComponent(this.id,t),this}},{key:"hasComponent",value:function(t){return this.world.hasComponent(this.id,t)}},{key:"getComponent",value:function(t){return this.world.getComponent(this.id,t)}}]),e}(mt),_t=function(t){function e(t){var n;return r(this,e),(n=v(this,u(e).call(this,t))).onComponentAdd=n.onComponentAdd.bind(f(n)),n.onComponentRemove=n.onComponentRemove.bind(f(n)),n.world.componentManager.on("add",n.onComponentAdd),n.world.componentManager.on("remove",n.onComponentRemove),n}return s(e,t),i(e,[{key:"onDestroy",value:function(){}},{key:"onComponentAdd",value:function(t,e,r,o){t===this.id&&function(t,e,r){if("object"===n(r)){var o=Object.getOwnPropertyNames(t),i={},a=!0,s=!1,u=void 0;try{for(var l,c=function(){var t=l.value;if(o.includes(t))throw new Error("Conflicting property names in entity for component '".concat(getComponentTypeName(e),"'."));i[t]={get:function(){return r[t]},set:function(e){r[t]=e},configurable:!0}},h=Object.getOwnPropertyNames(r)[Symbol.iterator]();!(a=(l=h.next()).done);a=!0)c()}catch(t){s=!0,u=t}finally{try{a||null==h.return||h.return()}finally{if(s)throw u}}Object.defineProperties(t,i)}}(this,e,r)}},{key:"onComponentRemove",value:function(t,e,r){t===this.id&&(e===EntityComponent?(this.world.off("componentadd",this.onComponentAdd),this.world.off("componentremove",this.onComponentRemove),this.onDestroy()):function(t,e,r){if("object"===n(r)){var o=!0,i=!1,a=void 0;try{for(var s,u=Object.getOwnPropertyNames(r)[Symbol.iterator]();!(o=(s=u.next()).done);o=!0){var l=s.value;delete t[l]}}catch(t){i=!0,a=t}finally{try{o||null==u.return||u.return()}finally{if(i)throw a}}}}(this,0,r))}}]),e}(gt);var wt=Object.freeze({__proto__:null,getEntityById:function(t,e){return getComponent(e,EntityComponent)},getEntities:function(t){var e=[],n=t.query([EntityComponent]),r=!0,o=!1,i=void 0;try{for(var a,s=n[Symbol.iterator]();!(r=(a=s.next()).done);r=!0){var u=a.value,l=t.getComponent(u,EntityComponent);e.push(l)}}catch(t){o=!0,i=t}finally{try{r||null==s.return||s.return()}finally{if(o)throw i}}return e}});function bt(t,e,n){return t<e?e:t>n?n:t}function Et(t){window.addEventListener("DOMContentLoaded",t)}function Ct(t,e,n){var r=n-e,o=(t-e)%r;return o<0&&(o+=r),o+e}var xt,kt,Mt=Object.freeze({__proto__:null,randomHexColor:function(){return"#"+Math.floor(16777215*Math.random()).toString(16)},loadImage:function(t){var e=new Image;return e.src=t,e},clampRange:bt,clearScreen:function(t,e,n){t.fillStyle="black",t.fillRect(0,0,e,n)},drawText:function(t,e,n,r){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:16,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"white";t.translate(n,r),o&&t.rotate(o),t.textAlign="center",t.textBaseline="middle",t.font="".concat(i,"px sans-serif"),t.fillStyle=a,t.fillText(e,0,0),o&&t.rotate(-o),t.translate(-n,-r)},drawBox:function(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:16,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:o,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"white",s=arguments.length>7&&void 0!==arguments[7]&&arguments[7];t.translate(e,n),r&&t.rotate(r),s?(t.strokeStyle=a,t.strokeRect(-o/2,-i/2,o,i)):(t.fillStyle=a,t.fillRect(-o/2,-i/2,o,i)),r&&t.rotate(-r),t.translate(-e,-n)},intersectBox:function(t,e){return 2*Math.abs(t.x-e.x)<t.width+e.width&&2*Math.abs(t.y-e.y)<t.height+e.height},applyMotion:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e;1!==e&&(t.dx*=e),1!==n&&(t.dy*=n),t.x+=t.dx,t.y+=t.dy},withinRadius:function(t,e,n){var r=t.x-e.x,o=t.y-e.y;return r*r+o*o<=n*n},onDOMLoaded:Et,lerp:function(t,e,n){return t+(e-t)*n},distance2D:function(t,e){var n=e.x-t.x,r=e.y-t.y;return Math.sqrt(n*n+r*r)},direction2D:function(t,e){var n=e.x-t.x,r=e.y-t.y;return Math.atan2(r,n)},lookAt2D:function(t,e,n){return bt(t+Ct(e-t,-Math.PI,Math.PI),t-n,t+n)},cycleRange:Ct,drawCircle:function(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:16,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"white",i=arguments.length>5&&void 0!==arguments[5]&&arguments[5];t.fillStyle=o,t.strokeStyle=o,t.beginPath(),t.arc(e,n,r,0,2*Math.PI),i?t.stroke():t.fill()},uuid:function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;return e?(e^16*Math.random()>>e/4).toString(16):([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,t)}});function Tt(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:320,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:n;kt=e,(xt=t).width=n,xt.height=r}function St(){return kt}function At(){return xt.clientWidth}function It(){return xt.clientHeight}Et((function(){if(!xt){var t=null,e=null,n=document.querySelector("display-port");n?(t=n.getCanvas(),e=n.getContext()):t=document.querySelector("canvas"),t&&(e||(e=t.getContext("2d")),Tt(t,e))}}));var Ot=Object.freeze({__proto__:null,createCanvas:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:320,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:document.body,r=document.createElement("canvas");n.appendChild(r),Tt(r,t,e)},attachCanvas:Tt,drawBufferToScreen:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:At(),o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:It();St().drawImage(t.canvas,e,n,r,o)},getCanvas:function(){return xt},getDrawContext:St,getClientWidth:At,getClientHeight:It,getClientOffsetX:function(){return xt.offsetLeft},getClientOffsetY:function(){return xt.offsetTop}}),Rt=new AudioContext;var jt=Object.freeze({__proto__:null,createSound:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n={_playing:!1,_data:null,_source:null,play:function(){var t=this;if(this._data){this._source&&this.destroy();var n=Rt.createBufferSource();n.loop=e,n.buffer=this._data,n.addEventListener("ended",(function(){t._playing=!1})),n.connect(Rt.destination),n.start(0),this._source=n,this._playing=!0}},pause:function(){this._source.stop(),this._playing=!1},destroy:function(){this._source&&this._source.disconnect(),this._source=null},isPaused:function(){return!this._playing}};return fetch(t).then((function(t){return t.arrayBuffer()})).then((function(t){return Rt.decodeAudioData(t)})).then((function(t){return n._data=t})),n}}),Dt=D(),Ht=O().attach(Dt);function Pt(t){return Dt.element&&Dt.detach(),Dt.attach(t)}Et((function(){if(!Dt.element){var t=null,e=document.querySelector("display-port");(t=e?e.getCanvas():document.querySelector("canvas"))&&Pt(t)}}));var Lt=1;function Ft(){return"__input#".concat(Lt++)}var Nt=Object.freeze({__proto__:null,attachCanvas:Pt,createContext:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return O().setPriority(t).toggle(e).attach(Dt)},createInput:function(t){return Ht.registerInput(Ft(),t)},createAction:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return Ht.registerAction.apply(Ht,[Ft()].concat(e))},createRange:function(t){return Ht.registerRange(Ft(),t)},createState:function(t){return Ht.registerState(Ft(),t)},poll:function(){return Dt.poll()},handleEvent:function(t,e){return Dt.handleEvent(t,e)}}),Kt=new L;var Bt=Object.freeze({__proto__:null,createRandom:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return new F(t)},random:function(){return Kt.random()},randomRange:function(t,e){return Kt.randomRange(t,e)},randomChoose:function(t){return Kt.randomChoose(t)},randomSign:function(){return Kt.randomSign()}});t.AbstractCamera=G,t.AbstractInputAdapter=k,t.ActionInputAdapter=M,t.Audio=jt,t.Component=tt,t.ComponentBase=yt,t.ComponentFactory=ft,t.DEFAULT_FRAME_TIME=Q,t.DOUBLE_ACTION_TIME=H,t.Display=Ot,t.DisplayPort=E,t.DoubleActionInputAdapter=P,t.Entity=wt,t.EntityBase=gt,t.EntityComponent=mt,t.EntityQuery=rt,t.EntityWorld=at,t.EventKey=x,t.Eventable=z,t.GameLoop=Z,t.HybridEntity=_t,t.Input=Nt,t.Keyboard=j,t.MAX_CONTEXT_PRIORITY=I,t.MIN_CONTEXT_PRIORITY=A,t.MODE_CENTER=m,t.MODE_FIT=g,t.MODE_NOSCALE=p,t.MODE_STRETCH=_,t.Mouse=R,t.QueryOperator=lt,t.Random=Bt,t.RandomGenerator=L,t.RangeInputAdapter=T,t.SimpleRandomGenerator=F,t.StateInputAdapter=S,t.TagComponent=pt,t.Utils=Mt,t.View=W,t.ViewHelper=X,t.ViewPort=Y,t.createContext=O,t.createSource=D,t.default=e,Object.defineProperty(t,"__esModule",{value:!0})}));
