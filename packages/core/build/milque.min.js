!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t=t||self).Milque={})}(this,(function(t){"use strict";var e=Object.freeze({__proto__:null,get Display(){return d},get Audio(){return v},get Input(){return V},get Random(){return W},get Utils(){return s},get default(){return e},get MODE_NOSCALE(){return J},get MODE_CENTER(){return Q},get MODE_FIT(){return Z},get MODE_STRETCH(){return $},get DisplayPort(){return nt},get EventKey(){return R},get MIN_CONTEXT_PRIORITY(){return j},get MAX_CONTEXT_PRIORITY(){return F},get createContext(){return P},get createSource(){return K},get AbstractInputAdapter(){return H},get ActionInputAdapter(){return I},get DOUBLE_ACTION_TIME(){return rt},get DoubleActionInputAdapter(){return it},get RangeInputAdapter(){return D},get StateInputAdapter(){return L},get Keyboard(){return T},get Mouse(){return A},get RandomGenerator(){return X},get SimpleRandomGenerator(){return Y},get Eventable(){return ht},get View(){return dt},get ViewHelper(){return ft},get ViewPort(){return vt},get AbstractCamera(){return mt},get GameLoop(){return _t}});function n(t,e,n){return t<e?e:t>n?n:t}function r(t){window.addEventListener("DOMContentLoaded",t)}function i(t,e,n){var r=n-e,i=(t-e)%r;return i<0&&(i+=r),i+e}var o,a,s=Object.freeze({__proto__:null,randomHexColor:function(){return"#"+Math.floor(16777215*Math.random()).toString(16)},loadImage:function(t){var e=new Image;return e.src=t,e},clampRange:n,clearScreen:function(t,e,n){t.fillStyle="black",t.fillRect(0,0,e,n)},drawText:function(t,e,n,r){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:16,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"white";t.translate(n,r),i&&t.rotate(i),t.textAlign="center",t.textBaseline="middle",t.font="".concat(o,"px sans-serif"),t.fillStyle=a,t.fillText(e,0,0),i&&t.rotate(-i),t.translate(-n,-r)},drawBox:function(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:16,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:i,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"white",s=arguments.length>7&&void 0!==arguments[7]&&arguments[7];t.translate(e,n),r&&t.rotate(r),s?(t.strokeStyle=a,t.strokeRect(-i/2,-o/2,i,o)):(t.fillStyle=a,t.fillRect(-i/2,-o/2,i,o)),r&&t.rotate(-r),t.translate(-e,-n)},intersectBox:function(t,e){return 2*Math.abs(t.x-e.x)<t.width+e.width&&2*Math.abs(t.y-e.y)<t.height+e.height},applyMotion:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e;1!==e&&(t.dx*=e),1!==n&&(t.dy*=n),t.x+=t.dx,t.y+=t.dy},withinRadius:function(t,e,n){var r=t.x-e.x,i=t.y-e.y;return r*r+i*i<=n*n},onDOMLoaded:r,lerp:function(t,e,n){return t+(e-t)*n},distance2D:function(t,e){var n=e.x-t.x,r=e.y-t.y;return Math.sqrt(n*n+r*r)},direction2D:function(t,e){var n=e.x-t.x,r=e.y-t.y;return Math.atan2(r,n)},lookAt2D:function(t,e,r){return n(t+i(e-t,-Math.PI,Math.PI),t-r,t+r)},cycleRange:i,drawCircle:function(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:16,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"white",o=arguments.length>5&&void 0!==arguments[5]&&arguments[5];t.fillStyle=i,t.strokeStyle=i,t.beginPath(),t.arc(e,n,r,0,2*Math.PI),o?t.stroke():t.fill()},uuid:function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;return e?(e^16*Math.random()>>e/4).toString(16):([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,t)}});function u(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:320,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:n;a=e,(o=t).width=n,o.height=r}function c(){return a}function h(){return o.clientWidth}function l(){return o.clientHeight}r((function(){if(!o){var t=null,e=null,n=document.querySelector("display-port");n?(t=n.getCanvas(),e=n.getContext()):t=document.querySelector("canvas"),t&&(e||(e=t.getContext("2d")),u(t,e))}}));var d=Object.freeze({__proto__:null,createCanvas:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:320,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:document.body,r=document.createElement("canvas");n.appendChild(r),u(r,t,e)},attachCanvas:u,drawBufferToScreen:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:h(),i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:l();c().drawImage(t.canvas,e,n,r,i)},getCanvas:function(){return o},getDrawContext:c,getClientWidth:h,getClientHeight:l,getClientOffsetX:function(){return o.offsetLeft},getClientOffsetY:function(){return o.offsetTop}}),f=new AudioContext;var v=Object.freeze({__proto__:null,createSound:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n={_playing:!1,_data:null,_source:null,play:function(){var t=this;if(this._data){this._source&&this.destroy();var n=f.createBufferSource();n.loop=e,n.buffer=this._data,n.addEventListener("ended",(function(){t._playing=!1})),n.connect(f.destination),n.start(0),this._source=n,this._playing=!0}},pause:function(){this._source.stop(),this._playing=!1},destroy:function(){this._source&&this._source.disconnect(),this._source=null},isPaused:function(){return!this._playing}};return fetch(t).then((function(t){return t.arrayBuffer()})).then((function(t){return f.decodeAudioData(t)})).then((function(t){return n._data=t})),n}});function m(t){return(m="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function p(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function g(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function y(t,e,n){return e&&g(t.prototype,e),n&&g(t,n),t}function _(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&w(t,e)}function b(t){return(b=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function w(t,e){return(w=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function x(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}function E(t,e,n){return(E=x()?Reflect.construct:function(t,e,n){var r=[null];r.push.apply(r,e);var i=new(Function.bind.apply(t,r));return n&&w(i,n.prototype),i}).apply(null,arguments)}function k(t){var e="function"==typeof Map?new Map:void 0;return(k=function(t){if(null===t||(n=t,-1===Function.toString.call(n).indexOf("[native code]")))return t;var n;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,r)}function r(){return E(t,arguments,b(this).constructor)}return r.prototype=Object.create(t.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),w(r,t)})(t)}function C(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function M(t,e){return!e||"object"!=typeof e&&"function"!=typeof e?C(t):e}function S(t){return function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var A=function(){function t(){p(this,t),this.sourceElement=null,this.eventHandler=null,this.onMouseDown=this.onMouseDown.bind(this),this.onMouseUp=this.onMouseUp.bind(this),this.onMouseMove=this.onMouseMove.bind(this)}return y(t,[{key:"attach",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:document;return this.sourceElement=t,this.sourceElement.addEventListener("mousedown",this.onMouseDown),this.sourceElement.addEventListener("mouseup",this.onMouseUp),this.sourceElement.addEventListener("contextmenu",this.onContextMenu),document.addEventListener("mousemove",this.onMouseMove),this}},{key:"detach",value:function(){return this.sourceElement.removeEventListener("mousedown",this.onMouseDown),this.sourceElement.removeEventListener("mouseup",this.onMouseUp),this.sourceElement.removeEventListener("contextmenu",this.onContextMenu),document.removeEventListener("mousemove",this.onMouseMove),this.sourceElement=null,this}},{key:"setEventHandler",value:function(t){return this.eventHandler=t,this}},{key:"onMouseDown",value:function(t){this.eventHandler&&(this.eventHandler.call(this,"mouse[".concat(t.button,"].down"),!0)&&(t.preventDefault(),t.stopPropagation()))}},{key:"onMouseUp",value:function(t){this.eventHandler&&(t.preventDefault(),t.stopPropagation(),this.eventHandler.call(this,"mouse[".concat(t.button,"].up"),!0))}},{key:"onMouseMove",value:function(t){if(this.eventHandler){var e=this.sourceElement,n=e.clientWidth,r=e.clientHeight;this.eventHandler.call(this,"mouse[pos].x",(t.pageX-e.offsetLeft)/n),this.eventHandler.call(this,"mouse[pos].y",(t.pageY-e.offsetTop)/r),this.eventHandler.call(this,"mouse[pos].dx",t.movementX/n),this.eventHandler.call(this,"mouse[pos].dy",t.movementY/r)}}},{key:"onContextMenu",value:function(t){t.preventDefault(),t.stopPropagation()}}]),t}(),T=function(){function t(){p(this,t),this.sourceElement=null,this.eventHandler=null,this.onKeyDown=this.onKeyDown.bind(this),this.onKeyUp=this.onKeyUp.bind(this)}return y(t,[{key:"attach",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:document;return this.sourceElement=t,this.sourceElement.addEventListener("keydown",this.onKeyDown),this.sourceElement.addEventListener("keyup",this.onKeyUp),this}},{key:"detach",value:function(){return this.sourceElement.removeEventListener("keydown",this.onKeyDown),this.sourceElement.removeEventListener("keyup",this.onKeyUp),this.sourceElement=null,this}},{key:"setEventHandler",value:function(t){return this.eventHandler=t,this}},{key:"onKeyDown",value:function(t){this.eventHandler&&((t.repeat?this.eventHandler.call(this,"key[".concat(t.key,"].repeat"),!0):this.eventHandler.call(this,"key[".concat(t.key,"].down"),!0))&&(t.preventDefault(),t.stopPropagation()))}},{key:"onKeyUp",value:function(t){this.eventHandler&&(this.eventHandler.call(this,"key[".concat(t.key,"].up"),!0)&&(t.preventDefault(),t.stopPropagation()))}}]),t}(),O=Symbol("any"),R=function(){function t(e,n,r){p(this,t),this.source=e,this.code=n,this.mode=r,this.string="".concat(this.source.toString(),"[").concat(this.code.toString(),"].").concat(this.mode.toString())}return y(t,null,[{key:"parse",value:function(e){var n=e.indexOf("["),r=e.indexOf("]"),i=e.indexOf(".");return new t(n<=0||0===i?O:e.substring(0,n),n<0||r<0||n+1===r?O:e.substring(n+1,r),i<0||e.trim().endsWith(".")?O:e.substring(i+1))}}]),y(t,[{key:"matches",value:function(t){return!(this.source!==O&&t.source!==O&&this.source!==t.source||this.code!==O&&t.code!==O&&this.code!==t.code||this.mode!==O&&t.mode!==O&&this.mode!==t.mode)}},{key:"toString",value:function(){return this.string}}]),t}();R.ANY=O;var H=function(){function t(e){p(this,t),this.prev=e,this.value=e,this.next=e}return y(t,[{key:"update",value:function(t,e){return!1}},{key:"consume",value:function(){return this.next}},{key:"poll",value:function(){return this.prev=this.value,this.value=this.next,this.next=this.consume(),this}}]),t}(),I=function(t){function e(t){var n;p(this,e),(n=M(this,b(e).call(this,!1))).eventKeys=[];var r=!0,i=!1,o=void 0;try{for(var a,s=t[Symbol.iterator]();!(r=(a=s.next()).done);r=!0){var u=a.value;n.eventKeys.push(R.parse(u))}}catch(t){i=!0,o=t}finally{try{r||null==s.return||s.return()}finally{if(i)throw o}}return n}return _(e,t),y(e,[{key:"consume",value:function(){return!1}},{key:"update",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=!0,r=!1,i=void 0;try{for(var o,a=this.eventKeys[Symbol.iterator]();!(n=(o=a.next()).done);n=!0){var s=o.value;if(s.matches(t))return this.next=e,!0}}catch(t){r=!0,i=t}finally{try{n||null==a.return||a.return()}finally{if(r)throw i}}return!1}}]),e}(H),D=function(t){function e(t){var n;return p(this,e),(n=M(this,b(e).call(this,0))).eventKey=R.parse(t),n}return _(e,t),y(e,[{key:"consume",value:function(){switch(this.eventKey.string){case"mouse[pos].dx":case"mouse[pos].dy":return 0;case"mouse[pos].x":case"mouse[pos].y":default:return this.next}}},{key:"update",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return!!this.eventKey.matches(t)&&(this.next=e,!0)}}]),e}(H),L=function(t){function e(t){var n;p(this,e),(n=M(this,b(e).call(this,0))).eventKeyEntries=[];for(var r=0,i=Object.keys(t);r<i.length;r++){var o=i[r];n.eventKeyEntries.push({key:R.parse(o),value:t[o]})}return n}return _(e,t),y(e,[{key:"update",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(e){var n=!0,r=!1,i=void 0;try{for(var o,a=this.eventKeyEntries[Symbol.iterator]();!(n=(o=a.next()).done);n=!0){var s=o.value;if(s.key.matches(t))return this.next=s.value,!0}}catch(t){r=!0,i=t}finally{try{n||null==a.return||a.return()}finally{if(r)throw i}}}return!1}}]),e}(H),j=-100,F=100;function P(){return{_source:null,_priority:0,_active:!0,inputs:new Map,get active(){return this._active},get source(){return this._source},get priority(){return this._priority},attach:function(t){return this._source=t,this._source.addContext(this),this},detach:function(){return this._source.removeContext(this),this._source=null,this},setPriority:function(t){if(t>F||t<j)throw new Error("Context priority must be between [".concat(j,", ").concat(F,"]."));return this._priority!==t&&(this._source?(this._source.removeContext(this),this._priority=t,this._source.addContext(this)):this._priority=t),this},registerInput:function(t,e){return this.inputs.set(t,e),e},registerAction:function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return this.registerInput(t,new I(n))},registerRange:function(t,e){return this.registerInput(t,new D(e))},registerState:function(t,e){return this.registerInput(t,new L(e))},toggle:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;return void 0===t&&(t=!this._active),this._active=t,this},enable:function(){return this.toggle(!0)},disable:function(){return this.toggle(!1)},poll:function(){var t=!0,e=!1,n=void 0;try{for(var r,i=this.inputs.values()[Symbol.iterator]();!(t=(r=i.next()).done);t=!0){r.value.poll()}}catch(t){e=!0,n=t}finally{try{t||null==i.return||i.return()}finally{if(e)throw n}}},update:function(t,e){var n,r=!0,i=!1,o=void 0;try{for(var a,s=this.inputs.values()[Symbol.iterator]();!(r=(a=s.next()).done);r=!0){n|=a.value.update(t,e)}}catch(t){i=!0,o=t}finally{try{r||null==s.return||s.return()}finally{if(i)throw o}}return n}}}function K(){var t={_contexts:new Array(F-j),element:null,keyboard:new T,mouse:new A,attach:function(t){return this.element=t,this.keyboard.attach(),this.mouse.attach(t),this},detach:function(){return this.element=null,this.keyboard.detach(),this.mouse.detach(),this},addContext:function(t){var e=t.priority-j;return this._contexts[e]||(this._contexts[e]=[]),this._contexts[e].push(t),this},removeContext:function(t){var e=t.priority-j,n=this._contexts[e];return n&&n.splice(n.indexOf(t),1),this},poll:function(){var t=!0,e=!1,n=void 0;try{for(var r,i=this._contexts[Symbol.iterator]();!(t=(r=i.next()).done);t=!0){var o=r.value;if(o){var a=!0,s=!1,u=void 0;try{for(var c,h=o[Symbol.iterator]();!(a=(c=h.next()).done);a=!0){var l=c.value;l.active&&l.poll()}}catch(t){s=!0,u=t}finally{try{a||null==h.return||h.return()}finally{if(s)throw u}}}}}catch(t){e=!0,n=t}finally{try{t||null==i.return||i.return()}finally{if(e)throw n}}},handleEvent:function(t,e){var n=R.parse(t),r=!0,i=!1,o=void 0;try{for(var a,s=this._contexts[Symbol.iterator]();!(r=(a=s.next()).done);r=!0){var u=a.value;if(u){var c=!0,h=!1,l=void 0;try{for(var d,f=u[Symbol.iterator]();!(c=(d=f.next()).done);c=!0){var v=d.value;if(v.active){if(v.update(n,e))return!0}}}catch(t){h=!0,l=t}finally{try{c||null==f.return||f.return()}finally{if(h)throw l}}}}}catch(t){i=!0,o=t}finally{try{r||null==s.return||s.return()}finally{if(i)throw o}}return!1}};return t.handleEvent=t.handleEvent.bind(t),t.keyboard.setEventHandler(t.handleEvent),t.mouse.setEventHandler(t.handleEvent),t}var q=K(),N=P().attach(q);function U(t){return q.element&&q.detach(),q.attach(t)}r((function(){if(!q.element){var t=null,e=document.querySelector("display-port");(t=e?e.getCanvas():document.querySelector("canvas"))&&U(t)}}));var z=1;function B(){return"__input#".concat(z++)}var V=Object.freeze({__proto__:null,attachCanvas:U,createContext:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return P().setPriority(t).toggle(e).attach(q)},createInput:function(t){return N.registerInput(B(),t)},createAction:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return N.registerAction.apply(N,[B()].concat(e))},createRange:function(t){return N.registerRange(B(),t)},createState:function(t){return N.registerState(B(),t)},poll:function(){return q.poll()},handleEvent:function(t,e){return q.handleEvent(t,e)}}),X=function(){function t(e){p(this,t),this._seed=e}return y(t,[{key:"random",value:function(){return Math.random()}},{key:"randomRange",value:function(t,e){return this.random()*(e-t)+t}},{key:"randomChoose",value:function(t){return t[Math.floor(this.random()*t.length)]}},{key:"randomSign",value:function(){return this.random()<.5?-1:1}},{key:"seed",get:function(){return this._seed}}]),t}(),Y=function(t){function e(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return p(this,e),(t=M(this,b(e).call(this,Math.abs(n%2147483647))))._next=t.seed,t}return _(e,t),y(e,[{key:"random",value:function(){return this._next=Math.abs(16807*this._next%2147483647-1),this._next/2147483646}}]),e}(X),G=new X;var W=Object.freeze({__proto__:null,createRandom:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return new Y(t)},random:function(){return G.random()},randomRange:function(t,e){return G.randomRange(t,e)},randomChoose:function(t){return G.randomChoose(t)},randomSign:function(){return G.randomSign()}}),J="noscale",Q="center",Z="fit",$="stretch",tt=Q,et='\n<style>\n    :host {\n        display: inline-block;\n        color: #555555;\n    }\n    div {\n        display: flex;\n        position: relative;\n        width: 100%;\n        height: 100%;\n    }\n    canvas {\n        background: #000000;\n        margin: auto;\n    }\n    label {\n        font-family: monospace;\n        color: currentColor;\n        position: absolute;\n    }\n    #title {\n        left: 0.5rem;\n        top: 0.5rem;\n    }\n    #fps {\n        right: 0.5rem;\n        top: 0.5rem;\n    }\n    #dimension {\n        left: 0.5rem;\n        bottom: 0.5rem;\n    }\n    .hidden {\n        display: none;\n    }\n    :host([debug]) div {\n        outline: 8px dashed rgba(0, 0, 0, 0.4);\n        outline-offset: -4px;\n        background-color: rgba(0, 0, 0, 0.1);\n    }\n    :host([mode="'.concat(J,'"]) canvas {\n        margin: 0;\n        top: 0;\n        left: 0;\n    }\n    :host([mode="').concat(Z,'"]), :host([mode="').concat(Q,'"]), :host([mode="').concat($,'"]) {\n        width: 100%;\n        height: 100%;\n    }\n    :host([full]) {\n        width: 100vw!important;\n        height: 100vh!important;\n    }\n    :host([disabled]) {\n        display: none;\n    }\n</style>'),nt=function(t){function e(){var t;return p(this,e),(t=M(this,b(e).call(this))).attachShadow({mode:"open"}),t.shadowRoot.innerHTML="<div>".concat(et).concat('\n<label class="hidden" id="title">display-port</label>\n<label class="hidden" id="fps">00</label>\n<label class="hidden" id="dimension">0x0</label>\n<canvas></canvas>',"</div>"),t._canvasElement=t.shadowRoot.querySelector("canvas"),t._canvasContext=t._canvasElement.getContext("2d"),t._canvasContext.imageSmoothingEnabled=!1,t._titleElement=t.shadowRoot.querySelector("#title"),t._fpsElement=t.shadowRoot.querySelector("#fps"),t._dimensionElement=t.shadowRoot.querySelector("#dimension"),t._animationRequestHandle=0,t._prevAnimationFrameTime=0,t._width=640,t._height=480,t.update=t.update.bind(C(t)),t}return _(e,t),y(e,null,[{key:"observedAttributes",get:function(){return["width","height","disabled","debug","id","class"]}}]),y(e,[{key:"connectedCallback",value:function(){this.hasAttribute("mode")||(this.mode=tt),this.updateCanvasSize(),this.resume()}},{key:"disconnectedCallback",value:function(){this.pause()}},{key:"attributeChangedCallback",value:function(t,e,n){switch(t){case"width":this._width=n;break;case"height":this._height=n;break;case"disabled":n?(this.update(0),this.pause()):this.resume();break;case"id":case"class":this._titleElement.innerHTML="display-port".concat(this.className?"."+this.className:"").concat(this.hasAttribute("id")?"#"+this.getAttribute("id"):"");break;case"debug":this._titleElement.classList.toggle("hidden",n),this._fpsElement.classList.toggle("hidden",n),this._dimensionElement.classList.toggle("hidden",n)}}},{key:"update",value:function(t){if(this._animationRequestHandle=requestAnimationFrame(this.update),this.updateCanvasSize(),this.debug){var e=t-this._prevAnimationFrameTime,n=e<=0?"--":String(Math.round(1e3/e)).padStart(2,"0");if(this._prevAnimationFrameTime=t,this._fpsElement.innerText!==n&&(this._fpsElement.innerText=n),this.mode===J){var r="".concat(this._width,"x").concat(this._height);this._dimensionElement.innerText!==r&&(this._dimensionElement.innerText=r)}else{var i="".concat(this._width,"x").concat(this._height,"|").concat(this.shadowRoot.host.clientWidth,"x").concat(this.shadowRoot.host.clientHeight);this._dimensionElement.innerText!==i&&(this._dimensionElement.innerText=i)}}this.dispatchEvent(new CustomEvent("frame",{detail:{now:t,context:this._canvasContext},bubbles:!1,composed:!0}))}},{key:"pause",value:function(){cancelAnimationFrame(this._animationRequestHandle)}},{key:"resume",value:function(){this._animationRequestHandle=requestAnimationFrame(this.update)}},{key:"updateCanvasSize",value:function(){var t=this.shadowRoot.host.getBoundingClientRect(),e=t.width,n=t.height,r=this._canvasElement,i=this._width,o=this._height,a=this.mode;if(a===$)i=e,o=n;else if(a!==J){if(e<i||n<o||a===Z){var s=e/i,u=n/o;s<u?(i=e,o*=s):(i*=u,o=n)}}i=Math.floor(i),o=Math.floor(o),r.width===i&&r.height===o||(r.width=i,r.height=o,r.style="width: ".concat(i,"px; height: ").concat(o,"px"),this.dispatchEvent(new CustomEvent("resize",{detail:{width:i,height:o},bubbles:!1,composed:!0})))}},{key:"getCanvas",value:function(){return this._canvasElement}},{key:"getContext",value:function(){return this._canvasContext}},{key:"width",get:function(){return this._width},set:function(t){this.setAttribute("width",t)}},{key:"height",get:function(){return this._height},set:function(t){this.setAttribute("height",t)}},{key:"mode",get:function(){return this.getAttribute("mode")},set:function(t){this.setAttribute("mode",t)}},{key:"disabled",get:function(){return this.hasAttribute("disabled")},set:function(t){t?this.setAttribute("disabled",""):this.removeAttribute("disabled")}},{key:"debug",get:function(){return this.hasAttribute("debug")},set:function(t){t?this.setAttribute("debug",""):this.removeAttribute("debug")}}]),e}(k(HTMLElement));window.customElements.define("display-port",nt);var rt=300,it=function(t){function e(t){var n;return p(this,e),(n=M(this,b(e).call(this,t))).actionTime=0,n}return _(e,t),y(e,[{key:"update",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=Date.now(),r=!0,i=!1,o=void 0;try{for(var a,s=this.eventKeys[Symbol.iterator]();!(r=(a=s.next()).done);r=!0){var u=a.value;if(u.matches(t))return e?n-this.actionTime<=rt?(this.actionTime=0,this.next=!0,!0):(this.actionTime=n,!1):(this.next=!1,!0)}}catch(t){i=!0,o=t}finally{try{r||null==s.return||s.return()}finally{if(i)throw o}}return!1}}]),e}(I),ot={on:function(t,e){var n,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e;if(this.__events.has(t)?n=this.__events.get(t):(n=new Map,this.__events.set(t,n)),n.has(r))throw new Error("Found callback for event '".concat(t,"' with the same handle '").concat(r,"'."));return n.set(r,e),this},off:function(t,e){if(!this.__events.has(t))throw new Error("Unable to find event '".concat(t,"'."));var n=this.__events.get(t);if(!n.has(e))throw new Error("Unable to find callback for event '".concat(t,"' with handle '").concat(e,"'."));return n.delete(e),this},once:function(t,e){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e,i=function(){n.off(t,r);for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];e.apply(n.__context||n,o)};return this.on(t,i,r)},emit:function(t){if(this.__events.has(t)){for(var e=Array.from(this.__events.get(t).values()),n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];for(var o=0,a=e;o<a.length;o++){var s=a[o];s.apply(this.__context||this,r)}}else this.__events.set(t,new Map);return this}};function at(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0,e=Object.create(ot);return e.__events=new Map,e.__context=t,e}function st(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,n=Object.assign(t,ot);return n.__events=new Map,n.__context=e,n}function ut(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,n=t.prototype;return Object.assign(n,ot),n.__events=new Map,n.__context=e,n}var ct={create:at,assign:st,mixin:ut},ht=Object.freeze({__proto__:null,create:at,assign:st,mixin:ut,default:ct});function lt(t,e){var n=document.createElement("canvas");n.width=t,n.height=e,n.style="image-rendering: pixelated";var r=n.getContext("2d");return r.imageSmoothingEnabled=!1,{canvas:n,context:r}}var dt=Object.freeze({__proto__:null,createView:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:640,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:480,n=lt(t,e),r=n.canvas,i=n.context;return{_canvas:r,_context:i,_width:t,_height:e,get canvas(){return this._canvas},get context(){return this._context},get width(){return this._width},set width(t){this._width=t,this._canvas.width=t},get height(){return this._height},set height(t){this._height=t,this._canvas.height=t}}},createViewBuffer:lt,drawBufferToCanvas:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:t.canvas.clientWidth,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:t.canvas.clientHeight;t.drawImage(e,n,r,i,o)}});var ft=Object.freeze({__proto__:null,setViewTransform:function(t){var e,n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;r?((e=t.context).setTransform.apply(e,S(r.getProjectionMatrix())),(n=t.context).transform.apply(n,S(r.getViewMatrix()))):t.context.setTransform(1,0,0,1,0,0)}}),vt=function(){function t(e,n){p(this,t),this._canvas=e,this._context=n}return y(t,[{key:"getX",value:function(){return 0}},{key:"getY",value:function(){return 0}},{key:"getWidth",value:function(){return this._canvas.clientWidth}},{key:"getHeight",value:function(){return this._canvas.clientHeight}},{key:"getCanvas",value:function(){return this._canvas}},{key:"getContext",value:function(){return this._context}}]),t}(),mt=function(){function t(){p(this,t)}return y(t,[{key:"update",value:function(t){}},{key:"getProjectionMatrix",value:function(){return[1,0,0,1,0,0]}},{key:"getViewMatrix",value:function(){return[1,0,0,1,0,0]}}]),t}(),pt=new Map;function gt(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t,n=yt(t);return pt.set(e,n),n}function yt(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=at(t);return e.prevFrameTime=0,e.animationFrameHandle=null,e.gameContext=t,e.frameTime=1e3/60,e.started=!1,e.paused=!1,e.setFrameTime=function(t){return this.frameTime=t,this},e.run=function(t){this.animationFrameHandle=requestAnimationFrame(this.run);var e=(t-this.prevFrameTime)/this.frameTime;this.prevFrameTime=t,"function"==typeof this.gameContext.update&&this.gameContext.update.call(this.gameContext,e),this.emit("update",e)}.bind(e),e.start=function(){if(this.started)throw new Error("Loop already started.");window.addEventListener("focus",this.resume),window.addEventListener("blur",this.pause),this.prevFrameTime=performance.now(),this.started=!0,"function"==typeof this.gameContext.start&&this.gameContext.start.call(this.gameContext),this.emit("start"),this.run(this.prevFrameTime)}.bind(e),e.stop=function(){if(!this.started)throw new Error("Loop not yet started.");window.removeEventListener("focus",this.resume),window.removeEventListener("blur",this.pause),cancelAnimationFrame(this.animationFrameHandle),this.animationFrameHandle=null,this.started=!1,"function"==typeof this.gameContext.stop&&this.gameContext.stop.call(this.gameContext),this.emit("stop")}.bind(e),e.pause=function(){this.started&&!this.paused&&(cancelAnimationFrame(this.animationFrameHandle),this.animationFrameHandle=null,this.paused=!0,"function"==typeof this.gameContext.pause&&this.gameContext.pause.call(this.gameContext),this.emit("pause"))}.bind(e),e.resume=function(){this.started&&this.pause&&(this.prevFrameTime=performance.now(),this.paused=!1,"function"==typeof this.gameContext.resume&&this.gameContext.resume.call(this.gameContext),this.emit("resume"),this.run(this.prevFrameTime))}.bind(e),e}var _t=Object.freeze({__proto__:null,INSTANCES:pt,DEFAULT_FRAME_TIME:1e3/60,start:function(){var t,e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;return pt.has(n)?t=pt.get(n):(e="object"===m(n)?n:{},t=gt(e,n)),setTimeout((function(){return t.start()}),0),t},stop:function(t){if(pt.has(t)){var e=pt.get(t);return e.stop(),e}return null},registerGameLoop:gt,createGameLoop:yt});t.AbstractCamera=mt,t.AbstractInputAdapter=H,t.ActionInputAdapter=I,t.Audio=v,t.DOUBLE_ACTION_TIME=rt,t.Display=d,t.DisplayPort=nt,t.DoubleActionInputAdapter=it,t.EventKey=R,t.Eventable=ht,t.GameLoop=_t,t.Input=V,t.Keyboard=T,t.MAX_CONTEXT_PRIORITY=F,t.MIN_CONTEXT_PRIORITY=j,t.MODE_CENTER=Q,t.MODE_FIT=Z,t.MODE_NOSCALE=J,t.MODE_STRETCH=$,t.Mouse=A,t.Random=W,t.RandomGenerator=X,t.RangeInputAdapter=D,t.SimpleRandomGenerator=Y,t.StateInputAdapter=L,t.Utils=s,t.View=dt,t.ViewHelper=ft,t.ViewPort=vt,t.createContext=P,t.createSource=K,t.default=e,Object.defineProperty(t,"__esModule",{value:!0})}));
