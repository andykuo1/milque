!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).Milque=e()}(this,(function(){"use strict";function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(e)}function e(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function n(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function r(t,e,r){return e&&n(t.prototype,e),r&&n(t,r),t}function i(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function o(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&u(t,e)}function s(t){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function u(t,e){return(u=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function c(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}function l(t,e,n){return(l=c()?Reflect.construct:function(t,e,n){var r=[null];r.push.apply(r,e);var i=new(Function.bind.apply(t,r));return n&&u(i,n.prototype),i}).apply(null,arguments)}function h(t){var e="function"==typeof Map?new Map:void 0;return(h=function(t){if(null===t||(n=t,-1===Function.toString.call(n).indexOf("[native code]")))return t;var n;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,r)}function r(){return l(t,arguments,s(this).constructor)}return r.prototype=Object.create(t.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),u(r,t)})(t)}function d(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function f(t,e){return!e||"object"!=typeof e&&"function"!=typeof e?d(t):e}function v(t,e,n){return t<e?e:t>n?n:t}function p(t){window.addEventListener("DOMContentLoaded",t)}function m(t,e,n){var r=n-e,i=(t-e)%r;return i<0&&(i+=r),i+e}var y,g,_=Object.freeze({__proto__:null,randomHexColor:function(){return"#"+Math.floor(16777215*Math.random()).toString(16)},loadImage:function(t){var e=new Image;return e.src=t,e},clampRange:v,clearScreen:function(t,e,n){t.fillStyle="black",t.fillRect(0,0,e,n)},drawText:function(t,e,n,r){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:16,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"white";t.translate(n,r),i&&t.rotate(i),t.textAlign="center",t.textBaseline="middle",t.font="".concat(o,"px sans-serif"),t.fillStyle=a,t.fillText(e,0,0),i&&t.rotate(-i),t.translate(-n,-r)},drawBox:function(t,e,n,r,i){var o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:i,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"white";t.translate(e,n),r&&t.rotate(r),t.fillStyle=a,t.fillRect(-i/2,-o/2,i,o),r&&t.rotate(-r),t.translate(-e,-n)},intersectBox:function(t,e){return 2*Math.abs(t.x-e.x)<t.width+e.width&&2*Math.abs(t.y-e.y)<t.height+e.height},applyMotion:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e;1!==e&&(t.dx*=e),1!==n&&(t.dy*=n),t.x+=t.dx,t.y+=t.dy},withinRadius:function(t,e,n){var r=t.x-e.x,i=t.y-e.y;return r*r+i*i<=n*n},onDOMLoaded:p,lerp:function(t,e,n){return t+(e-t)*n},distance2D:function(t,e){var n=e.x-t.x,r=e.y-t.y;return Math.sqrt(n*n+r*r)},direction2D:function(t,e){var n=e.x-t.x,r=e.y-t.y;return Math.atan2(r,n)},lookAt2D:function(t,e,n){return v(t+m(e-t,-Math.PI,Math.PI),t-n,t+n)},cycleRange:m,drawCircle:function(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:16,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"white",o=arguments.length>5&&void 0!==arguments[5]&&arguments[5];t.fillStyle=i,t.strokeStyle=i,t.beginPath(),t.arc(e,n,r,0,2*Math.PI),o?t.stroke():t.fill()}});function b(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:320,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:n;g=e,(y=t).width=n,y.height=r}function w(){return g}function x(){return y.clientWidth}function E(){return y.clientHeight}p((function(){if(!y){var t=null,e=null,n=document.querySelector("display-port");n?(t=n.getCanvas(),e=n.getContext()):t=document.querySelector("canvas"),t&&(e||(e=t.getContext("2d")),b(t,e))}}));var k=Object.freeze({__proto__:null,createCanvas:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:320,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:document.body,r=document.createElement("canvas");n.appendChild(r),b(r,t,e)},attachCanvas:b,drawBufferToScreen:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:x(),i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:E();w().drawImage(t.canvas,e,n,r,i)},getCanvas:function(){return y},getDrawContext:w,getClientWidth:x,getClientHeight:E,getClientOffsetX:function(){return y.offsetLeft},getClientOffsetY:function(){return y.offsetTop}}),C=new AudioContext;var O=Object.freeze({__proto__:null,createSound:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n={_playing:!1,_data:null,_source:null,play:function(){var t=this;if(this._data){this._source&&this.destroy();var n=C.createBufferSource();n.loop=e,n.buffer=this._data,n.addEventListener("ended",(function(){t._playing=!1})),n.connect(C.destination),n.start(0),this._source=n,this._playing=!0}},pause:function(){this._source.stop(),this._playing=!1},destroy:function(){this._source&&this._source.disconnect(),this._source=null},isPaused:function(){return!this._playing}};return fetch(t).then((function(t){return t.arrayBuffer()})).then((function(t){return C.decodeAudioData(t)})).then((function(t){return n._data=t})),n}}),M=function(){function t(){e(this,t),this.sourceElement=null,this.eventHandler=null,this.onMouseDown=this.onMouseDown.bind(this),this.onMouseUp=this.onMouseUp.bind(this),this.onMouseMove=this.onMouseMove.bind(this)}return r(t,[{key:"attach",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:document;return this.sourceElement=t,this.sourceElement.addEventListener("mousedown",this.onMouseDown),this.sourceElement.addEventListener("mouseup",this.onMouseUp),this.sourceElement.addEventListener("contextmenu",this.onContextMenu),document.addEventListener("mousemove",this.onMouseMove),this}},{key:"detach",value:function(){return this.sourceElement.removeEventListener("mousedown",this.onMouseDown),this.sourceElement.removeEventListener("mouseup",this.onMouseUp),this.sourceElement.removeEventListener("contextmenu",this.onContextMenu),document.removeEventListener("mousemove",this.onMouseMove),this.sourceElement=null,this}},{key:"setEventHandler",value:function(t){return this.eventHandler=t,this}},{key:"onMouseDown",value:function(t){this.eventHandler&&(this.eventHandler.call(this,"mouse[".concat(t.button,"].down"),!0)&&(t.preventDefault(),t.stopPropagation()))}},{key:"onMouseUp",value:function(t){this.eventHandler&&(t.preventDefault(),t.stopPropagation(),this.eventHandler.call(this,"mouse[".concat(t.button,"].up"),!0))}},{key:"onMouseMove",value:function(t){if(this.eventHandler){var e=this.sourceElement,n=e.clientWidth,r=e.clientHeight;this.eventHandler.call(this,"mouse[pos].x",(t.pageX-e.offsetLeft)/n),this.eventHandler.call(this,"mouse[pos].y",(t.pageY-e.offsetTop)/r),this.eventHandler.call(this,"mouse[pos].dx",t.movementX/n),this.eventHandler.call(this,"mouse[pos].dy",t.movementY/r)}}},{key:"onContextMenu",value:function(t){t.preventDefault(),t.stopPropagation()}}]),t}(),S=function(){function t(){e(this,t),this.sourceElement=null,this.eventHandler=null,this.onKeyDown=this.onKeyDown.bind(this),this.onKeyUp=this.onKeyUp.bind(this)}return r(t,[{key:"attach",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:document;return this.sourceElement=t,this.sourceElement.addEventListener("keydown",this.onKeyDown),this.sourceElement.addEventListener("keyup",this.onKeyUp),this}},{key:"detach",value:function(){return this.sourceElement.removeEventListener("keydown",this.onKeyDown),this.sourceElement.removeEventListener("keyup",this.onKeyUp),this.sourceElement=null,this}},{key:"setEventHandler",value:function(t){return this.eventHandler=t,this}},{key:"onKeyDown",value:function(t){this.eventHandler&&((t.repeat?this.eventHandler.call(this,"key[".concat(t.key,"].repeat"),!0):this.eventHandler.call(this,"key[".concat(t.key,"].down"),!0))&&(t.preventDefault(),t.stopPropagation()))}},{key:"onKeyUp",value:function(t){this.eventHandler&&(this.eventHandler.call(this,"key[".concat(t.key,"].up"),!0)&&(t.preventDefault(),t.stopPropagation()))}}]),t}(),A=Symbol("any"),T=function(){function t(n,r,i){e(this,t),this.source=n,this.code=r,this.mode=i,this.string="".concat(this.source.toString(),"[").concat(this.code.toString(),"].").concat(this.mode.toString())}return r(t,null,[{key:"parse",value:function(e){var n=e.indexOf("["),r=e.indexOf("]"),i=e.indexOf(".");return new t(n<=0||0===i?A:e.substring(0,n),n<0||r<0||n+1===r?A:e.substring(n+1,r),i<0||e.trim().endsWith(".")?A:e.substring(i+1))}}]),r(t,[{key:"matches",value:function(t){return!(this.source!==A&&t.source!==A&&this.source!==t.source||this.code!==A&&t.code!==A&&this.code!==t.code||this.mode!==A&&t.mode!==A&&this.mode!==t.mode)}},{key:"toString",value:function(){return this.string}}]),t}();T.ANY=A;var R=function(){function t(n){e(this,t),this.prev=n,this.value=n,this.next=n}return r(t,[{key:"update",value:function(t,e){return!1}},{key:"consume",value:function(){return this.next}},{key:"poll",value:function(){return this.prev=this.value,this.value=this.next,this.next=this.consume(),this}}]),t}(),j=function(t){function n(t){var r;e(this,n),(r=f(this,s(n).call(this,!1))).eventKeys=[];var i=!0,o=!1,a=void 0;try{for(var u,c=t[Symbol.iterator]();!(i=(u=c.next()).done);i=!0){var l=u.value;r.eventKeys.push(T.parse(l))}}catch(t){o=!0,a=t}finally{try{i||null==c.return||c.return()}finally{if(o)throw a}}return r}return a(n,t),r(n,[{key:"consume",value:function(){return!1}},{key:"update",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=!0,r=!1,i=void 0;try{for(var o,a=this.eventKeys[Symbol.iterator]();!(n=(o=a.next()).done);n=!0){var s=o.value;if(s.matches(t))return this.next=e,!0}}catch(t){r=!0,i=t}finally{try{n||null==a.return||a.return()}finally{if(r)throw i}}return!1}}]),n}(R),D=function(t){function n(t){var r;return e(this,n),(r=f(this,s(n).call(this,0))).eventKey=T.parse(t),r}return a(n,t),r(n,[{key:"consume",value:function(){switch(this.eventKey.string){case"mouse[pos].dx":case"mouse[pos].dy":return 0;case"mouse[pos].x":case"mouse[pos].y":default:return this.next}}},{key:"update",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return!!this.eventKey.matches(t)&&(this.next=e,!0)}}]),n}(R),H=function(t){function n(t){var r;e(this,n),(r=f(this,s(n).call(this,0))).eventKeyEntries=[];for(var i=0,o=Object.keys(t);i<o.length;i++){var a=o[i];r.eventKeyEntries.push({key:T.parse(a),value:t[a]})}return r}return a(n,t),r(n,[{key:"update",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(e){var n=!0,r=!1,i=void 0;try{for(var o,a=this.eventKeyEntries[Symbol.iterator]();!(n=(o=a.next()).done);n=!0){var s=o.value;if(s.key.matches(t))return this.next=s.value,!0}}catch(t){r=!0,i=t}finally{try{n||null==a.return||a.return()}finally{if(r)throw i}}}return!1}}]),n}(R);function P(){return{_source:null,_priority:0,_active:!0,inputs:new Map,get active(){return this._active},get source(){return this._source},get priority(){return this._priority},attach:function(t){return this._source=t,this._source.addContext(this),this},detach:function(){return this._source.removeContext(this),this._source=null,this},setPriority:function(t){if(t>100||t<-100)throw new Error("Context priority must be between [".concat(-100,", ").concat(100,"]."));return this._priority!==t&&(this._source?(this._source.removeContext(this),this._priority=t,this._source.addContext(this)):this._priority=t),this},registerInput:function(t,e){return this.inputs.set(t,e),e},registerAction:function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return this.registerInput(t,new j(n))},registerRange:function(t,e){return this.registerInput(t,new D(e))},registerState:function(t,e){return this.registerInput(t,new H(e))},toggle:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;return void 0===t&&(t=!this._active),this._active=t,this},enable:function(){return this.toggle(!0)},disable:function(){return this.toggle(!1)},poll:function(){var t=!0,e=!1,n=void 0;try{for(var r,i=this.inputs.values()[Symbol.iterator]();!(t=(r=i.next()).done);t=!0){r.value.poll()}}catch(t){e=!0,n=t}finally{try{t||null==i.return||i.return()}finally{if(e)throw n}}},update:function(t,e){var n,r=!0,i=!1,o=void 0;try{for(var a,s=this.inputs.values()[Symbol.iterator]();!(r=(a=s.next()).done);r=!0){n|=a.value.update(t,e)}}catch(t){i=!0,o=t}finally{try{r||null==s.return||s.return()}finally{if(i)throw o}}return n}}}function L(){var t={_contexts:new Array(200),element:null,keyboard:new S,mouse:new M,attach:function(t){return this.element=t,this.keyboard.attach(),this.mouse.attach(t),this},detach:function(){return this.element=null,this.keyboard.detach(),this.mouse.detach(),this},addContext:function(t){var e=t.priority- -100;return this._contexts[e]||(this._contexts[e]=[]),this._contexts[e].push(t),this},removeContext:function(t){var e=t.priority- -100,n=this._contexts[e];return n&&n.splice(n.indexOf(t),1),this},poll:function(){var t=!0,e=!1,n=void 0;try{for(var r,i=this._contexts[Symbol.iterator]();!(t=(r=i.next()).done);t=!0){var o=r.value;if(o){var a=!0,s=!1,u=void 0;try{for(var c,l=o[Symbol.iterator]();!(a=(c=l.next()).done);a=!0){var h=c.value;h.active&&h.poll()}}catch(t){s=!0,u=t}finally{try{a||null==l.return||l.return()}finally{if(s)throw u}}}}}catch(t){e=!0,n=t}finally{try{t||null==i.return||i.return()}finally{if(e)throw n}}},handleEvent:function(t,e){var n=T.parse(t),r=!0,i=!1,o=void 0;try{for(var a,s=this._contexts[Symbol.iterator]();!(r=(a=s.next()).done);r=!0){var u=a.value;if(u){var c=!0,l=!1,h=void 0;try{for(var d,f=u[Symbol.iterator]();!(c=(d=f.next()).done);c=!0){var v=d.value;if(v.active){if(v.update(n,e))return!0}}}catch(t){l=!0,h=t}finally{try{c||null==f.return||f.return()}finally{if(l)throw h}}}}}catch(t){i=!0,o=t}finally{try{r||null==s.return||s.return()}finally{if(i)throw o}}return!1}};return t.handleEvent=t.handleEvent.bind(t),t.keyboard.setEventHandler(t.handleEvent),t.mouse.setEventHandler(t.handleEvent),t}var I=L(),F=P().attach(I);function K(t){return I.element&&I.detach(),I.attach(t)}p((function(){if(!I.element){var t=null,e=document.querySelector("display-port");(t=e?e.getCanvas():document.querySelector("canvas"))&&K(t)}}));var q=1;function z(){return"__input#".concat(q++)}var U=Object.freeze({__proto__:null,attachCanvas:K,createContext:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return P().setPriority(t).toggle(e).attach(I)},createInput:function(t){return F.registerInput(z(),t)},createAction:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return F.registerAction.apply(F,[z()].concat(e))},createRange:function(t){return F.registerRange(z(),t)},createState:function(t){return F.registerState(z(),t)},poll:function(){return I.poll()},handleEvent:function(t,e){return I.handleEvent(t,e)}}),N=function(){function t(n){e(this,t),this._seed=n}return r(t,[{key:"random",value:function(){return Math.random()}},{key:"randomRange",value:function(t,e){return this.random()*(e-t)+t}},{key:"randomChoose",value:function(t){return t[Math.floor(this.random()*t.length)]}},{key:"randomSign",value:function(){return this.random()<.5?-1:1}},{key:"seed",get:function(){return this._seed}}]),t}(),B=function(t){function n(){var t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return e(this,n),(t=f(this,s(n).call(this,Math.abs(r%2147483647))))._next=t.seed,t}return a(n,t),r(n,[{key:"random",value:function(){return this._next=Math.abs(16807*this._next%2147483647-1),this._next/2147483646}}]),n}(N),X=new N;var Y=Object.freeze({__proto__:null,createRandom:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return new B(t)},random:function(){return X.random()},randomRange:function(t,e){return X.randomRange(t,e)},randomChoose:function(t){return X.randomChoose(t)},randomSign:function(){return X.randomSign()}});var G=Object.freeze({__proto__:null,createView:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:320,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t,n=document.createElement("canvas");n.width=t,n.height=e,n.style="image-rendering: pixelated";var r=n.getContext("2d");r.imageSmoothingEnabled=!1;var i={canvas:n,context:r,width:t,height:e,offsetX:0,offsetY:0};return i}}),W='\n<style>\n    :host {\n        display: inline-block;\n        color: #555555;\n    }\n    div {\n        display: flex;\n        position: relative;\n        width: 100%;\n        height: 100%;\n    }\n    canvas {\n        background: #000000;\n        margin: auto;\n    }\n    label {\n        font-family: monospace;\n        color: currentColor;\n        position: absolute;\n    }\n    #title {\n        left: 0.5rem;\n        top: 0.5rem;\n    }\n    #fps {\n        right: 0.5rem;\n        top: 0.5rem;\n    }\n    #dimension {\n        left: 0.5rem;\n        bottom: 0.5rem;\n    }\n    .hidden {\n        display: none;\n    }\n    :host([debug]) div {\n        outline: 8px dashed rgba(0, 0, 0, 0.4);\n        outline-offset: -4px;\n        background-color: rgba(0, 0, 0, 0.1);\n    }\n    :host([mode="'.concat("none",'"]) canvas, :host([mode="').concat("topleft",'"]) canvas {\n        margin: 0;\n        top: 0;\n        left: 0;\n    }\n    :host([mode="').concat("fit",'"]), :host([mode="').concat("center",'"]) {\n        width: 100vw;\n        height: 100vh;\n    }\n</style>'),V=function(t){function n(){var t;return e(this,n),(t=f(this,s(n).call(this))).attachShadow({mode:"open"}),t.shadowRoot.innerHTML="<div>".concat(W).concat('\n<label class="hidden" id="title">display-port</label>\n<label class="hidden" id="fps">00</label>\n<label class="hidden" id="dimension">0x0</label>\n<canvas></canvas>',"</div>"),t._canvasElement=t.shadowRoot.querySelector("canvas"),t._canvasContext=t._canvasElement.getContext("2d"),t._canvasContext.imageSmoothingEnabled=!1,t._titleElement=t.shadowRoot.querySelector("#title"),t._fpsElement=t.shadowRoot.querySelector("#fps"),t._dimensionElement=t.shadowRoot.querySelector("#dimension"),t._animationRequestHandle=0,t._prevAnimationFrameTime=0,t._width=300,t._height=300,t.update=t.update.bind(d(t)),t}return a(n,t),r(n,null,[{key:"observedAttributes",get:function(){return["width","height","id","class","debug"]}}]),r(n,[{key:"connectedCallback",value:function(){this.hasAttribute("mode")||(this.mode="center"),this.updateCanvasSize(),this.resume()}},{key:"disconnectedCallback",value:function(){this.pause()}},{key:"attributeChangedCallback",value:function(t,e,n){switch(t){case"width":this._width=n;break;case"height":this._height=n;break;case"id":case"class":this._titleElement.innerHTML="display-port".concat(this.className?"."+this.className:"").concat(this.hasAttribute("id")?"#"+this.getAttribute("id"):"");break;case"debug":this._titleElement.classList.toggle("hidden",n),this._fpsElement.classList.toggle("hidden",n),this._dimensionElement.classList.toggle("hidden",n)}}},{key:"update",value:function(t){if(this._animationRequestHandle=requestAnimationFrame(this.update),this.updateCanvasSize(),this.debug){var e=t-this._prevAnimationFrameTime,n=e<=0?"--":String(Math.round(1e3/e)).padStart(2,"0");this._prevAnimationFrameTime=t,this._fpsElement.innerText=n,this._dimensionElement.innerText="".concat(this._width,"x").concat(this._height,"|").concat(this.shadowRoot.host.clientWidth,"x").concat(this.shadowRoot.host.clientHeight)}this.dispatchEvent(new CustomEvent("frame",{detail:{now:t,context:this._canvasContext},bubbles:!1,composed:!0}))}},{key:"pause",value:function(){cancelAnimationFrame(this._animationRequestHandle)}},{key:"resume",value:function(){this._animationRequestHandle=requestAnimationFrame(this.update)}},{key:"updateCanvasSize",value:function(){var t=this.shadowRoot.host.getBoundingClientRect(),e=t.width,n=t.height,r=this._canvasElement,i=this._width,o=this._height,a=this.mode;if("topleft"!==a&&(e<i||n<o||"fit"===a)){var s=e/i,u=n/o;s<u?(i=e,o*=s):(i*=u,o=n)}i=Math.floor(i),o=Math.floor(o),r.width===i&&r.height===o||(r.width=i,r.height=o,r.style="width: ".concat(i,"px; height: ").concat(o,"px"),this.dispatchEvent(new CustomEvent("resize",{detail:{width:i,height:o},bubbles:!1,composed:!0})))}},{key:"drawBufferToCanvas",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.width,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.height;this._canvasContext.drawImage(t.canvas,e,n,r,i)}},{key:"getCanvas",value:function(){return this._canvasElement}},{key:"getContext",value:function(){return this._canvasContext}},{key:"width",get:function(){return this._width},set:function(t){return this.setAttribute("width",t)}},{key:"height",get:function(){return this._height},set:function(t){return this.setAttribute("height",t)}},{key:"mode",get:function(){return this.getAttribute("mode")},set:function(t){return this.setAttribute("mode",t)}},{key:"debug",get:function(){return this.hasAttribute("debug")},set:function(t){t?this.setAttribute("debug",""):this.removeAttribute("debug")}}]),n}(h(HTMLElement));window.customElements.define("display-port",V);var J=Object.freeze({__proto__:null,MODE_NONE:"none",MODE_TOPLEFT:"topleft",MODE_CENTER:"center",MODE_FIT:"fit",DisplayPort:V}),Q=function(t){function n(t){var r;return e(this,n),(r=f(this,s(n).call(this,t))).actionTime=0,r}return a(n,t),r(n,[{key:"update",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=Date.now(),r=!0,i=!1,o=void 0;try{for(var a,s=this.eventKeys[Symbol.iterator]();!(r=(a=s.next()).done);r=!0){var u=a.value;if(u.matches(t))return e?n-this.actionTime<=300?(this.actionTime=0,this.next=!0,!0):(this.actionTime=n,!1):(this.next=!1,!0)}}catch(t){i=!0,o=t}finally{try{r||null==s.return||s.return()}finally{if(i)throw o}}return!1}}]),n}(j),Z=Object.freeze({__proto__:null,EventKey:T,MIN_CONTEXT_PRIORITY:-100,MAX_CONTEXT_PRIORITY:100,createContext:P,createSource:L,AbstractInputAdapter:R,ActionInputAdapter:j,DOUBLE_ACTION_TIME:300,DoubleActionInputAdapter:Q,RangeInputAdapter:D,StateInputAdapter:H,Keyboard:S,Mouse:M}),$=Object.freeze({__proto__:null,RandomGenerator:N,SimpleRandomGenerator:B}),tt={on:function(t,e){var n,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e;if(this.__events.has(t)?n=this.__events.get(t):(n=new Map,this.__events.set(t,n)),n.has(r))throw new Error("Found callback for event '".concat(t,"' with the same handle '").concat(r,"'."));return n.set(r,e),this},off:function(t,e){if(!this.__events.has(t))throw new Error("Unable to find event '".concat(t,"'."));var n=this.__events.get(t);if(!n.has(e))throw new Error("Unable to find callback for event '".concat(t,"' with handle '").concat(e,"'."));return n.delete(e),this},once:function(t,e){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e,i=function(){n.off(t,r);for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];e.apply(n.__context||n,o)};return this.on(t,i,r)},emit:function(t){if(this.__events.has(t)){for(var e=Array.from(this.__events.get(t).values()),n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];for(var o=0,a=e;o<a.length;o++){var s=a[o];s.apply(this.__context||this,r)}}else this.__events.set(t,new Map);return this}};function et(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0,e=Object.create(tt);return e.__events=new Map,e.__context=t,e}function nt(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,n=Object.assign(t,tt);return n.__events=new Map,n.__context=e,n}function rt(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,n=t.prototype;return Object.assign(n,tt),n.__events=new Map,n.__context=e,n}var it={create:et,assign:nt,mixin:rt},ot=Object.freeze({__proto__:null,create:et,assign:nt,mixin:rt,default:it}),at=new Map;function st(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t,n=ut(t);return at.set(e,n),n}function ut(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=et(t);return e.prevFrameTime=0,e.animationFrameHandle=null,e.gameContext=t,e.frameTime=1e3/60,e.setFrameTime=function(t){return this.frameTime=t,this},e.run=function(t){this.animationFrameHandle=requestAnimationFrame(this.run);var e=(t-this.prevFrameTime)/this.frameTime;this.prevFrameTime=t,"function"==typeof this.gameContext.update&&this.gameContext.update.call(this.gameContext,e),this.emit("update",e)}.bind(e),e.start=function(){this.prevFrameTime=0,"function"==typeof this.gameContext.start&&this.gameContext.start.call(this.gameContext),this.emit("start"),this.run(0)}.bind(e),e.stop=function(){cancelAnimationFrame(this.animationFrameHandle),this.animationFrameHandle=null,"function"==typeof this.gameContext.stop&&this.gameContext.stop.call(this.gameContext),this.emit("stop")}.bind(e),e}var ct=Object.freeze({__proto__:null,INSTANCES:at,DEFAULT_FRAME_TIME:1e3/60,start:function(){var e,n,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;return at.has(r)?e=at.get(r):(n="object"===t(r)?r:{},e=st(n,r)),setTimeout((function(){return e.start()}),0),e},stop:function(t){if(at.has(t)){var e=at.get(t);return e.stop(),e}return null},registerGameLoop:st,createGameLoop:ut});return function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?o(Object(n),!0).forEach((function(e){i(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}({Display:k,Audio:O,Input:U,Random:Y,Viewport:G,Utils:_},J,{},Z,{},$,{},Object.freeze({__proto__:null,Eventable:ot,GameLoop:ct}))}));
