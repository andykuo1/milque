!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("gl-matrix")):"function"==typeof define&&define.amd?define(["exports","gl-matrix"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).Scene={},e.glMatrix)}(this,(function(e,t){"use strict";const s=t.vec3.fromValues(0,1,0);class i{constructor(e,t,s){this.canvas=e,this.projectionMatrix=t,this.viewMatrix=s,this.resize=this.resize.bind(this),e.addEventListener("resize",this.resize),setTimeout(this.resize,0)}destroy(){this.canvas.removeEventListener("resize",this.resize)}resize(){}}const r=Math.PI/3;const o=Math.PI/180;function n(e,t,s){e?(s.nodes[e].children.push(t),s.nodes[t].parent=e):(s.roots.push(t),s.nodes[t].parent=0)}function a(e,t,s){if(e){let i=s.nodes[e].children,r=i.indexOf(t);i.splice(r,1),s.nodes[t].parentNode=0}else{let e=s.roots,i=e.indexOf(t);e.splice(i,1),s.nodes[t].parentNode=0}}function c(e,t,s,i,r){if(s>=100)return;let o=i(t,e);if(!1===o)return;let n=e.nodes[t],a=r?r(n.children,t,e):n.children;for(let t of a)c(e,t,s+1,i,r);"function"==typeof o&&o(t,e)}function h(e,t){delete t.nodes[e]}e.Camera=i,e.FirstPersonCameraController=class{constructor(e={locky:!1}){this.locky=e.locky,this.position=t.vec3.create(),this.forward=t.vec3.fromValues(0,0,-1),this.right=t.vec3.fromValues(1,0,0),this.up=t.vec3.fromValues(0,1,0),this.forwardAmount=0,this.rightAmount=0,this.upAmount=0,this.pitch=0,this.yaw=-90}look(e,t,s=1){return this.pitch=Math.min(89.9,Math.max(-89.9,this.pitch+t*s)),this.yaw=(this.yaw+e*s)%360,this}move(e,t=0,s=0,i=1){return this.forwardAmount+=e*i,this.rightAmount+=t*i,this.upAmount+=s*i,this}apply(e){let{position:s,forward:i,right:r,up:n,forwardAmount:a,rightAmount:c,upAmount:h,pitch:l,yaw:d}=this,u=d*o,f=l*o,p=Math.cos(u),m=Math.cos(f),v=Math.sin(u),g=p*m,y=Math.sin(f),A=v*m;t.vec3.normalize(i,t.vec3.set(i,g,y,A)),t.vec3.normalize(r,t.vec3.cross(r,i,n));let w=t.vec3.create(),x=s[1];t.vec3.scale(w,i,a),t.vec3.add(s,s,w),t.vec3.scale(w,r,c),t.vec3.add(s,s,w),this.locky&&(s[1]=x),t.vec3.scale(w,n,h),t.vec3.add(s,s,w),this.forwardAmount=0,this.rightAmount=0,this.upAmount=0;let M=t.vec3.add(w,s,i);return t.mat4.lookAt(e,s,M,n),e}},e.OrthographicCamera=class extends i{constructor(e,s,i,r,o,n,a){super(e,t.mat4.create(),t.mat4.create()),this.bounds={left:s,top:i,right:r,bottom:o},this.clippingPlane={near:n,far:a}}resize(){const e=this.canvas.width/this.canvas.height,{near:s,far:i}=this.clippingPlane,{left:r,top:o,right:n,bottom:a}=this.bounds;t.mat4.ortho(this.projectionMatrix,r*e,n*e,a,o,s,i)}},e.PerspectiveCamera=class extends i{constructor(e,s=r,i=.1,o=1e3){super(e,t.mat4.create(),t.mat4.create()),this.fieldOfView=s,this.clippingPlane={near:i,far:o}}resize(){const e=this.canvas.width/this.canvas.height,{near:s,far:i}=this.clippingPlane;t.mat4.perspective(this.projectionMatrix,this.fieldOfView,e,s,i)}},e.SceneGraph=class{constructor(){this.nodes={},this.roots=[],this._nextAvailableSceneNodeId=1}createSceneNode(e){let t=this._nextAvailableSceneNodeId++,s={parent:0,children:[]};return this.nodes[t]=s,n(e,t,this),t}createSceneNodes(e,t){let s=[];for(let i=0;i<e;++i)s.push(this.createSceneNode(t));return s}deleteSceneNode(e){if(!(e in this.nodes))throw new Error("Cannot delete non-existant scene node for scene graph.");a(this.nodes[e].parent,e,this),c(this,e,0,h)}deleteSceneNodes(e){for(let t of e)this.deleteSceneNode(t)}getSceneNodeInfo(e){return this.nodes[e]}parentSceneNode(e,t){a(this.nodes[e].parent,e,this),n(t,e,this)}replaceSceneNode(e,t){let s=this.nodes[e],i=s.parent,r=s.children.slice();if(a(i,e,this),s.children.length=0,t){let e=this.nodes[t];a(e.parent,t,this),e.children.push(...r),n(i,t,this)}else if(i){this.nodes[i].children.push(...r)}else this.roots.push(...r);for(let e of r)this.nodes[e].parent=i}walk(e,t={}){const{from:s,childFilter:i}=t;let r;r=s?Array.isArray(s)?s:[s]:this.roots,i&&(r=i(r,0,this));for(let t of r)c(this,t,0,e,i)}},e.lookAt=function(e,i,r,o=0,n=1){let a=t.vec3.create(),c=t.quat.create();t.mat4.getTranslation(a,e),t.mat4.getRotation(c,e);let h=t.vec3.fromValues(i,r,o);t.mat4.lookAt(e,a,h,s);let l=t.quat.create();t.mat4.getRotation(e,l),t.quat.slerp(c,c,l,n),t.mat4.fromRotationTranslation(e,c,a)},e.panTo=function(e,s,i,r=0,o=1){let n=t.vec3.create();t.mat4.getTranslation(n,e);let a=t.vec3.fromValues((s-n[0])*o,(i-n[1])*o,(r-n[2])*o);t.mat4.translate(e,e,a)},e.screenToWorldRay=function(e,s,i,r){let o=t.vec4.fromValues(e,s,-1,1),n=t.mat4.create();t.mat4.invert(n,i),t.vec4.transformMat4(o,o,n),o[2]=-1,o[3]=0,t.mat4.invert(n,r),t.vec4.transformMat4(o,o,n);let a=t.vec3.fromValues(o[0],o[1],o[2]);return t.vec3.normalize(a,a),a},Object.defineProperty(e,"__esModule",{value:!0})}));
