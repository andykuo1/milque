!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("gl-matrix")):"function"==typeof define&&define.amd?define(["exports","gl-matrix"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).Scene={},e.glMatrix)}(this,(function(e,t){"use strict";const o=t.vec3.fromValues(0,1,0);class r{constructor(e,t){this.projectionMatrix=e,this.viewMatrix=t}resize(e,t){return this}}const s=Math.PI/3;const n=Math.PI/180;function i(e,t,o){e?(o.nodes[e].children.push(t),o.nodes[t].parent=e):(o.roots.push(t),o.nodes[t].parent=0)}function a(e,t,o){if(e){let r=o.nodes[e].children,s=r.indexOf(t);r.splice(s,1),o.nodes[t].parentNode=0}else{let e=o.roots,r=e.indexOf(t);e.splice(r,1),o.nodes[t].parentNode=0}}function c(e,t,o,r,s){if(o>=100)return;let n=r(t,e);if(!1===n)return;let i=e.nodes[t],a=s?s(i.children,t,e):i.children;for(let t of a)c(e,t,o+1,r,s);"function"==typeof n&&n(t,e)}function h(e,t){delete t.nodes[e]}e.Camera=r,e.FirstPersonCameraController=class{constructor(e={locky:!1}){this.locky=e.locky,this.position=t.vec3.create(),this.forward=t.vec3.fromValues(0,0,-1),this.right=t.vec3.fromValues(1,0,0),this.up=t.vec3.fromValues(0,1,0),this.forwardAmount=0,this.rightAmount=0,this.upAmount=0,this.pitch=0,this.yaw=-90}look(e,t,o=1){return this.pitch=Math.min(89.9,Math.max(-89.9,this.pitch+t*o)),this.yaw=(this.yaw+e*o)%360,this}move(e,t=0,o=0,r=1){return this.forwardAmount+=e*r,this.rightAmount+=t*r,this.upAmount+=o*r,this}apply(e){let{position:o,forward:r,right:s,up:i,forwardAmount:a,rightAmount:c,upAmount:h,pitch:l,yaw:d}=this,u=d*n,f=l*n,p=Math.cos(u),m=Math.cos(f),v=Math.sin(u),g=p*m,y=Math.sin(f),A=v*m;t.vec3.normalize(r,t.vec3.set(r,g,this.locky?0:y,A)),t.vec3.normalize(s,t.vec3.cross(s,r,i));let x=t.vec3.create();t.vec3.scale(x,r,a),t.vec3.add(o,o,x),t.vec3.scale(x,s,c),t.vec3.add(o,o,x),t.vec3.scale(x,i,h),t.vec3.add(o,o,x),this.forwardAmount=0,this.rightAmount=0,this.upAmount=0,this.locky&&t.vec3.set(r,g,y,A);let w=t.vec3.add(x,o,r);return t.mat4.lookAt(e,o,w,i),e}},e.OrthographicCamera=class extends r{constructor(e,o,r,s,n,i){super(t.mat4.create(),t.mat4.create()),this.bounds={left:e,top:o,right:r,bottom:s},this.clippingPlane={near:n,far:i}}resize(e,o){const r=e/o,{near:s,far:n}=this.clippingPlane,{left:i,top:a,right:c,bottom:h}=this.bounds;return t.mat4.ortho(this.projectionMatrix,i*r,c*r,h,a,s,n),this}},e.PerspectiveCamera=class extends r{constructor(e=s,o=.1,r=1e3){super(t.mat4.create(),t.mat4.create()),this.fieldOfView=e,this.clippingPlane={near:o,far:r}}resize(e,o){const r=e/o,{near:s,far:n}=this.clippingPlane;return t.mat4.perspective(this.projectionMatrix,this.fieldOfView,r,s,n),this}},e.SceneGraph=class{constructor(){this.nodes={},this.roots=[],this._nextAvailableSceneNodeId=1}createSceneNode(e){let t=this._nextAvailableSceneNodeId++,o={parent:0,children:[]};return this.nodes[t]=o,i(e,t,this),t}createSceneNodes(e,t){let o=[];for(let r=0;r<e;++r)o.push(this.createSceneNode(t));return o}deleteSceneNode(e){if(!(e in this.nodes))throw new Error("Cannot delete non-existant scene node for scene graph.");a(this.nodes[e].parent,e,this),c(this,e,0,h)}deleteSceneNodes(e){for(let t of e)this.deleteSceneNode(t)}getSceneNodeInfo(e){return this.nodes[e]}parentSceneNode(e,t){a(this.nodes[e].parent,e,this),i(t,e,this)}replaceSceneNode(e,t){let o=this.nodes[e],r=o.parent,s=o.children.slice();if(a(r,e,this),o.children.length=0,t){let e=this.nodes[t];a(e.parent,t,this),e.children.push(...s),i(r,t,this)}else if(r){this.nodes[r].children.push(...s)}else this.roots.push(...s);for(let e of s)this.nodes[e].parent=r}walk(e,t={}){const{from:o,childFilter:r}=t;let s;s=o?Array.isArray(o)?o:[o]:this.roots,r&&(s=r(s,0,this));for(let t of s)c(this,t,0,e,r)}},e.lookAt=function(e,r,s,n=0,i=1){let a=t.vec3.create(),c=t.quat.create();t.mat4.getTranslation(a,e),t.mat4.getRotation(c,e);let h=t.vec3.fromValues(r,s,n);t.mat4.lookAt(e,a,h,o);let l=t.quat.create();t.mat4.getRotation(l,e),t.quat.slerp(c,c,l,i),t.mat4.fromRotationTranslation(e,c,a)},e.panTo=function(e,o,r,s=0,n=1){let i=t.vec3.create();t.mat4.getTranslation(i,e);let a=t.vec3.fromValues((o-i[0])*n,(r-i[1])*n,(s-i[2])*n);t.mat4.translate(e,e,a)},e.screenToWorldRay=function(e,o,r,s,n,i=!1){let a=t.vec4.fromValues(o,r,-1,1),c=t.mat4.create();return t.mat4.invert(c,s),t.vec4.transformMat4(a,a,c),a[2]=-1,a[3]=0,t.mat4.invert(c,n),t.vec4.transformMat4(a,a,c),e[0]=a[0],e[1]=a[1],e[2]=a[2],i&&t.vec3.normalize(e,e),e},Object.defineProperty(e,"__esModule",{value:!0})}));
