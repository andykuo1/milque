!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("gl-matrix")):"function"==typeof define&&define.amd?define(["exports","gl-matrix"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).Milque={},t.glMatrix)}(this,(function(t,e){"use strict";const r="noscale",n=Symbol("template"),s=Symbol("style");class i extends HTMLElement{static get[n](){let t=document.createElement("template");return t.innerHTML='<div class="container">\r\n    <label class="hidden" id="title">display-port</label>\r\n    <label class="hidden" id="fps">00</label>\r\n    <label class="hidden" id="dimension">0x0</label>\r\n    <canvas></canvas>\r\n    <slot></slot>\r\n</div>',Object.defineProperty(this,n,{value:t}),t}static get[s](){let t=document.createElement("style");return t.innerHTML=":host{display:inline-block;color:#555}.container{display:flex;position:relative;width:100%;height:100%}canvas{background:#000;margin:auto;-ms-interpolation-mode:nearest-neighbor;image-rendering:-moz-crisp-edges;image-rendering:pixelated}label{font-family:monospace;color:currentColor;position:absolute}#title{left:.5rem;top:.5rem}#fps{right:.5rem;top:.5rem}#dimension{left:.5rem;bottom:.5rem}.hidden{display:none}:host([debug]) .container{outline:6px dashed rgba(0,0,0,.1);outline-offset:-4px;background-color:rgba(0,0,0,.1)}:host([mode=noscale]) canvas{margin:0;top:0;left:0}:host([mode=center]),:host([mode=fit]),:host([mode=stretch]){width:100%;height:100%}:host([full]){width:100vw!important;height:100vh!important}:host([disabled]){display:none}slot{display:flex;flex-direction:column;align-items:center;justify-content:center;position:absolute;width:100%;height:100%;top:0;left:0;pointer-events:none}::slotted(*){pointer-events:auto}",Object.defineProperty(this,s,{value:t}),t}static get observedAttributes(){return["width","height","disabled","onframe","debug","id","class"]}constructor(){super(),this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(this.constructor[n].content.cloneNode(!0)),this.shadowRoot.appendChild(this.constructor[s].cloneNode(!0)),this._canvasElement=this.shadowRoot.querySelector("canvas"),this._titleElement=this.shadowRoot.querySelector("#title"),this._fpsElement=this.shadowRoot.querySelector("#fps"),this._dimensionElement=this.shadowRoot.querySelector("#dimension"),this._animationRequestHandle=0,this._prevAnimationFrameTime=0,this._width=300,this._height=150,this._onframe=null,this.update=this.update.bind(this)}get canvas(){return this._canvasElement}connectedCallback(){this.hasAttribute("mode")||(this.mode="noscale"),this.hasAttribute("tabindex")||this.setAttribute("tabindex",0),this.updateCanvasSize(),this.resume()}disconnectedCallback(){this.pause()}attributeChangedCallback(t,e,r){switch(t){case"width":this._width=r;break;case"height":this._height=r;break;case"disabled":r?(this.update(0),this.pause()):this.resume();break;case"onframe":this.onframe=new Function("event",`with(document){with(this){${r}}}`).bind(this);break;case"id":case"class":this._titleElement.innerHTML=`display-port${this.className?"."+this.className:""}${this.hasAttribute("id")?"#"+this.getAttribute("id"):""}`;break;case"debug":this._titleElement.classList.toggle("hidden",r),this._fpsElement.classList.toggle("hidden",r),this._dimensionElement.classList.toggle("hidden",r)}}update(t){this._animationRequestHandle=requestAnimationFrame(this.update),this.updateCanvasSize();const e=t-this._prevAnimationFrameTime;if(this._prevAnimationFrameTime=t,this.debug){const t=e<=0?"--":String(Math.round(1e3/e)).padStart(2,"0");if(this._fpsElement.innerText!==t&&(this._fpsElement.innerText=t),this.mode===r){let t=`${this._width}x${this._height}`;this._dimensionElement.innerText!==t&&(this._dimensionElement.innerText=t)}else{let t=`${this._width}x${this._height}|${this.shadowRoot.host.clientWidth}x${this.shadowRoot.host.clientHeight}`;this._dimensionElement.innerText!==t&&(this._dimensionElement.innerText=t)}}this.dispatchEvent(new CustomEvent("frame",{detail:{now:t,prevTime:this._prevAnimationFrameTime,deltaTime:e,canvas:this._canvasElement,get context(){let t=this.canvas.getContext("2d");return t.imageSmoothingEnabled=!1,t}},bubbles:!1,composed:!0}))}pause(){cancelAnimationFrame(this._animationRequestHandle)}resume(){this._animationRequestHandle=requestAnimationFrame(this.update)}updateCanvasSize(){let t=this.shadowRoot.host.getBoundingClientRect();const e=t.width,n=t.height;let s=this._canvasElement,i=this._width,o=this._height;const a=this.mode;if("stretch"===a)i=e,o=n;else if(a!==r){if(e<i||n<o||"fit"===a){let t=e/i,r=n/o;t<r?(i=e,o*=t):(i*=r,o=n)}}i=Math.floor(i),o=Math.floor(o),s.clientWidth===i&&s.clientHeight===o||(s.width=this._width,s.height=this._height,s.style=`width: ${i}px; height: ${o}px`,this.dispatchEvent(new CustomEvent("resize",{detail:{width:i,height:o},bubbles:!1,composed:!0})))}get onframe(){return this._onframe}set onframe(t){this._onframe&&this.removeEventListener("frame",this._onframe),this._onframe=t,this._onframe&&this.addEventListener("frame",t)}get width(){return this._width}set width(t){this.setAttribute("width",t)}get height(){return this._height}set height(t){this.setAttribute("height",t)}get mode(){return this.getAttribute("mode")}set mode(t){this.setAttribute("mode",t)}get disabled(){return this.hasAttribute("disabled")}set disabled(t){t?this.setAttribute("disabled",""):this.removeAttribute("disabled")}get debug(){return this.hasAttribute("debug")}set debug(t){t?this.setAttribute("debug",""):this.removeAttribute("debug")}}window.customElements.define("display-port",i);const o={NULL:0,DOWN:1,UP:2,MOVE:3,parse(t){if("string"!=typeof t)return o.NULL;switch(t.toLowerCase()){case"down":return o.DOWN;case"up":return o.UP;case"move":return o.MOVE;default:return o.NULL}}};class a{static createAdapter(t,e,r,n,s,i){return{target:t,adapterId:e,deviceName:r,keyCode:n,scale:s,eventCode:i}}constructor(){this.adapters={"*":l()}}add(t){for(let e of t){const{deviceName:t,keyCode:r}=e;let n;t in this.adapters?n=this.adapters[t]:(n=l(),this.adapters[t]=n),r in n?n[r].push(e):n[r]=[e]}}delete(t){for(let e of t){const{deviceName:t,keyCode:r}=e;if(t in this.adapters){let n=this.adapters[t];if(r in n){let t=n[r],s=t.indexOf(e);s>=0&&t.splice(s,1)}}}}clear(){for(let t in this.adapters)this.adapters[t]=l()}poll(t,e,r){const n=this.findAdapters(t,e);for(let t of n){const e=t.eventCode;if(e===o.NULL){const{target:e,scale:n}=t,s=r.value*n;e.poll(s,t)}else{const{target:n,scale:s}=t,i=r.getEvent(e)*s;n.poll(i,t)}}return n.length>0}update(t,e,r){let n=!1;for(let s of this.findAdapters(t,e)){const t=s.eventCode;if(t!==o.NULL){const{target:e,scale:i}=s,o=r.getEvent(t)*i;e.update(o,s),n=!0}}return n}reset(t,e,r){let n=!1;for(let r of this.findAdapters(t,e))r.target.reset(),n=!0;return n}findAdapters(t,e){let r=[];if(t in this.adapters){let n=this.adapters[t];e in n&&r.push(...n[e]),r.push(...n["*"])}let n=this.adapters["*"];return e in n&&r.push(...n[e]),r.push(...n["*"]),r}}function l(){return{"*":[]}}class h extends class{constructor(){this.value=0}update(t){this.value=t}poll(){this.value=0}getEvent(t){return 0}getState(){return this.value}}{constructor(t){super(),this.update=this.update.bind(this),Array.isArray(t)||(t=[t]);let e=[],r=0;for(let n of t){"string"==typeof n&&(n={key:n});const{key:t,scale:s=1,event:i="null"}=n,{deviceName:l,keyCode:h}=u(t),c=o.parse(i),d=Number(s);let f=a.createAdapter(this,r,l,h,d,c);e.push(f),++r}this.adapters=e,this.values=new Array(e.length).fill(0),this.next={values:new Array(e.length).fill(0),value:0}}poll(t,e){const r=e.adapterId;let n=this.values[r];this.values[r]=t,this.value=this.value-n+t,this.next.values[r]=0,this.next.value+=t-n}update(t,e){const r=e.adapterId;let n=this.next.values[r];this.next.values[r]=t,this.next.value+=t-n}reset(){this.values.fill(0),this.value=0,this.next.values.fill(0),this.next.value=0}}function u(t){let e=t.indexOf(":");if(e>=0)return{deviceName:t.substring(0,e),keyCode:t.substring(e+1)};throw new Error("Invalid key string - missing device separator ':'.")}function c(t,e){return`${t}:${e}`}const d=1,f=2;const p=Symbol("inputRefCounts");function m(t,e,r){const n=c(e,r);let s=t[p],i=s[n]+1||1;return s[n]=i,i}function y(t,e,r){const n=c(e,r);let s=t[p],i=s[n]-1||0;return s[n]=Math.max(i,0),i}class g{next(){return Math.random()}}let b;class x{constructor(t=new g){this.generator=t}static next(){return b.next()}next(){return this.generator.next()}static choose(t){return b.choose(t)}choose(t){return t[Math.floor(this.generator.next()*t.length)]}static range(t,e){return b.range(t,e)}range(t,e){return(e-t)*this.generator.next()+t}static sign(){return b.sign()}sign(){return this.generator.next()<.5?-1:1}}b=new x;var _=Object.freeze({__proto__:null,line:function(t,e,r,n,s){let i=Math.floor(t),o=Math.floor(e),a=Math.floor(r),l=Math.floor(n),h=Math.abs(r-t),u=t<r?1:-1,c=-Math.abs(n-e),d=e<n?1:-1,f=h+c,p=i,m=o,y=s(p,m);if(void 0!==y)return y;let g=h*h+c*c,b=0;for(;b<g&&(p!==a||m!==l);){++b;let t=2*f;if(t>=c&&(f+=c,p+=u),t<=h&&(f+=h,m+=d),y=s(p,m),void 0!==y)return y}}});function w(t,e){const r=document.createElement("a"),n=e.indexOf(";");e=e.substring(0,n+1)+"headers=Content-Disposition%3A%20attachment%3B%20filename="+t+";"+e.substring(n+1),r.setAttribute("href",e),r.setAttribute("download",t),r.style.display="none",document.body.appendChild(r),r.click(),document.body.removeChild(r)}const v=["svg","g"];function A(t,e=t.cloneNode(!0)){let r=t.childNodes,n=e.childNodes;for(var s=0;s<n.length;s++){let t=n[s],e=t.tagName;if(-1!=v.indexOf(e))A(r[s],t);else if(r[s]instanceof Element){const e=window.getComputedStyle(r[s]);let n=[];for(let t of Object.keys(e))n.push(`${t}:${e.getPropertyValue(t)};`);t.setAttribute("style",n.join(""))}}return e}var N=Object.freeze({__proto__:null,FILE_TYPE_PNG:"png",FILE_TYPE_SVG:"svg",downloadText:function(t,e){w(t,"data:text/plain; charset=utf-8,"+encodeURIComponent(e))},downloadImageFromSVG:function(t,e,r,n,s){const i=function(t){const e=A(t),r=(new XMLSerializer).serializeToString(e);return new Blob([r],{type:"image/svg+xml"})}(r);switch(e){case"png":{const r=URL.createObjectURL(i),o=document.createElement("canvas"),a=o.getContext("2d"),l=window.devicePixelRatio||1;o.width=n*l,o.height=s*l,o.style.width=n+"px",o.style.height=s+"px",a.setTransform(l,0,0,l,0,0);const h=new Image;h.onload=()=>{a.drawImage(h,0,0),URL.revokeObjectURL(r);const n=o.toDataURL("image/"+e).replace("image/"+e,"image/octet-stream");w(t,n)},h.src=r}break;case"svg":{const e=new FileReader;e.onload=()=>{w(t,e.result)},e.readAsDataURL(i)}break;default:throw new Error("Unknown file type '"+e+"'")}},downloadURL:w});var M=Object.freeze({__proto__:null,uploadFile:async function(t=[],e=!1){return new Promise(((r,n)=>{const s=document.createElement("input");s.addEventListener("change",(t=>{r(e?t.target.files:t.target.files[0])})),s.type="file",s.accept=t.join(","),s.style.display="none",s.toggleAttribute("multiple",e),document.body.appendChild(s),s.click(),document.body.removeChild(s)}))}});const E={5:S("#7F8C8D"),4:S("#2ECC71"),3:S("#4794C8"),2:S("#F39C12"),1:S("#C0392B"),0:[""]};function T(t,e){return t-e}function S(t){return[`background: ${t}`,"border-radius: 0.5em","color: white","font-weight: bold","padding: 2px 0.5em"]}function I(){}function F(t){switch(t){case 5:return console.trace;case 4:case 3:return console.log;case 2:return console.warn;case 1:return console.error;case 0:return I;default:return console.log}}function R(t,e,r,n){if(e&&t.unshift(`[${e}]`),r){let e=[`%c${r}`,E[n].join(";")];t.unshift(e[0],e[1])}return t}const k=Symbol("level"),O=Symbol("domain"),C={};let L=2,z="app";class B{static get TRACE(){return 5}static get DEBUG(){return 4}static get INFO(){return 3}static get WARN(){return 2}static get ERROR(){return 1}static get OFF(){return 0}static getLogger(t){return t in C?C[t]:C[t]=new B(t)}static useDefaultLevel(t){return L=t,this}static useDefaultDomain(t){return z=t,this}constructor(t){this.name=t,this[k]=L,this[O]=z}setLevel(t){return this[k]=t,this}getLevel(){return this[k]}setDomain(t){return this[O]=t,this}getDomain(){return this[O]}log(t,...e){if(T(this[k],t)<0)return this;R(e,this.name,this[O],t),F(t)(...e)}trace(...t){if(T(this[k],5)<0)return this;R(t,this.name,this[O],5),F(5)(...t)}debug(...t){if(T(this[k],4)<0)return this;R(t,this.name,this[O],4),F(4)(...t)}info(...t){if(T(this[k],3)<0)return this;R(t,this.name,this[O],3),F(3)(...t)}warn(...t){if(T(this[k],2)<0)return this;R(t,this.name,this[O],2),F(2)(...t)}error(...t){if(T(this[k],1)<0)return this;R(t,this.name,this[O],1),F(1)(...t)}}var U=Object.freeze({__proto__:null,Logger:B});const P={on(t,e,r=e){let n;if(this.__events.has(t)?n=this.__events.get(t):(n=new Map,this.__events.set(t,n)),n.has(r))throw new Error(`Found callback for event '${t}' with the same handle '${r}'.`);return n.set(r,e),this},off(t,e){if(!this.__events.has(t))throw new Error(`Unable to find event '${t}'.`);{const r=this.__events.get(t);if(!r.has(e))throw new Error(`Unable to find callback for event '${t}' with handle '${e}'.`);r.delete(e)}return this},once(t,e,r=e){return this.on(t,((...n)=>{this.off(t,r),e.apply(this.__context||this,n)}),r)},emit(t,...e){if(this.__events.has(t)){let r=[];const n=Array.from(this.__events.get(t).values());for(const t of n){let n=t.apply(this.__context||this,e);n&&r.push(n)}return r}return this.__events.set(t,new Map),[]}};function j(t){const e=Object.create(P);return e.__events=new Map,e.__context=t,e}function D(t,e){const r=Object.assign(t,P);return r.__events=new Map,r.__context=e,r}function V(t,e){const r=t.prototype;return Object.assign(r,P),r.__events=new Map,r.__context=e,r}var $={create:j,assign:D,mixin:V},G=Object.freeze({__proto__:null,create:j,assign:D,mixin:V,default:$});class q{constructor(t){this._heap=[],this._comparator=t}get size(){return this._heap.length}clear(){this._heap.length=0}push(...t){for(const e of t)this._heap.push(e),this._shiftUp()}pop(){const t=this.peek();let e=this._heap.length-1;return e>0&&this._swap(0,e),this._heap.pop(),this._shiftDown(),t}replace(t){const e=this.peek();return this._heap[0]=t,this._shiftDown(),e}peek(){return this._heap[0]}_compare(t,e){return this._comparator(this._heap[t],this._heap[e])}_swap(t,e){let r=this._heap[t];this._heap[t]=this._heap[e],this._heap[e]=r}_shiftUp(){let t,e=this._heap.length-1;for(;e>0&&this._compare(e,t=(e+1>>>1)-1);)this._swap(e,t),e=t}_shiftDown(){const t=this._heap.length;let e,r=0,n=W(r),s=n<t,i=H(r),o=i<t;for(;s&&this._compare(n,r)||o&&this._compare(i,r);)e=o&&this._compare(i,n)?i:n,this._swap(r,e),r=e,n=W(r),s=n<t,i=H(r),o=i<t}values(){return this._heap}[Symbol.iterator](){return this._heap[Symbol.iterator]()}}function W(t){return 1+(t<<1)}function H(t){return t+1<<1}function Y(t,e,r){return Math.min(r,Math.max(e,t))}function X(t,e,r){let n=r-e,s=(t-e)%n;return s<0&&(s+=n),s+e}const Q=Math.PI/180,J=180/Math.PI;function Z(t,e,r){if(r.has(e))throw new Error(`Found cyclic dependency for '${e.name||e}'.`);if(!t.visited.has(e)){if(t.visited.add(e),t.edgeMap.has(e)){let n=t.edgeMap.get(e);if(n.size>0){r.add(e);for(let e of n)Z(t,e,r);r.delete(e)}}t.dst.push(e)}}async function K(t,e){return new Promise(((e,r)=>{let n=new Image;n.addEventListener("load",(()=>{e(n)})),n.addEventListener("error",(t=>{r(t)})),n.src=t}))}var tt=Object.freeze({__proto__:null,loadImage:K});async function et(t,e){return(await fetch(t)).text()}var rt=Object.freeze({__proto__:null,loadText:et});async function nt(t,e){let r=await fetch(t);return await r.arrayBuffer()}var st=Object.freeze({__proto__:null,loadBytes:nt});async function it(t,e){let r=await fetch(t);return await r.json()}var ot=Object.freeze({__proto__:null,loadJSON:it});async function at(t,e){let r=await fetch(t),n=await r.text();{const t=10;for(let e=0;e<t;++e){performance.now();ht(n);performance.now()}}{const t=10;for(let e=0;e<t;++e){performance.now();lt(n);performance.now()}}return lt(n)}function lt(t){const e=[],r=[],n=[],s=[],i=[],o=[],a=/v\s+(\S+)\s+(\S+)\s+(\S+)/g,l=/vn\s+(\S+)\s+(\S+)\s+(\S+)/g,h=/vt\s+(\S+)\s+(\S+)/g,u=/f\s+(([^/\s]*)\/([^/\s]*)\/?([^/\s]*))\s+(([^/\s]*)\/([^/\s]*)\/?([^/\s]*))\s+(([^/\s]*)\/([^/\s]*)\/?([^/\s]*))(\s+(([^/\s]*)\/([^/\s]*)\/?([^/\s]*)))?/g,c=/f\s+([^/\s]+)\s+([^/\s]+)\s+([^/\s]+)/g;let d,f,p,m,y,g,b=!1,x=null;for(t=t.replace(/^#.*/g,"");null!=(x=a.exec(t));)d=Number.parseFloat(x[1]),f=Number.parseFloat(x[2]),p=Number.parseFloat(x[3]),e.push(d),e.push(f),e.push(p);for(;null!=(x=l.exec(t));)d=Number.parseFloat(x[1]),f=Number.parseFloat(x[2]),p=Number.parseFloat(x[3]),n.push(d),n.push(f),n.push(p);for(;null!=(x=h.exec(t));)d=Number.parseFloat(x[1]),f=Number.parseFloat(x[2]),r.push(d),r.push(f);for(;null!=(x=u.exec(t));)d=Number.parseInt(x[2]),Number.isNaN(d)&&(d=1),f=Number.parseInt(x[6]),Number.isNaN(f)&&(f=1),p=Number.parseInt(x[10]),Number.isNaN(p)&&(p=1),s.push(d),s.push(f),s.push(p),d=Number.parseInt(x[4]),Number.isNaN(d)?(d=Number.parseInt(x[3]),f=Number.parseInt(x[7]),p=Number.parseInt(x[11]),o.push(d),o.push(f),o.push(p),i.push(1),i.push(1),i.push(1)):(f=Number.parseInt(x[8]),Number.isNaN(f)&&(f=1),p=Number.parseInt(x[12]),Number.isNaN(p)&&(p=1),o.push(d),o.push(f),o.push(p),d=Number.parseInt(x[3]),Number.isNaN(d)&&(d=1),f=Number.parseInt(x[7]),Number.isNaN(f)&&(f=1),p=Number.parseInt(x[11]),Number.isNaN(p)&&(p=1),i.push(d),i.push(f),i.push(p)),void 0!==x[13]&&(m=Number.parseInt(x[15]),Number.isNaN(m)&&(m=1),s.push(m),m=Number.parseInt(x[17]),Number.isNaN(m)?(m=Number.parseInt(x[16]),o.push(m),i.push(1)):(o.push(m),m=Number.parseInt(x[16]),i.push(m)),b=!0);for(;null!=(x=c.exec(t));)d=Number.parseInt(x[2]),f=Number.parseInt(x[6]),p=Number.parseInt(x[10]),s.push(d),s.push(f),s.push(p),i.push(1),i.push(1),i.push(1),o.push(1),o.push(1),o.push(1),void 0!==x[13]&&(m=Number.parseInt(x[14]),s.push(m),i.push(1),o.push(1),b=!0);g=s.length;const _=new Float32Array(3*g);for(let t=0;t<g;++t)y=s[t]-1,_[3*t+0]=e[3*y+0],_[3*t+1]=e[3*y+1],_[3*t+2]=e[3*y+2];g=i.length;const w=new Float32Array(2*g);for(let t=0;t<g;++t)y=i[t]-1,w[2*t+0]=r[2*y+0],w[2*t+1]=r[2*y+1];g=o.length;const v=new Float32Array(3*g);for(let t=0;t<g;++t)y=o[t]-1,v[3*t+0]=n[3*y+0],v[3*t+1]=n[3*y+1],v[3*t+2]=n[3*y+2];g=s.length;const A=new Uint16Array(g);for(let t=0;t<g;++t)A[t]=t;return b&&console.warn("WebGL does not support quad faces, only triangles."),{positions:_,texcoords:w,normals:v,indices:A}}function ht(t){const e=[],r=[],n=[],s=[],i=[],o=[],a=/v( +[\d|.|+|\-|e]+)( [\d|.|+|\-|e]+)( [\d|.|+|\-|e]+)/g,l=/vn( +[\d|.|+|\-|e]+)( [\d|.|+|\-|e]+)( [\d|.|+|\-|e]+)/g,h=/vt( +[\d|.|+|\-|e]+)( [\d|.|+|\-|e]+)/g,u=/f( +([\d]*)\/([\d]*)\/([\d]*))( ([\d]*)\/([\d]*)\/([\d]*))( ([\d]*)\/([\d]*)\/([\d]*))( ([\d]*)\/([\d]*)\/([\d]*))?/g,c=/f( +[\d|.|+|\-|e]+)( [\d|.|+|\-|e]+)( [\d|.|+|\-|e]+)/g;let d,f,p,m,y,g,b=!1,x=null;for(t=t.replace(/^#.*/g,"");null!=(x=a.exec(t));)d=Number.parseFloat(x[1]),f=Number.parseFloat(x[2]),p=Number.parseFloat(x[3]),e.push(d),e.push(f),e.push(p);for(;null!=(x=l.exec(t));)d=Number.parseFloat(x[1]),f=Number.parseFloat(x[2]),p=Number.parseFloat(x[3]),n.push(d),n.push(f),n.push(p);for(;null!=(x=h.exec(t));)d=Number.parseFloat(x[1]),f=Number.parseFloat(x[2]),r.push(d),r.push(f);for(;null!=(x=u.exec(t));)d=Number.parseInt(x[2]),Number.isNaN(d)&&(d=1),f=Number.parseInt(x[6]),Number.isNaN(f)&&(f=1),p=Number.parseInt(x[10]),Number.isNaN(p)&&(p=1),s.push(d),s.push(f),s.push(p),d=Number.parseInt(x[3]),Number.isNaN(d)&&(d=1),f=Number.parseInt(x[7]),Number.isNaN(f)&&(f=1),p=Number.parseInt(x[11]),Number.isNaN(p)&&(p=1),i.push(d),i.push(f),i.push(p),d=Number.parseInt(x[4]),Number.isNaN(d)&&(d=1),f=Number.parseInt(x[8]),Number.isNaN(f)&&(f=1),p=Number.parseInt(x[12]),Number.isNaN(p)&&(p=1),o.push(d),o.push(f),o.push(p),void 0!==x[13]&&(m=Number.parseInt(x[14]),Number.isNaN(m)&&(m=1),s.push(m),m=Number.parseInt(x[15]),Number.isNaN(m)&&(m=1),i.push(m),m=Number.parseInt(x[16]),Number.isNaN(m)&&(m=1),o.push(m),b=!0);for(;null!=(x=c.exec(t));)d=Number.parseInt(x[2]),f=Number.parseInt(x[6]),p=Number.parseInt(x[10]),s.push(d),s.push(f),s.push(p),i.push(1),i.push(1),i.push(1),o.push(1),o.push(1),o.push(1),void 0!==x[13]&&(m=Number.parseInt(x[14]),s.push(m),i.push(1),o.push(1),b=!0);g=s.length;const _=new Float32Array(3*g);for(let t=0;t<g;++t)y=s[t]-1,_[3*t+0]=e[3*y+0],_[3*t+1]=e[3*y+1],_[3*t+2]=e[3*y+2];g=i.length;const w=new Float32Array(2*g);for(let t=0;t<g;++t)y=i[t]-1,w[2*t+0]=r[2*y+0],w[2*t+1]=r[2*y+1];g=o.length;const v=new Float32Array(3*g);for(let t=0;t<g;++t)y=o[t]-1,v[3*t+0]=n[3*y+0],v[3*t+1]=n[3*y+1],v[3*t+2]=n[3*y+2];g=s.length;const A=new Uint16Array(g);for(let t=0;t<g;++t)A[t]=t;return b&&console.warn("WebGL does not support quad faces, only triangles."),{positions:_,texcoords:w,normals:v,indices:A}}var ut=Object.freeze({__proto__:null,loadOBJ:at});let ct={};function dt(t,e){ct[t]=e}function ft(t){if(t in ct)return ct[t];throw new Error(`Unknown asset type '${t}'.`)}async function pt(t,e={},r="."){if(t.indexOf(":")<0)throw new Error("Missing type for asset source.");let[n,s]=t.split(":"),i=ft(n);return await i(r+"/"+s,e)}dt("image",K),dt("text",et),dt("json",it),dt("bytes",nt),dt("obj",at);var mt=Object.freeze({__proto__:null,defineAssetLoader:dt,getAssetLoader:ft,loadAssetMap:async function(t,e="."){let r={};for(let n of Object.keys(t)){let s=t[n];if("string"==typeof s)r[n]=await pt(s,void 0,e);else{if("object"!=typeof s)throw new Error("Unknown entry type in asset map.");if(!("src"in s))throw new Error("Missing required field 'src' for entry in asset map.");if("name"in s&&s.name!==n)throw new Error(`Cannot redefine name for asset '${n}' for entry in asset map.`);r[n]=await pt(s.src,s,e)}}return r},loadAssetList:async function(t,e="."){let r={};for(let n of t)if("string"==typeof n)r[n]=await pt(n,void 0,e);else{if("object"!=typeof n)throw new Error("Unknown entry type in asset list.");if(!("src"in n))throw new Error("Missing required field 'src' for entry in asset list.");r["name"in n?n.name:n.src]=await pt(n.src,n,e)}return r},loadAsset:pt});const yt=1e-8;function gt(t,e,r){return Math.min(Math.max(t,e),r)}function bt(t,e,r,n){return{x:t,y:e,rx:r,ry:n}}function xt(t,e,r){let n=r.x-e.x,s=r.rx+e.rx-Math.abs(n);if(s<0)return null;let i=r.y-e.y,o=r.ry+e.ry-Math.abs(i);if(o<0)return null;if(s<o){let i=Math.sign(n);t.dx=s*i,t.dy=0,t.nx=i,t.ny=0,t.x=e.x+e.rx*i,t.y=r.y}else{let n=Math.sign(i);t.dx=0,t.dy=o*n,t.nx=0,t.ny=n,t.x=r.x,t.y=e.y+e.ry*n}return t}function _t(t,e,r,n){let s=r-e.x,i=e.rx-Math.abs(s);if(i<0)return null;let o=n-e.y,a=e.ry-Math.abs(o);if(a<0)return null;if(i<a){let r=Math.sign(s);t.dx=i*r,t.dy=0,t.nx=r,t.ny=0,t.x=e.x+e.rx*r,t.y=n}else{let n=Math.sign(o);t.dx=0,t.dy=a*n,t.nx=0,t.ny=n,t.x=r,t.y=e.y+e.ry*n}return t}function wt(t,e,r,n,s,i,o=0,a=0){if(Math.abs(s)<yt&&Math.abs(i)<yt&&0===o&&0===a)return _t(t,e,r,n);let l=e.rx,h=e.ry,u=o,c=a,d=1/(s||yt),f=1/(i||yt),p=Math.sign(d),m=Math.sign(f),y=(e.x-p*(l+u)-r)*d,g=(e.y-m*(h+c)-n)*f,b=(e.x+p*(l+u)-r)*d,x=(e.y+m*(h+c)-n)*f;if(y>x||g>b)return null;let _=Math.max(y,g),w=Math.min(b,x);if(_>1||w<0)return null;let v=gt(_,0,1),A=(1-v)*-s,N=(1-v)*-i,M=r+s*v,E=n+i*v;return y>g?(t.time=v,t.nx=-p,t.ny=0,t.dx=A,t.dy=N,t.x=M,t.y=E):(t.time=v,t.nx=0,t.ny=-m,t.dx=A,t.dy=N,t.x=M,t.y=E),t}function vt(t,e,r,n,s){if(Math.abs(n)<yt&&Math.abs(s)<yt){let n=xt({},r,e);return n&&(n.time=0),t.x=e.x,t.y=e.y,t.time=n?0:1,t.hit=n,t}let i=function(t,e,r,n,s){return wt(t,e,r.x,r.y,n,s,r.rx,r.ry)}({},r,e,n,s);if(i){let o,a,l=gt(i.time,0,1),h=Math.sqrt(n*n+s*s);h?(o=n/h,a=s/h):(o=0,a=0),i.x=gt(i.x+o*e.rx,r.x-r.rx,r.x+r.rx),i.y=gt(i.y+a*e.ry,r.y-r.ry,r.y+r.ry),t.time=l,t.x=e.x+n*l,t.y=e.y+s*l,t.hit=i}else t.time=1,t.x=e.x+n,t.y=e.y+s,t.hit=i;return t}function At(t,e,r,n,s){let i={};t.time=1,t.x=e.x+n,t.y=e.y+s,t.hit=null;for(let o=0,a=r.length;o<a;++o){let a=vt(i,e,r[o],n,s);a.time<=t.time&&(t.time=a.time,t.x=a.x,t.y=a.y,t.hit=a.hit)}return t}var Nt=Object.freeze({__proto__:null,EPSILON:yt,clamp:gt,createAABB:bt,createRect:function(t,e,r,n){let s=Math.abs(r-t)/2,i=Math.abs(n-e)/2;return bt(Math.min(t,r)+s,Math.min(e,n)+i,s,i)},testAABB:function(t,e){return!(Math.abs(t.x-e.x)>t.rx+e.rx)&&!(Math.abs(t.y-e.y)>t.ry+e.ry)},intersectAABB:xt,intersectPoint:_t,intersectSegment:wt,sweepInto:At});function Mt(t,e=[]){for(let r of t)switch(r.type){case"point":r.hit=null;for(let t of e)if(r.hit=_t({},t,r.x,r.y),r.hit)break;break;case"segment":r.hit=null;for(let t of e)if(r.hit=wt({},t,r.x,r.y,r.dx,r.dy,r.px,r.py),r.hit)break;break;case"aabb":r.hit=null;for(let t of e)if(r.hit=xt({},t,r),r.hit)break}}function Et(t,e=[],r=1){for(let n of t){let t,s=n.dx*r,i=n.dy*r,o=0,a={},l=null,h=100;do{if(t=At(a,n,e,s,i),n.x=t.x-Math.sign(s)*yt,n.y=t.y-Math.sign(i)*yt,o+=t.time,t.hit){s+=t.hit.nx*Math.abs(s),i+=t.hit.ny*Math.abs(i),l=t.hit;let e=Math.max(1-o,0);s*=e,i*=e,Math.abs(s)<yt&&(s=0),Math.abs(i)<yt&&(i=0)}}while(o<1&&--h>=0);n.dx=s,n.dy=i,n.hit=l}}var Tt=Object.freeze({__proto__:null,computeIntersections:Mt,resolveIntersections:Et});var St=Object.freeze({__proto__:null,createIntersectionWorld:function(){return{dynamics:[],masks:[],statics:[],update(t){Et(this.dynamics,this.statics,t),Mt(this.masks,this.statics)},render(t){t.save(),t.strokeStyle="green";for(let e of this.statics)t.strokeRect(e.x-e.rx,e.y-e.ry,2*e.rx,2*e.ry);t.strokeStyle="lime";for(let e of this.dynamics)t.strokeRect(e.x-e.rx,e.y-e.ry,2*e.rx,2*e.ry);t.strokeStyle="blue";for(let e of this.masks)switch(e.type){case"point":t.save(),t.fillStyle="red",t.fillRect(e.x-1,e.y-1,2,2),t.restore();break;case"segment":t.beginPath(),t.moveTo(e.x,e.y),t.lineTo(e.x+e.dx,e.y+e.dy),t.stroke();break;case"aabb":t.strokeRect(e.x-e.rx,e.y-e.ry,2*e.rx,2*e.ry)}t.restore()}}}});const It=new AudioContext;!async function(t){document.addEventListener("click",(()=>{"suspended"===t.state&&t.resume()}))}(It);const Ft={gain:0,pitch:0,pan:0,loop:!1};class Rt{constructor(t,e,r=!1){this.context=t,this.buffer=e,this._source=null,this.playing=!1,this.loop=r,this.onAudioSourceEnded=this.onAudioSourceEnded.bind(this)}onAudioSourceEnded(){this._playing=!1}play(t=Ft){if(!this.buffer)return;this._source&&this.destroy();const e=this.context;let r=e.createBufferSource();r.addEventListener("ended",this.onAudioSourceEnded),r.buffer=this.buffer,r.loop=t.loop;let n=r;if(t.pitch&&(r.detune.value=100*t.pitch),t.gain){const r=e.createGain();r.gain.value=t.gain,n=n.connect(r)}if(t.pan){const r=e.createStereoPanner();r.pan.value=t.pan,n=n.connect(r)}n.connect(e.destination),r.start(),this._source=r,this._playing=!0}pause(){this._source.stop(),this._playing=!1}destroy(){this._source&&this._source.disconnect(),this._source=null}}var kt=Object.freeze({__proto__:null,AUDIO_CONTEXT:It,AUDIO_ASSET_TAG:"audio",loadAudio:async function(t,e={}){const r=It;let n=await fetch(t),s=await n.arrayBuffer(),i=await r.decodeAudioData(s);return new Rt(r,i,Boolean(e.loop))}});class Ot{static currentTime(){return performance.now()}static start(t){let e=new Ot(t,!1);return e.start(),e}constructor(t,e=!1){this.app=t,this._controlled=e,this._animationFrameHandle=null,this.prevFrameTime=0,this.started=!1,this.paused=!1,this.fixedTimeStep=1/60,this.prevAccumulatedTime=0,this._onstart=null,this._onstop=null,this._onpreupdate=null,this._onupdate=null,this._onfixedupdate=null,this._onpostupdate=null,this._onpause=null,this._onresume=null,this.onAnimationFrame=this.onAnimationFrame.bind(this),this.onWindowFocus=this.onWindowFocus.bind(this),this.onWindowBlur=this.onWindowBlur.bind(this)}setFixedUpdatesPerSecond(t){return this.fixedTimeStep=1/t,this}onWindowFocus(){this.started&&this.resume()}onWindowBlur(){this.started&&this.pause()}onAnimationFrame(t){if(this._controlled)throw new Error("Cannot run controlled game loop; call step() instead.");if(!this.started)throw new Error("Must be called after start().");this.animationFrameHandle=requestAnimationFrame(this.onAnimationFrame),this.step(t)}step(t=Ot.currentTime()){if(!this.started)return!1;const e=t-this.prevFrameTime;if(this.prevFrameTime=t,this.paused)return!1;if(this.app.preUpdate&&this.app.preUpdate(e),this.app.update&&this.app.update(e),this.prevAccumulatedTime+=e/1e3,this.prevAccumulatedTime>250*this.fixedTimeStep){let t=250*this.fixedTimeStep,e=Math.floor((this.prevAccumulatedTime-t)/this.fixedTimeStep);this.prevAccumulatedTime=t,console.error(`[ApplicationLoop] Too many updates! Skipped ${e} fixed updates.`)}for(;this.prevAccumulatedTime>=this.fixedTimeStep;)this.prevAccumulatedTime-=this.fixedTimeStep,this.app.fixedUpdate&&this.app.fixedUpdate();this.app.postUpdate&&this.app.postUpdate(e)}start(){if(this.started)throw new Error("Loop already started.");return window.addEventListener("focus",this.onWindowFocus),window.addEventListener("blur",this.onWindowBlur),this.started=!0,this.prevFrameTime=Ot.currentTime(),this.app.start&&this.app.start(),this.controlled||this.onAnimationFrame(this.prevFrameTime),this}stop(){if(!this.started)throw new Error("Loop not yet started.");return window.removeEventListener("focus",this.onWindowFocus),window.removeEventListener("blur",this.onWindowBlur),this.started=!1,this.app.stop&&this.app.stop(),this._controlled||this.animationFrameHandle&&(cancelAnimationFrame(this.animationFrameHandle),this.animationFrameHandle=null),this}pause(){return this.paused||(this.paused=!0,this.app.pause&&this.app.pause()),this}resume(){return this.pause?(this.prevFrameTime=Ot.currentTime(),this.paused=!1,this.app.resume&&this.app.resume(),this):this}}class Ct{constructor(t){this.context=t,this.display=null,this.renderContext=null}setDisplay(t){return this.display=t,this.renderContext=t.canvas.getContext("2d"),this}start(){this.context.start()}update(t){this.context.update(t),this.context.render(this.renderContext)}}const Lt=Symbol("game"),zt=Symbol("loop");var Bt=Object.freeze({__proto__:null,start:function(t){let e={...t},r=new Ct(e),n=new Ot(r);return e[Lt]=r,e[zt]=n,e.display=null,window.addEventListener("DOMContentLoaded",(()=>{let t=document.querySelector("display-port");if(!t)throw new Error("Cannot find display-port in document.");r.setDisplay(t),e.display=t,e.load().then((()=>n.start()))})),e},stop:function(t){t[zt].stop(),delete t[Lt],delete t[zt]}});const Ut={x:0,y:0,width:1,height:1,color:"dodgerblue",solid:!0},Pt=Symbol("BoxRendererInfo");function jt(t,e,r,n){return e?t in e?e[t]:t in r?r[t]:n[t]:r&&t in r?r[t]:n[t]}const Dt={x:0,y:0,width:1,height:1,spriteImage:null},Vt=Symbol("SpriteRendererInfo");function $t(t,e,r,n){return e?t in e?e[t]:t in r?r[t]:n[t]:r&&t in r?r[t]:n[t]}class Gt{static createBounds(t,e,r,n){return{x:t,y:e,rx:r,ry:n}}constructor(t=0,e=Gt.createBounds(0,0,Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER)){this.level=t,this.bounds=e,this.boxes=[],this.nodes=new Array(4)}insertAll(t){for(let e of t)this.insert(e)}insert(t){let e=this.nodes[0];if(e){let e=this.findQuadIndex(t);if(e>=0)return void this.nodes[e].insert(t)}if(this.boxes.push(t),this.boxes.length>10&&this.level<5){e||this.split();for(let t=this.boxes.length-1;t>=0;--t){let e=this.boxes[t],r=this.findQuadIndex(e);r>=0&&(this.boxes.splice(t,1),this.nodes[r].insert(e))}}}retrieve(t,e=[],r={}){const{includeSelf:n=!1}=r;if(this.nodes[0]){let r=this.findQuadIndex(t);r>=0&&this.nodes[r].retrieve(t,e)}let s=this.boxes;if(n)e.push(...s);else{let r=s.indexOf(t);for(let t=0;t<r;++t)e.push(s[t]);let n=s.length;for(let t=r+1;t<n;++t)e.push(s[t])}return e}clear(){this.boxes.length=0;for(let t=0;t<this.nodes.length;++t){let e=this.nodes[t];e&&(e.clear(),this.nodes[t]=null)}}split(){let{x:t,y:e,rx:r,ry:n}=this.bounds,s=this.level+1,i=this.constructor;this.nodes[0]=new i(s,Gt.createBounds(t+r,e,r,n)),this.nodes[1]=new i(s,Gt.createBounds(t,e,r,n)),this.nodes[2]=new i(s,Gt.createBounds(t,e+n,r,n)),this.nodes[3]=new i(s,Gt.createBounds(t+r,e+n,r,n))}findQuadIndex(t){const{x:e,y:r,rx:n,ry:s}=this.bounds,i=e+n,o=r+s,{x:a,y:l,rx:h,ry:u}=t,c=l<o&&l+2*u<o,d=l>o;let f=-1;return a<i&&a+2*h<i?c?f=1:d&&(f=2):a>i&&(c?f=0:d&&(f=3)),f}}function qt(t,e,r,n,s,i,o){return{x:t,y:e,dx:r,dy:n,nx:s,ny:i,time:o}}function Wt(t,e){let r=e.x-t.x,n=e.rx+t.rx-Math.abs(r);if(n<0)return null;let s=e.y-t.y,i=e.ry+t.ry-Math.abs(s);if(i<0)return null;if(n<i){let s=Math.sign(r);return qt(t.x+t.rx*s,e.y,n*s,0,s,0,0)}{let r=Math.sign(s);return qt(e.x,t.y+t.ry*r,0,i*r,0,r,0)}}const Ht=Symbol("maskCount");class Yt{constructor(t,e,r,n,s,i){this.aabbGraph=t,this.mask=e,this.x=r,this.y=n,this.rx=s,this.ry=i}setPosition(t,e){return this.x=t,this.y=e,this}setSize(t,e){return this.setHalfSize(t/2,e/2)}setHalfSize(t,e){return this.rx=t,this.ry=e,this}}const Xt={};function Qt(t,e,r){null===t?(r.rootNodes.push(e),e.parentNode=null):(t.childNodes.push(e),e.parentNode=t)}function Jt(t,e,r){if(null===t){let t=r.rootNodes.indexOf(e);r.rootNodes.splice(t,1),e.parentNode=void 0}else{let r=t.childNodes.indexOf(e);t.childNodes.splice(r,1),e.parentNode=void 0}}function Zt(t,e,r,n,s){if(r>=100)return;let i=n(e.owner,e);if(!1===i)return;let o=e.childNodes;s&&Kt(t.nodes,o,e,s);for(let t of o)Zt(t,r+1,n);"function"==typeof i&&i(e.owner,e)}function Kt(t,e,r,n){let s=e.map((t=>t.owner));n(s,r);for(let r=0;r<s.length;++r)e[r]=t.get(s[r]);e.length=s.length}class te{constructor(t,e,r,n){this.sceneGraph=t,this.owner=e,this.parentNode=r,this.childNodes=n}}const ee=e.vec3.fromValues(0,0,0),re=e.vec3.fromValues(1,0,0),ne=e.vec3.fromValues(0,1,0),se=e.vec3.fromValues(0,0,1);function ie(){return{translation:e.vec3.create(),rotation:e.quat.create(),scale:e.vec3.fromValues(1,1,1)}}function oe(t,r=e.mat4.create()){return e.mat4.fromRotationTranslationScale(r,t.rotation,t.translation,t.scale)}var ae=Object.freeze({__proto__:null,ORIGIN:ee,XAXIS:re,YAXIS:ne,ZAXIS:se,create:ie,lookAt:function(t,r=ee){const n=e.vec3.create();e.vec3.subtract(n,r,t.position),e.vec3.normalize(n,n);const s=e.vec3.dot(se,n);if(Math.abs(s- -1)<Number.EPSILON)return e.quat.set(t.rotation,0,0,1,Math.PI),t;if(Math.abs(s-1)<Number.EPSILON)return e.quat.set(t.rotation,0,0,0,1),t;e.vec3.cross(n,se,n),e.vec3.normalize(n,n);const i=Math.acos(s)/2,o=Math.sin(i);return t.rotation[0]=n[0]*o,t.rotation[1]=n[1]*o,t.rotation[2]=n[2]*o,t.rotation[3]=Math.cos(i),t},getTransformationMatrix:oe,getForwardVector:function(t,r=e.vec3.create()){return e.vec3.transformQuat(r,se,t.rotation),r},getUpVector:function(t,r=e.vec3.create()){return e.vec3.transformQuat(r,ne,t.rotation),r},getRightVector:function(t,r=e.vec3.create()){return e.vec3.transformQuat(r,re,t.rotation),r}});function le(t,e,r,n,s){if(!s){const e=Math.random(),r=Math.random(),n=Math.random();s=[];for(let i=0;i<t.length;i+=3)s.push(e,r,n)}return{position:t,texcoord:e,normal:r,indices:n,color:s,elementSize:3,elementCount:n.length}}function he(t,e,r,n){for(let s=0;s<n.color.length;s+=3)n.color[s+0]=t,n.color[s+1]=e,n.color[s+2]=r;return n}function ue(t,r){const n=r.position,s=r.normal,i=e.mat3.create();e.mat3.normalFromMat4(i,t);const o=e.vec3.create();for(let r=0;r<n.length;r+=3)o[0]=n[r+0],o[1]=n[r+1],o[2]=n[r+2],e.vec3.transformMat4(o,o,t),n[r+0]=o[0],n[r+1]=o[1],n[r+2]=o[2],o[0]=s[r+0],o[1]=s[r+1],o[2]=s[r+2],e.vec3.transformMat3(o,o,i),s[r+0]=o[0],s[r+1]=o[1],s[r+2]=o[2];return r}function ce(...t){const e=[],r=[],n=[],s=[],i=[];let o=0;for(const a of t)e.push(...a.position),r.push(...a.texcoord),n.push(...a.normal),i.push(...a.color),s.push(...a.indices.map((t=>t+o))),o+=a.position.length/3;return le(e,r,n,s,i)}function de(t=!1){let e;if(t){const t=.5,r=.5;e=[0-t,0-r,0,0+t,0-r,0,0-t,0+r,0,0+t,0+r,0]}else e=[0,0,0,1,0,0,0,1,0,1,1,0];return le(e,[0,0,1,0,0,1,1,1],[0,0,1,0,0,1,0,0,1,0,0,1],[0,1,2,2,1,3])}var fe=Object.freeze({__proto__:null,create:de});function pe(t=!0){const r=de(!0);if(t){const t=de(!0);return ue(e.mat4.fromYRotation(e.mat4.create(),Math.PI),t),he(r.color[0],r.color[1],r.color[2],t),ce(r,t)}return r}var me=Object.freeze({__proto__:null,create:pe});function ye(t=!0,r=!0,n=!0,s=!0,i=!0,o=!0){const a=Math.PI/2,l=e.mat4.create(),h=[];if(t){const t=pe(!1);e.mat4.fromTranslation(l,[0,0,.5]),ue(l,t),h.push(t)}if(n){const t=pe(!1);e.mat4.fromXRotation(l,-a),e.mat4.translate(l,l,[0,0,.5]),ue(l,t),h.push(t)}if(r){const t=pe(!1);e.mat4.fromYRotation(l,Math.PI),e.mat4.translate(l,l,[0,0,.5]),ue(l,t),h.push(t)}if(s){const t=pe(!1);e.mat4.fromXRotation(l,a),e.mat4.translate(l,l,[0,0,.5]),ue(l,t),h.push(t)}if(i){const t=pe(!1);e.mat4.fromYRotation(l,-a),e.mat4.translate(l,l,[0,0,.5]),ue(l,t),h.push(t)}if(o){const t=pe(!1);e.mat4.fromYRotation(l,a),e.mat4.translate(l,l,[0,0,.5]),ue(l,t),h.push(t)}return ce(...h)}var ge=Object.freeze({__proto__:null,create:ye});var be=Object.freeze({__proto__:null,create:function(){const t=.2,r=e.mat4.create(),n=ye(!0,!0,!0,!0,!1,!0);e.mat4.fromTranslation(r,[.1,.4,0]),e.mat4.scale(r,r,[.4,t,t]),ue(r,n),he(n.color[0],n.color[1],n.color[2],n);const s=ye(!0,!0,!0,!0,!1,!0);e.mat4.fromScaling(r,[t,t,t]),ue(r,s),he(n.color[0],n.color[1],n.color[2],s);const i=ye(!0,!0,!0,!0,!0,!0);return e.mat4.fromTranslation(r,[-.2,0,0]),e.mat4.scale(r,r,[t,1,t]),ue(r,i),he(n.color[0],n.color[1],n.color[2],i),ce(i,n,s)}}),xe=Object.freeze({__proto__:null,Quad:fe,Plane:me,Cube:ge,GlyphF:be,create:le,applyColor:he,applyTransformation:ue,joinGeometry:ce});function _e(t,e,r,n){if(!n){const e=Math.random(),r=Math.random(),s=Math.random();n=[];for(let i=0;i<t.length;i+=3)n.push(e,r,s)}return{position:t,texcoord:e,indices:r,color:n,elementSize:2,elementCount:r.length}}function we(t,r){const n=r.position,s=e.vec2.create();for(let r=0;r<n.length;r+=2)s[0]=n[r+0],s[1]=n[r+1],e.vec3.transformMat3(s,s,t),n[r+0]=s[0],n[r+1]=s[1];return r}function ve(...t){const e=[],r=[],n=[],s=[];let i=0;for(const o of t){e.push(...o.position),r.push(...o.texcoord),s.push(...o.color);for(let t=0;t<o.indices.length;++t){const e=o.indices[t];n.push(e+i)}i+=o.position.length/2}return _e(e,r,n,s)}function Ae(t=!1){let e;if(t){const t=.5,r=.5;e=[0-t,0-r,0+t,0-r,0-t,0+r,0+t,0+r]}else e=[0,0,1,0,0,1,1,1];return _e(e,[0,0,1,0,0,1,1,1],[0,1,2,2,1,3])}var Ne=Object.freeze({__proto__:null,create:Ae});var Me=Object.freeze({__proto__:null,create:function(){const t=.2,r=e.mat3.create(),n=Ae();e.mat3.fromTranslation(r,[.1,.4]),e.mat3.scale(r,r,[.4,t]),we(r,n),he(n.color[0],n.color[1],n.color[2],n);const s=Ae();e.mat3.fromScaling(r,[t,t]),we(r,s),he(n.color[0],n.color[1],n.color[2],s);const i=Ae();return e.mat3.fromTranslation(r,[-.2,0]),e.mat3.scale(r,r,[t,1]),we(r,i),he(n.color[0],n.color[1],n.color[2],i),ve(i,n,s)}}),Ee=Object.freeze({__proto__:null,Quad2D:Ne,GlyphF2D:Me,applyColor2D:he,create:_e,applyTransformation2D:we,joinGeometry2D:ve});function Te(t,e,r){const n=t.createShader(e);if(t.shaderSource(n,r),t.compileShader(n),!t.getShaderParameter(n,t.COMPILE_STATUS)){const e=t.getShaderInfoLog(n);throw t.deleteShader(n),new Error(e)}return n}function Se(t,e,r,n=[]){const s=t.createProgram();t.attachShader(s,e),t.attachShader(s,r);for(let e=0;e<n.length;++e)t.bindAttribLocation(s,e,n[e]);if(t.linkProgram(s),!t.getProgramParameter(s,t.LINK_STATUS)){const e=t.getProgramInfoLog(s);throw t.deleteProgram(s),new Error(e)}return s}function Ie(t,e){const r={},n=t.getProgramParameter(e,t.ACTIVE_ATTRIBUTES);for(let s=0;s<n;++s){const n=t.getActiveAttrib(e,s);if(!n)break;const i=n.name,o=t.getAttribLocation(e,i);r[i]=Fe(o)}return r}function Fe(t){const e=function(t,e,r){e.enableVertexAttribArray(t),e.bindBuffer(e.ARRAY_BUFFER,r.handle),e.vertexAttribPointer(t,r.size,r.type,r.normalize,r.stride,r.offset)}.bind(null,t);return e.location=t,e}function Re(t,e){const r={},n={textureUnit:0},s=t.getProgramParameter(e,t.ACTIVE_UNIFORMS);for(let i=0;i<s;++i){const s=t.getActiveUniform(e,i);if(!s)break;let o=s.name;"[0]"===o.substring(o.length-3)&&(o=o.substring(0,o.length-3));const a=ke(t,e,s,n);r[o]=a}return r}function ke(t,e,r,n){const s=r.name,i=t.getUniformLocation(e,s),o=r.type,a=r.size>1&&"[0]"===s.substring(s.length-3),l=Ce(t,o);if(!l)throw new Error(`Unknown uniform type 0x${o.toString(16)}.`);switch(o){case t.FLOAT:case t.INT:case t.BOOL:return l.setter(i,a);case t.SAMPLER_2D:case t.SAMPLER_CUBE:{let t;if(a){t=[];for(let e=0;e<r.size;++e)t.push(n.textureUnit++)}else t=n.textureUnit++;return l.setter(i,a,t)}default:return l.setter(i)}}let Oe=null;function Ce(t,e){if(Oe)return Oe[e];function r(t,e,r=!1,n=0){if(r&&!Array.isArray(n))throw new Error("Cannot create sampler array for non-array texture unit.");const s=(r?function(t,e,r,n,s){n.uniform1fv(t,e),s.forEach(((t,s)=>{n.activeTexture(n.TEXTURE0+e[s]),n.bindTexture(r,t)}))}:function(t,e,r,n,s){n.uniform1i(t,e),n.activeTexture(n.TEXTURE0+e),n.bindTexture(r,s)}).bind(null,e,n,t);return s.location=e,s}return Oe={[t.FLOAT]:{TypedArray:Float32Array,size:4,setter(t,e=!1){const r=(e?function(t,e,r){e.uniform1fv(t,r)}:function(t,e,r){e.uniform1f(t,r)}).bind(null,t);return r.location=t,r}},[t.FLOAT_VEC2]:{TypedArray:Float32Array,size:8,setter(t){const e=function(t,e,r){e.uniform2fv(t,r)}.bind(null,t);return e.location=t,e}},[t.FLOAT_VEC3]:{TypedArray:Float32Array,size:12,setter(t){const e=function(t,e,r){e.uniform3fv(t,r)}.bind(null,t);return e.location=t,e}},[t.FLOAT_VEC4]:{TypedArray:Float32Array,size:16,setter(t){const e=function(t,e,r){e.uniform4fv(t,r)}.bind(null,t);return e.location=t,e}},[t.INT]:{TypedArray:Int32Array,size:4,setter(t,e=!1){const r=(e?function(t,e,r){e.uniform1iv(t,r)}:function(t,e,r){e.uniform1i(t,r)}).bind(null,t);return r.location=t,r}},[t.INT_VEC2]:{TypedArray:Int32Array,size:8,setter(t){const e=function(t,e,r){e.uniform2iv(t,r)}.bind(null,t);return e.location=t,e}},[t.INT_VEC3]:{TypedArray:Int32Array,size:12,setter(t){const e=function(t,e,r){e.uniform3iv(t,r)}.bind(null,t);return e.location=t,e}},[t.INT_VEC4]:{TypedArray:Int32Array,size:16,setter(t){const e=function(t,e,r){e.uniform4iv(t,r)}.bind(null,t);return e.location=t,e}},[t.BOOL]:{TypedArray:Uint32Array,size:4,setter(t,e=!1){const r=(e?function(t,e,r){e.uniform1iv(t,r)}:function(t,e,r){e.uniform1i(t,r)}).bind(null,t);return r.location=t,r}},[t.BOOL_VEC2]:{TypedArray:Uint32Array,size:8,setter(t){const e=function(t,e,r){e.uniform2iv(t,r)}.bind(null,t);return e.location=t,e}},[t.BOOL_VEC3]:{TypedArray:Uint32Array,size:12,setter(t){const e=function(t,e,r){e.uniform3iv(t,r)}.bind(null,t);return e.location=t,e}},[t.BOOL_VEC4]:{TypedArray:Uint32Array,size:16,setter(t){const e=function(t,e,r){e.uniform4iv(t,r)}.bind(null,t);return e.location=t,e}},[t.FLOAT_MAT2]:{TypedArray:Float32Array,size:16,setter(t){const e=function(t,e,r){e.uniformMatrix2fv(t,!1,r)}.bind(null,t);return e.location=t,e}},[t.FLOAT_MAT3]:{TypedArray:Float32Array,size:36,setter(t){const e=function(t,e,r){e.uniformMatrix3fv(t,!1,r)}.bind(null,t);return e.location=t,e}},[t.FLOAT_MAT4]:{TypedArray:Float32Array,size:64,setter(t){const e=function(t,e,r){e.uniformMatrix4fv(t,!1,r)}.bind(null,t);return e.location=t,e}},[t.SAMPLER_2D]:{TypedArray:null,size:0,setter:r.bind(null,t.TEXTURE_2D)},[t.SAMPLER_CUBE]:{TypedArray:null,size:0,setter:r.bind(null,t.TEXTURE_CUBE)}},Oe[e]}function Le(t,e,r,n,s=!1,i=0,o=0,a=t.ARRAY_BUFFER,l=t.STATIC_DRAW){const h=t.createBuffer(),u=Be(t,e);if(!u)throw new Error(`Unknown uniform type 0x${e.toString(16)}.`);if(r instanceof u.TypedArray)t.bindBuffer(a,h),t.bufferData(a,r,l);else if(Array.isArray(r))r=new u.TypedArray(r),t.bindBuffer(a,h),t.bufferData(a,r,l);else{if("number"!=typeof r)throw new Error("Unknown buffer data type - can only be a TypedArray, an Array, or a number.");t.bindBuffer(a,h),t.bufferData(a,r,l)}return{handle:h,size:n,type:e,normalize:s,stride:i,offset:o,updateData(t,r,n=0,s=t.STATIC_DRAW){t.bindBuffer(t.ARRAY_BUFFER,this.handle);const i=Be(t,e);r instanceof i.TypedArray||(r=new i.TypedArray(r)),n>0?t.bufferSubData(t.ARRAY_BUFFER,n,r):t.bufferData(t.ARRAY_BUFFER,r,s)}}}let ze=null;function Be(t,e){return ze||(ze={[t.BYTE]:{TypedArray:Int8Array,size:1},[t.SHORT]:{TypedArray:Int16Array,size:2},[t.UNSIGNED_BYTE]:{TypedArray:Uint8Array,size:1},[t.UNSIGNED_SHORT]:{TypedArray:Uint16Array,size:2},[t.FLOAT]:{TypedArray:Float32Array,size:4}}),ze[e]}var Ue=Object.freeze({__proto__:null,SceneGraph:class{constructor(){this.root=this.createSceneNode(ie(),null)}update(){this.root.updateWorldMatrix()}createSceneNode(t=ie(),r=this.root){const n={sceneGraph:this,transform:t,localMatrix:e.mat4.create(),worldMatrix:e.mat4.create(),parent:null,children:[],setParent(t){if(this.parent){const t=this.parent.children.indexOf(this);this.parent.children.splice(t,1)}return t&&t.children.push(this),this.parent=r,this},updateWorldMatrix(t){oe(this.transform,this.localMatrix),t?e.mat4.multiply(this.worldMatrix,t,this.localMatrix):e.mat4.copy(this.worldMatrix,this.localMatrix);for(const t of this.children)t.updateWorldMatrix(this.worldMatrix)}};return r&&n.setParent(r),n}},Transform:ae,Geometry:xe,Geometry2D:Ee,createShaderProgramInfo:function(t,e,r,n=[]){const s=Te(t,t.VERTEX_SHADER,e),i=Te(t,t.FRAGMENT_SHADER,r),o=Se(t,s,i,n);return t.detachShader(o,s),t.detachShader(o,i),t.deleteShader(s),t.deleteShader(i),{handle:o,_gl:t,uniforms:Re(t,o),attributes:Ie(t,o),uniform(t,e){return t in this.uniforms&&this.uniforms[t](this._gl,e),this},attribute(t,e){return t in this.attributes&&this.attributes[t](this._gl,e),this},elementAttribute(t){return this._gl.bindBuffer(this._gl.ELEMENT_ARRAY_BUFFER,t),this}}},createShader:Te,createShaderProgram:Se,createShaderProgramAttributeSetters:Ie,createShaderProgramAttributeSetter:Fe,createShaderProgramUniformSetters:Re,createShaderProgramUniformSetter:ke,getUniformTypeInfo:Ce,createBufferInfo:Le,createElementBufferInfo:function(t,e,r,n=0,s=0,i=t.STATIC_DRAW){return Le(t,e,r,1,!1,n,s,t.ELEMENT_ARRAY_BUFFER,i)},getBufferTypeInfo:Be,createVertexArrayInfo:function(t,e=[]){const r=t.createVertexArray(),n={};for(let t=0;t<e.length;++t)n[e[t]]={location:t,setter:Fe(t)};return{handle:r,attributes:n,_gl:t,elementBuffer:null,elementType:null,elementCount:0,attributeBuffers:{},setElementCount(t){return this.elementCount=t,this},elementAttribute(t){this._gl.bindBuffer(this._gl.ELEMENT_ARRAY_BUFFER,t.handle);const e=Be(this._gl,t.type);return this.elementCount=this._gl.getBufferParameter(this._gl.ELEMENT_ARRAY_BUFFER,this._gl.BUFFER_SIZE)/e.size,this.elementBuffer=t,this.elementType=t.type,this},sharedAttribute(t,e){return t in this.attributes&&this.attributes[t].setter(this._gl,e),this.attributeBuffers[t]=e,this},programAttribute(t,e,...r){for(const n of r)n.attribute(t,e);return this.attributeBuffers[t]=e,this}}},createTextureInfo:function(t){return{handle:t.createTexture()}},createDrawInfo:function(t,e,r,n=0,s=null){return{programInfo:t,vertexArrayInfo:e,uniforms:r,drawArrayOffset:n,drawMode:s}},draw:function(t,e,r={}){for(const n of e){const e=n.programInfo,s=n.vertexArrayInfo,i=n.uniforms,o=n.drawArrayOffset,a=n.drawMode||t.TRIANGLES;t.useProgram(e.handle),t.bindVertexArray(s.handle);for(const[t,n]of Object.entries(r))e.uniform(t,n);for(const[t,r]of Object.entries(i))e.uniform(t,r);s.elementBuffer?t.drawElements(a,s.elementCount,s.elementType,o*s.elementBuffer.size):t.drawArrays(a,o,s.elementCount)}}});class Pe{getViewMatrix(t){}getProjectionMatrix(t){}}class je extends Pe{constructor(t=-1,r=1,n=-1,s=1,i=0,o=1){super(),this.position=e.vec3.create(),this.rotation=e.quat.create(),this.scale=e.vec3.fromValues(1,1,1),this.clippingPlane={left:t,right:r,top:n,bottom:s,near:i,far:o}}get x(){return this.position[0]}set x(t){this.position[0]=t}get y(){return this.position[1]}set y(t){this.position[1]=t}get z(){return this.position[2]}set z(t){this.position[2]=t}moveTo(t,r,n=0,s=1){let i=e.vec3.fromValues(t,r,n);return e.vec3.lerp(this.position,this.position,i,Math.max(Math.min(s,1),0)),this}getViewMatrix(t){let r=-Math.round(this.x),n=-Math.round(this.y),s=0===this.z?1:1/this.z,i=e.vec3.fromValues(r,n,0),o=e.vec3.fromValues(this.scale[0]*s,this.scale[1]*s,1);return e.mat4.fromRotationTranslationScale(t,this.rotation,i,o),t}getProjectionMatrix(t){let{left:r,right:n,top:s,bottom:i,near:o,far:a}=this.clippingPlane;return e.mat4.ortho(t,r,n,s,i,o,a),t}}function De(t,e){return t.a=e[0],t.b=e[1],t.c=e[4],t.d=e[5],t.e=e[12],t.f=e[13],t}var Ve=Object.freeze({__proto__:null,CanvasView2D:class{constructor(t,e=new je){this.display=t,this.camera=e,this.viewTransformDOMMatrix=new DOMMatrix}transformScreenToWorld(t,r){let n=e.mat4.create();this.getViewProjectionMatrix(n),e.mat4.invert(n,n);let s=e.vec3.fromValues(t,r,0);return e.vec3.transformMat4(s,s,n),s}transformCanvas(t){let r=this.viewTransformDOMMatrix,n=e.mat4.create();this.getViewProjectionMatrix(n),De(r,n);const{a:s,b:i,c:o,d:a,e:l,f:h}=r;t.transform(s,i,o,a,l,h)}getViewProjectionMatrix(t){const r=this.display.width,n=this.display.height;let s=e.mat4.create();const i=this.camera.getProjectionMatrix(s),o=this.camera.getViewMatrix(t);e.mat4.multiply(s,o,i);const a=e.mat4.fromTranslation(t,[r/2,n/2,0]);return e.mat4.multiply(t,a,s),t}},setDOMMatrix:De,Camera:Pe,Camera2D:je,Camera3D:class extends Pe{static screenToWorld(t,r,n,s){let i=e.mat4.multiply(e.mat4.create(),s,n);e.mat4.invert(i,i);let o=e.vec3.fromValues(t,r,0);return e.vec3.transformMat4(o,o,i),o}constructor(t,r,n=.1,s=1e3){super(),this.position=e.vec3.create(),this.rotation=e.quat.create(),this.fieldOfView=t,this.aspectRatio=r,this.clippingPlane={near:n,far:s},this._viewMatrix=e.mat4.create(),this._projectionMatrix=e.mat4.create()}get x(){return this.position[0]}set x(t){this.position[0]=t}get y(){return this.position[1]}set y(t){this.position[1]=t}get z(){return this.position[2]}set z(t){this.position[2]=t}moveTo(t,r,n,s=1){let i=e.vec3.fromValues(t,r,n);e.vec3.lerp(this.position,this.position,i,Math.min(1,s))}getViewMatrix(t=this._viewMatrix){let r=-this.x,n=-this.y,s=-this.z,i=e.vec3.fromValues(r,n,s);return e.mat4.fromRotationTranslation(t,this.rotation,i),t}getProjectionMatrix(t=this._projectionMatrix){let{near:r,far:n}=this.clippingPlane;return e.mat4.perspective(t,this.fieldOfView,this.aspectRatio,r,n),t}}});t.ApplicationLoop=Ot,t.AssetLoader=mt,t.Audio=kt,t.AxisAlignedBoundingBox=Yt,t.AxisAlignedBoundingBoxGraph=class{constructor(t={}){this.masks=new Map,this.boxes=new Set,this.dynamics=new Map,this.quadtree=new Gt}add(t,e,r={}){let n=function(t,e,r,n){return{owner:t,name:e,box:r,get:n}}(t,e,null,null);if(this.masks.has(t)){if(e in this.masks.get(t))throw new Error(`Mask ${e} already exists for owner.`);{let r=this.masks.get(t);r[e]=n,r[Ht]++}}else this.masks.set(t,{[Ht]:1,[e]:n});if(Array.isArray(r)){const t=r[0]||0,e=r[1]||0,s=r[2]/2||0,i=r[3]/2||0;let o=new Yt(this,n,t,e,s,i);this.boxes.add(o),n.box=o}else if("object"==typeof r){let e=r.x||0,s=r.y||0,i=r.rx||r.width/2||0,o=r.ry||r.height/2||0;"object"==typeof t&&(e||(e=t.x||0),s||(s=t.y||0),i||(i=t.width/2||0),o||(o=t.height/2||0));let a=new Yt(this,n,e,s,i,o);this.boxes.add(a),n.box=a,"get"in r&&(n.get=r.get,n.get(a,t),this.dynamics.set(n,{halfdx:0,halfdy:0}))}else{if("function"!=typeof r)throw new Error("Invalid mask option type.");{let e=new Yt(this,n,0,0,0,0);this.boxes.add(e),n.box=e,n.get=r,n.get(e,t),this.dynamics.set(n,{halfdx:0,halfdy:0})}}}remove(t,e){if(this.masks.has(t)){let r=this.masks.get(t),n=r[e];if(n){return n.get&&this.dynamics.delete(n),this.boxes.delete(n.box),r[e]=null,--r[Ht]<=0&&this.masks.delete(t),!0}return!1}return!1}get(t,e){return this.masks.has(t)?this.masks.get(t)[e]:null}count(t){return this.masks.has(t)?this.masks.get(t)[Ht]:0}clear(){this.boxes.clear(),this.masks.clear(),this.dynamics.clear(),this.quadtree.clear()}solve(t){for(let t of this.dynamics.keys()){let{box:e,owner:r}=t,n=e.x,s=e.y;t.get(e,r);let i=this.dynamics.get(t),o=(e.x-n)/2,a=(e.y-s)/2;i.halfMotionX=o,i.halfMotionY=a,e.x-=o,e.y-=a,e.rx+=Math.abs(o),e.ry+=Math.abs(a)}null==t&&(t=this.masks.keys());let e=[],r=this.quadtree;r.clear(),r.insertAll(this.boxes);for(let t of this.dynamics.keys()){const{box:e}=t,{halfMotionX:r,halfMotionY:n}=this.dynamics.get(t);e.x+=r,e.y+=n,e.rx-=Math.abs(r),e.ry-=Math.abs(n)}let n=[];for(let s of t){let t=Object.values(this.masks.get(s));for(let i of t){const{box:t}=i;r.retrieve(t,n);let o=0,a=0;if(this.dynamics.has(i)){const{halfMotionX:t,halfMotionY:e}=this.dynamics.get(i);o=2*t,a=2*e}for(let r of n){let n=Wt(t,r);n&&e.push({owner:s,other:r.mask.owner,ownerMask:i,otherMask:r.mask,hit:n,dx:o,dy:a})}n.length=0}}return e}},t.BoxRenderer=class{static get Info(){return Pt}static draw(t,e,r){const n=r?{...Ut,...r}:Ut;for(let r of e){const e=r[Pt],s=jt("x",e,r,n),i=jt("y",e,r,n),o=jt("width",e,r,n),a=jt("height",e,r,n),l=jt("color",e,r,n),h=jt("solid",e,r,n);t.translate(s,i);{const e=o/2,r=a/2;h?(t.fillStyle=l,t.fillRect(-e,-r,o,a)):(t.strokeStyle=l,t.strokeRect(-e,-r,o,a))}t.translate(-s,-i)}}},t.ByteLoader=st,t.Discrete=_,t.DisplayPort=i,t.Downloader=N,t.EntityManager=class{constructor(t={}){const{componentFactoryMap:e={},strictMode:r=!1}=t;let n={},s={};for(let t in e){let r,i,o=e[t];try{r="create"in o?o.create:"function"==typeof o?o:null,i="destroy"in o?o.destroy:null}catch(t){throw new Error("Unsupported component factory options.")}n[t]={owner:o,create:r,destroy:i},s[t]={}}this.factoryMap=n,this.instances=s,this.entities=new Set,this.nextAvailableEntityId=1,this.strictMode=r}create(t){if(void 0!==t){if("string"!=typeof t)throw new Error("Invalid type for entity id - must be a string.")}else t=String(this.nextAvailableEntityId++);if(this.entities.has(t))throw new Error(`Invalid duplicate entity id '${t}' allocated for new entity.`);return this.entities.add(t),t}destroy(t){for(let e in this.instances)this.remove(e,t);this.entities.delete(t)}add(t,e,r){if(!(t in this.factoryMap)){if(this.strictMode)throw new Error(`Missing component factory for '${t}'.`);this.factoryMap[t]={owner:{},create:null,destroy:null},this.instances[t]={}}if(!(t in this.instances))throw new Error(`Missing component instance mapping for '${t}'.`);if(!this.entities.has(e))throw new Error(`Entity '${e}' does not exist.`);if(this.instances[t][e])throw new Error(`Entity already has component '${t}'.`);const{create:n}=this.factoryMap[t];let s=n?n(void 0!==r?r:Xt,e,this):r?{...r}:{};s&&(this.instances[t][e]=s)}remove(t,e){if(!(t in this.factoryMap)){if(this.strictMode)throw new Error(`Missing component factory for '${t}'.`);return}if(!(t in this.instances))throw new Error(`Missing component instance mapping for '${t}'.`);let r=this.instances[t],n=r[e];if(n){r[e]=null;const{destroy:s}=this.factoryMap[t];s&&s(n,e,this)}}get(t,e){if(!(t in this.instances))throw new Error(`Missing component instance mapping for '${t}'.`);return this.instances[t][e]||null}has(t,e){return t in this.instances&&Boolean(this.instances[t][e])}clear(t){if(!(t in this.factoryMap)){if(this.strictMode)throw new Error(`Missing component factory for '${t}'.`);return}if(!(t in this.instances))throw new Error(`Missing component instance mapping for '${t}'.`);let e=this.instances[t];const{destroy:r}=this.factoryMap[t];if(r)for(let n in e){let s=e[n];e[n]=null,r(s,t,n,this)}this.instances[t]={}}getEntityIds(){return this.entities}getComponentFactory(t){return t in this.factoryMap?this.factoryMap[t].owner:null}getComponentNames(){return Object.keys(this.factoryMap)}getComponentEntityIds(t){return t in this.instances?Object.keys(this.instances[t]):[]}getComponentInstances(t){return t in this.instances?Object.values(this.instances[t]):[]}},t.Eventable=G,t.Game=Bt,t.ImageLoader=tt,t.InputContext=class{constructor(t={}){const{disabled:e=!0}=t;this.inputSource=null,this._disabled=e,this._ignoreInput=e,this.adapters=new a,this.inputs={},this.onSourceInput=this.onSourceInput.bind(this),this.onSourcePoll=this.onSourcePoll.bind(this)}get disabled(){return this._disabled}set disabled(t){this.toggle(!t)}setInputMap(t){return this._setupInputs(this.inputSource,t),this}attach(t){return this._setupInputs(t,null),this.toggle(!0),this}detach(){return this.toggle(!1),this._setupInputs(null,null),this}_setupInputs(t,e){const r=this.disabled;this.disabled=!0;const n=this.inputSource,s=this.inputs,i=n!==t&&n,o=this.inputs&&e;if(i||o){i&&(n.removeEventListener("poll",this.onSourcePoll),n.removeEventListener("input",this.onSourceInput));for(let t in s){let{adapters:e}=s[t];for(let t of e){const{deviceName:e,keyCode:r}=t;0===y(n,e,r)&&n.delete(e,r)}}o&&(this.adapters.clear(),this.inputs={})}if(e){let t={};for(let r in e){let n=e[r],s=new h(n),i=s.adapters;this.adapters.add(i),t[r]=s}this.inputs=t}if(t){!function(t){p in t||(t[p]={})}(t);const e=this.inputs;for(let r in e){let{adapters:n}=e[r];for(let e of n){const{deviceName:r,keyCode:n}=e;1===m(t,r,n)&&t.add(r,n)}}this.inputSource!==t&&(t.addEventListener("poll",this.onSourcePoll),t.addEventListener("input",this.onSourceInput),this.inputSource=t)}this.disabled=r}onSourceInput(t){if(t.consumed||this._ignoreInput){const{deviceName:e,keyCode:r,input:n}=t;this.adapters.reset(e,r,n)}else{const{stage:e,deviceName:r,keyCode:n,input:s}=t;switch(e){case f:this.adapters.poll(r,n,s);break;case d:this.adapters.update(r,n,s)}t.consumed=!0}}onSourcePoll(t){this._ignoreInput!==this.disabled&&(this._ignoreInput=this.disabled)}toggle(t=this._disabled){if(t){if(!this.inputSource)throw new Error("Input source must be set before enabling input context.");Object.keys(this.inputs).length<=0&&console.warn("No inputs found for enabled input context - did you forget to setInputMap()?")}return this._disabled=!t,this}getInput(t){return this.inputs[t]}getInputValue(t){return t in this.inputs?this.inputs[t].value:0}},t.IntersectionHelper=Nt,t.IntersectionResolver=Tt,t.IntersectionWorld=St,t.JSONLoader=ot,t.Logger=U,t.Mogli=Ue,t.OBJLoader=ut,t.PriorityQueue=q,t.QuadTree=Gt,t.Random=x,t.RandomGenerator=g,t.SceneGraph=class{constructor(t={}){this.nodeConstructor=t.nodeConstructor||te,this.nodes=new Map,this.rootNodes=[]}add(t,e=null){if(null===t)throw new Error("Cannot add null as child to scene graph.");if(null===e||this.nodes.has(e)){let r=null===e?null:this.nodes.get(e);if(this.nodes.has(t)){let e=this.nodes.get(t);return Jt(e.parentNode,e,this),Qt(r,e,this),e}{let e=new this.nodeConstructor(this,t,null,[]);return this.nodes.set(t,e),Qt(r,e,this),e}}throw new Error("No node in scene graph exists for parent.")}remove(t){if(null===t)return this.clear(),!0;if(this.nodes.has(t)){let e=this.nodes.get(t);return Jt(e.parentNode,e,this),Zt(this,e,0,(t=>{this.nodes.delete(t)})),!0}return!1}replace(t,e){if(null===t)throw new Error("Cannot replace null for child in scene graph.");if(this.nodes.has(t)){let r=this.nodes.get(t),n=r.parentNode,s=[...r.childNodes];if(Jt(n,r,this),r.childNodes.length=0,null===e)null===n?this.rootNodes.push(...s):n.childNodes.push(...s);else{let t;this.nodes.has(e)?(t=this.nodes.get(e),Jt(t.parentNode,t,this),t.childNodes.push(...s)):(t=new this.nodeConstructor(this,e,null,s),this.nodes.set(e,t)),Qt(n,t,this)}for(let t of s)t.parentNode=n;return e}if(null===t)return this.replace(this.root.owner,e);throw new Error("Cannot find target object to replace in scene graph.")}clear(){this.nodes.clear(),this.rootNodes.length=0}get(t){return this.nodes.get(t)}walk(t,e,r={}){const{childrenOnly:n=!0,childrenCallback:s}=r;if(null===t){Kt(this.nodes,this.rootNodes,null,s);for(let t of this.rootNodes)Zt(this,t,0,e,s)}else{const r=this.get(t);if(r)throw new Error("No node in scene graph exists for walk start.");if(n){Kt(this.nodes,r.childNodes,r,s);for(let t of r.childNodes)Zt(this,t,0,e,s)}else Zt(this,r,0,e,s)}}},t.SceneNode=te,t.SimpleRandomGenerator=class extends g{constructor(t=0){super(),this._seed=Math.abs(t%2147483647),this._next=this._seed}next(){return this._next=Math.abs(16807*this._next%2147483647-1),this._next/2147483646}get seed(){return this._seed}set seed(t){this._seed=Math.abs(t%2147483647),this._next=this._seed}},t.SpriteRenderer=class{static get Info(){return Vt}static draw(t,e,r){const n=r?{...Dt,...r}:Dt;for(let r of e){const e=r[Vt],s=$t("x",e,r,n),i=$t("y",e,r,n),o=$t("spriteImage",e,r,n);if(o){const e=o.width,r=o.height;t.translate(s,i);{const n=e/2,s=r/2;t.drawImage(o,-n,-s)}t.translate(-s,-i)}else{const e=10,r=10;t.translate(s,i);{const n=e/2,s=r/2;t.strokeStyle="black",t.strokeRect(-n,-s,e,r),t.textAlign="center",t.textBaseline="middle",t.strokeText("?",0,0,e)}t.translate(-s,-i)}}}},t.TextLoader=rt,t.Uploader=M,t.View=Ve,t.clamp=Y,t.cycle=X,t.direction2=function(t,e,r,n){let s=r-t,i=n-e;return Math.atan2(i,s)},t.distance2=function(t,e,r,n){let s=r-t,i=n-e;return Math.sqrt(s*s+i*i)},t.lerp=function(t,e,r){return t+(e-t)*r},t.lookAt2=function(t,e,r){return Y(t+X(e-t,-Math.PI,Math.PI),t-r,t+r)},t.testAxisAlignedBoundingBox=function(t,e){return!(Math.abs(t.x-e.x)>t.rx+e.rx||Math.abs(t.y-e.y)>t.ry+e.ry)},t.toDegrees=function(t){return t*J},t.toRadians=function(t){return t*Q},t.topoSort=function(t,e){let r=[];for(let n of t){let t=e(n);if(Array.isArray(t))r.push([n,...t]);else if(t)throw new Error("Dependency callback must return an array.")}return function(t,e,r=[]){let n=new Map;for(let t of e)if(t.length>1){let e=t[0],r=t[1];n.has(e)||n.set(e,new Set),n.has(r)||n.set(r,new Set),n.get(e).add(r)}let s={edgeMap:n,index:t.length,visited:new Set,dst:r};for(let e of t)Z(s,e,new Set);return r}(function(t){let e=new Set;for(let r of t)for(let t of r)e.add(t);return Array.from(e)}(r),function(t){let e=[];for(let r of t){let t=r[0];for(let n=1;n<r.length;++n){let s=r[n];e.push([t,s])}}return e}(r))},t.uuid=function t(e){return e?(e^16*Math.random()>>e/4).toString(16):([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,t)},t.withinRadius=function(t,e,r,n,s){const i=t-r,o=e-n;return i*i+o*o<=s*s},Object.defineProperty(t,"__esModule",{value:!0})}));
